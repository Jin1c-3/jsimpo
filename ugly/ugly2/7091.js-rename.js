(function(e){"use strict";var c=v();var o=w();var t=P();var n=b();var r={imagePlaceholder:undefined,cacheBust:false};var y={toSvg:i,toPng:a,toJpeg:l,toBlob:f,toPixelData:u,impl:{fontFaces:t,images:n,util:c,inliner:o,options:{}}};if(typeof module!=="undefined")module.exports=y;else e.domtoimage=y;function i(t,n){n=n||{};s(n);return Promise.resolve(t).then(function(e){return m(e,n.filter,true)}).then(d).then(g).then(e).then(function(e){return p(e,n.width||c.width(t),n.height||c.height(t),n.escapePercentSign)});function e(t){if(n.bgcolor)t.style.backgroundColor=n.bgcolor;if(n.width)t.style.width=n.width+"px";if(n.height)t.style.height=n.height+"px";if(n.style)Object.keys(n.style).forEach(function(e){t.style[e]=n.style[e]});return t}}function u(t,e){return h(t,e||{}).then(function(e){return e.getContext("2d").getImageData(0,0,c.width(t),c.height(t)).data})}function a(e,t){t=t||{};t.escapePercentSign=true;return h(e,t).then(function(e){return e.toDataURL()})}function l(e,t){t=t||{};return h(e,t).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})}function f(e,t){t=t||{};t.escapePercentSign=true;return h(e,t).then(c.canvasToBlob)}function s(e){if(typeof e.imagePlaceholder==="undefined"){y.impl.options.imagePlaceholder=r.imagePlaceholder}else{y.impl.options.imagePlaceholder=e.imagePlaceholder}if(typeof e.cacheBust==="undefined"){y.impl.options.cacheBust=r.cacheBust}else{y.impl.options.cacheBust=e.cacheBust}}function h(n,r){return i(n,r).then(c.makeImage).then(function(e){var t=o(n);t.getContext("2d").drawImage(e,0,0);return t});function o(e){var t=document.createElement("canvas");t.width=r.width||c.width(e);t.height=r.height||c.height(e);if(r.bgcolor){var n=t.getContext("2d");n.fillStyle=r.bgcolor;n.fillRect(0,0,t.width,t.height)}return t}}function m(t,n,e){if(!e&&n&&!n(t))return Promise.resolve();return Promise.resolve(t).then(r).then(function(e){return o(t,e,n)}).then(function(e){return i(t,e)});function r(e){if(e instanceof HTMLCanvasElement)return c.makeImage(e.toDataURL());return e.cloneNode(false)}function o(e,t,n){var r=e.childNodes;if(r.length===0)return Promise.resolve(t);return o(t,c.asArray(r),n).then(function(){return t});function o(t,e,n){var r=Promise.resolve();e.forEach(function(e){r=r.then(function(){return m(e,n)}).then(function(e){if(e)t.appendChild(e)})});return r}}function i(u,a){if(!(a instanceof Element))return a;return Promise.resolve().then(e).then(t).then(n).then(r).then(function(){return a});function e(){e(window.getComputedStyle(u),a.style);function e(e,t){if(e.cssText)t.cssText=e.cssText;else n(e,t);function n(t,n){c.asArray(t).forEach(function(e){n.setProperty(e,t.getPropertyValue(e),t.getPropertyPriority(e))})}}}function t(){[":before",":after"].forEach(function(e){t(e)});function t(e){var t=window.getComputedStyle(u,e);var n=t.getPropertyValue("content");if(n===""||n==="none")return;var r=c.uid();a.className=a.className+" "+r;var o=document.createElement("style");o.appendChild(i(r,e,t));a.appendChild(o);function i(e,t,n){var r="."+e+":"+t;var o=n.cssText?i(n):u(n);return document.createTextNode(r+"{"+o+"}");function i(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function u(t){return c.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}}}function n(){if(u instanceof HTMLTextAreaElement)a.innerHTML=u.value;if(u instanceof HTMLInputElement)a.setAttribute("value",u.value)}function r(){if(!(a instanceof SVGElement))return;a.setAttribute("xmlns","http://www.w3.org/2000/svg");if(!(a instanceof SVGRectElement))return;["width","height"].forEach(function(e){var t=a.getAttribute(e);if(!t)return;a.style.setProperty(e,t)})}}}function d(n){return t.resolveAll().then(function(e){var t=document.createElement("style");n.appendChild(t);t.appendChild(document.createTextNode(e));return n})}function g(e){return n.inlineAll(e).then(function(){return e})}function p(e,t,n,r){return Promise.resolve(e).then(function(e){e.setAttribute("xmlns","http://www.w3.org/1999/xhtml");return(new XMLSerializer).serializeToString(e)}).then(function(e){return c.escapeXhtml(e,r)}).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+n+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})}function v(){return{escape:s,parseExtension:r,mimeType:e,dataAsUrl:f,isDataUrl:t,canvasToBlob:i,resolveUrl:u,getAndEncode:l,uid:a(),delay:h,asArray:m,escapeXhtml:d,makeImage:c,width:g,height:p};function n(){var e="application/font-woff";var t="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:t,jpeg:t,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function r(e){var t=/\.([^\.\/]*?)$/g.exec(e);if(t)return t[1];else return""}function e(e){var t=r(e).toLowerCase();return n()[t]||""}function t(e){return e.search(/^(data:)/)!==-1}function o(i){return new Promise(function(e){var t=window.atob(i.toDataURL().split(",")[1]);var n=t.length;var r=new Uint8Array(n);for(var o=0;o<n;o++)r[o]=t.charCodeAt(o);e(new Blob([r],{type:"image/png"}))})}function i(t){if(t.toBlob)return new Promise(function(e){t.toBlob(e)});return o(t)}function u(e,t){var n=document.implementation.createHTMLDocument();var r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");n.body.appendChild(o);r.href=t;o.href=e;return o.href}function a(){var t=0;return function(){return"u"+e()+t++;function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function c(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){e(n)};n.onerror=t;n.src=r})}function l(a){var c=3e4;if(y.impl.options.cacheBust){a+=(/\?/.test(a)?"&":"?")+(new Date).getTime()}return new Promise(function(n){var e=new XMLHttpRequest;e.onreadystatechange=o;e.ontimeout=i;e.responseType="blob";e.timeout=c;e.open("GET",a,true);e.send();var r;if(y.impl.options.imagePlaceholder){var t=y.impl.options.imagePlaceholder.split(/,/);if(t&&t[1]){r=t[1]}}function o(){if(e.readyState!==4)return;if(e.status!==200){if(r){n(r)}else{u("cannot fetch resource: "+a+", status: "+e.status)}return}var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];n(e)};t.readAsDataURL(e.response)}function i(){if(r){n(r)}else{u("timeout of "+c+"ms occured while fetching resource: "+a)}}function u(e){console.error(e);n("")}})}function f(e,t){return"data:"+t+";base64,"+e}function s(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function h(n){return function(t){return new Promise(function(e){setTimeout(function(){e(t)},n)})}}function m(e){var t=[];var n=e.length;for(var r=0;r<n;r++)t.push(e[r]);return t}function d(e,t){if(t){e=e.replace(/%/g,"%25")}return e.replace(/#/g,"%23").replace(/\n/g,"%0A")}function g(e){var t=v(e,"border-left-width");var n=v(e,"border-right-width");return e.scrollWidth+t+n}function p(e){var t=v(e,"border-top-width");var n=v(e,"border-bottom-width");return e.scrollHeight+t+n}function v(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}}function w(){var r=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:e,shouldProcess:n,impl:{readUrls:i,inline:u}};function n(e){return e.search(r)!==-1}function i(e){var t=[];var n;while((n=r.exec(e))!==null){t.push(n[1])}return t.filter(function(e){return!c.isDataUrl(e)})}function u(t,n,r,e){return Promise.resolve(n).then(function(e){return r?c.resolveUrl(e,r):e}).then(e||c.getAndEncode).then(function(e){return c.dataAsUrl(e,c.mimeType(n))}).then(function(e){return t.replace(o(n),"$1"+e+"$3")});function o(e){return new RegExp("(url\\(['\"]?)("+c.escape(e)+")(['\"]?\\))","g")}}function e(t,r,o){if(e())return Promise.resolve(t);return Promise.resolve(t).then(i).then(function(e){var n=Promise.resolve(t);e.forEach(function(t){n=n.then(function(e){return u(e,t,r,o)})});return n});function e(){return!n(t)}}}function P(){return{resolveAll:e,impl:{readAll:t}};function e(){return t().then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})}function t(){return Promise.resolve(c.asArray(document.styleSheets)).then(t).then(e).then(function(e){return e.map(n)});function e(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return o.shouldProcess(e.style.getPropertyValue("src"))})}function t(e){var n=[];e.forEach(function(t){try{c.asArray(t.cssRules||[]).forEach(n.push.bind(n))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}});return n}function n(n){return{resolve:function e(){var t=(n.parentStyleSheet||{}).href;return o.inlineAll(n.cssText,t)},src:function(){return n.style.getPropertyValue("src")}}}}}function b(){return{inlineAll:r,impl:{newImage:n}};function n(r){return{inline:e};function e(e){if(c.isDataUrl(r.src))return Promise.resolve();return Promise.resolve(r.src).then(e||c.getAndEncode).then(function(e){return c.dataAsUrl(e,c.mimeType(r.src))}).then(function(n){return new Promise(function(e,t){r.onload=e;r.onerror=t;r.src=n})})}}function r(e){if(!(e instanceof Element))return Promise.resolve(e);return t(e).then(function(){if(e instanceof HTMLImageElement)return n(e).inline();else return Promise.all(c.asArray(e.childNodes).map(function(e){return r(e)}))});function t(t){var e=t.style.getPropertyValue("background");if(!e)return Promise.resolve(t);return o.inlineAll(e).then(function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))}).then(function(){return t})}}}})(this);