"use strict";const X_DIM="x";const Y_DIM="y";const Z_DIM="z";const InitialOperationField={transformTranslate:[0,0,0],transformScale:[1,1,1]};const InterpolateMatrix={transformScale:function(t,n,e,o){t[0]=t[0]*n;t[1]=t[1]*n;t[2]=t[2]*n;t[3]=t[3]*n;t[4]=t[4]*e;t[5]=t[5]*e;t[6]=t[6]*e;t[7]=t[7]*e;t[8]=t[8]*o;t[9]=t[9]*o;t[10]=t[10]*o;t[11]=t[11]*o},transformTranslate:function(t,n,e,o){t[12]=t[0]*n+t[4]*e+t[8]*o+t[12];t[13]=t[1]*n+t[5]*e+t[9]*o+t[13];t[14]=t[2]*n+t[6]*e+t[10]*o+t[14];t[15]=t[3]*n+t[7]*e+t[11]*o+t[15]}};const computeNextValLinear=function(t,n,e,o){const r="round"in t;const i=t.round;let c=(o-t.min)/(t.max-t.min);if(!t.extrapolate){c=c>1?1:c<0?0:c}let s=n*(1-c)+e*c;if(r){s=Math.round(i*s)/i}if(!isFinite(s)){s=null}return s};const computeNextValLinearScalar=function(t,n){return computeNextValLinear(t,t.from,t.to,n)};const setNextValAndDetectChange=function(t,n,e,o){if(!o){const r=t[n];t[n]=e;o=o||e!==r}else{t[n]=e}return o};const initIdentity=function(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=0;t[5]=1;t[6]=0;t[7]=0;t[8]=0;t[9]=0;t[10]=1;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1};const computeNextMatrixOperationField=function(t,n,e,o,r){if(t.from[e]!==undefined&&t.to[e]!==undefined){return computeNextValLinear(t,t.from[e],t.to[e],r)}else{return InitialOperationField[n][o]}};const computeTransform=function(t,n,e,o,r,i){const c=o.transform!==undefined?o.transform:o.transform=[{matrix:[]}];const s=c[0].matrix;const a=s[0];const l=s[1];const u=s[2];const f=s[3];const m=s[4];const p=s[5];const d=s[6];const x=s[7];const I=s[8];const M=s[9];const N=s[10];const D=s[11];const y=s[12];const V=s[13];const h=s[14];const F=s[15];if(!i){initIdentity(s)}const O=computeNextMatrixOperationField(t,n,X_DIM,0,e);const S=computeNextMatrixOperationField(t,n,Y_DIM,1,e);const _=computeNextMatrixOperationField(t,n,Z_DIM,2,e);InterpolateMatrix[n](s,O,S,_);if(!r){r=a!==s[0]||l!==s[1]||u!==s[2]||f!==s[3]||m!==s[4]||p!==s[5]||d!==s[6]||x!==s[7]||I!==s[8]||M!==s[9]||N!==s[10]||D!==s[11]||y!==s[12]||V!==s[13]||h!==s[14]||F!==s[15]}return r};const buildStyleInterpolator=function(s){function t(t,n){let e=false;let o=false;for(const r in s){const i=s[r];if(i.type==="linear"){if(r in InterpolateMatrix){e=computeTransform(i,r,n,t,e,o);o=true}else{const c=computeNextValLinearScalar(i,n);e=setNextValAndDetectChange(t,r,c,e)}}else if(i.type==="constant"){const c=i.value;e=setNextValAndDetectChange(t,r,c,e)}else if(i.type==="step"){const c=n>=i.threshold?i.to:i.from;e=setNextValAndDetectChange(t,r,c,e)}else if(i.type==="identity"){const c=n;e=setNextValAndDetectChange(t,r,c,e)}}return e}return t};module.exports=buildStyleInterpolator;