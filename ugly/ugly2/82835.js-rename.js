"use strict";describe("Binder",function(){var l;function o(e,t){return jqLite(e[0].childNodes[t])}beforeEach(function(){this.compileToHtml=function(i){var n;inject(function(e,t){i=jqLite(i);t(i)(e);n=sortedHtml(i)});return n}});afterEach(function(){dealoc(l);dealoc(this.element)});it("BindUpdate",inject(function(e,t){t('<div ng-init="a=123"/>')(e);e.$digest();expect(e.a).toBe(123)}));it("ExecuteInitialization",inject(function(e,t){t('<div ng-init="a=123">')(e);expect(e.a).toBe(123)}));it("ExecuteInitializationStatements",inject(function(e,t){t('<div ng-init="a=123;b=345">')(e);expect(e.a).toBe(123);expect(e.b).toBe(345)}));it("ApplyTextBindings",inject(function(e,t){l=t('<div ng-bind="model.a">x</div>')(e);e.model={a:123};e.$apply();expect(l.text()).toBe("123")}));it("InputTypeButtonActionExecutesInScope",inject(function(e,t){var i=false;l=t('<input type="button" ng-click="person.save()" value="Apply">')(e);e.person={};e.person.save=function(){i=true};browserTrigger(l,"click");expect(i).toBe(true)}));it("InputTypeButtonActionExecutesInScope2",inject(function(e,t){var i="";l=t('<input type="image" ng-click="action()">')(e);e.action=function(){i+="click;"};expect(i).toEqual("");browserTrigger(l,"click");expect(i).toEqual("click;")}));it("ButtonElementActionExecutesInScope",inject(function(e,t){var i=false;l=t('<button ng-click="person.save()">Apply</button>')(e);e.person={};e.person.save=function(){i=true};browserTrigger(l,"click");expect(i).toBe(true)}));it("RepeaterUpdateBindings",inject(function(e,t){var i=t("<ul>"+'<LI ng-repeat="item in model.items" ng-bind="item.a"></LI>'+"</ul>")(e);var n=[{a:"A"},{a:"B"}];e.model={items:n};e.$apply();expect(sortedHtml(i)).toBe("<ul>"+"\x3c!-- ngRepeat: item in model.items --\x3e"+'<li ng-bind="item.a" ng-repeat="item in model.items">A</li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+'<li ng-bind="item.a" ng-repeat="item in model.items">B</li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+"</ul>");n.unshift({a:"C"});e.$apply();expect(sortedHtml(i)).toBe("<ul>"+"\x3c!-- ngRepeat: item in model.items --\x3e"+'<li ng-bind="item.a" ng-repeat="item in model.items">C</li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+'<li ng-bind="item.a" ng-repeat="item in model.items">A</li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+'<li ng-bind="item.a" ng-repeat="item in model.items">B</li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+"</ul>");n.shift();e.$apply();expect(sortedHtml(i)).toBe("<ul>"+"\x3c!-- ngRepeat: item in model.items --\x3e"+'<li ng-bind="item.a" ng-repeat="item in model.items">A</li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+'<li ng-bind="item.a" ng-repeat="item in model.items">B</li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+"</ul>");n.shift();n.shift();e.$apply()}));it("RepeaterContentDoesNotBind",inject(function(e,t){l=t("<ul>"+'<LI ng-repeat="item in model.items"><span ng-bind="item.a"></span></li>'+"</ul>")(e);e.model={items:[{a:"A"}]};e.$apply();expect(sortedHtml(l)).toBe("<ul>"+"\x3c!-- ngRepeat: item in model.items --\x3e"+'<li ng-repeat="item in model.items"><span ng-bind="item.a">A</span></li>'+"\x3c!-- end ngRepeat: item in model.items --\x3e"+"</ul>")}));it("DoNotOverwriteCustomAction",function(){var e=this.compileToHtml('<input type="submit" value="Save" action="foo();">');expect(e.indexOf('action="foo();"')).toBeGreaterThan(0)});it("ItShouldRemoveExtraChildrenWhenIteratingOverHash",inject(function(e,t){l=t('<div><div ng-repeat="i in items">{{i}}</div></div>')(e);var i={};e.items=i;e.$apply();expect(l[0].childNodes.length).toEqual(1);i.name="misko";e.$apply();expect(l[0].childNodes.length).toEqual(3);delete i.name;e.$apply();expect(l[0].childNodes.length).toEqual(1)}));it("IfAttrBindingThrowsErrorDecorateTheAttribute",function(){module(function(e){e.mode("log")});inject(function(e,t,i){i('<div attr="before {{error.throw()}} after"></div>',null,true)(e);var n=t.errors;var a=0;e.error={throw:function(){throw new Error("ErrorMsg"+ ++a)}};e.$apply();expect(n.length).not.toEqual(0);expect(n.shift()).toMatch(/ErrorMsg1/);n.length=0;e.error["throw"]=function(){return"X"};e.$apply();expect(n.length).toMatch("0")})});it("NestedRepeater",inject(function(e,t){l=t("<div>"+'<div ng-repeat="m in model" name="{{m.name}}">'+'<ul name="{{i}}" ng-repeat="i in m.item"></ul>'+"</div>"+"</div>")(e);e.model=[{name:"a",item:["a1","a2"]},{name:"b",item:["b1","b2"]}];e.$apply();expect(sortedHtml(l)).toBe("<div>"+"\x3c!-- ngRepeat: m in model --\x3e"+'<div name="a" ng-repeat="m in model">'+"\x3c!-- ngRepeat: i in m.item --\x3e"+'<ul name="a1" ng-repeat="i in m.item"></ul>'+"\x3c!-- end ngRepeat: i in m.item --\x3e"+'<ul name="a2" ng-repeat="i in m.item"></ul>'+"\x3c!-- end ngRepeat: i in m.item --\x3e"+"</div>"+"\x3c!-- end ngRepeat: m in model --\x3e"+'<div name="b" ng-repeat="m in model">'+"\x3c!-- ngRepeat: i in m.item --\x3e"+'<ul name="b1" ng-repeat="i in m.item"></ul>'+"\x3c!-- end ngRepeat: i in m.item --\x3e"+'<ul name="b2" ng-repeat="i in m.item"></ul>'+"\x3c!-- end ngRepeat: i in m.item --\x3e"+"</div>"+"\x3c!-- end ngRepeat: m in model --\x3e"+"</div>")}));it("HideBindingExpression",inject(function(e,t){l=t('<div ng-hide="hidden === 3"/>')(e);e.hidden=3;e.$apply();assertHidden(l);e.hidden=2;e.$apply();assertVisible(l)}));it("HideBinding",inject(function(e,t){l=t('<div ng-hide="hidden"/>')(e);e.hidden="true";e.$apply();assertHidden(l);e.hidden="false";e.$apply();assertHidden(l);e.hidden=0;e.$apply();assertVisible(l);e.hidden=false;e.$apply();assertVisible(l);e.hidden="";e.$apply();assertVisible(l)}));it("ShowBinding",inject(function(e,t){l=t('<div ng-show="show"/>')(e);e.show="true";e.$apply();assertVisible(l);e.show="false";e.$apply();assertVisible(l);e.show=false;e.$apply();assertHidden(l);e.show=false;e.$apply();assertHidden(l);e.show="";e.$apply();assertHidden(l)}));it("BindClass",inject(function(e,t){l=t('<div ng-class="clazz"/>')(e);e.clazz="testClass";e.$apply();expect(sortedHtml(l)).toBe('<div class="testClass" ng-class="clazz"></div>');e.clazz=["a","b"];e.$apply();expect(sortedHtml(l)).toBe('<div class="a b" ng-class="clazz"></div>')}));it("BindClassEvenOdd",inject(function(e,t){l=t("<div>"+'<div ng-repeat="i in [0,1]" ng-class-even="\'e\'" ng-class-odd="\'o\'"></div>'+"</div>")(e);e.$apply();var i=jqLite(l[0].childNodes[1]);var n=jqLite(l[0].childNodes[3]);expect(i.hasClass("o")).toBeTruthy();expect(n.hasClass("e")).toBeTruthy();expect(sortedHtml(l)).toBe("<div>"+"\x3c!-- ngRepeat: i in [0,1] --\x3e"+'<div class="o" ng-class-even="\'e\'" ng-class-odd="\'o\'" ng-repeat="i in [0,1]"></div>'+"\x3c!-- end ngRepeat: i in [0,1] --\x3e"+'<div class="e" ng-class-even="\'e\'" ng-class-odd="\'o\'" ng-repeat="i in [0,1]"></div>'+"\x3c!-- end ngRepeat: i in [0,1] --\x3e"+"</div>")}));it("BindStyle",inject(function(e,t){l=t('<div ng-style="style"/>')(e);e.$eval('style={height: "10px"}');e.$apply();expect(l.css("height")).toBe("10px");e.$eval("style={}");e.$apply()}));it("ActionOnAHrefThrowsError",function(){module(function(e){e.mode("log")});inject(function(e,t,i){var n=i('<a ng-click="action()">Add Phone</a>')(e);e.action=function(){throw new Error("MyError")};browserTrigger(n,"click");expect(t.errors[0]).toMatch(/MyError/)})});it("ShouldIgnoreVbNonBindable",inject(function(e,t){l=t("<div>{{a}}"+"<div ng-non-bindable>{{a}}</div>"+"<div ng-non-bindable=''>{{b}}</div>"+"<div ng-non-bindable='true'>{{c}}</div>"+"</div>")(e);e.a=123;e.$apply();expect(l.text()).toBe("123{{a}}{{b}}{{c}}")}));it("ShouldTemplateBindPreElements",inject(function(e,t){l=t("<pre>Hello {{name}}!</pre>")(e);e.name="World";e.$apply();expect(sortedHtml(l)).toBe("<pre>Hello World!</pre>")}));it("FillInOptionValueWhenMissing",inject(function(e,t){l=t('<select ng-model="foo">'+'<option selected="true">{{a}}</option>'+'<option value="">{{b}}</option>'+"<option>C</option>"+"</select>")(e);e.a="A";e.b="B";e.$apply();var i=o(l,0);var n=o(l,1);var a=o(l,2);expect(i.attr("value")).toEqual("A");expect(i.text()).toEqual("A");expect(n.attr("value")).toEqual("");expect(n.text()).toEqual("B");expect(a.attr("value")).toEqual("C");expect(a.text()).toEqual("C")}));it("ItShouldSelectTheCorrectRadioBox",inject(function(e,t,i,n){l=t("<div>"+'<input type="radio" ng-model="sex" value="female">'+'<input type="radio" ng-model="sex" value="male">'+"</div>")(e);jqLite(n[0].body).append(i.append(l));var a=jqLite(l[0].childNodes[0]);var o=jqLite(l[0].childNodes[1]);browserTrigger(a);expect(e.sex).toBe("female");expect(a[0].checked).toBe(true);expect(o[0].checked).toBe(false);expect(a.val()).toBe("female");browserTrigger(o);expect(e.sex).toBe("male");expect(a[0].checked).toBe(false);expect(o[0].checked).toBe(true);expect(o.val()).toBe("male")}));it("ItShouldRepeatOnHashes",inject(function(e,t){l=t("<ul>"+'<li ng-repeat="(k,v) in {a:0,b:1}" ng-bind="k + v"></li>'+"</ul>")(e);e.$apply();expect(sortedHtml(l)).toBe("<ul>"+"\x3c!-- ngRepeat: (k,v) in {a:0,b:1} --\x3e"+'<li ng-bind="k + v" ng-repeat="(k,v) in {a:0,b:1}">a0</li>'+"\x3c!-- end ngRepeat: (k,v) in {a:0,b:1} --\x3e"+'<li ng-bind="k + v" ng-repeat="(k,v) in {a:0,b:1}">b1</li>'+"\x3c!-- end ngRepeat: (k,v) in {a:0,b:1} --\x3e"+"</ul>")}));it("ItShouldFireChangeListenersBeforeUpdate",inject(function(e,t){l=t('<div ng-bind="name"></div>')(e);e.name="";e.$watch("watched",function(){e.name=123});e.watched="change";e.$apply();expect(e.name).toBe(123);expect(sortedHtml(l)).toBe('<div ng-bind="name">123</div>')}));it("ItShouldHandleMultilineBindings",inject(function(e,t){l=t("<div>{{\n 1 \n + \n 2 \n}}</div>")(e);e.$apply();expect(l.text()).toBe("3")}))});