"use strict";const Select=require("./select");const highlight=(t,r)=>{let h=t.toLowerCase();return t=>{let e=t.toLowerCase();let s=e.indexOf(h);let i=r(t.slice(s,s+h.length));return s>=0?t.slice(0,s)+i+t.slice(s+h.length):t}};class AutoComplete extends Select{constructor(t){super(t);this.cursorShow()}moveCursor(t){this.state.cursor+=t}dispatch(t){return this.append(t)}space(t){return this.options.multiple?super.space(t):this.append(t)}append(t){let{cursor:e,input:s}=this.state;this.input=s.slice(0,e)+t+s.slice(e);this.moveCursor(1);return this.complete()}delete(){let{cursor:t,input:e}=this.state;if(!e)return this.alert();this.input=e.slice(0,t-1)+e.slice(t);this.moveCursor(-1);return this.complete()}deleteForward(){let{cursor:t,input:e}=this.state;if(e[t]===void 0)return this.alert();this.input=`${e}`.slice(0,t)+`${e}`.slice(t+1);return this.complete()}number(t){return this.append(t)}async complete(){this.completing=true;this.choices=await this.suggest(this.input,this.state._choices);this.state.limit=void 0;this.index=Math.min(Math.max(this.visible.length-1,0),this.index);await this.render();this.completing=false}suggest(t=this.input,e=this.state._choices){if(typeof this.options.suggest==="function"){return this.options.suggest.call(this,t,e)}let s=t.toLowerCase();return e.filter(t=>t.message.toLowerCase().includes(s))}pointer(){return""}format(){if(!this.focused)return this.input;if(this.options.multiple&&this.state.submitted){return this.selected.map(t=>this.styles.primary(t.message)).join(", ")}if(this.state.submitted){let t=this.value=this.input=this.focused.value;return this.styles.primary(t)}return this.input}async render(){if(this.state.status!=="pending")return super.render();let t=this.options.highlight?this.options.highlight.bind(this):this.styles.placeholder;let e=highlight(this.input,t);let s=this.choices;this.choices=s.map(t=>({...t,message:e(t.message)}));await super.render();this.choices=s}submit(){if(this.options.multiple){this.value=this.selected.map(t=>t.name)}return super.submit()}}module.exports=AutoComplete;