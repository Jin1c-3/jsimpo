"use strict";const{mustCall}=require("../common");const assert=require("assert");const http=require("http");const net=require("net");net.createServer(mustCall(function(t){t.write("HTTP/1.1 101 Switching Protocols\r\n"+"Connection: upgrade\r\n"+"Transfer-Encoding: chunked\r\n"+"Upgrade: websocket\r\n"+"\r\n"+"Â€","latin1");this.close()})).listen(0,mustCall(function(){http.get({host:this.address().host,port:this.address().port,headers:{Connection:"upgrade",Upgrade:"websocket"}}).on("upgrade",mustCall((t,e,r)=>{assert.strictEqual(r.length,1);assert.strictEqual(r[0],128);e.destroy()}))}));