"use strict";const semver=require("semver");const url=require("url");const path=require("path");const log=require("npmlog");const headersTarballRange=">= 3.0.0 || ~0.12.10 || ~0.10.42";const bitsre=/\/win-(x86|x64|arm64)\//;const bitsreV3=/\/win-(x86|ia32|x64)\//;function processRelease(r,e,a,l){var s=semver.valid(r[0])&&r[0]||e.opts.target||a;var i=semver.parse(s);var t=e.opts["dist-url"]||e.opts.disturl;var o;var v;var n;var u;var p;var b;var m;var h;var U;var c;if(!i){return{version:s}}s=i.version;o=s===semver.parse(a).version;if(!o){l=null}if(l){n=l.name.replace(/io\.js/,"iojs")}else{v=i.major>=1&&i.major<4;n=v?"iojs":"node"}if(!t&&process.env.NODEJS_ORG_MIRROR){t=process.env.NODEJS_ORG_MIRROR}if(t){log.verbose("download","using dist-url",t)}if(t){u=t.replace(/\/+$/,"")}else{u="https://nodejs.org/dist"}u+="/v"+s+"/";if(l&&l.headersUrl&&!t){p=url.resolve(l.headersUrl,"./");b=resolveLibUrl(n,l.libUrl||p||u,"x86",i.major);m=resolveLibUrl(n,l.libUrl||p||u,"x64",i.major);h=resolveLibUrl(n,l.libUrl||p||u,"arm64",i.major);U=l.headersUrl}else{p=u;b=resolveLibUrl(n,p,"x86",i.major);m=resolveLibUrl(n,p,"x64",i.major);h=resolveLibUrl(n,p,"arm64",i.major);c=semver.satisfies(i,headersTarballRange);U=url.resolve(p,n+"-v"+s+(c?"-headers":"")+".tar.gz")}return{version:s,semver:i,name:n,baseUrl:p,tarballUrl:U,shasumsUrl:url.resolve(p,"SHASUMS256.txt"),versionDir:(n!=="node"?n+"-":"")+s,ia32:{libUrl:b,libPath:normalizePath(path.relative(url.parse(p).path,url.parse(b).path))},x64:{libUrl:m,libPath:normalizePath(path.relative(url.parse(p).path,url.parse(m).path))},arm64:{libUrl:h,libPath:normalizePath(path.relative(url.parse(p).path,url.parse(h).path))}}}function normalizePath(r){return path.normalize(r).replace(/\\/g,"/")}function resolveLibUrl(r,e,a,l){var s=url.resolve(e,"./");var i=bitsre.test(e)||l===3&&bitsreV3.test(e);if(!i){if(l>=1){return url.resolve(s,"win-"+a+"/"+r+".lib")}return url.resolve(s,(a==="x86"?"":a+"/")+r+".lib")}return e.replace(l===3?bitsreV3:bitsre,"/win-"+a+"/")}module.exports=processRelease;