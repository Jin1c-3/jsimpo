var Class=require("../../../utils/Class");var Clamp=require("../../../math/Clamp");var Components=require("../../components");var GameObject=require("../../GameObject");var GetBitmapTextSize=require("../GetBitmapTextSize");var ParseFromAtlas=require("../ParseFromAtlas");var ParseXMLBitmapFont=require("../ParseXMLBitmapFont");var Rectangle=require("../../../geom/rectangle/Rectangle");var Render=require("./BitmapTextRender");var BitmapText=new Class({Extends:GameObject,Mixins:[Components.Alpha,Components.BlendMode,Components.Depth,Components.Mask,Components.Origin,Components.Pipeline,Components.ScrollFactor,Components.Texture,Components.Tint,Components.Transform,Components.Visible,Render],initialize:function t(i,e,n,r,s,a,o){if(s===undefined){s=""}if(o===undefined){o=0}GameObject.call(this,i,"BitmapText");this.font=r;var h=this.scene.sys.cache.bitmapFont.get(r);if(!h){console.warn("Invalid BitmapText key: "+r)}this.fontData=h.data;this._text="";this._fontSize=a||this.fontData.size;this._letterSpacing=0;this._align=o;this._bounds=GetBitmapTextSize();this._dirty=true;this._maxWidth=0;this.wordWrapCharCode=32;this.charColors=[];this.dropShadowX=0;this.dropShadowY=0;this.dropShadowColor=0;this.dropShadowAlpha=.5;this.fromAtlas=h.fromAtlas;this.setTexture(h.texture,h.frame);this.setPosition(e,n);this.setOrigin(0,0);this.initPipeline();this.setText(s)},setLeftAlign:function(){this._align=BitmapText.ALIGN_LEFT;this._dirty=true;return this},setCenterAlign:function(){this._align=BitmapText.ALIGN_CENTER;this._dirty=true;return this},setRightAlign:function(){this._align=BitmapText.ALIGN_RIGHT;this._dirty=true;return this},setFontSize:function(t){this._fontSize=t;this._dirty=true;return this},setLetterSpacing:function(t){if(t===undefined){t=0}this._letterSpacing=t;this._dirty=true;return this},setText:function(t){if(!t&&t!==0){t=""}if(Array.isArray(t)){t=t.join("\n")}if(t!==this.text){this._text=t.toString();this._dirty=true;this.updateDisplayOrigin()}return this},setDropShadow:function(t,i,e,n){if(t===undefined){t=0}if(i===undefined){i=0}if(e===undefined){e=0}if(n===undefined){n=.5}this.dropShadowX=t;this.dropShadowY=i;this.dropShadowColor=e;this.dropShadowAlpha=n;return this},setCharacterTint:function(t,i,e,n,r,s,a){if(t===undefined){t=0}if(i===undefined){i=1}if(e===undefined){e=false}if(n===undefined){n=-1}if(r===undefined){r=n;s=n;a=n}var o=this.text.length;if(i===-1){i=o}if(t<0){t=o+t}t=Clamp(t,0,o-1);var h=Clamp(t+i,t,o);var u=this.charColors;for(var f=t;f<h;f++){var d=u[f];if(n===-1){u[f]=null}else{var l=e?1:0;if(d){d.tintEffect=l;d.tintTL=n;d.tintTR=r;d.tintBL=s;d.tintBR=a}else{u[f]={tintEffect:l,tintTL:n,tintTR:r,tintBL:s,tintBR:a}}}}return this},setWordTint:function(t,i,e,n,r,s,a){if(i===undefined){i=1}var o=this.getTextBounds();var h=o.words;var u=typeof t==="number";var f=0;for(var d=0;d<h.length;d++){var l=h[d];if(u&&d===t||!u&&l.word===t){this.setCharacterTint(l.i,l.word.length,e,n,r,s,a);f++;if(f===i){return this}}}return this},getTextBounds:function(t){var i=this._bounds;if(this._dirty||t||this.scaleX!==i.scaleX||this.scaleY!==i.scaleY){GetBitmapTextSize(this,t,true,i);this._dirty=false}return i},getCharacterAt:function(t,i,e){var n=this.getLocalPoint(t,i,null,e);var r=this.getTextBounds();var s=r.characters;var a=new Rectangle;for(var o=0;o<s.length;o++){var h=s[o];a.setTo(h.x,h.t,h.r-h.x,h.b);if(a.contains(n.x,n.y)){return h}}return null},updateDisplayOrigin:function(){this._dirty=true;this.getTextBounds(false);return this},setFont:function(t,i,e){if(i===undefined){i=this._fontSize}if(e===undefined){e=this._align}if(t!==this.font){var n=this.scene.sys.cache.bitmapFont.get(t);if(n){this.font=t;this.fontData=n.data;this._fontSize=i;this._align=e;this.fromAtlas=n.fromAtlas===true;this.setTexture(n.texture,n.frame);GetBitmapTextSize(this,false,true,this._bounds)}}return this},setMaxWidth:function(t,i){this._maxWidth=t;this._dirty=true;if(i!==undefined){this.wordWrapCharCode=i}return this},align:{set:function(t){this._align=t;this._dirty=true},get:function(){return this._align}},text:{set:function(t){this.setText(t)},get:function(){return this._text}},fontSize:{set:function(t){this._fontSize=t;this._dirty=true},get:function(){return this._fontSize}},letterSpacing:{set:function(t){this._letterSpacing=t;this._dirty=true},get:function(){return this._letterSpacing}},maxWidth:{set:function(t){this._maxWidth=t;this._dirty=true},get:function(){return this._maxWidth}},width:{get:function(){this.getTextBounds(false);return this._bounds.global.width}},height:{get:function(){this.getTextBounds(false);return this._bounds.global.height}},toJSON:function(){var t=Components.ToJSON(this);var i={font:this.font,text:this.text,fontSize:this.fontSize,letterSpacing:this.letterSpacing,align:this.align};t.data=i;return t},preDestroy:function(){this.charColors.length=0;this._bounds=null;this.fontData=null}});BitmapText.ALIGN_LEFT=0;BitmapText.ALIGN_CENTER=1;BitmapText.ALIGN_RIGHT=2;BitmapText.ParseFromAtlas=ParseFromAtlas;BitmapText.ParseXMLBitmapFont=ParseXMLBitmapFont;module.exports=BitmapText;