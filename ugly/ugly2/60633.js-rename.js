var functionToCatch;var lineNumber;function catchLineNumber(){var t={};Error.prepareStackTrace=function(t,o){o.some(function(t){if(t.getFunction()==functionToCatch){lineNumber=t.getLineNumber();return true}return false});return lineNumber};Error.captureStackTrace(t);return t.stack}function log(){catchLineNumber()}function foo(){}function test1(){log(foo()==foo()?"a":"b")}function test2(){var t={foo:function(){}};log(t.foo()==t.foo()?"a":"b")}function test3(){var t={log:log,foo:function(){}};t.log(t.foo()==t.foo()?"a":"b")}function test(t,o){functionToCatch=t;t();assertEquals(o,lineNumber)}test(test1,58);test(test2,65);test(test3,72);eval(test1.toString()+"//@ sourceUrl=foo");eval(test2.toString()+"//@ sourceUrl=foo");eval(test3.toString()+"//@ sourceUrl=foo");test(test1,2);test(test2,3);test(test3,3);