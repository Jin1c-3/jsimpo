define(function(e,n,t){"use strict";var s=e("thirdparty/lodash"),r=e("thirdparty/CodeMirror/lib/codemirror");var o;function f(e){o=null;if(e){e.off("changes",f)}}function u(e,n){if(!o||!o.tokens||o.line!==n||o.cm!==e){var t=e.getLineTokens(n,false);t.unshift(e.getTokenAt({line:n,ch:0},false));o={cm:e,line:n,timeStamp:Date.now(),tokens:t};e.off("changes",f);e.on("changes",f)}return o.tokens}function l(e,n,t){if(t){f();return e.getTokenAt(n,t)}var o=u(e,n.line),i=s.sortedIndex(o,{end:n.ch},"end"),r=o[i];return r||e.getTokenAt(n,t)}function i(e,n){return{editor:e,pos:n,token:e.getTokenAt(n,true)}}function a(e,n){if(n===undefined){n=true}if(e.pos.ch<=0||e.token.start<=0){if(e.pos.line<=0){return false}e.pos.line--;e.pos.ch=e.editor.getLine(e.pos.line).length}else{e.pos.ch=e.token.start}e.token=l(e.editor,e.pos,n);return true}function c(e){return(e.pos.ch<=0||e.token.start<=0)&&e.pos.line<=0}function d(e,n){var t=e.editor.getLine(e.pos.line).length;if(n===undefined){n=true}if(e.pos.ch>=t||e.token.end>=t){if(e.pos.line>=e.editor.lineCount()-1){return false}e.pos.line++;e.pos.ch=0}else{e.pos.ch=e.token.end+1}e.token=l(e.editor,e.pos,n);return true}function p(e){var n=e.editor.getLine(e.pos.line).length;return(e.pos.ch>=n||e.token.end>=n)&&e.pos.line>=e.editor.lineCount()-1}function k(e,n){if(!e(n)){return false}while(!n.token.type&&!/\S/.test(n.token.string)){if(!e(n)){return false}}return true}function h(e){var n=e.pos.ch-e.token.start;if(n<0){console.log("CodeHintUtils: _offsetInToken - Invalid context: pos not in the current token!")}return n}function g(e,n,t){t=t||true;var o=e.getMode(),i;if(o.innerMode){o=r.innerMode(o,l(e,n,t).state).mode}i=o.name==="xml"?o.configuration:o.name;return{mode:o,name:i}}n.getTokenAt=l;n.movePrevToken=a;n.moveNextToken=d;n.isAtStart=c;n.isAtEnd=p;n.moveSkippingWhitespace=k;n.getInitialContext=i;n.offsetInToken=h;n.getModeAt=g});