"use babel";import SelectListView from"atom-select-list";import repositoryForPath from"./helpers";export default class DiffListView{constructor(){this.selectListView=new SelectListView({emptyMessage:"No diffs in file",items:[],filterKeyForItem:e=>e.lineText,elementForItem:e=>{const t=document.createElement("li");t.classList.add("two-lines");const i=document.createElement("div");i.classList.add("primary-line");i.textContent=e.lineText;t.appendChild(i);const s=document.createElement("div");s.classList.add("secondary-line");s.textContent=`-${e.oldStart},${e.oldLines} +${e.newStart},${e.newLines}`;t.appendChild(s);return t},didConfirmSelection:e=>{this.cancel();const t=e.newStart>0?e.newStart-1:e.newStart;this.editor.setCursorBufferPosition([t,0],{autoscroll:true});this.editor.moveToFirstCharacterOfLine()},didCancelSelection:()=>{this.cancel()}});this.selectListView.element.classList.add("diff-list-view");this.panel=atom.workspace.addModalPanel({item:this.selectListView,visible:false})}attach(){this.previouslyFocusedElement=document.activeElement;this.selectListView.reset();this.panel.show();this.selectListView.focus()}cancel(){this.panel.hide();if(this.previouslyFocusedElement){this.previouslyFocusedElement.focus();this.previouslyFocusedElement=null}}destroy(){this.cancel();this.panel.destroy();return this.selectListView.destroy()}async toggle(){const e=atom.workspace.getActiveTextEditor();if(this.panel.isVisible()){this.cancel()}else if(e){this.editor=e;const i=await repositoryForPath(this.editor.getPath());let t=i?i.getLineDiffs(this.editor.getPath(),this.editor.getText()):[];if(!t)t=[];for(let e of t){const s=e.newStart>0?e.newStart-1:e.newStart;const o=this.editor.lineTextForBufferRow(s);e.lineText=o?o.trim():""}await this.selectListView.update({items:t});this.attach()}}}