var app=app||{};(function(){"use strict";var o=function(t,e){t.style.display=e?"":"none"};var l=function(e,t){return[].some.call(document.querySelectorAll(t),function(t){return t===e})};app.AppView=Backbone.View.extend({el:".todoapp",statsTemplate:microtemplate(document.querySelector("#stats-template").innerHTML),events:{"keypress .new-todo":"createOnEnter","click .clear-completed":"clearCompleted","click .toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$(".toggle-all").item(0);this.input=this.$(".new-todo").item(0);this.footer=this.$(".footer").item(0);this.main=this.$(".main").item(0);this.listenTo(app.todos,"add",this.addOne);this.listenTo(app.todos,"reset",this.addAll);this.listenTo(app.todos,"change:completed",this.filterOne);this.listenTo(app.todos,"filter",this.filterAll);this.listenTo(app.todos,"all",this.render);app.todos.fetch({reset:true})},render:function(){var t=app.todos.completed().length;var e=app.todos.remaining().length;var i='[href="#/'+(app.TodoFilter||"")+'"]';if(app.todos.length){o(this.main,true);o(this.footer,true);this.footer.innerHTML=this.statsTemplate({completed:t,remaining:e});[].forEach.call(this.$(".filters li a"),function(t){t.classList.remove("selected");if(l(t,i)){t.classList.add("selected")}})}else{o(this.main,false);o(this.footer,false)}this.allCheckbox.checked=!e},addOne:function(t){var e=new app.TodoView({model:t});document.querySelector(".todo-list").appendChild(e.render().el)},addAll:function(){this.$(".todo-list").item(0).innerHTML="";app.todos.forEach(this.addOne,this)},filterOne:function(t){t.trigger("visible")},filterAll:function(){app.todos.forEach(this.filterOne,this)},newAttributes:function(){return{title:this.input.value.trim(),order:app.todos.nextOrder(),completed:false}},createOnEnter:function(t){if(t.which!==ENTER_KEY||!this.input.value.trim()){return}app.todos.create(this.newAttributes());this.input.value=""},clearCompleted:function(){app.todos.completed().forEach(function(t){t.destroy()});return false},toggleAllComplete:function(){var e=this.allCheckbox.checked;app.todos.forEach(function(t){t.save({completed:e})})}})})();