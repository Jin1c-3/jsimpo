"use strict";const Select=require("./select");const Form=require("./form");const form=Form.prototype;class Editable extends Select{constructor(e){super({...e,multiple:true});this.align=[this.options.align,"left"].find(e=>e!=null);this.emptyError="";this.values={}}dispatch(e,t){let i=this.focused;let r=i.parent||{};if(!i.editable&&!r.editable){if(e==="a"||e==="i")return super[e]()}return form.dispatch.call(this,e,t)}append(e,t){return form.append.call(this,e,t)}delete(e,t){return form.delete.call(this,e,t)}space(e){return this.focused.editable?this.append(e):super.space()}number(e){return this.focused.editable?this.append(e):super.number(e)}next(){return this.focused.editable?form.next.call(this):super.next()}prev(){return this.focused.editable?form.prev.call(this):super.prev()}async indicator(e,t){let i=e.indicator||"";let r=e.editable?i:super.indicator(e,t);return await this.resolve(r,this.state,e,t)||""}indent(e){return e.role==="heading"?"":e.editable?" ":"  "}async renderChoice(e,t){e.indent="";if(e.editable)return form.renderChoice.call(this,e,t);return super.renderChoice(e,t)}error(){return""}footer(){return this.state.error}async validate(){let i=true;for(let t of this.choices){if(typeof t.validate!=="function"){continue}if(t.role==="heading"){continue}let e=t.parent?this.value[t.parent.name]:this.value;if(t.editable){e=t.value===t.name?t.initial||"":t.value}else if(!this.isDisabled(t)){e=t.enabled===true}i=await t.validate(e,this.state);if(i!==true){break}}if(i!==true){this.state.error=typeof i==="string"?i:"Invalid Input"}return i}submit(){if(this.focused.newChoice===true)return super.submit();if(this.choices.some(e=>e.newChoice)){return this.alert()}this.value={};for(let t of this.choices){let e=t.parent?this.value[t.parent.name]:this.value;if(t.role==="heading"){this.value[t.name]={};continue}if(t.editable){e[t.name]=t.value===t.name?t.initial||"":t.value}else if(!this.isDisabled(t)){e[t.name]=t.enabled===true}}return this.base.submit.call(this)}}module.exports=Editable;