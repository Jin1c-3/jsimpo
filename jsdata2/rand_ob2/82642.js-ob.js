const _0x35f5 = [
    'Edit\x20Test',
    'subscriber.added',
    'https://example.com/new-subscriber',
    'ignore_me',
    'Can\x20delete\x20a\x20webhook',
    'DataGenerator',
    'webhook',
    'del',
    'empty',
    '31SQaNEN',
    '10597FCzZau',
    '1ThVjwj',
    '1059594rckAjF',
    '1013659yLUnUQ',
    '1040165znqCyf',
    '731125RfMIkr',
    '924757XcLsYW',
    '1GMnnaC',
    '95763oJqDmw',
    'should',
    'supertest',
    '../../utils',
    '../../../core/shared/config',
    './utils',
    'Webhooks\x20API',
    'startGhost',
    'get',
    'url',
    'doAuth',
    'integrations',
    'test.create',
    'test',
    'thisissecret',
    'Content',
    'post',
    'API',
    'getApiQuery',
    'webhooks/',
    'set',
    'Origin',
    'send',
    'expect',
    'Content-Type',
    'cacheRules',
    'private',
    'body',
    'exist',
    'webhooks',
    'checkResponse',
    'event',
    'target_url',
    'equal',
    'secret',
    'name',
    'api_version',
    'integration_id',
    'not',
    'location',
    'Cache-Control',
    'fake-integration',
    'errors',
    'type',
    'context',
    'Validation\x20failed\x20for\x20\x27integration_id\x27.\x20\x27integration_id\x27\x20value\x20does\x20not\x20match\x20any\x20existing\x20integration.',
    'integrations/',
    'Testing',
    'site.changed',
    'https://example.com/rebuild',
    'put'
];
function _0x340b(_0x3dc96b, _0x553231) {
    return _0x340b = function (_0x35f5f4, _0x340b0a) {
        _0x35f5f4 = _0x35f5f4 - 0xb8;
        let _0x367cbb = _0x35f5[_0x35f5f4];
        return _0x367cbb;
    }, _0x340b(_0x3dc96b, _0x553231);
}
const _0x474b72 = _0x340b;
(function (_0x30a1c4, _0x35a3d3) {
    const _0x1530ec = _0x340b;
    while (!![]) {
        try {
            const _0x18ebbc = parseInt(_0x1530ec(0xb8)) * -parseInt(_0x1530ec(0xb9)) + -parseInt(_0x1530ec(0xba)) * parseInt(_0x1530ec(0xbb)) + parseInt(_0x1530ec(0xbc)) + parseInt(_0x1530ec(0xbd)) + -parseInt(_0x1530ec(0xbe)) + -parseInt(_0x1530ec(0xbf)) * -parseInt(_0x1530ec(0xc0)) + -parseInt(_0x1530ec(0xc1));
            if (_0x18ebbc === _0x35a3d3)
                break;
            else
                _0x30a1c4['push'](_0x30a1c4['shift']());
        } catch (_0x4bcb08) {
            _0x30a1c4['push'](_0x30a1c4['shift']());
        }
    }
}(_0x35f5, 0xba6c8));
const should = require(_0x474b72(0xc2)), supertest = require(_0x474b72(0xc3)), testUtils = require(_0x474b72(0xc4)), config = require(_0x474b72(0xc5)), localUtils = require(_0x474b72(0xc6));
describe(_0x474b72(0xc7), function () {
    const _0x43219d = _0x474b72;
    let _0x2c8170;
    const _0x35b8b5 = 'canary';
    before(async function () {
        const _0x3a860a = _0x340b;
        await testUtils[_0x3a860a(0xc8)](), _0x2c8170 = supertest['agent'](config[_0x3a860a(0xc9)](_0x3a860a(0xca))), await localUtils[_0x3a860a(0xcb)](_0x2c8170, _0x3a860a(0xcc));
    }), it('Can\x20create\x20a\x20webhook', async function () {
        const _0x30065c = _0x340b, _0x8848c4 = {
                'event': _0x30065c(0xcd),
                'target_url': 'http://example.com/webhooks/test/extra/1',
                'name': _0x30065c(0xce),
                'secret': _0x30065c(0xcf),
                'api_version': _0x35b8b5,
                'integration_id': testUtils['DataGenerator'][_0x30065c(0xd0)][_0x30065c(0xcc)][0x0]['id']
            }, _0x54d553 = await _0x2c8170[_0x30065c(0xd1)](localUtils[_0x30065c(0xd2)][_0x30065c(0xd3)](_0x30065c(0xd4)))[_0x30065c(0xd5)](_0x30065c(0xd6), config[_0x30065c(0xc9)](_0x30065c(0xca)))[_0x30065c(0xd7)]({ 'webhooks': [_0x8848c4] })[_0x30065c(0xd8)](_0x30065c(0xd9), /json/)['expect']('Cache-Control', testUtils[_0x30065c(0xda)][_0x30065c(0xdb)])['expect'](0xc9), _0x540119 = _0x54d553[_0x30065c(0xdc)];
        should[_0x30065c(0xdd)](_0x540119[_0x30065c(0xde)]), localUtils['API'][_0x30065c(0xdf)](_0x540119[_0x30065c(0xde)][0x0], 'webhook'), _0x540119['webhooks'][0x0][_0x30065c(0xe0)][_0x30065c(0xc2)]['equal'](_0x8848c4['event']), _0x540119[_0x30065c(0xde)][0x0][_0x30065c(0xe1)][_0x30065c(0xc2)][_0x30065c(0xe2)](_0x8848c4[_0x30065c(0xe1)]), _0x540119['webhooks'][0x0][_0x30065c(0xe3)][_0x30065c(0xc2)][_0x30065c(0xe2)](_0x8848c4[_0x30065c(0xe3)]), _0x540119[_0x30065c(0xde)][0x0]['name'][_0x30065c(0xc2)][_0x30065c(0xe2)](_0x8848c4[_0x30065c(0xe4)]), _0x540119[_0x30065c(0xde)][0x0][_0x30065c(0xe5)][_0x30065c(0xc2)][_0x30065c(0xe2)](_0x8848c4['api_version']), _0x540119[_0x30065c(0xde)][0x0][_0x30065c(0xe6)]['should'][_0x30065c(0xe2)](_0x8848c4['integration_id']), should[_0x30065c(0xe7)]['exist'](_0x54d553['headers'][_0x30065c(0xe8)]), await _0x2c8170[_0x30065c(0xd1)](localUtils[_0x30065c(0xd2)][_0x30065c(0xd3)](_0x30065c(0xd4)))[_0x30065c(0xd5)](_0x30065c(0xd6), config[_0x30065c(0xc9)]('url'))[_0x30065c(0xd7)]({ 'webhooks': [_0x8848c4] })['expect'](_0x30065c(0xd9), /json/)[_0x30065c(0xd8)](_0x30065c(0xe9), testUtils[_0x30065c(0xda)]['private'])[_0x30065c(0xd8)](0x1a6);
    }), it('Fails\x20nicely\x20when\x20creating\x20an\x20orphaned\x20webhook', async function () {
        const _0xe6d469 = _0x340b, _0x37044e = {
                'event': 'test.create',
                'target_url': 'http://example.com/webhooks/test/extra/10',
                'name': _0xe6d469(0xce),
                'secret': 'thisissecret',
                'api_version': _0x35b8b5,
                'integration_id': _0xe6d469(0xea)
            }, _0x376f00 = await _0x2c8170['post'](localUtils['API'][_0xe6d469(0xd3)](_0xe6d469(0xd4)))['set'](_0xe6d469(0xd6), config[_0xe6d469(0xc9)](_0xe6d469(0xca)))[_0xe6d469(0xd7)]({ 'webhooks': [_0x37044e] })[_0xe6d469(0xd8)](_0xe6d469(0xd9), /json/)[_0xe6d469(0xd8)](_0xe6d469(0xe9), testUtils['cacheRules'][_0xe6d469(0xdb)])[_0xe6d469(0xd8)](0x1a6), _0x437a44 = _0x376f00[_0xe6d469(0xdc)];
        should['exist'](_0x437a44[_0xe6d469(0xeb)]), _0x437a44['errors'][0x0][_0xe6d469(0xec)][_0xe6d469(0xc2)]['equal']('ValidationError'), _0x437a44['errors'][0x0][_0xe6d469(0xed)][_0xe6d469(0xc2)][_0xe6d469(0xe2)](_0xe6d469(0xee));
    }), it('Can\x20edit\x20a\x20webhook', async function () {
        const _0x2b7021 = _0x340b;
        let _0x5f25df, _0x559fdd;
        const _0x3d9876 = await _0x2c8170[_0x2b7021(0xd1)](localUtils[_0x2b7021(0xd2)]['getApiQuery'](_0x2b7021(0xef)))[_0x2b7021(0xd5)](_0x2b7021(0xd6), config['get'](_0x2b7021(0xca)))[_0x2b7021(0xd7)]({ 'integrations': [{ 'name': 'Rubbish\x20Integration\x20Name' }] })[_0x2b7021(0xd8)](0xc9);
        [_0x5f25df] = _0x3d9876['body'][_0x2b7021(0xcc)];
        const _0x55e281 = await _0x2c8170['post'](localUtils['API'][_0x2b7021(0xd3)](_0x2b7021(0xd4)))['set']('Origin', config[_0x2b7021(0xc9)](_0x2b7021(0xca)))['send']({
            'webhooks': [{
                    'name': _0x2b7021(0xf0),
                    'event': _0x2b7021(0xf1),
                    'target_url': _0x2b7021(0xf2),
                    'integration_id': _0x5f25df['id']
                }]
        })[_0x2b7021(0xd8)](0xc9);
        [_0x559fdd] = _0x55e281[_0x2b7021(0xdc)][_0x2b7021(0xde)];
        const _0x4a8d78 = await _0x2c8170[_0x2b7021(0xf3)](localUtils[_0x2b7021(0xd2)]['getApiQuery'](_0x2b7021(0xd4) + _0x559fdd['id'] + '/'))[_0x2b7021(0xd5)]('Origin', config[_0x2b7021(0xc9)](_0x2b7021(0xca)))[_0x2b7021(0xd7)]({
                'webhooks': [{
                        'name': _0x2b7021(0xf4),
                        'event': _0x2b7021(0xf5),
                        'target_url': _0x2b7021(0xf6),
                        'integration_id': _0x2b7021(0xf7)
                    }]
            })['expect'](0xc8)[_0x2b7021(0xd8)]('Content-Type', /json/)[_0x2b7021(0xd8)]('Cache-Control', testUtils['cacheRules'][_0x2b7021(0xdb)]), [_0x48d0de] = _0x4a8d78[_0x2b7021(0xdc)][_0x2b7021(0xde)];
        should[_0x2b7021(0xe2)](_0x48d0de['id'], _0x559fdd['id']), should[_0x2b7021(0xe2)](_0x48d0de[_0x2b7021(0xe4)], _0x2b7021(0xf4)), should[_0x2b7021(0xe2)](_0x48d0de[_0x2b7021(0xe0)], _0x2b7021(0xf5)), should[_0x2b7021(0xe2)](_0x48d0de[_0x2b7021(0xe1)], _0x2b7021(0xf6)), should[_0x2b7021(0xe2)](_0x48d0de[_0x2b7021(0xe6)], _0x5f25df['id']);
    }), it(_0x43219d(0xf8), async function () {
        const _0x17d351 = _0x43219d, _0x330793 = {
                'event': _0x17d351(0xcd),
                'target_url': 'http://example.com/webhooks/test/2',
                'integration_id': testUtils[_0x17d351(0xf9)][_0x17d351(0xd0)][_0x17d351(0xcc)][0x0]['id']
            }, _0x21db0e = await _0x2c8170['post'](localUtils[_0x17d351(0xd2)][_0x17d351(0xd3)](_0x17d351(0xd4)))[_0x17d351(0xd5)]('Origin', config[_0x17d351(0xc9)]('url'))['send']({ 'webhooks': [_0x330793] })[_0x17d351(0xd8)](_0x17d351(0xd9), /json/)['expect'](_0x17d351(0xe9), testUtils[_0x17d351(0xda)][_0x17d351(0xdb)])[_0x17d351(0xd8)](0xc9), _0x58a68c = _0x21db0e[_0x17d351(0xdc)];
        should[_0x17d351(0xdd)](_0x58a68c[_0x17d351(0xde)]), localUtils['API']['checkResponse'](_0x58a68c[_0x17d351(0xde)][0x0], _0x17d351(0xfa)), _0x58a68c['webhooks'][0x0]['event']['should'][_0x17d351(0xe2)](_0x330793[_0x17d351(0xe0)]), _0x58a68c[_0x17d351(0xde)][0x0][_0x17d351(0xe1)][_0x17d351(0xc2)][_0x17d351(0xe2)](_0x330793[_0x17d351(0xe1)]);
        const _0x5735af = await _0x2c8170[_0x17d351(0xfb)](localUtils[_0x17d351(0xd2)][_0x17d351(0xd3)](_0x17d351(0xd4) + _0x58a68c[_0x17d351(0xde)][0x0]['id'] + '/'))[_0x17d351(0xd5)](_0x17d351(0xd6), config['get'](_0x17d351(0xca)))[_0x17d351(0xd8)](0xcc);
        _0x5735af['body'][_0x17d351(0xc2)]['be'][_0x17d351(0xfc)]();
    });
});
