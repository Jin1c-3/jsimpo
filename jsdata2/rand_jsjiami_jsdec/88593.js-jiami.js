const uuid=require('uuid');const {encode,decode}=require('arson');const {MESSAGE,RESPONSE,PING,PONG}=require('./types.js');const hasOwn=Object['prototype']['hasOwnProperty'];Object['assign'](exports,{'enable'(_0x46c862){var _0xcc67af={'zOZrd':'Error sending message:','nQDjG':function(_0x1f109a,_0x496a37){return _0x1f109a!==_0x496a37;},'UkPSK':'HTVGo','MkvhG':'YdjND','Pgzte':'RAShn','qsGuk':function(_0x27d300,_0x2573ae){return _0x27d300!==_0x2573ae;},'jGStS':'EPIPE','SnSTd':'yYFYS','xpOij':function(_0x143a08,_0x9a2f87){return _0x143a08!==_0x9a2f87;},'tVrpB':function(_0xbddcf9,_0x54afba){return _0xbddcf9===_0x54afba;},'TNUSv':'function','NErWN':'vbxPf','MnhCi':'FRaLR','uGhDa':function(_0x5b963c){return _0x5b963c();},'wWnxo':function(_0x18f6d1,_0x312ac7){return _0x18f6d1(_0x312ac7);},'MfpDO':'XbBQT','ZRsdq':'cHRyi','OqNxx':'dccNY','dLpFH':'ptDsZ','ZnrJR':'xATAn','VtsdO':function(_0x1a1570,_0x1a9e5b){return _0x1a1570(_0x1a9e5b);},'VVcOh':'encodedError','nVien':function(_0x5b7656,_0x1203f9){return _0x5b7656(_0x1203f9);},'ZtGOD':'bOgRP','OIWTx':function(_0xed80c4,_0x46a2bd){return _0xed80c4===_0x46a2bd;},'Xletj':'slirv','nWABa':'OeLTb','TenUw':function(_0xc46ed6,_0x3a1b6c){return _0xc46ed6(_0x3a1b6c);},'Ujekx':'cgOmW','XWAwf':'lMDSq','PqXml':function(_0x23bcf6){return _0x23bcf6();},'zdIrW':function(_0x36235f,_0x4c4f0e){return _0x36235f===_0x4c4f0e;},'UhZVx':'pROWX','RgOqC':function(_0x46be08,_0x32d299,_0x20d99b){return _0x46be08(_0x32d299,_0x20d99b);},'IAGKa':'process exited','TDoFp':'message','cZSQd':'exit'};if(_0xcc67af['zdIrW'](typeof _0x46c862['onMessage'],_0xcc67af['TNUSv'])&&typeof _0x46c862['sendMessage']==='function'){return _0x46c862;}const _0x5c72e7=new Map();_0x46c862['onMessage']=function onMessage(_0x41ee78,_0x385bfa){if(_0xcc67af['nQDjG'](_0xcc67af['UkPSK'],_0xcc67af['MkvhG'])){if(!_0x5c72e7['has'](_0x41ee78)){if(_0xcc67af['nQDjG'](_0xcc67af['Pgzte'],'QUGDt')){_0x5c72e7['set'](_0x41ee78,new Set());}else{serializable[key]=error[key];}}_0x5c72e7['get'](_0x41ee78)['add'](_0x385bfa);}else{console['error'](_0xcc67af['zOZrd'],error);}};const _0x3a8bae=new Map();const _0x969d4b=new Map();const _0xdeb3f2=new Map();const _0x33a9c5=Object['create'](null);function _0x57edd4(_0x5130b2){if(_0x5130b2&&_0xcc67af['qsGuk'](_0x5130b2['code'],_0xcc67af['jGStS'])){console['error'](_0xcc67af['zOZrd'],_0x5130b2);}}_0x33a9c5[PING]=function({id}){if(_0xcc67af['SnSTd']!=='xpXFy'){_0x46c862['send']({'type':PONG,'id':id},_0x57edd4);}else{return _0x46c862;}};_0x33a9c5[PONG]=function({id}){const _0x259e37=_0x3a8bae['get'](id);if(_0xcc67af['tVrpB'](typeof _0x259e37,_0xcc67af['TNUSv'])){if(_0xcc67af['NErWN']!==_0xcc67af['MnhCi']){_0x3a8bae['delete'](id);_0xcc67af['uGhDa'](_0x259e37);}else{if(error&&_0xcc67af['xpOij'](error['code'],'EPIPE')){console['error'](_0xcc67af['zOZrd'],error);}}}};_0x33a9c5[MESSAGE]=function({responseId,topic,encodedPayload}){var _0x149a02={'yytNM':function(_0x588484,_0x4b8b65){return _0x588484>_0x4b8b65;},'UxhMi':function(_0x1dccbf,_0x568085){return _0x1dccbf!==_0x568085;},'FoduN':_0xcc67af['dLpFH'],'lCLpc':function(_0x512b83,_0x442eb5){return _0xcc67af['tVrpB'](_0x512b83,_0x442eb5);},'XKvAP':_0xcc67af['ZnrJR']};const _0x1d4267=(_0xdeb3f2['get'](topic)||Promise['resolve']())['then'](()=>{const _0x56f79f=[];const _0xe87e6e=_0x5c72e7['get'](topic);if(_0xe87e6e&&_0x149a02['yytNM'](_0xe87e6e['size'],0x0)){if(_0x149a02['UxhMi']('XRktR',_0x149a02['FoduN'])){_0xe87e6e['forEach'](_0x594911=>_0x56f79f['push'](_0x594911(decode(encodedPayload))));return Promise['all'](_0x56f79f);}else{_0x46c862['send']({'type':PONG,'id':id},_0x57edd4);}}return _0x56f79f;})['then'](_0xe33ff8=>{var _0x59eb2b={'VvERP':function(_0x17180e,_0x4ae3a5){return _0xcc67af['wWnxo'](_0x17180e,_0x4ae3a5);}};if(responseId){if(_0xcc67af['MfpDO']===_0xcc67af['ZRsdq']){entry['reject'](_0x59eb2b['VvERP'](decode,message['encodedError']));}else{_0x46c862['send']({'type':RESPONSE,'responseId':responseId,'encodedResults':encode(_0xe33ff8)},_0x57edd4);}}},_0x4da07f=>{var _0x16d823={'ybDbV':function(_0x28a7b0,_0x55b749){return _0xcc67af['wWnxo'](_0x28a7b0,_0x55b749);}};if(_0xcc67af['tVrpB']('dccNY',_0xcc67af['OqNxx'])){const _0x46ae21={};Reflect['ownKeys'](_0x4da07f)['forEach'](_0x335159=>{if(_0x149a02['lCLpc'](_0x149a02['XKvAP'],_0x149a02['XKvAP'])){_0x46ae21[_0x335159]=_0x4da07f[_0x335159];}else{if(responseId){_0x46c862['send']({'type':RESPONSE,'responseId':responseId,'encodedResults':_0x16d823['ybDbV'](encode,results)},_0x57edd4);}}});_0x46c862['send']({'type':RESPONSE,'responseId':responseId,'encodedError':_0xcc67af['wWnxo'](encode,_0x46ae21)},_0x57edd4);}else{_0x5c72e7['set'](topic,new Set());}});_0xdeb3f2['set'](topic,_0x1d4267);};_0x33a9c5[RESPONSE]=function(_0x3c51cf){if(_0xcc67af['ZtGOD']==='bOgRP'){const _0x390911=_0x969d4b['get'](_0x3c51cf['responseId']);if(_0x390911){if(_0xcc67af['OIWTx']('slirv',_0xcc67af['Xletj'])){if(hasOwn['call'](_0x3c51cf,_0xcc67af['VVcOh'])){_0x390911['reject'](_0xcc67af['nVien'](decode,_0x3c51cf['encodedError']));}else{if(_0xcc67af['OIWTx'](_0xcc67af['nWABa'],'oFdLT')){setTimeout(poll,delay_ms);delay_ms*=backoff_factor;}else{_0x390911['resolve'](_0xcc67af['TenUw'](decode,_0x3c51cf['encodedResults']));}}}else{_0xcc67af['VtsdO'](reject,error);}}}else{if(hasOwn['call'](_0x3c51cf,_0xcc67af['VVcOh'])){entry['reject'](_0xcc67af['nVien'](decode,_0x3c51cf['encodedError']));}else{entry['resolve'](decode(_0x3c51cf['encodedResults']));}}};_0x46c862['on'](_0xcc67af['TDoFp'],_0x7d41dd=>{const _0x58edf5=_0x33a9c5[_0x7d41dd['type']];if(typeof _0x58edf5===_0xcc67af['TNUSv']){_0xcc67af['TenUw'](_0x58edf5,_0x7d41dd);}});_0x46c862['sendMessage']=function sendMessage(_0x4123ca,_0x679ee5){var _0x55ee00={'ufckP':function(_0xffed79,_0x115705){return _0xcc67af['TenUw'](_0xffed79,_0x115705);}};_0x46c862['readyForMessages']=_0x46c862['readyForMessages']||_0xcc67af['PqXml'](_0x2772a0);return _0x46c862['readyForMessages']['then'](()=>{var _0x1ee885={'LMDjF':function(_0x33efd1,_0xbfa21b){return _0x33efd1(_0xbfa21b);},'lMxNd':function(_0xc33d80,_0x430b7d){return _0xc33d80!==_0x430b7d;},'vjAkM':_0xcc67af['Ujekx']};if(_0xcc67af['XWAwf']===_0xcc67af['XWAwf']){const _0xdeac84=_0xcc67af['uGhDa'](uuid);return new Promise((_0x35981b,_0x1d98d2)=>{_0x969d4b['set'](_0xdeac84,{'resolve':_0x35981b,'reject':_0x1d98d2});_0x46c862['send']({'type':MESSAGE,'responseId':_0xdeac84,'topic':_0x4123ca,'encodedPayload':_0x55ee00['ufckP'](encode,_0x679ee5)},_0x10fd5a=>{if(_0x10fd5a){_0x1ee885['LMDjF'](_0x1d98d2,_0x10fd5a);}});})['then'](_0x225aff=>{if(_0x1ee885['lMxNd'](_0x1ee885['vjAkM'],'nvvDO')){_0x969d4b['delete'](_0xdeac84);return _0x225aff;}else{_0x969d4b['delete'](_0xdeac84);throw error;}},_0x118f53=>{_0x969d4b['delete'](_0xdeac84);throw _0x118f53;});}else{if(!_0x5c72e7['has'](_0x4123ca)){_0x5c72e7['set'](_0x4123ca,new Set());}_0x5c72e7['get'](_0x4123ca)['add'](callback);}});};function _0x2772a0(){var _0x3d75b0={'QrhiI':'jXOWD','MmljF':function(_0x5847f3,_0xeec358,_0xe33fbe){return _0xcc67af['RgOqC'](_0x5847f3,_0xeec358,_0xe33fbe);},'wZtDr':_0xcc67af['VVcOh'],'WxlEY':function(_0xbe4d48,_0x3f93f6){return _0xcc67af['TenUw'](_0xbe4d48,_0x3f93f6);},'HctDM':function(_0x2a330b,_0x43bee6){return _0x2a330b===_0x43bee6;},'JbxcI':'BMVIl','WJdHv':_0xcc67af['TNUSv'],'vQMVY':function(_0xa242fb){return _0xcc67af['PqXml'](_0xa242fb);}};return new Promise((_0x668745,_0x1da9a6)=>{if(_0xcc67af['zdIrW'](_0xcc67af['UhZVx'],'pROWX')){const _0x15d6df={'type':PING,'id':uuid()};const _0x21310e=1.1;let _0x5822a1=0x32;_0x3a8bae['set'](_0x15d6df['id'],_0x668745);function _0x294a17(){var _0x3da279={'PghMy':function(_0x300ccb,_0x23c9b8,_0x1ca2c1){return _0x300ccb(_0x23c9b8,_0x1ca2c1);},'gXrya':function(_0x3d5b74,_0xe05c6){return _0x3d5b74(_0xe05c6);},'gSvFD':_0x3d75b0['QrhiI'],'sTOPx':function(_0x4205e6,_0x5d6115,_0x28459e){return _0x3d75b0['MmljF'](_0x4205e6,_0x5d6115,_0x28459e);},'AQdfc':_0x3d75b0['wZtDr'],'khefs':function(_0x4f04bb,_0x251b9e){return _0x3d75b0['WxlEY'](_0x4f04bb,_0x251b9e);}};if(_0x3d75b0['HctDM'](_0x3d75b0['JbxcI'],_0x3d75b0['JbxcI'])){if(_0x3a8bae['has'](_0x15d6df['id'])){_0x46c862['send'](_0x15d6df,_0x3bca22=>{var _0x1465eb={'JBzSD':function(_0x5b0d1d,_0x475d21){return _0x3da279['gXrya'](_0x5b0d1d,_0x475d21);}};if(_0x3da279['gSvFD']==='jXOWD'){if(_0x3bca22){if('gpFMg'!=='LKsqP'){_0x1da9a6(_0x3bca22);}else{_0x46c862['send']({'type':RESPONSE,'responseId':responseId,'encodedResults':_0x1465eb['JBzSD'](encode,results)},_0x57edd4);}}else{_0x3da279['sTOPx'](setTimeout,_0x294a17,_0x5822a1);_0x5822a1*=_0x21310e;}}else{if(_0x3bca22){_0x1da9a6(_0x3bca22);}else{_0x3da279['PghMy'](setTimeout,_0x294a17,_0x5822a1);_0x5822a1*=_0x21310e;}}});}}else{const _0x38ba25=_0x969d4b['get'](message['responseId']);if(_0x38ba25){if(hasOwn['call'](message,_0x3da279['AQdfc'])){_0x38ba25['reject'](_0x3da279['khefs'](decode,message['encodedError']));}else{_0x38ba25['resolve'](_0x3da279['khefs'](decode,message['encodedResults']));}}}}_0xcc67af['PqXml'](_0x294a17);}else{const _0x501e82=_0x3a8bae['get'](id);if(typeof _0x501e82===_0x3d75b0['WJdHv']){_0x3a8bae['delete'](id);_0x3d75b0['vQMVY'](_0x501e82);}}});}_0x46c862['on'](_0xcc67af['cZSQd'],(_0x174fc4,_0x561ca6)=>{const _0x2d299e=new Error(_0xcc67af['IAGKa']);Object['assign'](_0x2d299e,{'code':_0x174fc4,'signal':_0x561ca6});_0x969d4b['forEach'](_0x83c031=>_0x83c031['reject'](_0x2d299e));_0x46c862['readyForMessages']=Promise['reject'](_0x2d299e);_0x46c862['readyForMessages']['catch'](()=>{});});return _0x46c862;},'onMessage'(_0x3bcd81,_0x196f41){}});if(typeof process['send']==='function'){exports['enable'](process);exports['onMessage']=process['onMessage'];}