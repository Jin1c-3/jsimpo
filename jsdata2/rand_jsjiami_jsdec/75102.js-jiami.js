import{Meteor}from'meteor/meteor';import{SyncedCron}from'meteor/littledata:synced-cron';import{updateUserTokenpassBalances}from'./functions/updateUserTokenpassBalances';import{Tokenpass}from'./Tokenpass';import{Rooms,Subscriptions,Users}from'../../models';import{removeUserFromRoom}from'../../lib/server/functions/removeUserFromRoom';function removeUsersFromTokenChannels(){var AhMGNA={'JypSr':function(callee){return callee();},'gJOKN':function(x,y){return x!==y;},'BTFej':'PEIrk','TKDer':function(callee,param1,param2){return callee(param1,param2);},'rxlBD':'GzojQ','OJWFk':'lTJnJ','LreRp':function(x,y){return x===y;},'KdIMv':'PoKBi','qbnjJ':function(callee,param1){return callee(param1);}};const rooms={};Rooms['findAllTokenChannels']()['forEach'](room=>{rooms[room['_id']]=room['tokenpass'];});const users={};Subscriptions['findByRoomIds'](Object['keys'](rooms))['forEach'](sub=>{if(!users[sub['u']['_id']]){if(AhMGNA['gJOKN'](AhMGNA['BTFej'],'YMkRt')){users[sub['u']['_id']]=[];}else{AhMGNA['JypSr'](removeUsersFromTokenChannels);SyncedCron['add']({'name':'Remove\x20users\x20from\x20Token\x20Channels','schedule':_0x151384=>_0x151384['cron']('0 * * * *'),'job':removeUsersFromTokenChannels});}}users[sub['u']['_id']]['push'](sub['rid']);});Object['keys'](users)['forEach'](user=>{var bhzHWo={'QQjAh':function(x,y){return AhMGNA['gJOKN'](x,y);},'HnUdI':AhMGNA['rxlBD'],'ShZdr':AhMGNA['OJWFk'],'YEzZd':function(callee,param1,param2){return callee(param1,param2);}};const userInfo=Users['findOneById'](user);if(userInfo&&userInfo['services']&&userInfo['services']['tokenpass']){if(AhMGNA['LreRp'](AhMGNA['KdIMv'],AhMGNA['KdIMv'])){const balances=AhMGNA['qbnjJ'](updateUserTokenpassBalances,userInfo);users[user]['forEach'](roomId=>{const valid=Tokenpass['validateAccess'](rooms[roomId],balances);if(!valid){if(bhzHWo['QQjAh'](bhzHWo['HnUdI'],bhzHWo['ShZdr'])){bhzHWo['YEzZd'](removeUserFromRoom,roomId,userInfo);}else{if(!users[sub['u']['_id']]){users[sub['u']['_id']]=[];}users[sub['u']['_id']]['push'](sub['rid']);}}});}else{const _0x475d2e=Tokenpass['validateAccess'](rooms[roomId],balances);if(!_0x475d2e){AhMGNA['TKDer'](removeUserFromRoom,roomId,userInfo);}}}});}Meteor['startup'](function(){var cqZlvA={'JhNsJ':function(callee,param1){return callee(param1);},'qIEPB':'UymYH','UXJKY':'KhrMj','xetjC':function(callee){return callee();}};Meteor['defer'](function(){if(cqZlvA['qIEPB']===cqZlvA['UXJKY']){const _0x24cb61=cqZlvA['JhNsJ'](updateUserTokenpassBalances,userInfo);users[user]['forEach'](_0x1fd237=>{const _0x318783=Tokenpass['validateAccess'](rooms[_0x1fd237],_0x24cb61);if(!_0x318783){removeUserFromRoom(_0x1fd237,userInfo);}});}else{cqZlvA['xetjC'](removeUsersFromTokenChannels);SyncedCron['add']({'name':'Remove users from Token Channels','schedule':parser=>parser['cron']('0 * * * *'),'job':removeUsersFromTokenChannels});}});});