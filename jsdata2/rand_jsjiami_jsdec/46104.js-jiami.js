import _0xc19df8 from'os';import _0x4e5eac from'glob';import _0x50ab15 from'fs-extra';import _0x942145 from'execa';import _0x4b6714 from'cheerio';import{join,dirname,relative}from'path';import{version}from'next/package';import{recursiveReadDir}from'next/dist/lib/recursive-readdir';import{fetchViaHTTP,findPort,initNextServerScript,killApp,renderViaHTTP}from'next-test-utils';jest['setTimeout'](0x3e8*0x3c*0x2);const appDir=join(__dirname,'../app');const workDir=join(_0xc19df8['tmpdir'](),'required-server-files-'+Date['now']());let server;let nextApp;let appPort;let buildId;let requiredFilesManifest;let errors=[];describe('Required Server Files',()=>{var KSqyva={'CkDeZ':'error','TPjsu':function(callee,param1){return callee(param1);},'NouBd':'http','vgzXO':'next/dist/server/next-server','FBruG':'.nft.json','ckeDG':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'DRhxY':'yarn','ySiNl':'pack','AGoCX':function(callee,param1,param2){return callee(param1,param2);},'IpzQn':function(callee,param1,param2){return callee(param1,param2);},'PqgNm':'package.json','yQfGP':'latest','OyzRX':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'lfgig':'install','EIGhi':'ignore','xmKIp':'inherit','MKXsv':'.yarn-cache','YgbKL':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'GiZmX':'build','BRvZj':'production','SfJmp':function(callee,param1,param2){return callee(param1,param2);},'kXcFn':'.next/BUILD_ID','qAsau':'utf8','sopAv':function(callee,param1,param2){return callee(param1,param2);},'ortWa':'.next/required-server-files.json','NpLuA':function(callee,param1){return callee(param1);},'yWHVE':'.yarn','xuHSc':'.next/server/pages','hQGKi':function(x,y){return x!==y;},'TMDni':'/node_modules/next/dist/server/next-server.js','mlfsb':'.next/server','MIsWO':function(callee,param1,param2){return callee(param1,param2);},'KWMgW':'node_modules','IcDJU':'server.js','zvHUi':function(x,y){return x+y;},'eIqiX':'global.nextConfig = ','ELxUt':function(callee,param1,param2,param3,param4,param5){return callee(param1,param2,param3,param4,param5);},'zRcyU':function(callee,param1){return callee(param1);},'NrAdk':function(callee,param1){return callee(param1);},'vrBQH':function(callee,param1){return callee(param1);},'tjsyS':function(callee,param1){return callee(param1);},'OvxjM':function(callee,param1){return callee(param1);},'cPnNU':'undefined','LkkUM':'boolean','riWDU':function(callee,param1){return callee(param1);},'veWmC':'string','AzoBS':function(callee,param1){return callee(param1);},'ZcmYT':'#props','kxnjf':'#index','Lkkol':'index page','mOWIk':'world','Edwsv':function(callee,param1){return callee(param1);},'gWmTm':function(callee,param1){return callee(param1);},'uPeND':function(callee,param1){return callee(param1);},'apsif':function(callee,param1,param2){return callee(param1,param2);},'AtWrS':'/dynamic/first','UdSoF':function(callee,param1){return callee(param1);},'cCFdI':function(callee,param1){return callee(param1);},'eKyGm':'#dynamic','CoATN':'dynamic\x20page','SthyE':'first','mDoNQ':function(callee,param1,param2){return callee(param1,param2);},'KscPQ':'/dynamic/second','lRjBp':function(callee,param1){return callee(param1);},'xXgQJ':function(callee,param1){return callee(param1);},'Wmdwu':'second','YeuOl':function(callee,param1){return callee(param1);},'uGypw':'/fallback/first','BHauj':'fallback page','SWqpt':function(callee,param1){return callee(param1);},'dFWCN':function(callee,param1){return callee(param1);},'SVPfy':'#slug','RnkYX':function(callee,param1){return callee(param1);},'sTaKS':function(callee,param1,param2){return callee(param1,param2);},'szUBa':'/fallback/second','YvEEe':function(callee,param1){return callee(param1);},'TtxkW':'#fallback','VpzWE':function(callee,param1){return callee(param1);},'qaYam':function(callee,param1){return callee(param1);},'rHEtf':function(callee,param1){return callee(param1);},'TbBAj':'third','JUhRr':'/some-other-path','sFUac':function(callee,param1){return callee(param1);},'bKodx':function(callee,param1){return callee(param1);},'GZsaz':function(callee,param1){return callee(param1);},'PXhuw':function(callee,param1){return callee(param1);},'XAjof':function(callee,param1){return callee(param1);},'GrBGE':function(callee,param1){return callee(param1);},'rCpzP':function(callee,param1){return callee(param1);},'GXATy':'/dynamic/[slug]?slug=first','CZciv':function(callee,param1){return callee(param1);},'gYaZG':function(callee,param1){return callee(param1);},'PpBeM':function(callee,param1){return callee(param1);},'XoYHA':function(callee,param1){return callee(param1);},'fVsqb':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'RrrHa':'/dynamic/[slug]?slug=second','qDaHr':'/dynamic/[slug]?slug=%5Bslug%5D.json','XQmQq':'1=second&slug=second','Evque':function(callee,param1){return callee(param1);},'SXMrF':function(callee,param1){return callee(param1);},'QBtau':function(callee,param1){return callee(param1);},'vHdMY':'1=first','yxAjK':function(callee,param1){return callee(param1);},'rTklj':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'wjxpw':'/fallback/[slug]','RQHOS':function(callee,param1){return callee(param1);},'poxbq':function(callee,param1){return callee(param1);},'JFNNj':function(callee,param1){return callee(param1);},'uGMsz':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'qJAQA':function(callee,param1){return callee(param1);},'RPwim':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'peSyn':'1=second','BSZSC':'/catch-all/[[...rest]]','MxxCw':function(callee,param1){return callee(param1);},'BKGWv':'#catch-all','Ffonm':'optional\x20catch-all\x20page','vDhXX':function(callee,param1){return callee(param1);},'lyOzv':'1=hello&catchAll=hello','bnghF':function(callee,param1){return callee(param1);},'KKVbX':function(callee,param1){return callee(param1);},'ouLVA':'hello','hyAZk':function(callee,param1){return callee(param1);},'bteRt':'/catch-all/[[..rest]]','wCOKH':'1=hello/world&catchAll=hello/world','DxIrP':function(callee,param1){return callee(param1);},'CdWEG':function(callee,param1){return callee(param1);},'hzxlN':function(callee,param1){return callee(param1);},'COliv':function(callee,param1){return callee(param1);},'qLgTB':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'RzNUX':function(callee,param1){return callee(param1);},'ZfchN':'1=hello/world&rest=hello/world','hCnXs':'/dynamic/another/','Cfnlo':'/dynamic/another','ciWyj':'/fallback/another/','Vjhoq':'manual','emIfX':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'krrhO':'/some-catch-all/hello/world','kgvvB':'hello/world','FcSae':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'LDRVl':'/errors/gip','JwEDJ':function(callee,param1){return callee(param1);},'yyMCe':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'QmcAU':'/errors/gssp','mYUEZ':function(callee,param1){return callee(param1);},'rZCHN':function(callee,param1){return callee(param1);},'MswsR':'gssp hit an oops','Knsmj':'/errors/gsp/crash','ogLLu':function(callee,param1){return callee(param1);},'WslEg':'/api/error','WEaAC':function(callee,param1){return callee(param1);},'tidYc':function(callee,param1){return callee(param1);},'tgLum':'some error from /api/error','kSVSQ':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'yVrTR':'/optional-ssp','FfZMI':'/optional-ssp/[[...rest]]','ZMPcz':function(callee,param1){return callee(param1);},'CJbvV':'value','MvShN':'/optional-ssg','WSmku':'/optional-ssg/[[...rest]]','fTqYB':function(callee,param1){return callee(param1);},'zKmPq':'/api/optional','Batut':'/api/optional/[[...rest]]','ULaxw':'/api/optional?another=value','HvzVe':'/index','OPyWE':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'RtzmQ':'/[slug]','oExVM':function(callee,param1){return callee(param1);},'HpVwQ':'#slug-page','VCEIM':'[slug] page','CMRqB':function(callee,param1){return callee(param1);},'zbjSW':'should output required-server-files manifest correctly','eYgJq':function(callee,param1,param2){return callee(param1,param2);},'cGVKW':'should render SSR page correctly','ZciCE':function(callee,param1,param2){return callee(param1,param2);},'EFVTS':'should render dynamic SSR page correctly','GZVkp':function(callee,param1,param2){return callee(param1,param2);},'ywIhV':'should\x20render\x20fallback\x20page\x20correctly','jkzqL':function(callee,param1,param2){return callee(param1,param2);},'dDGCQ':'should render dynamic SSR page correctly with x-matched-path','pGTSe':'should render fallback page correctly with x-matched-path and routes-matches','SpPIg':'should return data correctly with x-matched-path','MDPwI':'should\x20render\x20fallback\x20optional\x20catch-all\x20route\x20correctly\x20with\x20x-matched-path\x20and\x20routes-matches','sszHZ':'should\x20return\x20data\x20correctly\x20with\x20x-matched-path\x20for\x20optional\x20catch-all\x20route','nPtYh':'should not apply trailingSlash redirect','peTaT':'should normalize catch-all rewrite query values correctly','hhPcr':'should bubble error correctly for gip page','prCSK':function(callee,param1,param2){return callee(param1,param2);},'MfHoS':'should bubble error correctly for gssp page','RYdBp':function(callee,param1,param2){return callee(param1,param2);},'ncsKr':function(callee,param1,param2){return callee(param1,param2);},'LQNbX':'should\x20bubble\x20error\x20correctly\x20for\x20API\x20page','ybDgd':function(callee,param1,param2){return callee(param1,param2);},'KmkYX':'should\x20normalize\x20optional\x20values\x20correctly\x20for\x20SSP\x20page','WuSwk':'should normalize optional values correctly for SSG page','oQBZL':'should\x20normalize\x20optional\x20values\x20correctly\x20for\x20SSG\x20page\x20with\x20encoded\x20slash','EImFz':'should match the index page correctly'};KSqyva['oExVM'](beforeAll,async()=>{var uVxVlt={'KSBWO':KSqyva['CkDeZ'],'sgINV':function(callee,param1){return KSqyva['TPjsu'](callee,param1);},'PYYNz':KSqyva['NouBd'],'xBwpj':KSqyva['vgzXO']};const nextServerTrace=await _0x50ab15['readJSON'](require['resolve'](KSqyva['vgzXO'])+KSqyva['FBruG']);const packageDir=dirname(require['resolve']('next/package.json'));await KSqyva['ckeDG'](_0x942145,KSqyva['DRhxY'],[KSqyva['ySiNl']],{'cwd':packageDir});const packagePath=KSqyva['AGoCX'](join,packageDir,'next-v'+version+'.tgz');await _0x50ab15['ensureDir'](workDir);await _0x50ab15['writeFile'](KSqyva['IpzQn'](join,workDir,KSqyva['PqgNm']),JSON['stringify']({'dependencies':{'next':packagePath,'react':KSqyva['yQfGP'],'react-dom':'latest'}}));await _0x50ab15['copy'](appDir,workDir);await KSqyva['OyzRX'](_0x942145,KSqyva['DRhxY'],[KSqyva['lfgig']],{'cwd':workDir,'stdio':[KSqyva['EIGhi'],KSqyva['xmKIp'],KSqyva['xmKIp']],'env':{...process['env'],'YARN_CACHE_FOLDER':KSqyva['IpzQn'](join,workDir,KSqyva['MKXsv'])}});await KSqyva['YgbKL'](_0x942145,'yarn',['next',KSqyva['GiZmX']],{'cwd':workDir,'stdio':['ignore','inherit','inherit'],'env':{...process['env'],'NODE_ENV':KSqyva['BRvZj'],'NOW_BUILDER':'1'}});buildId=await _0x50ab15['readFile'](KSqyva['SfJmp'](join,workDir,KSqyva['kXcFn']),KSqyva['qAsau']);requiredFilesManifest=await _0x50ab15['readJSON'](KSqyva['sopAv'](join,workDir,KSqyva['ortWa']));await _0x50ab15['ensureDir'](workDir+'-react');await _0x50ab15['writeFile'](KSqyva['NpLuA'](join,workDir+'-react/package.json'),JSON['stringify']({'dependencies':{'react':KSqyva['yQfGP'],'react-dom':KSqyva['yQfGP']}}));await KSqyva['YgbKL'](_0x942145,KSqyva['DRhxY'],[KSqyva['lfgig']],{'cwd':workDir+'-react','stdio':[KSqyva['EIGhi'],KSqyva['xmKIp'],KSqyva['xmKIp']],'env':{...process['env'],'YARN_CACHE_FOLDER':KSqyva['sopAv'](join,workDir,KSqyva['yWHVE'])}});await _0x50ab15['remove'](packagePath);const files=await recursiveReadDir(workDir,/.*/);const pageTraceFiles=await _0x4e5eac['sync']('**/*.nft.json',{'cwd':join(workDir,KSqyva['xuHSc'])});const combinedTraces=new Set();for(const file of pageTraceFiles){const filePath=join(workDir,'.next/server/pages',file);const trace=await _0x50ab15['readJSON'](filePath);trace['files']['forEach'](f=>combinedTraces['add'](relative(workDir,join(dirname(filePath),f))));}for(const file of files){const cleanFile=KSqyva['sopAv'](join,'./',file);if(!nextServerTrace['files']['includes'](cleanFile)&&KSqyva['hQGKi'](file,KSqyva['TMDni'])&&!combinedTraces['has'](cleanFile)&&!requiredFilesManifest['files']['includes'](cleanFile)&&!cleanFile['startsWith'](KSqyva['mlfsb'])&&KSqyva['hQGKi'](cleanFile,KSqyva['ortWa'])){await _0x50ab15['remove'](join(workDir,file));}}for(const file of await _0x50ab15['readdir'](workDir+'-react/node_modules')){await _0x50ab15['copy'](KSqyva['MIsWO'](join,workDir+'-react/node_modules',file),join(workDir,KSqyva['KWMgW'],file));}await _0x50ab15['remove'](workDir+'-react');async function startServer(){var dVaJxa={'Globx':uVxVlt['KSBWO']};const http=uVxVlt['sgINV'](require,uVxVlt['PYYNz']);const NextServer=uVxVlt['sgINV'](require,uVxVlt['xBwpj'])['default'];const appPort=process['env']['PORT'];nextApp=new NextServer({'conf':global['nextConfig'],'dir':process['env']['APP_DIR'],'quiet':![],'minimalMode':!![]});server=http['createServer'](async(req,res)=>{try{await nextApp['getRequestHandler']()(req,res);}catch(_0x2bc53b){console['error']('top-level',_0x2bc53b);res['statusCode']=0x1f4;res['end'](dVaJxa['Globx']);}});await new Promise((res,rej)=>{server['listen'](appPort,err=>err?rej(err):res());});console['log']('Listening\x20at\x20::'+appPort);}const serverPath=join(workDir,KSqyva['IcDJU']);await _0x50ab15['writeFile'](serverPath,KSqyva['zvHUi'](KSqyva['eIqiX']+JSON['stringify'](requiredFilesManifest['config'])+';\x0a'+startServer['toString']()+';\x0a','startServer().catch(console.error)'));appPort=await findPort();server=await KSqyva['ELxUt'](initNextServerScript,serverPath,/Listening at/,{...process['env'],'NODE_ENV':KSqyva['BRvZj'],'PORT':appPort,'APP_DIR':workDir},undefined,{'cwd':workDir,'onStderr'(msg){if(msg['includes']('top-level')){errors['push'](msg);}}});});KSqyva['CMRqB'](afterAll,async()=>{if(server)KSqyva['zRcyU'](killApp,server);await _0x50ab15['remove'](workDir);});KSqyva['sTaKS'](it,KSqyva['zbjSW'],async()=>{KSqyva['NrAdk'](expect,requiredFilesManifest['version'])['toBe'](0x1);KSqyva['vrBQH'](expect,Array['isArray'](requiredFilesManifest['files']))['toBe'](!![]);KSqyva['tjsyS'](expect,Array['isArray'](requiredFilesManifest['ignore']))['toBe'](!![]);KSqyva['OvxjM'](expect,requiredFilesManifest['files']['length'])['toBeGreaterThan'](0x0);KSqyva['OvxjM'](expect,requiredFilesManifest['ignore']['length'])['toBeGreaterThan'](0x0);KSqyva['OvxjM'](expect,typeof requiredFilesManifest['config']['configFile'])['toBe'](KSqyva['cPnNU']);KSqyva['OvxjM'](expect,typeof requiredFilesManifest['config']['trailingSlash'])['toBe'](KSqyva['LkkUM']);KSqyva['riWDU'](expect,typeof requiredFilesManifest['appDir'])['toBe'](KSqyva['veWmC']);for(const file of requiredFilesManifest['files']){expect(await _0x50ab15['exists'](KSqyva['MIsWO'](join,workDir,file)))['toBe'](!![]);}KSqyva['AzoBS'](expect,await _0x50ab15['exists'](KSqyva['MIsWO'](join,workDir,KSqyva['mlfsb'])))['toBe'](!![]);});KSqyva['eYgJq'](it,KSqyva['cGVKW'],async()=>{const html=await renderViaHTTP(appPort,'/');const $=_0x4b6714['load'](html);const data=JSON['parse'](KSqyva['AzoBS']($,KSqyva['ZcmYT'])['text']());KSqyva['AzoBS'](expect,$(KSqyva['kxnjf'])['text']())['toBe'](KSqyva['Lkkol']);KSqyva['AzoBS'](expect,data['hello'])['toBe'](KSqyva['mOWIk']);const html2=await KSqyva['MIsWO'](renderViaHTTP,appPort,'/');const $2=_0x4b6714['load'](html2);const data2=JSON['parse'](KSqyva['Edwsv']($2,KSqyva['ZcmYT'])['text']());KSqyva['gWmTm'](expect,KSqyva['gWmTm']($2,KSqyva['kxnjf'])['text']())['toBe']('index page');KSqyva['gWmTm'](expect,KSqyva['gWmTm'](isNaN,data2['random']))['toBe'](![]);KSqyva['uPeND'](expect,data2['random'])['not']['toBe'](data['random']);});KSqyva['ZciCE'](it,KSqyva['EFVTS'],async()=>{const html=await KSqyva['apsif'](renderViaHTTP,appPort,KSqyva['AtWrS']);const $=_0x4b6714['load'](html);const data=JSON['parse'](KSqyva['UdSoF']($,KSqyva['ZcmYT'])['text']());KSqyva['cCFdI'](expect,$(KSqyva['eKyGm'])['text']())['toBe'](KSqyva['CoATN']);KSqyva['cCFdI'](expect,$('#slug')['text']())['toBe'](KSqyva['SthyE']);KSqyva['cCFdI'](expect,data['hello'])['toBe']('world');const html2=await KSqyva['mDoNQ'](renderViaHTTP,appPort,KSqyva['KscPQ']);const $2=_0x4b6714['load'](html2);const data2=JSON['parse'](KSqyva['cCFdI']($2,KSqyva['ZcmYT'])['text']());KSqyva['cCFdI'](expect,KSqyva['lRjBp']($2,KSqyva['eKyGm'])['text']())['toBe'](KSqyva['CoATN']);KSqyva['xXgQJ'](expect,KSqyva['xXgQJ']($2,'#slug')['text']())['toBe'](KSqyva['Wmdwu']);KSqyva['xXgQJ'](expect,isNaN(data2['random']))['toBe'](![]);KSqyva['YeuOl'](expect,data2['random'])['not']['toBe'](data['random']);});KSqyva['GZVkp'](it,KSqyva['ywIhV'],async()=>{const html=await KSqyva['mDoNQ'](renderViaHTTP,appPort,KSqyva['uGypw']);const $=_0x4b6714['load'](html);const data=JSON['parse'](KSqyva['YeuOl']($,KSqyva['ZcmYT'])['text']());expect(KSqyva['YeuOl']($,'#fallback')['text']())['toBe'](KSqyva['BHauj']);KSqyva['SWqpt'](expect,KSqyva['dFWCN']($,KSqyva['SVPfy'])['text']())['toBe'](KSqyva['SthyE']);KSqyva['dFWCN'](expect,data['hello'])['toBe'](KSqyva['mOWIk']);const html2=await renderViaHTTP(appPort,KSqyva['uGypw']);const $2=_0x4b6714['load'](html2);const data2=JSON['parse'](KSqyva['dFWCN']($2,'#props')['text']());KSqyva['dFWCN'](expect,$2('#fallback')['text']())['toBe'](KSqyva['BHauj']);KSqyva['RnkYX'](expect,$2(KSqyva['SVPfy'])['text']())['toBe'](KSqyva['SthyE']);expect(KSqyva['RnkYX'](isNaN,data2['random']))['toBe'](![]);KSqyva['RnkYX'](expect,data2['random'])['not']['toBe'](data['random']);const html3=await KSqyva['sTaKS'](renderViaHTTP,appPort,KSqyva['szUBa']);const $3=_0x4b6714['load'](html3);const data3=JSON['parse'](KSqyva['YvEEe']($3,'#props')['text']());KSqyva['YvEEe'](expect,KSqyva['YvEEe']($3,KSqyva['TtxkW'])['text']())['toBe'](KSqyva['BHauj']);expect(KSqyva['YvEEe']($3,KSqyva['SVPfy'])['text']())['toBe']('second');KSqyva['YvEEe'](expect,KSqyva['VpzWE'](isNaN,data3['random']))['toBe'](![]);const {pageProps:data4}=JSON['parse'](await KSqyva['sTaKS'](renderViaHTTP,appPort,'/_next/data/'+buildId+'/fallback/third.json'));KSqyva['qaYam'](expect,data4['hello'])['toBe'](KSqyva['mOWIk']);KSqyva['rHEtf'](expect,data4['slug'])['toBe'](KSqyva['TbBAj']);});KSqyva['jkzqL'](it,'should render SSR page correctly with x-matched-path',async()=>{const html=await renderViaHTTP(appPort,KSqyva['JUhRr'],undefined,{'headers':{'x-matched-path':'/'}});const $=_0x4b6714['load'](html);const data=JSON['parse'](KSqyva['sFUac']($,'#props')['text']());KSqyva['bKodx'](expect,$('#index')['text']())['toBe'](KSqyva['Lkkol']);KSqyva['GZsaz'](expect,data['hello'])['toBe']('world');const html2=await renderViaHTTP(appPort,KSqyva['JUhRr'],undefined,{'headers':{'x-matched-path':'/'}});const $2=_0x4b6714['load'](html2);const data2=JSON['parse'](KSqyva['PXhuw']($2,'#props')['text']());KSqyva['PXhuw'](expect,KSqyva['XAjof']($2,KSqyva['kxnjf'])['text']())['toBe'](KSqyva['Lkkol']);KSqyva['GrBGE'](expect,KSqyva['GrBGE'](isNaN,data2['random']))['toBe'](![]);KSqyva['rCpzP'](expect,data2['random'])['not']['toBe'](data['random']);});it(KSqyva['dDGCQ'],async()=>{const html=await renderViaHTTP(appPort,'/some-other-path',undefined,{'headers':{'x-matched-path':KSqyva['GXATy']}});const $=_0x4b6714['load'](html);const data=JSON['parse'](KSqyva['CZciv']($,KSqyva['ZcmYT'])['text']());KSqyva['CZciv'](expect,KSqyva['gYaZG']($,KSqyva['eKyGm'])['text']())['toBe'](KSqyva['CoATN']);KSqyva['PpBeM'](expect,KSqyva['XoYHA']($,KSqyva['SVPfy'])['text']())['toBe'](KSqyva['SthyE']);KSqyva['XoYHA'](expect,data['hello'])['toBe'](KSqyva['mOWIk']);const html2=await KSqyva['fVsqb'](renderViaHTTP,appPort,KSqyva['JUhRr'],undefined,{'headers':{'x-matched-path':KSqyva['RrrHa']}});const $2=_0x4b6714['load'](html2);const data2=JSON['parse']($2(KSqyva['ZcmYT'])['text']());KSqyva['XoYHA'](expect,KSqyva['XoYHA']($2,'#dynamic')['text']())['toBe'](KSqyva['CoATN']);KSqyva['XoYHA'](expect,$2('#slug')['text']())['toBe'](KSqyva['Wmdwu']);KSqyva['XoYHA'](expect,isNaN(data2['random']))['toBe'](![]);expect(data2['random'])['not']['toBe'](data['random']);const html3=await renderViaHTTP(appPort,KSqyva['JUhRr'],undefined,{'headers':{'x-matched-path':KSqyva['qDaHr'],'x-now-route-matches':KSqyva['XQmQq']}});const $3=_0x4b6714['load'](html3);const data3=JSON['parse']($3('#props')['text']());KSqyva['Evque'](expect,KSqyva['SXMrF']($3,KSqyva['eKyGm'])['text']())['toBe']('dynamic\x20page');KSqyva['SXMrF'](expect,KSqyva['SXMrF']($3,KSqyva['SVPfy'])['text']())['toBe']('second');expect(isNaN(data3['random']))['toBe'](![]);KSqyva['QBtau'](expect,data3['random'])['not']['toBe'](data['random']);});it(KSqyva['pGTSe'],async()=>{const html=await KSqyva['fVsqb'](renderViaHTTP,appPort,KSqyva['uGypw'],undefined,{'headers':{'x-matched-path':KSqyva['uGypw'],'x-now-route-matches':KSqyva['vHdMY']}});const $=_0x4b6714['load'](html);const data=JSON['parse'](KSqyva['QBtau']($,'#props')['text']());KSqyva['QBtau'](expect,KSqyva['yxAjK']($,KSqyva['TtxkW'])['text']())['toBe'](KSqyva['BHauj']);expect(KSqyva['yxAjK']($,KSqyva['SVPfy'])['text']())['toBe'](KSqyva['SthyE']);KSqyva['yxAjK'](expect,data['hello'])['toBe'](KSqyva['mOWIk']);const html2=await KSqyva['rTklj'](renderViaHTTP,appPort,'/fallback/[slug]',undefined,{'headers':{'x-matched-path':KSqyva['wjxpw'],'x-now-route-matches':'1=second'}});const $2=_0x4b6714['load'](html2);const data2=JSON['parse'](KSqyva['RQHOS']($2,KSqyva['ZcmYT'])['text']());KSqyva['RQHOS'](expect,KSqyva['poxbq']($2,KSqyva['TtxkW'])['text']())['toBe'](KSqyva['BHauj']);expect($2(KSqyva['SVPfy'])['text']())['toBe'](KSqyva['Wmdwu']);expect(isNaN(data2['random']))['toBe'](![]);KSqyva['JFNNj'](expect,data2['random'])['not']['toBe'](data['random']);});it(KSqyva['SpPIg'],async()=>{const res=await KSqyva['uGMsz'](fetchViaHTTP,appPort,'/_next/data/'+buildId+'/dynamic/first.json',undefined,{'headers':{'x-matched-path':KSqyva['GXATy']}});const {pageProps:data}=await res['json']();expect(data['slug'])['toBe']('first');KSqyva['qJAQA'](expect,data['hello'])['toBe'](KSqyva['mOWIk']);const res2=await KSqyva['RPwim'](fetchViaHTTP,appPort,'/_next/data/'+buildId+'/fallback/[slug].json',undefined,{'headers':{'x-matched-path':'/_next/data/'+buildId+'/fallback/[slug].json','x-now-route-matches':KSqyva['peSyn']}});const {pageProps:data2}=await res2['json']();expect(data2['slug'])['toBe'](KSqyva['Wmdwu']);KSqyva['qJAQA'](expect,data2['hello'])['toBe'](KSqyva['mOWIk']);});KSqyva['jkzqL'](it,KSqyva['MDPwI'],async()=>{const html=await renderViaHTTP(appPort,KSqyva['BSZSC'],undefined,{'headers':{'x-matched-path':KSqyva['BSZSC'],'x-now-route-matches':''}});const $=_0x4b6714['load'](html);const data=JSON['parse']($('#props')['text']());KSqyva['qJAQA'](expect,KSqyva['MxxCw']($,KSqyva['BKGWv'])['text']())['toBe'](KSqyva['Ffonm']);KSqyva['vDhXX'](expect,data['params'])['toEqual']({});expect(data['hello'])['toBe'](KSqyva['mOWIk']);const html2=await renderViaHTTP(appPort,KSqyva['BSZSC'],undefined,{'headers':{'x-matched-path':KSqyva['BSZSC'],'x-now-route-matches':KSqyva['lyOzv']}});const $2=_0x4b6714['load'](html2);const data2=JSON['parse'](KSqyva['bnghF']($2,KSqyva['ZcmYT'])['text']());expect(KSqyva['KKVbX']($2,'#catch-all')['text']())['toBe'](KSqyva['Ffonm']);KSqyva['KKVbX'](expect,data2['params'])['toEqual']({'rest':[KSqyva['ouLVA']]});KSqyva['KKVbX'](expect,KSqyva['hyAZk'](isNaN,data2['random']))['toBe'](![]);expect(data2['random'])['not']['toBe'](data['random']);const html3=await renderViaHTTP(appPort,KSqyva['bteRt'],undefined,{'headers':{'x-matched-path':KSqyva['BSZSC'],'x-now-route-matches':KSqyva['wCOKH']}});const $3=_0x4b6714['load'](html3);const data3=JSON['parse'](KSqyva['hyAZk']($3,KSqyva['ZcmYT'])['text']());KSqyva['DxIrP'](expect,KSqyva['DxIrP']($3,'#catch-all')['text']())['toBe'](KSqyva['Ffonm']);KSqyva['DxIrP'](expect,data3['params'])['toEqual']({'rest':['hello',KSqyva['mOWIk']]});KSqyva['CdWEG'](expect,KSqyva['CdWEG'](isNaN,data3['random']))['toBe'](![]);KSqyva['CdWEG'](expect,data3['random'])['not']['toBe'](data['random']);});KSqyva['jkzqL'](it,KSqyva['sszHZ'],async()=>{const res=await KSqyva['RPwim'](fetchViaHTTP,appPort,'/_next/data/'+buildId+'/catch-all.json',undefined,{'headers':{'x-matched-path':KSqyva['BSZSC']}});const {pageProps:data}=await res['json']();KSqyva['hzxlN'](expect,data['params'])['toEqual']({});KSqyva['COliv'](expect,data['hello'])['toBe'](KSqyva['mOWIk']);const res2=await KSqyva['qLgTB'](fetchViaHTTP,appPort,'/_next/data/'+buildId+'/catch-all/[[...rest]].json',undefined,{'headers':{'x-matched-path':'/_next/data/'+buildId+'/catch-all/[[...rest]].json','x-now-route-matches':'1=hello&rest=hello'}});const {pageProps:data2}=await res2['json']();expect(data2['params'])['toEqual']({'rest':[KSqyva['ouLVA']]});KSqyva['RzNUX'](expect,data2['hello'])['toBe'](KSqyva['mOWIk']);const res3=await KSqyva['qLgTB'](fetchViaHTTP,appPort,'/_next/data/'+buildId+'/catch-all/[[...rest]].json',undefined,{'headers':{'x-matched-path':'/_next/data/'+buildId+'/catch-all/[[...rest]].json','x-now-route-matches':KSqyva['ZfchN']}});const {pageProps:data3}=await res3['json']();expect(data3['params'])['toEqual']({'rest':[KSqyva['ouLVA'],KSqyva['mOWIk']]});KSqyva['RzNUX'](expect,data3['hello'])['toBe'](KSqyva['mOWIk']);});it(KSqyva['nPtYh'],async()=>{for(const path of['/',KSqyva['hCnXs'],KSqyva['Cfnlo'],'/fallback/first/',KSqyva['uGypw'],KSqyva['ciWyj'],'/fallback/another']){const res=await KSqyva['qLgTB'](fetchViaHTTP,appPort,path,undefined,{'redirect':KSqyva['Vjhoq']});KSqyva['RzNUX'](expect,res['status'])['toBe'](0xc8);}});it(KSqyva['peTaT'],async()=>{const html=await KSqyva['emIfX'](renderViaHTTP,appPort,KSqyva['krrhO'],{'path':KSqyva['kgvvB']},{'headers':{'x-matched-path':'/'}});const $=_0x4b6714['load'](html);expect(JSON['parse'](KSqyva['RzNUX']($,'#router')['text']())['query'])['toEqual']({'path':[KSqyva['ouLVA'],KSqyva['mOWIk']]});});KSqyva['jkzqL'](it,KSqyva['hhPcr'],async()=>{errors=[];const res=await KSqyva['FcSae'](fetchViaHTTP,appPort,KSqyva['LDRVl'],{'crash':'1'});KSqyva['RzNUX'](expect,res['status'])['toBe'](0x1f4);KSqyva['RzNUX'](expect,await res['text']())['toBe']('error');KSqyva['RzNUX'](expect,errors['length'])['toBe'](0x1);KSqyva['JwEDJ'](expect,errors[0x0])['toContain']('gip hit an oops');});KSqyva['prCSK'](it,KSqyva['MfHoS'],async()=>{errors=[];const res=await KSqyva['yyMCe'](fetchViaHTTP,appPort,KSqyva['QmcAU'],{'crash':'1'});KSqyva['JwEDJ'](expect,res['status'])['toBe'](0x1f4);KSqyva['JwEDJ'](expect,await res['text']())['toBe'](KSqyva['CkDeZ']);KSqyva['mYUEZ'](expect,errors['length'])['toBe'](0x1);KSqyva['rZCHN'](expect,errors[0x0])['toContain'](KSqyva['MswsR']);});KSqyva['RYdBp'](it,'should\x20bubble\x20error\x20correctly\x20for\x20gsp\x20page',async()=>{errors=[];const res=await fetchViaHTTP(appPort,KSqyva['Knsmj']);expect(res['status'])['toBe'](0x1f4);KSqyva['rZCHN'](expect,await res['text']())['toBe'](KSqyva['CkDeZ']);KSqyva['ogLLu'](expect,errors['length'])['toBe'](0x1);KSqyva['ogLLu'](expect,errors[0x0])['toContain']('gsp\x20hit\x20an\x20oops');});KSqyva['ncsKr'](it,KSqyva['LQNbX'],async()=>{errors=[];const res=await fetchViaHTTP(appPort,KSqyva['WslEg']);KSqyva['WEaAC'](expect,res['status'])['toBe'](0x1f4);KSqyva['WEaAC'](expect,await res['text']())['toBe'](KSqyva['CkDeZ']);expect(errors['length'])['toBe'](0x1);KSqyva['tidYc'](expect,errors[0x0])['toContain'](KSqyva['tgLum']);});KSqyva['ybDgd'](it,KSqyva['KmkYX'],async()=>{const res=await KSqyva['kSVSQ'](fetchViaHTTP,appPort,KSqyva['yVrTR'],{'rest':'','another':'value'},{'headers':{'x-matched-path':KSqyva['FfZMI']}});const html=await res['text']();const $=_0x4b6714['load'](html);const props=JSON['parse'](KSqyva['ZMPcz']($,'#props')['text']());expect(props['params'])['toEqual']({});expect(props['query'])['toEqual']({'another':KSqyva['CJbvV']});});KSqyva['ybDgd'](it,KSqyva['WuSwk'],async()=>{const res=await fetchViaHTTP(appPort,KSqyva['MvShN'],{'rest':'','another':KSqyva['CJbvV']},{'headers':{'x-matched-path':KSqyva['WSmku']}});const html=await res['text']();const $=_0x4b6714['load'](html);const props=JSON['parse']($(KSqyva['ZcmYT'])['text']());KSqyva['ZMPcz'](expect,props['params'])['toEqual']({});});KSqyva['ybDgd'](it,KSqyva['oQBZL'],async()=>{const res=await fetchViaHTTP(appPort,'/optional-ssg/[[...rest]]',undefined,{'headers':{'x-matched-path':'/optional-ssg/[[...rest]]','x-now-route-matches':'1=en%2Fes%2Fhello%252Fworld&rest=en%2Fes%2Fhello%252Fworld'}});const html=await res['text']();const $=_0x4b6714['load'](html);const props=JSON['parse']($(KSqyva['ZcmYT'])['text']());KSqyva['fTqYB'](expect,props['params'])['toEqual']({'rest':['en','es',KSqyva['kgvvB']]});});it('should normalize optional values correctly for API page',async()=>{const res=await KSqyva['kSVSQ'](fetchViaHTTP,appPort,KSqyva['zKmPq'],{'rest':'','another':KSqyva['CJbvV']},{'headers':{'x-matched-path':KSqyva['Batut']}});const json=await res['json']();KSqyva['fTqYB'](expect,json['query'])['toEqual']({'another':KSqyva['CJbvV']});expect(json['url'])['toBe'](KSqyva['ULaxw']);});it(KSqyva['EImFz'],async()=>{const res=await KSqyva['kSVSQ'](fetchViaHTTP,appPort,'/',undefined,{'headers':{'x-matched-path':KSqyva['HvzVe']},'redirect':'manual'});const html=await res['text']();const $=_0x4b6714['load'](html);KSqyva['fTqYB'](expect,$(KSqyva['kxnjf'])['text']())['toBe']('index page');});it('should\x20match\x20the\x20root\x20dyanmic\x20page\x20correctly',async()=>{const res=await KSqyva['OPyWE'](fetchViaHTTP,appPort,KSqyva['HvzVe'],undefined,{'headers':{'x-matched-path':KSqyva['RtzmQ']},'redirect':KSqyva['Vjhoq']});const html=await res['text']();const $=_0x4b6714['load'](html);KSqyva['oExVM'](expect,$(KSqyva['HpVwQ'])['text']())['toBe'](KSqyva['VCEIM']);});});