import{join}from'path';import{killApp,findPort,launchApp,fetchViaHTTP,initNextServerScript}from'next-test-utils';import _0x36ad0f from'clone';import _0x4757c8 from'get-port';jest['setTimeout'](0x3e8*0x3c*0x2);const appDir=join(__dirname,'../');let appPort;let app;let server;jest['setTimeout'](0x3e8*0x3c*0x2);const context={};function runTests(){var sabuvv={'DGKEt':function(callee){return callee();},'msYze':function(callee,param1){return callee(param1);},'NDchz':'Nextjs','rZnEq':function(callee,param1){return callee(param1);},'YePtd':function(callee,param1){return callee(param1);},'hyJfT':function(callee,param1,param2){return callee(param1,param2);},'yzjak':'should parse JSON body','jkyUa':'should not throw if request body is already parsed in custom middleware','EnkcM':function(callee,param1,param2){return callee(param1,param2);},'YJWtq':'should not throw if request\'s content-type is invalid'};sabuvv['hyJfT'](it,sabuvv['yzjak'],async()=>{appPort=await findPort();app=await launchApp(appDir,appPort,{});const data=await sabuvv['DGKEt'](makeRequest);sabuvv['msYze'](expect,data)['toEqual']([{'title':sabuvv['NDchz']}]);sabuvv['rZnEq'](killApp,app);});sabuvv['hyJfT'](it,sabuvv['jkyUa'],async()=>{await sabuvv['DGKEt'](startServer);const data=await sabuvv['DGKEt'](makeRequest);expect(data)['toEqual']([{'title':sabuvv['NDchz']}]);sabuvv['YePtd'](killApp,server);});sabuvv['EnkcM'](it,sabuvv['YJWtq'],async()=>{await startServer();const status=await sabuvv['DGKEt'](makeRequestWithInvalidContentType);expect(status)['toBe'](0xc8);killApp(server);});}async function makeRequest(){var QOsiRR={'sKJsC':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'jmfSZ':'POST','RGOir':'application/json; charset=utf-8','gVrVT':'Nextjs'};const data=await QOsiRR['sKJsC'](fetchViaHTTP,appPort,'/api',null,{'method':QOsiRR['jmfSZ'],'headers':{'Content-Type':QOsiRR['RGOir']},'body':JSON['stringify']([{'title':QOsiRR['gVrVT']}])})['then'](res=>res['ok']&&res['json']());return data;}async function makeRequestWithInvalidContentType(){var sUSxJt={'vtUTp':function(callee,param1,param2,param3,param4){return callee(param1,param2,param3,param4);},'YzVrm':'/api','fmZwN':'POST','RDXOv':'application/json;'};const status=await sUSxJt['vtUTp'](fetchViaHTTP,appPort,sUSxJt['YzVrm'],null,{'method':sUSxJt['fmZwN'],'headers':{'Content-Type':sUSxJt['RDXOv']},'body':JSON['stringify']([{'title':'Nextjs'}])})['then'](res=>res['status']);return status;}const startServer=async(optEnv={},opts)=>{var OMoSKh={'ISYJo':'server.js','LiIFh':function(callee){return callee();},'MySkH':function(callee,param1){return callee(param1);},'dLOFM':function(callee,param1,param2,param3,param4,param5){return callee(param1,param2,param3,param4,param5);}};const scriptPath=join(appDir,OMoSKh['ISYJo']);context['appPort']=appPort=await OMoSKh['LiIFh'](_0x4757c8);const env=Object['assign']({},OMoSKh['MySkH'](_0x36ad0f,process['env']),{'PORT':''+appPort},optEnv);server=await OMoSKh['dLOFM'](initNextServerScript,scriptPath,/ready on/i,env,/ReferenceError: options is not defined/,opts);};runTests();