'use strict';const fs=require('fs-extra');const os=require('os');const path=require('path');const spawnSync=require('./spawn-sync');const template=require('lodash.template');const CONFIG=require('../config');module['exports']=function(_0x3097c8){var _0x1ac519={'VIHKB':function(_0xefb744,_0xf0c698){return _0xefb744===_0xf0c698;},'kvncQ':'stable','fbenE':'atom','uEOvz':'apm','lINdl':function(_0x2f2209,_0x411481){return _0x2f2209===_0x411481;},'hHuuI':'ppc','rihLF':function(_0x13517f,_0x2489cc){return _0x13517f!==_0x2489cc;},'sKYcK':'TYNJZ','uSzlI':'usr','fTNeD':'bin','mmWlf':'pixmaps','Usiqx':'doc','yNTYq':function(_0x39676e,_0x29670e){return _0x39676e===_0x29670e;},'XqQuH':'bdaqg','EjPlx':'PTXWu','UAmWx':'755','dnLLc':'atom.sh','GCQAh':'resources','lXpkA':'.bin','muhhX':'chrome-sandbox','sdLTu':function(_0x51fca9,_0x2f10a8,_0x4f13ba){return _0x51fca9(_0x2f10a8,_0x4f13ba);},'dnKLs':'linux','GxfuT':'debian','DUgJE':'control.in','UxToQ':function(_0x3acdcc,_0x4358a1){return _0x3acdcc(_0x4358a1);},'aLcll':'atom.desktop.in','Kmccc':'/usr','PokzA':'atom.png','bdTzn':'LICENSE.md','PyMMN':'copyright','KuwXb':'polkit-1','oAnGV':'actions','TDkFY':function(_0x34ebc3,_0x4cc63e,_0x1d6c85,_0x232bbe){return _0x34ebc3(_0x4cc63e,_0x1d6c85,_0x232bbe);},'AuxmH':'fakeroot','ntJOu':'dpkg-deb'};console['log']('Creating Debian package for "'+_0x3097c8+'\x22');const _0x273e0f=_0x1ac519['VIHKB'](CONFIG['channel'],_0x1ac519['kvncQ'])?_0x1ac519['fbenE']:'atom-'+CONFIG['channel'];const _0x2069eb=_0x1ac519['VIHKB'](CONFIG['channel'],_0x1ac519['kvncQ'])?_0x1ac519['uEOvz']:'apm-'+CONFIG['channel'];const _0x11b6d6=CONFIG['appMetadata']['description'];const _0x1b8434=CONFIG['appMetadata']['version'];let _0x283ca1;if(_0x1ac519['VIHKB'](process['arch'],'ia32')){_0x283ca1='i386';}else if(_0x1ac519['VIHKB'](process['arch'],'x64')){_0x283ca1='amd64';}else if(_0x1ac519['lINdl'](process['arch'],_0x1ac519['hHuuI'])){if(_0x1ac519['rihLF'](_0x1ac519['sKYcK'],'TYNJZ')){_0x283ca1=process['arch'];}else{_0x283ca1='powerpc';}}else{_0x283ca1=process['arch'];}const _0x3743b3=path['join'](CONFIG['buildOutputPath'],'atom-'+_0x283ca1+'.deb');const _0x75e4f1=path['join'](os['tmpdir'](),path['basename'](_0x3097c8));const _0x5eea4f=path['join'](_0x75e4f1,'DEBIAN');const _0x456269=path['join'](_0x75e4f1,_0x1ac519['uSzlI']);const _0x520516=path['join'](_0x456269,_0x1ac519['fTNeD']);const _0xf5d5c6=path['join'](_0x456269,'share');const _0x3733df=path['join'](_0xf5d5c6,_0x273e0f);const _0x339d2f=path['join'](_0xf5d5c6,'applications');const _0x4ce983=path['join'](_0xf5d5c6,_0x1ac519['mmWlf']);const _0x10e677=path['join'](_0xf5d5c6,_0x1ac519['Usiqx'],_0x273e0f);if(fs['existsSync'](_0x75e4f1)){if(_0x1ac519['yNTYq'](_0x1ac519['XqQuH'],_0x1ac519['EjPlx'])){console['log']('Deleting existing Debian package at "'+_0x75e4f1+'.deb"');fs['removeSync'](_0x75e4f1+'.deb');}else{console['log']('Deleting existing build dir for Debian package at "'+_0x75e4f1+'\x22');fs['removeSync'](_0x75e4f1);}}if(fs['existsSync'](_0x75e4f1+'.deb')){console['log']('Deleting existing Debian package at "'+_0x75e4f1+'.deb"');fs['removeSync'](_0x75e4f1+'.deb');}if(fs['existsSync'](_0x75e4f1)){console['log']('Deleting\x20existing\x20Debian\x20package\x20at\x20\x22'+_0x3743b3+'\x22');fs['removeSync'](_0x75e4f1);}console['log']('Creating Debian package directory structure at "'+_0x75e4f1+'\x22');fs['mkdirpSync'](_0x75e4f1);fs['mkdirpSync'](_0x5eea4f);fs['mkdirpSync'](_0x456269);fs['mkdirpSync'](_0xf5d5c6);fs['mkdirpSync'](_0x339d2f);fs['mkdirpSync'](_0x4ce983);fs['mkdirpSync'](_0x10e677);fs['mkdirpSync'](_0x520516);console['log']('Copying\x20\x22'+_0x3097c8+'" to "'+_0x3733df+'\x22');fs['copySync'](_0x3097c8,_0x3733df);fs['chmodSync'](_0x3733df,_0x1ac519['UAmWx']);console['log']('Copying\x20binaries\x20into\x20\x22'+_0x520516+'\x22');fs['copySync'](path['join'](CONFIG['repositoryRootPath'],_0x1ac519['dnLLc']),path['join'](_0x520516,_0x273e0f));fs['symlinkSync'](path['join']('..','share',_0x273e0f,_0x1ac519['GCQAh'],'app',_0x1ac519['uEOvz'],'node_modules',_0x1ac519['lXpkA'],_0x1ac519['uEOvz']),path['join'](_0x520516,_0x2069eb));fs['chmodSync'](path['join'](_0x3733df,_0x1ac519['muhhX']),'4755');console['log']('Writing control file into "'+_0x5eea4f+'\x22');const _0x38ea8b=_0x1ac519['sdLTu'](spawnSync,'du',['-sk',_0x3097c8])['stdout']['toString']()['split'](/\s+/)[0x0];const _0x473294=fs['readFileSync'](path['join'](CONFIG['repositoryRootPath'],_0x1ac519['GCQAh'],_0x1ac519['dnKLs'],_0x1ac519['GxfuT'],_0x1ac519['DUgJE']));const _0x216608=_0x1ac519['UxToQ'](template,_0x473294)({'appFileName':_0x273e0f,'version':_0x1b8434,'arch':_0x283ca1,'installedSize':_0x38ea8b,'description':_0x11b6d6});fs['writeFileSync'](path['join'](_0x5eea4f,'control'),_0x216608);console['log']('Writing desktop entry file into "'+_0x339d2f+'\x22');const _0x40c9a6=fs['readFileSync'](path['join'](CONFIG['repositoryRootPath'],_0x1ac519['GCQAh'],_0x1ac519['dnKLs'],_0x1ac519['aLcll']));const _0x4e63bc=_0x1ac519['UxToQ'](template,_0x40c9a6)({'appName':CONFIG['appName'],'appFileName':_0x273e0f,'description':_0x11b6d6,'installDir':_0x1ac519['Kmccc'],'iconPath':_0x273e0f});fs['writeFileSync'](path['join'](_0x339d2f,_0x273e0f+'.desktop'),_0x4e63bc);console['log']('Copying icon into "'+_0x4ce983+'\x22');fs['copySync'](path['join'](_0x3097c8,_0x1ac519['GCQAh'],'app.asar.unpacked',_0x1ac519['GCQAh'],_0x1ac519['PokzA']),path['join'](_0x4ce983,_0x273e0f+'.png'));console['log']('Copying license into "'+_0x10e677+'\x22');fs['copySync'](path['join'](_0x3097c8,'resources',_0x1ac519['bdTzn']),path['join'](_0x10e677,_0x1ac519['PyMMN']));console['log']('Copying polkit configuration into "'+_0xf5d5c6+'\x22');fs['copySync'](path['join'](CONFIG['repositoryRootPath'],'resources','linux','atom.policy'),path['join'](_0xf5d5c6,_0x1ac519['KuwXb'],_0x1ac519['oAnGV'],'atom-'+CONFIG['channel']+'.policy'));console['log']('Generating\x20.deb\x20file\x20from\x20'+_0x75e4f1);_0x1ac519['TDkFY'](spawnSync,_0x1ac519['AuxmH'],[_0x1ac519['ntJOu'],'-b',_0x75e4f1],{'stdio':'inherit'});console['log']('Copying generated package into "'+_0x3743b3+'\x22');fs['copySync'](_0x75e4f1+'.deb',_0x3743b3);};