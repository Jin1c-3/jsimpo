import{Meteor}from'meteor/meteor';import{Accounts}from'meteor/accounts-base';import{Template}from'meteor/templating';import{Tracker}from'meteor/tracker';import _0x523bf6 from'underscore';import _0x436d9c from'mem';import{APIClient}from'../../utils/client';import{saveUser,interestedUserIds}from'../../../client/startup/listenActiveUsers';import{Presence}from'../../../client/lib/presence';import'./userPresence.html';const data=new Map();const promises=new Map();const pending=new Map();const getAll=_0x523bf6['debounce'](async function getAll(){var fHcEPc={'DzQTU':function(callee){return callee();},'Cbvoo':function(callee){return callee();},'FNDjV':function(x,y){return x!==y;},'NVsMb':'HTFgj'};const ids=Array['from'](pending['keys']());if(ids['length']===0x0){return;}const params={'ids':ids};try{if(fHcEPc['FNDjV']('FSzfn','XPnTO')){const {users}=await APIClient['v1']['get']('users.presence',params);users['forEach'](user=>saveUser(user,!![]));ids['forEach'](id=>{const {resolve}=promises['get'](id);fHcEPc['DzQTU'](resolve);});}else{interestedUserIds['add'](id);const _0x182402=pending['get'](id)||new Promise((_0x141c47,_0x74ba9a)=>{promises['set'](id,{'resolve':resolve,'reject':reject});});pending['set'](id,_0x182402);return _0x182402;}}catch(_0x2d6ab2){if(fHcEPc['FNDjV'](fHcEPc['NVsMb'],fHcEPc['NVsMb'])){promises['set'](id,{'resolve':resolve,'reject':reject});}else{ids['forEach'](id=>{const {reject}=promises['get'](id);fHcEPc['Cbvoo'](reject);});}}},0x64);export const get=_0x436d9c(function get(id){var qVRcFy={'MhBLR':'lWTzq','LzLGE':'OtlMa'};interestedUserIds['add'](id);const promise=pending['get'](id)||new Promise((resolve,reject)=>{var rkjmHI={'gMzFd':function(callee){return callee();}};if(qVRcFy['MhBLR']===qVRcFy['LzLGE']){const {reject}=promises['get'](id);rkjmHI['gMzFd'](reject);}else{promises['set'](id,{'resolve':resolve,'reject':reject});}});pending['set'](id,promise);return promise;});const options={'threshold':0.1};let lastEntries=[];const handleEntries=function(entries){var qJwffa={'TpBgc':function(callee,param1){return callee(param1);}};lastEntries=entries['filter'](({isIntersecting})=>isIntersecting);lastEntries['forEach'](async entry=>{const {uid}=data['get'](entry['target']);await qJwffa['TpBgc'](get,uid);pending['delete'](uid);});getAll();};const featureExists=!!window['IntersectionObserver'];const observer=featureExists&&new IntersectionObserver(handleEntries,options);Tracker['autorun'](()=>{var XvjChs={'VbNgb':'hTrdJ'};const isConnected=Meteor['status']()['connected'];if(!Meteor['userId']()||!isConnected){if('hTrdJ'===XvjChs['VbNgb']){Presence['reset']();return Meteor['users']['update']({'status':{'$exists':!![]}},{'$unset':{'status':!![]}},{'multi':!![]});}else{Presence['reset']();interestedUserIds['clear']();}}_0x436d9c['clear'](get);Presence['restart']();if(featureExists){for(const node of data['keys']()){observer['unobserve'](node);observer['observe'](node);}return;}getAll();Accounts['onLogout'](()=>{Presence['reset']();interestedUserIds['clear']();});});Template['userPresence']['onRendered'](function(){if(!this['data']||!this['data']['uid']){return;}data['set'](this['firstNode'],this['data']);if(featureExists){return observer['observe'](this['firstNode']);}});