/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2020 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */
var Class=require('../../../utils/Class');var Clamp=require('../../../math/Clamp');var Components=require('../../components');var GameObject=require('../../GameObject');var GetBitmapTextSize=require('../GetBitmapTextSize');var ParseFromAtlas=require('../ParseFromAtlas');var ParseXMLBitmapFont=require('../ParseXMLBitmapFont');var Rectangle=require('../../../geom/rectangle/Rectangle');var Render=require('./BitmapTextRender');var BitmapText=new Class({'Extends':GameObject,'Mixins':[Components['Alpha'],Components['BlendMode'],Components['Depth'],Components['Mask'],Components['Origin'],Components['Pipeline'],Components['ScrollFactor'],Components['Texture'],Components['Tint'],Components['Transform'],Components['Visible'],Render],'initialize':function BitmapText(_0x3d0cb7,_0xbca3f4,_0x4a963b,_0x19d6d8,_0x2eb674,_0x2efbfa,_0x244e0e){var _0x590224={'DpOpC':'6|1|4|5|3|0|2','EDQWF':function(_0x936c14,_0x567c2b,_0x5e69d9,_0x53ee03,_0x5b7fb5){return _0x936c14(_0x567c2b,_0x5e69d9,_0x53ee03,_0x5b7fb5);},'ytEIZ':function(_0xbca3f4,_0x4a963b){return _0xbca3f4===_0x4a963b;},'tMXie':function(_0xbca3f4,_0x4a963b){return _0xbca3f4===_0x4a963b;},'Jjosm':function(_0xbca3f4,_0x4a963b){return _0xbca3f4!==_0x4a963b;},'LjFEx':'VjTtt','UtjLo':'bXprh','icbeH':'BitmapText','uexTO':'iaATc','Fkxhv':function(_0xbca3f4,_0x4a963b){return _0xbca3f4+_0x4a963b;}};if(_0x590224['tMXie'](_0x2eb674,undefined)){if(_0x590224['Jjosm'](_0x590224['LjFEx'],'VjTtt')){_0xbca3f4=0x0;}else{_0x2eb674='';}}if(_0x590224['tMXie'](_0x244e0e,undefined)){if(_0x590224['UtjLo']!==_0x590224['UtjLo']){this['_fontSize']=value;this['_dirty']=!![];}else{_0x244e0e=0x0;}}GameObject['call'](this,_0x3d0cb7,_0x590224['icbeH']);this['font']=_0x19d6d8;var _0x2e6704=this['scene']['sys']['cache']['bitmapFont']['get'](_0x19d6d8);if(!_0x2e6704){if('iaATc'!==_0x590224['uexTO']){var _0xb60a75=_0x590224['DpOpC']['split']('|'),_0x3e0743=0x0;while(!![]){switch(_0xb60a75[_0x3e0743++]){case'0':this['setTexture'](_0x2e6704['texture'],_0x2e6704['frame']);continue;case'1':this['fontData']=_0x2e6704['data'];continue;case'2':_0x590224['EDQWF'](GetBitmapTextSize,this,![],!![],this['_bounds']);continue;case'3':this['fromAtlas']=_0x590224['ytEIZ'](_0x2e6704['fromAtlas'],!![]);continue;case'4':this['_fontSize']=_0x2efbfa;continue;case'5':this['_align']=_0x244e0e;continue;case'6':this['font']=key;continue;}break;}}else{console['warn'](_0x590224['Fkxhv']('Invalid\x20BitmapText\x20key:\x20',_0x19d6d8));}}this['fontData']=_0x2e6704['data'];this['_text']='';this['_fontSize']=_0x2efbfa||this['fontData']['size'];this['_letterSpacing']=0x0;this['_align']=_0x244e0e;this['_bounds']=GetBitmapTextSize();this['_dirty']=!![];this['_maxWidth']=0x0;this['wordWrapCharCode']=0x20;this['charColors']=[];this['dropShadowX']=0x0;this['dropShadowY']=0x0;this['dropShadowColor']=0x0;this['dropShadowAlpha']=0.5;this['fromAtlas']=_0x2e6704['fromAtlas'];this['setTexture'](_0x2e6704['texture'],_0x2e6704['frame']);this['setPosition'](_0xbca3f4,_0x4a963b);this['setOrigin'](0x0,0x0);this['initPipeline']();this['setText'](_0x2eb674);},'setLeftAlign':function(){this['_align']=BitmapText['ALIGN_LEFT'];this['_dirty']=!![];return this;},'setCenterAlign':function(){this['_align']=BitmapText['ALIGN_CENTER'];this['_dirty']=!![];return this;},'setRightAlign':function(){this['_align']=BitmapText['ALIGN_RIGHT'];this['_dirty']=!![];return this;},'setFontSize':function(_0x3feeb5){this['_fontSize']=_0x3feeb5;this['_dirty']=!![];return this;},'setLetterSpacing':function(_0x59900f){var _0x1c3dc={'XRsBy':function(_0x45f037,_0x1d591f){return _0x45f037===_0x1d591f;},'fmjup':'RkDnu','oGNAu':'UBuWi'};if(_0x59900f===undefined){if(_0x1c3dc['XRsBy'](_0x1c3dc['fmjup'],_0x1c3dc['oGNAu'])){align=this['_align'];}else{_0x59900f=0x0;}}this['_letterSpacing']=_0x59900f;this['_dirty']=!![];return this;},'setText':function(_0x5e37b7){var _0x2fba56={'fqJWv':function(_0x549122,_0x24cb79){return _0x549122!==_0x24cb79;}};if(!_0x5e37b7&&_0x5e37b7!==0x0){_0x5e37b7='';}if(Array['isArray'](_0x5e37b7)){_0x5e37b7=_0x5e37b7['join']('\x0a');}if(_0x2fba56['fqJWv'](_0x5e37b7,this['text'])){this['_text']=_0x5e37b7['toString']();this['_dirty']=!![];this['updateDisplayOrigin']();}return this;},'setDropShadow':function(_0x220dfb,_0x57a095,_0x3c908d,_0x21c273){var _0x4cfd4c={'MgGgq':function(_0x220dfb,_0x57a095){return _0x220dfb===_0x57a095;},'UZSFb':function(_0x220dfb,_0x57a095){return _0x220dfb===_0x57a095;},'CTOuM':'IYQeF','CNLBG':function(_0x220dfb,_0x57a095){return _0x220dfb===_0x57a095;},'zckSx':'fARsO'};if(_0x4cfd4c['MgGgq'](_0x220dfb,undefined)){_0x220dfb=0x0;}if(_0x57a095===undefined){if(_0x4cfd4c['UZSFb']('VAivg',_0x4cfd4c['CTOuM'])){start=0x0;}else{_0x57a095=0x0;}}if(_0x3c908d===undefined){if(_0x4cfd4c['CNLBG'](_0x4cfd4c['zckSx'],'WraGf')){topLeft=-0x1;}else{_0x3c908d=0x0;}}if(_0x4cfd4c['CNLBG'](_0x21c273,undefined)){_0x21c273=0.5;}this['dropShadowX']=_0x220dfb;this['dropShadowY']=_0x57a095;this['dropShadowColor']=_0x3c908d;this['dropShadowAlpha']=_0x21c273;return this;},'setCharacterTint':function(_0x110c01,_0x4f89b6,_0x208374,_0x25b266,_0x10760b,_0x551ae7,_0xa5b11){var _0x134ea6={'mrilF':function(_0x3b6466,_0x3e3258){return _0x3b6466===_0x3e3258;},'XtIZT':'aPpXq','IjYnU':'PmsOW','LIYWg':function(_0x3454ad,_0x32e1bc){return _0x3454ad+_0x32e1bc;},'CIVZF':function(_0x3c10c8,_0x237f0b){return _0x3c10c8-_0x237f0b;},'VtSZb':function(_0x135b9f,_0x45f02e,_0x5ef4dd,_0x2957c9){return _0x135b9f(_0x45f02e,_0x5ef4dd,_0x2957c9);},'HEoaS':function(_0x2353af,_0xaf41f5){return _0x2353af<_0xaf41f5;},'veBcn':'oADkJ','uuGyu':'wbPMe'};if(_0x134ea6['mrilF'](_0x110c01,undefined)){if(_0x134ea6['mrilF'](_0x134ea6['XtIZT'],_0x134ea6['IjYnU'])){_0x10760b=_0x25b266;_0x551ae7=_0x25b266;_0xa5b11=_0x25b266;}else{_0x110c01=0x0;}}if(_0x4f89b6===undefined){_0x4f89b6=0x1;}if(_0x208374===undefined){_0x208374=![];}if(_0x134ea6['mrilF'](_0x25b266,undefined)){_0x25b266=-0x1;}if(_0x10760b===undefined){_0x10760b=_0x25b266;_0x551ae7=_0x25b266;_0xa5b11=_0x25b266;}var _0x2d4e36=this['text']['length'];if(_0x4f89b6===-0x1){_0x4f89b6=_0x2d4e36;}if(_0x110c01<0x0){_0x110c01=_0x134ea6['LIYWg'](_0x2d4e36,_0x110c01);}_0x110c01=Clamp(_0x110c01,0x0,_0x134ea6['CIVZF'](_0x2d4e36,0x1));var _0x4ca60b=_0x134ea6['VtSZb'](Clamp,_0x110c01+_0x4f89b6,_0x110c01,_0x2d4e36);var _0x417787=this['charColors'];for(var _0x32d3f1=_0x110c01;_0x134ea6['HEoaS'](_0x32d3f1,_0x4ca60b);_0x32d3f1++){var _0x4b7599=_0x417787[_0x32d3f1];if(_0x25b266===-0x1){_0x417787[_0x32d3f1]=null;}else{var _0x55569b=_0x208374?0x1:0x0;if(_0x4b7599){if(_0x134ea6['veBcn']!==_0x134ea6['uuGyu']){var _0x5b452d='2|3|0|4|1'['split']('|'),_0x307f23=0x0;while(!![]){switch(_0x5b452d[_0x307f23++]){case'0':_0x4b7599['tintTR']=_0x10760b;continue;case'1':_0x4b7599['tintBR']=_0xa5b11;continue;case'2':_0x4b7599['tintEffect']=_0x55569b;continue;case'3':_0x4b7599['tintTL']=_0x25b266;continue;case'4':_0x4b7599['tintBL']=_0x551ae7;continue;}break;}}else{return this['_maxWidth'];}}else{_0x417787[_0x32d3f1]={'tintEffect':_0x55569b,'tintTL':_0x25b266,'tintTR':_0x10760b,'tintBL':_0x551ae7,'tintBR':_0xa5b11};}}}return this;},'setWordTint':function(_0x2ec82c,_0x4e0415,_0x1351e5,_0x446dfb,_0x1c4baa,_0x67050,_0x4eab24){var _0x29f6db={'hjYzb':function(_0x5e4650,_0x12f003){return _0x5e4650!==_0x12f003;},'OLPzS':function(_0x317922,_0x58f0b7){return _0x317922===_0x58f0b7;},'loGtP':function(_0x1475c5,_0x16e83a){return _0x1475c5===_0x16e83a;},'NZYBn':'pNUCt','vcSNz':function(_0x47ea7f,_0x52de75){return _0x47ea7f<_0x52de75;},'uQsLX':function(_0x1a5e37,_0x3e0240){return _0x1a5e37===_0x3e0240;}};if(_0x29f6db['OLPzS'](_0x4e0415,undefined)){if(_0x29f6db['loGtP'](_0x29f6db['NZYBn'],_0x29f6db['NZYBn'])){_0x4e0415=0x1;}else{this['_maxWidth']=value;this['_dirty']=!![];if(_0x29f6db['hjYzb'](wordWrapCharCode,undefined)){this['wordWrapCharCode']=wordWrapCharCode;}return this;}}var _0x43344b=this['getTextBounds']();var _0x121873=_0x43344b['words'];var _0x5bf6bf=_0x29f6db['loGtP'](typeof _0x2ec82c,'number');var _0x3422db=0x0;for(var _0x536c28=0x0;_0x29f6db['vcSNz'](_0x536c28,_0x121873['length']);_0x536c28++){var _0x417381=_0x121873[_0x536c28];if(_0x5bf6bf&&_0x536c28===_0x2ec82c||!_0x5bf6bf&&_0x29f6db['uQsLX'](_0x417381['word'],_0x2ec82c)){this['setCharacterTint'](_0x417381['i'],_0x417381['word']['length'],_0x1351e5,_0x446dfb,_0x1c4baa,_0x67050,_0x4eab24);_0x3422db++;if(_0x29f6db['uQsLX'](_0x3422db,_0x4e0415)){return this;}}}return this;},'getTextBounds':function(_0x49c6b6){var _0x516b5a={'Moxhc':'1|0|5|3|6|2|4','Chbjz':function(_0x1eebd6,_0x1a994f,_0x17151d,_0x423d47,_0xd4c38c){return _0x1eebd6(_0x1a994f,_0x17151d,_0x423d47,_0xd4c38c);},'EXxKL':function(_0xc1a946,_0x3f8134){return _0xc1a946===_0x3f8134;},'cwJXp':function(_0x753ba8,_0x4df2ee){return _0x753ba8!==_0x4df2ee;},'nHvuC':function(_0x16ea34,_0x1bc35f){return _0x16ea34!==_0x1bc35f;},'SgaFv':'Lzivk','enPbf':'HeHcj','wjZEp':function(_0x4d61f8,_0x1265ad,_0x430b22,_0x34e421,_0x4946d0){return _0x4d61f8(_0x1265ad,_0x430b22,_0x34e421,_0x4946d0);}};var _0x215fc0=this['_bounds'];if(this['_dirty']||_0x49c6b6||_0x516b5a['cwJXp'](this['scaleX'],_0x215fc0['scaleX'])||_0x516b5a['nHvuC'](this['scaleY'],_0x215fc0['scaleY'])){if(_0x516b5a['nHvuC'](_0x516b5a['SgaFv'],_0x516b5a['enPbf'])){_0x516b5a['wjZEp'](GetBitmapTextSize,this,_0x49c6b6,!![],_0x215fc0);this['_dirty']=![];}else{var _0x3d4d6d=this['scene']['sys']['cache']['bitmapFont']['get'](key);if(_0x3d4d6d){var _0x386e2c=_0x516b5a['Moxhc']['split']('|'),_0x2b38bd=0x0;while(!![]){switch(_0x386e2c[_0x2b38bd++]){case'0':this['fontData']=_0x3d4d6d['data'];continue;case'1':this['font']=key;continue;case'2':this['setTexture'](_0x3d4d6d['texture'],_0x3d4d6d['frame']);continue;case'3':this['_align']=align;continue;case'4':_0x516b5a['Chbjz'](GetBitmapTextSize,this,![],!![],this['_bounds']);continue;case'5':this['_fontSize']=size;continue;case'6':this['fromAtlas']=_0x516b5a['EXxKL'](_0x3d4d6d['fromAtlas'],!![]);continue;}break;}}}}return _0x215fc0;},'getCharacterAt':function(_0x3041d9,_0x56c9b4,_0x24c874){var _0x1e1f5f={'wpETk':function(_0x3041d9,_0x56c9b4){return _0x3041d9===_0x56c9b4;},'PPXoD':'blXvC','Gfszc':function(_0x3041d9,_0x56c9b4){return _0x3041d9-_0x56c9b4;}};var _0x17faa4=this['getLocalPoint'](_0x3041d9,_0x56c9b4,null,_0x24c874);var _0x4ca8ca=this['getTextBounds']();var _0x4a0192=_0x4ca8ca['characters'];var _0x3df91e=new Rectangle();for(var _0x28e2c9=0x0;_0x28e2c9<_0x4a0192['length'];_0x28e2c9++){if(_0x1e1f5f['wpETk'](_0x1e1f5f['PPXoD'],_0x1e1f5f['PPXoD'])){var _0x1d2df6=_0x4a0192[_0x28e2c9];_0x3df91e['setTo'](_0x1d2df6['x'],_0x1d2df6['t'],_0x1e1f5f['Gfszc'](_0x1d2df6['r'],_0x1d2df6['x']),_0x1d2df6['b']);if(_0x3df91e['contains'](_0x17faa4['x'],_0x17faa4['y'])){return _0x1d2df6;}}else{this['_maxWidth']=value;this['_dirty']=!![];}}return null;},'updateDisplayOrigin':function(){this['_dirty']=!![];this['getTextBounds'](![]);return this;},'setFont':function(_0x50468b,_0x1191ea,_0x3da71a){var _0x10a14a={'OpCGd':function(_0x3e1ee1,_0x491bb7){return _0x3e1ee1===_0x491bb7;},'UqarN':function(_0x10e8d9,_0x5354d7){return _0x10e8d9===_0x5354d7;},'SABab':'fUUUM','icycS':'bgadm','eupYP':function(_0xe7700,_0x155662){return _0xe7700===_0x155662;}};if(_0x1191ea===undefined){_0x1191ea=this['_fontSize'];}if(_0x10a14a['OpCGd'](_0x3da71a,undefined)){if(_0x10a14a['UqarN'](_0x10a14a['SABab'],_0x10a14a['icycS'])){alpha=0.5;}else{_0x3da71a=this['_align'];}}if(_0x50468b!==this['font']){var _0x24dabf=this['scene']['sys']['cache']['bitmapFont']['get'](_0x50468b);if(_0x24dabf){this['font']=_0x50468b;this['fontData']=_0x24dabf['data'];this['_fontSize']=_0x1191ea;this['_align']=_0x3da71a;this['fromAtlas']=_0x10a14a['eupYP'](_0x24dabf['fromAtlas'],!![]);this['setTexture'](_0x24dabf['texture'],_0x24dabf['frame']);GetBitmapTextSize(this,![],!![],this['_bounds']);}}return this;},'setMaxWidth':function(_0x12fb1b,_0x5cb7d1){var _0x30f592={'BNQKU':function(_0x20716c,_0x2bef54){return _0x20716c!==_0x2bef54;}};this['_maxWidth']=_0x12fb1b;this['_dirty']=!![];if(_0x30f592['BNQKU'](_0x5cb7d1,undefined)){this['wordWrapCharCode']=_0x5cb7d1;}return this;},'align':{'set':function(_0x1538f4){this['_align']=_0x1538f4;this['_dirty']=!![];},'get':function(){return this['_align'];}},'text':{'set':function(_0x4233a4){this['setText'](_0x4233a4);},'get':function(){return this['_text'];}},'fontSize':{'set':function(_0x17e077){this['_fontSize']=_0x17e077;this['_dirty']=!![];},'get':function(){return this['_fontSize'];}},'letterSpacing':{'set':function(_0x33710d){this['_letterSpacing']=_0x33710d;this['_dirty']=!![];},'get':function(){return this['_letterSpacing'];}},'maxWidth':{'set':function(_0x3eaf24){this['_maxWidth']=_0x3eaf24;this['_dirty']=!![];},'get':function(){return this['_maxWidth'];}},'width':{'get':function(){this['getTextBounds'](![]);return this['_bounds']['global']['width'];}},'height':{'get':function(){this['getTextBounds'](![]);return this['_bounds']['global']['height'];}},'toJSON':function(){var _0x771eea=Components['ToJSON'](this);var _0x7e970={'font':this['font'],'text':this['text'],'fontSize':this['fontSize'],'letterSpacing':this['letterSpacing'],'align':this['align']};_0x771eea['data']=_0x7e970;return _0x771eea;},'preDestroy':function(){this['charColors']['length']=0x0;this['_bounds']=null;this['fontData']=null;}});BitmapText['ALIGN_LEFT']=0x0;BitmapText['ALIGN_CENTER']=0x1;BitmapText['ALIGN_RIGHT']=0x2;BitmapText['ParseFromAtlas']=ParseFromAtlas;BitmapText['ParseXMLBitmapFont']=ParseXMLBitmapFont;module['exports']=BitmapText;