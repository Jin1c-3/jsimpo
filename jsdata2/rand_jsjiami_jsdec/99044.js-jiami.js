'use strict';const fs=require('fs');const path=require('path');const {expect}=require('chai');const fse=require('fs-extra');const {execSync}=require('../utils/childProcess');const serverlessExec=require('../serverlessBinary');const {getTmpDirPath}=require('../utils/fs');const fixturePaths={'regular':path['join'](__dirname,'fixtures/regular'),'individually':path['join'](__dirname,'fixtures/individually'),'artifact':path['join'](__dirname,'fixtures/artifact')};describe('Integration\x20test\x20-\x20Packaging\x20-\x20CloudFormation',()=>{var _0x1b317b={'BFplB':function(_0x26ca64){return _0x26ca64();},'zFBeO':function(_0x582e43,_0x107327,_0xb9b9d9){return _0x582e43(_0x107327,_0xb9b9d9);},'DAiXo':'.serverless/cloudformation-template-update-stack.json','OmnEw':function(_0x5ca1aa,_0x20d2c6){return _0x5ca1aa(_0x20d2c6);},'rWudp':'ServerlessDeploymentBucket','jAQuI':'Arn','yKtOn':'nodejs12.x','Lffrg':function(_0x112ff5,_0x330799){return _0x112ff5!==_0x330799;},'UsggJ':'gUUUE','Vyybj':function(_0x3c6733,_0x11d669,_0x2b3033){return _0x3c6733(_0x11d669,_0x2b3033);},'wUEeG':function(_0x26610a,_0x22ed35){return _0x26610a(_0x22ed35);},'lJLvZ':'AWS::Lambda::Function','VZqLj':'aws-nodejs-dev-hello','aROTA':function(_0xf973f6,_0x12eb4a,_0x360a73){return _0xf973f6(_0x12eb4a,_0x360a73);},'vVzPq':'handler.hello','wDYCS':'HelloLogGroup','SLdvs':function(_0x4a30d1,_0x5df104,_0x5cf09b){return _0x4a30d1(_0x5df104,_0x5cf09b);},'yEyyN':function(_0x413201,_0x4001d4){return _0x413201(_0x4001d4);},'dRPwI':function(_0x2d90e1,_0x2ee24e){return _0x2d90e1(_0x2ee24e);},'ONYAq':function(_0x19ea37,_0x3e1c49){return _0x19ea37(_0x3e1c49);},'gWJjG':'IamRoleLambdaExecution','LMwfM':'SUpmR','sgMim':function(_0xc22d7e,_0x42cf65,_0x13aae2){return _0xc22d7e(_0x42cf65,_0x13aae2);},'QIlwF':'aws-nodejs-us-east-1-custom-name','aYSPt':function(_0x16411b,_0x14c1f2,_0x53a7ca){return _0x16411b(_0x14c1f2,_0x53a7ca);},'xjHQN':'package artifact directive works','pNoXH':'creates\x20the\x20correct\x20default\x20function\x20resource\x20in\x20cfn\x20template','WjxvP':'resolves self.provider.region'};let _0x4b09c8;_0x1b317b['ONYAq'](beforeEach,()=>{_0x4b09c8=_0x1b317b['BFplB'](getTmpDirPath);});_0x1b317b['aYSPt'](it,_0x1b317b['xjHQN'],()=>{if(_0x1b317b['Lffrg']('gUUUE',_0x1b317b['UsggJ'])){fse['copySync'](fixturePaths['artifact'],_0x4b09c8);_0x1b317b['zFBeO'](execSync,serverlessExec+' package',{'cwd':_0x4b09c8});const _0x5da451=JSON['parse'](fs['readFileSync'](path['join'](_0x4b09c8,_0x1b317b['DAiXo'])));expect(_0x5da451['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'])['to']['match'](/serverless\/aws-nodejs\/dev\/[^]*\/artifact.zip/);delete _0x5da451['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'];_0x1b317b['OmnEw'](expect,_0x5da451['Resources']['HelloLambdaFunction'])['to']['deep']['equal']({'Type':'AWS::Lambda::Function','Properties':{'Code':{'S3Bucket':{'Ref':_0x1b317b['rWudp']}},'FunctionName':'aws-nodejs-dev-hello','Handler':'handler.hello','MemorySize':0x400,'Role':{'Fn::GetAtt':['IamRoleLambdaExecution',_0x1b317b['jAQuI']]},'Runtime':_0x1b317b['yKtOn'],'Timeout':0x6},'DependsOn':['HelloLogGroup']});}else{fse['copySync'](fixturePaths['artifact'],_0x4b09c8);_0x1b317b['Vyybj'](execSync,serverlessExec+' package',{'cwd':_0x4b09c8});const _0x2fa56a=JSON['parse'](fs['readFileSync'](path['join'](_0x4b09c8,_0x1b317b['DAiXo'])));_0x1b317b['OmnEw'](expect,_0x2fa56a['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'])['to']['match'](/serverless\/aws-nodejs\/dev\/[^]*\/artifact.zip/);delete _0x2fa56a['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'];_0x1b317b['wUEeG'](expect,_0x2fa56a['Resources']['HelloLambdaFunction'])['to']['deep']['equal']({'Type':_0x1b317b['lJLvZ'],'Properties':{'Code':{'S3Bucket':{'Ref':'ServerlessDeploymentBucket'}},'FunctionName':_0x1b317b['VZqLj'],'Handler':'handler.hello','MemorySize':0x400,'Role':{'Fn::GetAtt':['IamRoleLambdaExecution',_0x1b317b['jAQuI']]},'Runtime':_0x1b317b['yKtOn'],'Timeout':0x6},'DependsOn':['HelloLogGroup']});}});_0x1b317b['aYSPt'](it,_0x1b317b['pNoXH'],()=>{fse['copySync'](fixturePaths['regular'],_0x4b09c8);_0x1b317b['aROTA'](execSync,serverlessExec+' package',{'cwd':_0x4b09c8});const _0x59c7c1=JSON['parse'](fs['readFileSync'](path['join'](_0x4b09c8,'.serverless/cloudformation-template-update-stack.json')));_0x1b317b['wUEeG'](expect,_0x59c7c1['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'])['to']['match'](/serverless\/aws-nodejs\/dev\/[^]*\/aws-nodejs.zip/);delete _0x59c7c1['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'];expect(_0x59c7c1['Resources']['HelloLambdaFunction'])['to']['deep']['equal']({'Type':_0x1b317b['lJLvZ'],'Properties':{'Code':{'S3Bucket':{'Ref':_0x1b317b['rWudp']}},'FunctionName':_0x1b317b['VZqLj'],'Handler':_0x1b317b['vVzPq'],'MemorySize':0x400,'Role':{'Fn::GetAtt':['IamRoleLambdaExecution',_0x1b317b['jAQuI']]},'Runtime':'nodejs12.x','Timeout':0x6},'DependsOn':[_0x1b317b['wDYCS']]});});it('handles package individually with include/excludes correctly',()=>{fse['copySync'](fixturePaths['individually'],_0x4b09c8);_0x1b317b['SLdvs'](execSync,serverlessExec+' package',{'cwd':_0x4b09c8});const _0x50a064=JSON['parse'](fs['readFileSync'](path['join'](_0x4b09c8,_0x1b317b['DAiXo'])));_0x1b317b['yEyyN'](expect,_0x50a064['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'])['to']['match'](/serverless\/aws-nodejs\/dev\/[^]*\/hello.zip/);_0x1b317b['dRPwI'](expect,_0x50a064['Resources']['Hello2LambdaFunction']['Properties']['Code']['S3Key'])['to']['match'](/serverless\/aws-nodejs\/dev\/[^]*\/hello2.zip/);delete _0x50a064['Resources']['HelloLambdaFunction']['Properties']['Code']['S3Key'];_0x1b317b['ONYAq'](expect,_0x50a064['Resources']['HelloLambdaFunction'])['to']['deep']['equal']({'Type':'AWS::Lambda::Function','Properties':{'Code':{'S3Bucket':{'Ref':_0x1b317b['rWudp']}},'FunctionName':_0x1b317b['VZqLj'],'Handler':_0x1b317b['vVzPq'],'MemorySize':0x400,'Role':{'Fn::GetAtt':[_0x1b317b['gWJjG'],'Arn']},'Runtime':'nodejs12.x','Timeout':0x6},'DependsOn':[_0x1b317b['wDYCS']]});});it(_0x1b317b['WjxvP'],()=>{var _0x1d8b38={'CFHuR':function(_0x5afec4){return _0x1b317b['BFplB'](_0x5afec4);}};if(_0x1b317b['LMwfM']==='SUpmR'){fse['copySync'](fixturePaths['regular'],_0x4b09c8);_0x1b317b['sgMim'](execSync,serverlessExec+' package',{'cwd':_0x4b09c8});const _0x384b41=JSON['parse'](fs['readFileSync'](path['join'](_0x4b09c8,_0x1b317b['DAiXo'])));_0x1b317b['ONYAq'](expect,_0x384b41['Resources']['CustomDashnameLambdaFunction']['Properties']['FunctionName'])['to']['equal'](_0x1b317b['QIlwF']);}else{_0x4b09c8=_0x1d8b38['CFHuR'](getTmpDirPath);}});});