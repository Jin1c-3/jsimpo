const errors=require('@tryghost/errors');const _=require('lodash');const should=require('should');const sinon=require('sinon');const Promise=require('bluebird');const validators=require('../../../../../../../core/server/api/canary/utils/validators');describe('Unit: canary/utils/validators/input/tags',function(){var _0x4d797b={'qRLXe':function(_0xdb6819,_0x331abd){return _0xdb6819!==_0x331abd;},'uSwtE':'akqUO','DyAJd':'gtURL','HhlFe':'ValidationError','voNjT':'gZcAn','pTakM':function(_0xe43e89,_0x36658e){return _0xe43e89===_0x36658e;},'qOjqs':'BoCGL','rLICO':'eqYhU','GKLXm':'HiKOT','eFoQQ':function(_0x72f76d,_0x185b42,_0x2c1826){return _0x72f76d(_0x185b42,_0x2c1826);},'CkAAT':function(_0x593bda,_0x5ed1ed,_0x3da11c){return _0x593bda(_0x5ed1ed,_0x3da11c);},'cxvgM':'should fail with no tags','CndZx':function(_0xc4a2db,_0x10c3b0,_0x7fffdb){return _0xc4a2db(_0x10c3b0,_0x7fffdb);},'pnUTn':'should\x20fail\x20with\x20no\x20tags\x20in\x20array','vNsVL':function(_0x598c4d,_0x3318d1,_0x7c004c){return _0x598c4d(_0x3318d1,_0x7c004c);},'XOWqK':'should fail with more than tags','OlduB':function(_0x5319a0,_0x16b1b3,_0xaa136b){return _0x5319a0(_0x16b1b3,_0xaa136b);},'ygneS':'should fail without required fields','bmgZS':'should\x20remove\x20`strip`able\x20fields\x20and\x20leave\x20regular\x20fields','eHCuT':'YMUzx','CngdD':'qOEob','JfIkH':'not uri','JIBkz':'abc','jVVBV':'DhsCb','Hdkpj':'pass','fjnGy':'strip me','pXHmn':'iOMBd','fxzIH':'tags','oJjgN':'required fields','sybKp':'YYJgK','iAaJt':function(_0x17c7e0,_0x21b095){return _0x17c7e0!==_0x21b095;},'iCpXp':'Ysash','sFvbv':'eWdYs','JXriW':'OjHiC','AIMuw':'ErBJp','BqfaY':'OfwmD','hVHYX':'Ahrws','dNXVA':function(_0xeb138d,_0x1a494c,_0x16adf2){return _0xeb138d(_0x1a494c,_0x16adf2);},'YbkNP':function(_0x5c99ac,_0x15dd2c,_0x3f7802){return _0x5c99ac(_0x15dd2c,_0x3f7802);},'kBNkD':'should pass with some fields','YjCeO':'UsjuK','UwkTC':function(_0x28725b,_0x50c080){return _0x28725b(_0x50c080);},'RBzSq':'add','MpeSP':function(_0x3606cc,_0x553d48,_0x1f5d99){return _0x3606cc(_0x553d48,_0x1f5d99);},'NXoQw':'edit'};_0x4d797b['UwkTC'](afterEach,function(){if(_0x4d797b['qRLXe'](_0x4d797b['uSwtE'],_0x4d797b['DyAJd'])){sinon['restore']();}else{const _0x3cf4b8={'options':{},'data':{'tags':[]}};return validators['input']['tags']['add'](apiConfig,_0x3cf4b8)['then'](Promise['reject'])['catch'](_0x2ab32b=>{_0x2ab32b['errorType']['should']['equal']('ValidationError');});}});describe(_0x4d797b['RBzSq'],function(){var _0xc1e21a={'AIYqP':_0x4d797b['jVVBV'],'KrwWa':'ValidationError','gBFKV':_0x4d797b['Hdkpj'],'eVjFA':_0x4d797b['fjnGy'],'smRtq':function(_0x1bc187,_0x483727){return _0x4d797b['pTakM'](_0x1bc187,_0x483727);},'OpUfl':'abuYW','YMYCj':'NXRFW'};if(_0x4d797b['pTakM'](_0x4d797b['pXHmn'],'arTKH')){sinon['restore']();}else{const _0xdb2d9={'docName':_0x4d797b['fxzIH'],'method':'add'};_0x4d797b['OlduB'](describe,_0x4d797b['oJjgN'],function(){var _0x6ec868={'gclZA':_0x4d797b['HhlFe'],'uzkMb':function(_0x37ffc4,_0x1fad7a){return _0x37ffc4!==_0x1fad7a;},'kxAVN':_0x4d797b['voNjT'],'mEfic':'WuYxs','znHeo':function(_0x25e0ef,_0x4e4494){return _0x4d797b['pTakM'](_0x25e0ef,_0x4e4494);},'wkDhR':_0x4d797b['qOjqs'],'WPBph':'a\x20fail'};if(_0x4d797b['rLICO']===_0x4d797b['GKLXm']){const _0x4edd18={'options':{},'data':{'tags':[{'name':'pass'}]}};return validators['input']['tags']['edit'](_0xdb2d9,_0x4edd18);}else{_0x4d797b['eFoQQ'](it,'should fail with no data',function(){var _0x2e5c66={'sUrqF':_0xc1e21a['AIYqP'],'mwXEE':'ValidationError'};const _0x3c45df={'options':{},'data':{}};return validators['input']['tags']['add'](_0xdb2d9,_0x3c45df)['then'](Promise['reject'])['catch'](_0x514e78=>{var _0x4e5383={'brgRx':'a fail'};if('OoamA'===_0x2e5c66['sUrqF']){const _0x29605d={'options':{},'data':{'tags':[{'what':_0x4e5383['brgRx']}]}};return validators['input']['tags']['add'](_0xdb2d9,_0x29605d)['then'](Promise['reject'])['catch'](_0x54617d=>{_0x54617d['errorType']['should']['equal']('ValidationError');});}else{_0x514e78['errorType']['should']['equal'](_0x2e5c66['mwXEE']);}});});_0x4d797b['CkAAT'](it,_0x4d797b['cxvgM'],function(){const _0x541022={'options':{},'data':{'posts':[]}};return validators['input']['tags']['add'](_0xdb2d9,_0x541022)['then'](Promise['reject'])['catch'](_0x3633d4=>{_0x3633d4['errorType']['should']['equal']('ValidationError');});});_0x4d797b['CndZx'](it,_0x4d797b['pnUTn'],function(){const _0x5111e1={'options':{},'data':{'tags':[]}};return validators['input']['tags']['add'](_0xdb2d9,_0x5111e1)['then'](Promise['reject'])['catch'](_0x526ef7=>{_0x526ef7['errorType']['should']['equal'](_0x6ec868['gclZA']);});});_0x4d797b['vNsVL'](it,_0x4d797b['XOWqK'],function(){var _0x31016c={'gcclG':_0xc1e21a['KrwWa']};const _0x3083fe={'options':{},'data':{'tags':[],'posts':[]}};return validators['input']['tags']['add'](_0xdb2d9,_0x3083fe)['then'](Promise['reject'])['catch'](_0x44f701=>{_0x44f701['errorType']['should']['equal'](_0x31016c['gcclG']);});});_0x4d797b['OlduB'](it,_0x4d797b['ygneS'],function(){var _0x45ce93={'OVhTz':_0x6ec868['gclZA']};if(_0x6ec868['znHeo']('eNpQU',_0x6ec868['wkDhR'])){err['errorType']['should']['equal'](_0x6ec868['gclZA']);}else{const _0x325923={'options':{},'data':{'tags':[{'what':_0x6ec868['WPBph']}]}};return validators['input']['tags']['add'](_0xdb2d9,_0x325923)['then'](Promise['reject'])['catch'](_0x276380=>{if(_0x6ec868['uzkMb'](_0x6ec868['kxAVN'],_0x6ec868['mEfic'])){_0x276380['errorType']['should']['equal']('ValidationError');}else{_0x276380['errorType']['should']['equal'](_0x45ce93['OVhTz']);}});}});_0x4d797b['OlduB'](it,'should\x20pass\x20with\x20required\x20fields',function(){const _0x17ca83={'options':{},'data':{'tags':[{'name':'pass'}]}};return validators['input']['tags']['add'](_0xdb2d9,_0x17ca83);});it(_0x4d797b['bmgZS'],function(){var _0x2ffadc={'YyLwg':_0xc1e21a['gBFKV'],'tErNx':_0xc1e21a['eVjFA']};if(_0xc1e21a['smRtq'](_0xc1e21a['OpUfl'],_0xc1e21a['YMYCj'])){const _0x1d24eb={'options':{},'data':{'tags':[{'name':_0x2ffadc['YyLwg'],'parent':'strip me','created_at':_0x2ffadc['tErNx'],'created_by':_0x2ffadc['tErNx'],'updated_at':'strip me','updated_by':_0x2ffadc['tErNx']}]}};let _0x12295b=validators['input']['tags']['add'](_0xdb2d9,_0x1d24eb);should['exist'](_0x1d24eb['data']['tags'][0x0]['name']);should['not']['exist'](_0x1d24eb['data']['tags'][0x0]['parent']);should['not']['exist'](_0x1d24eb['data']['tags'][0x0]['created_at']);should['not']['exist'](_0x1d24eb['data']['tags'][0x0]['created_by']);should['not']['exist'](_0x1d24eb['data']['tags'][0x0]['updated_at']);should['not']['exist'](_0x1d24eb['data']['tags'][0x0]['updated_by']);return _0x12295b;}else{const _0xba360c={'options':{},'data':{'tags':[{'name':_0xc1e21a['gBFKV'],'parent':_0xc1e21a['eVjFA'],'created_at':_0xc1e21a['eVjFA'],'created_by':_0xc1e21a['eVjFA'],'updated_at':_0xc1e21a['eVjFA'],'updated_by':_0xc1e21a['eVjFA']}]}};let _0x212991=validators['input']['tags']['add'](_0xdb2d9,_0xba360c);should['exist'](_0xba360c['data']['tags'][0x0]['name']);should['not']['exist'](_0xba360c['data']['tags'][0x0]['parent']);should['not']['exist'](_0xba360c['data']['tags'][0x0]['created_at']);should['not']['exist'](_0xba360c['data']['tags'][0x0]['created_by']);should['not']['exist'](_0xba360c['data']['tags'][0x0]['updated_at']);should['not']['exist'](_0xba360c['data']['tags'][0x0]['updated_by']);return _0x212991;}});}});_0x4d797b['OlduB'](describe,'field formats',function(){var _0x4a8864={'YYkLf':_0x4d797b['eHCuT'],'rtghW':_0x4d797b['CngdD'],'ydDUm':function(_0x3beece,_0x4d6975,_0x5d3a04){return _0x3beece(_0x4d6975,_0x5d3a04);}};const _0x2f5c6c={'name':[0x7b,new Date(),',starts-with-coma','',_['repeat']('a',0xc0),null],'slug':[0x7b,new Date(),_['repeat']('a',0xc0)],'description':[0x7b,new Date(),_['repeat']('a',0x1f5)],'feature_image':[0x7b,new Date(),_0x4d797b['JfIkH']],'visibility':[0x7b,new Date(),_0x4d797b['JIBkz'],null],'meta_title':[0x7b,new Date(),_['repeat']('a',0x12d)],'meta_description':[0x7b,new Date(),_['repeat']('a',0x1f5)]};Object['keys'](_0x2f5c6c)['forEach'](_0x4e56ae=>{var _0xdc0b0b={'ncUNO':function(_0x24d862,_0x2f5d7d){return _0x24d862===_0x2f5d7d;},'SPaSi':_0x4a8864['YYkLf']};if(_0x4a8864['rtghW']==='qOEob'){_0x4a8864['ydDUm'](it,'should fail for bad '+_0x4e56ae,function(){var _0x28be9e={'FciiB':'name'};if(_0xdc0b0b['ncUNO'](_0xdc0b0b['SPaSi'],'YMUzx')){const _0x2e6c61=_0x2f5c6c[_0x4e56ae];const _0x3198a5=_0x2e6c61['map'](_0x449567=>{var _0x2d6fb5={'ZLONZ':'ValidationError'};const _0x128703={};_0x128703[_0x4e56ae]=_0x449567;if(_0x4e56ae!==_0x28be9e['FciiB']){_0x128703['name']='abc';}const _0x3ef796={'options':{},'data':{'tags':[_0x128703]}};return validators['input']['tags']['add'](_0xdb2d9,_0x3ef796)['then'](Promise['reject'])['catch'](_0x846d05=>{_0x846d05['errorType']['should']['equal'](_0x2d6fb5['ZLONZ']);});});return Promise['all'](_0x3198a5);}else{err['errorType']['should']['equal']('ValidationError');}});}else{const _0x1bc9e6={'options':{},'data':{'posts':[]}};return validators['input']['tags']['edit'](_0xdb2d9,_0x1bc9e6)['then'](Promise['reject'])['catch'](_0x272bca=>{_0x272bca['errorType']['should']['equal']('ValidationError');});}});});}});_0x4d797b['MpeSP'](describe,_0x4d797b['NXoQw'],function(){var _0x56eb16={'MCISa':_0x4d797b['HhlFe'],'FAfnD':'pass'};if(_0x4d797b['YjCeO']===_0x4d797b['YjCeO']){const _0x43380f={'docName':_0x4d797b['fxzIH'],'method':'edit'};_0x4d797b['YbkNP'](describe,_0x4d797b['oJjgN'],function(){var _0xc22565={'QzdBM':function(_0x3f07e8,_0x3278be){return _0x4d797b['qRLXe'](_0x3f07e8,_0x3278be);},'iWxdO':_0x4d797b['sybKp'],'aOIIj':'ValidationError','AThSB':function(_0x537850,_0x9ba64b){return _0x4d797b['iAaJt'](_0x537850,_0x9ba64b);},'NTnHV':_0x4d797b['iCpXp'],'ygLgD':'ahGds','OHRRm':_0x4d797b['sFvbv'],'XieqA':_0x4d797b['JXriW'],'GXFhs':function(_0x3ee69c,_0x574bc1){return _0x4d797b['pTakM'](_0x3ee69c,_0x574bc1);},'AKvAT':_0x4d797b['AIMuw'],'FgAly':_0x4d797b['BqfaY']};if('Ahrws'!==_0x4d797b['hVHYX']){var _0x3b0176={'beZvq':'ValidationError'};const _0x3c5eb9={'options':{},'data':{'posts':[]}};return validators['input']['tags']['add'](_0x43380f,_0x3c5eb9)['then'](Promise['reject'])['catch'](_0x1707db=>{_0x1707db['errorType']['should']['equal'](_0x3b0176['beZvq']);});}else{it('should fail with no data',function(){var _0x1f9e5a={'BYpIx':_0xc22565['aOIIj']};if(_0xc22565['AThSB']('uzyWt',_0xc22565['NTnHV'])){const _0x74b305={'options':{},'data':{}};return validators['input']['tags']['edit'](_0x43380f,_0x74b305)['then'](Promise['reject'])['catch'](_0x459df7=>{if(_0xc22565['QzdBM']('YYJgK',_0xc22565['iWxdO'])){_0x459df7['errorType']['should']['equal'](_0x1f9e5a['BYpIx']);}else{_0x459df7['errorType']['should']['equal'](_0xc22565['aOIIj']);}});}else{var _0x1f701={'YYjKL':'ValidationError'};const _0x34e824={'options':{},'data':{}};return validators['input']['tags']['add'](_0x43380f,_0x34e824)['then'](Promise['reject'])['catch'](_0x35d01e=>{_0x35d01e['errorType']['should']['equal'](_0x1f701['YYjKL']);});}});_0x4d797b['OlduB'](it,_0x4d797b['cxvgM'],function(){if(_0xc22565['XieqA']!=='GoVCI'){const _0x373717={'options':{},'data':{'posts':[]}};return validators['input']['tags']['edit'](_0x43380f,_0x373717)['then'](Promise['reject'])['catch'](_0x21cc73=>{var _0x350d19={'FbGLf':'pass'};if(_0xc22565['AThSB'](_0xc22565['ygLgD'],_0xc22565['OHRRm'])){_0x21cc73['errorType']['should']['equal'](_0xc22565['aOIIj']);}else{const _0x59b4dc={'options':{},'data':{'tags':[{'name':_0x350d19['FbGLf']}]}};return validators['input']['tags']['add'](_0x43380f,_0x59b4dc);}});}else{err['errorType']['should']['equal']('ValidationError');}});_0x4d797b['dNXVA'](it,_0x4d797b['XOWqK'],function(){var _0x245ee5={'raAYJ':_0x56eb16['MCISa']};const _0x30b2e0={'options':{},'data':{'tags':[],'posts':[]}};return validators['input']['tags']['edit'](_0x43380f,_0x30b2e0)['then'](Promise['reject'])['catch'](_0x432822=>{if(_0xc22565['GXFhs'](_0xc22565['AKvAT'],_0xc22565['FgAly'])){_0x432822['errorType']['should']['equal'](_0x245ee5['raAYJ']);}else{_0x432822['errorType']['should']['equal'](_0xc22565['aOIIj']);}});});_0x4d797b['YbkNP'](it,_0x4d797b['kBNkD'],function(){const _0x4ecd63={'options':{},'data':{'tags':[{'name':_0x56eb16['FAfnD']}]}};return validators['input']['tags']['edit'](_0x43380f,_0x4ecd63);});}});}else{err['errorType']['should']['equal']('ValidationError');}});});