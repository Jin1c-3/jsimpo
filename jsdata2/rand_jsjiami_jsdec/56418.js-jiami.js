// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
'use strict';const common=require('../common');if(!common['hasCrypto'])common['skip']('missing\x20crypto');const assert=require('assert');const tls=require('tls');const fixtures=require('../common/fixtures');const options={'key':fixtures['readKey']('rsa_private.pem'),'cert':fixtures['readKey']('rsa_cert.crt')};const server=tls['createServer'](options,function(_0x1261cf){_0x1261cf['pipe'](_0x1261cf);_0x1261cf['on']('end',()=>_0x1261cf['end']());})['listen'](0x0,common['mustCall'](function(){var _0x531bf1={'AgOiB':function(_0x3ee841){return _0x3ee841();}};_0x531bf1['AgOiB'](unauthorized);}));function unauthorized(){var _0x23d05e={'tNMrZ':function(_0x62c476,_0xedf446,_0x185318){return _0x62c476(_0xedf446,_0x185318);},'KIyRC':'data failed to echo!','dCsPI':function(_0x588a77){return _0x588a77();},'GNfic':function(_0x41b4f2,_0x20870f){return _0x41b4f2===_0x20870f;},'ZwYCc':'QzDGM','ikPVC':'end','AadyD':'connect\x20unauthorized','ZfnoN':'session','nAKgD':'error'};console['log'](_0x23d05e['AadyD']);const _0xbae691=tls['connect']({'port':server['address']()['port'],'servername':'localhost','rejectUnauthorized':![]},common['mustCall'](function(){var _0x4fc85d={'AvOlD':function(_0x571e2d,_0x3e2b85,_0x72b8f9){return _0x23d05e['tNMrZ'](_0x571e2d,_0x3e2b85,_0x72b8f9);},'kQDNa':_0x23d05e['KIyRC'],'OoSYT':function(_0x15e70e){return _0x23d05e['dCsPI'](_0x15e70e);}};if(_0x23d05e['GNfic'](_0x23d05e['ZwYCc'],_0x23d05e['ZwYCc'])){let _0x5b15ea;assert(!_0xbae691['authorized']);_0xbae691['on']('data',common['mustCall'](_0x36f85a=>{assert['strictEqual'](_0x36f85a['toString'](),'ok');_0x5b15ea=_0x36f85a;}));_0xbae691['on'](_0x23d05e['ikPVC'],common['mustCall'](()=>{_0x4fc85d['AvOlD'](assert,_0x5b15ea,_0x4fc85d['kQDNa']);}));_0xbae691['on'](_0x23d05e['ikPVC'],()=>rejectUnauthorized());}else{_0x4fc85d['OoSYT'](rejectUnauthorizedUndefined);}}));_0xbae691['once'](_0x23d05e['ZfnoN'],common['mustCall'](()=>{}));_0xbae691['on'](_0x23d05e['nAKgD'],common['mustNotCall']());_0xbae691['end']('ok');}function rejectUnauthorized(){console['log']('reject unauthorized');const _0x46ab15=tls['connect'](server['address']()['port'],{'servername':'localhost'},common['mustNotCall']());_0x46ab15['on']('data',common['mustNotCall']());_0x46ab15['on']('error',common['mustCall'](function(_0x78e7f9){rejectUnauthorizedUndefined();}));_0x46ab15['end']('ng');}function rejectUnauthorizedUndefined(){var _0x260cf9={'iHCBa':function(_0x1d7d37){return _0x1d7d37();},'lrUUQ':'reject\x20unauthorized\x20undefined','aoHMX':'data','mAprx':'error'};console['log'](_0x260cf9['lrUUQ']);const _0x48f5de=tls['connect'](server['address']()['port'],{'servername':'localhost','rejectUnauthorized':undefined},common['mustNotCall']());_0x48f5de['on'](_0x260cf9['aoHMX'],common['mustNotCall']());_0x48f5de['on'](_0x260cf9['mAprx'],common['mustCall'](function(_0x2f271a){_0x260cf9['iHCBa'](authorized);}));_0x48f5de['end']('ng');}function authorized(){var _0x4bb57f={'HgNQO':'... authorized','GsqLw':function(_0x1f8dd5,_0x396308){return _0x1f8dd5(_0x396308);},'gIOVN':'data','FBfdE':'end','okZbl':'rsa_cert.crt','huLWp':'localhost','zwKCP':'error'};console['log']('connect authorized');const _0x2a477a=tls['connect'](server['address']()['port'],{'ca':[fixtures['readKey'](_0x4bb57f['okZbl'])],'servername':_0x4bb57f['huLWp']},common['mustCall'](function(){console['log'](_0x4bb57f['HgNQO']);_0x4bb57f['GsqLw'](assert,_0x2a477a['authorized']);_0x2a477a['on'](_0x4bb57f['gIOVN'],common['mustCall'](_0x198003=>{assert['strictEqual'](_0x198003['toString'](),'ok');}));_0x2a477a['on'](_0x4bb57f['FBfdE'],()=>server['close']());}));_0x2a477a['on'](_0x4bb57f['zwKCP'],common['mustNotCall']());_0x2a477a['end']('ok');}