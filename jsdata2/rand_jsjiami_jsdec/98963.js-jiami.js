'use strict';const {expect}=require('chai');const path=require('path');const fs=require('fs');const os=require('os');const overrideEnv=require('process-utils/override-env');const overrideCwd=require('process-utils/override-cwd');const proxyquire=require('proxyquire');const resolveLocalServerless=require('../../../../../lib/cli/resolve-local-serverless-path');const commandsSchema=require('../../../../../lib/cli/commands-schema');const runServerless=require('../../../../utils/run-serverless');const fixtures=require('../../../../fixtures/programmatic');const versions={'serverless':require('../../../../../package')['version'],'@serverless/dashboard-plugin':require('@serverless/dashboard-plugin/package')['version']};const generatePayload=proxyquire('../../../../../lib/utils/telemetry/generatePayload',{'@serverless/utils/get-notifications-mode':()=>'on'});describe('test/unit/lib/utils/telemetry/generatePayload.test.js',()=>{var _0x2a11db={'uPhyj':function(_0x587e6d,_0x22efbf){return _0x587e6d(_0x22efbf);},'dSZfI':'foo','tYhnX':function(_0x24a35c,_0x5905fe){return _0x24a35c(_0x5905fe);},'JUXuW':'frameworkLocalUserId','xaGJS':'firstLocalInstallationTimestamp','kzpfO':'dashboard','UWIoq':'ciName','OLkis':'commandDurationMs','CKAch':'aws','qUSDU':'nodejs12.x','JDQuT':'global:other','kWsrI':'oVzPK','msuxN':function(_0x436373,_0x4dd5c1){return _0x436373!==_0x4dd5c1;},'FuKoQ':'RIGQp','gMkAZ':'MrzqA','XHZON':'nodejs14.x','WyNID':'000000000000.dkr.ecr.sa-east-1.amazonaws.com/test-lambda-docker@sha256:6bb600b4d6e1d7cf521097177dd0c4e9ea373edb91984a505333be8ac9455d38','TDxHK':'/aws/lambda/extra-log','xASrv':'AWS::Logs::LogGroup','iIKym':'/aws/lambda/extra-log-2','niEWm':'AWS::S3::Bucket','IjSNw':'package.json','jzwSt':function(_0x5a6a64,_0x222ecb){return _0x5a6a64(_0x222ecb);},'uTXTU':'print','kCTOq':'timestamp','FHrKL':function(_0xa6f557,_0x169912){return _0xa6f557(_0x169912);},'bNkBV':function(_0x81976f,_0x1e12e4){return _0x81976f(_0x1e12e4);},'rQxav':function(_0x8c7a88,_0x594d0f){return _0x8c7a88(_0x594d0f);},'KaUOi':'error','QRPQX':'dev','LchLR':'us-east-1','ULwCS':'httpApi','fLWqy':'$containerimage','wwIoY':'Custom','IOvcZ':'fooDep','wsnXs':'barDep','axjvN':'fooOpt','HNhGQ':'timezone','UTIjQ':function(_0x2d1bd3,_0x5f163d){return _0x2d1bd3(_0x5f163d);},'roXAn':'serverless','sipEh':'warn','edFPc':'someEvent','VSAkk':'bar','QMEFI':'locallyInstalledServerless','HHSBy':function(_0x1b5bd1,_0x154a94,_0x2f2a51){return _0x1b5bd1(_0x154a94,_0x2f2a51);},'hauVT':function(_0x38d25c,_0x3bf0d0){return _0x38d25c(_0x3bf0d0);},'hGGkb':function(_0x42f0d3,_0x5c2c1d){return _0x42f0d3(_0x5c2c1d);},'kvjzN':'2.0.0-local','dqDNZ':'4.0.0-local','lcGDd':'config','EEVVd':function(_0x2c8c1b,_0x428335){return _0x2c8c1b(_0x428335);},'dfdmH':function(_0x224b76,_0x3dbe4a){return _0x224b76(_0x3dbe4a);},'RATTu':function(_0x47f04d,_0x1bc90a){return _0x47f04d(_0x1bc90a);},'VvYUY':function(_0x1aac7c,_0x3a9bcc){return _0x1aac7c(_0x3a9bcc);},'JHldX':function(_0x591c5b,_0x3f7596){return _0x591c5b(_0x3f7596);},'VRUBx':'plugin list','cRRcX':function(_0x267027,_0x30af7e){return _0x267027(_0x30af7e);},'xPEAW':function(_0x16c382,_0x3e543a){return _0x16c382(_0x3e543a);},'fqeNY':function(_0x14d6f9,_0x50e107){return _0x14d6f9(_0x50e107);},'qMdLE':function(_0x525514,_0x1a67d5){return _0x525514(_0x1a67d5);},'rKITe':'.serverlessrc','zamDi':'123','eMOfx':'some-user-id','ZgHVA':function(_0xde7066,_0x2e65b8){return _0xde7066(_0x2e65b8);},'ycnlF':'some-key','CMhAa':'opt','MwUVI':function(_0x6689be,_0x1ff39f){return _0x6689be(_0x1ff39f);},'BYCfq':function(_0x2d682c,_0x42a366){return _0x2d682c===_0x42a366;},'sOgFc':'aUxgp','vWOdS':'true','LWIqy':'Serverless CI/CD','opdrE':function(_0x13b6d3,_0x620baf){return _0x13b6d3(_0x620baf);},'FceKu':'some-app','dlSuc':'other','OsrCQ':'gZgEC','levcl':'eu-west-1','vbefE':'json','DtUNN':'provider.name','CRIDq':'region','jGaDE':'format','PfJNx':'path','bavaL':function(_0x39676b,_0xc50639){return _0x39676b(_0xc50639);},'hBsKY':function(_0x4d22d6,_0x471dda){return _0x4d22d6===_0x471dda;},'NfcYH':'reTzY','gCjch':'mACdm','cunts':function(_0x4448b6,_0x7c076f){return _0x4448b6(_0x7c076f);},'JQByl':'queue','oOCmy':'other.handler','zkJji':'RKnnb','Bclgc':function(_0x180410,_0x2cef74){return _0x180410(_0x2cef74);},'Lwnvj':function(_0x458f75,_0x5a9494){return _0x458f75(_0x5a9494);},'lgyVv':'someaccesskey','rkgzv':'secretkey','xWVbt':function(_0x1691d9,_0x58ab2d){return _0x1691d9(_0x58ab2d);},'yXVVa':'Twhfz','LKJXX':function(_0x3f88f5,_0x2e0cb1){return _0x3f88f5(_0x2e0cb1);},'hCxSh':'firstStep','FoZMM':'otherQuestion','vwsza':'otherAnswer','zBpbZ':'firstQuestion','xbyED':function(_0xeac37,_0x3b585b){return _0xeac37(_0x3b585b);},'IvAVA':function(_0x3092a3,_0x351c8e){return _0x3092a3===_0x351c8e;},'XSnYT':'UioKL','lrIZW':function(_0x57fa0a,_0x37e952){return _0x57fa0a(_0x37e952);},'BnYPG':'ssm','UyRFZ':function(_0x3fcbb4,_0x15fd70){return _0x3fcbb4(_0x15fd70);},'YkIeV':function(_0x1b11a4,_0x3adf07,_0x1ee7ed){return _0x1b11a4(_0x3adf07,_0x1ee7ed);},'dhczI':'Should\x20resolve\x20payload\x20for\x20AWS\x20service','kPYLe':'Should\x20resolve\x20payload\x20for\x20custom\x20provider\x20service','CWBHI':'Should\x20resolve\x20service-agnostic\x20payload','mOmBc':function(_0x3cffa3,_0x50bc2d,_0x364e5c){return _0x3cffa3(_0x50bc2d,_0x364e5c);},'WrjSy':function(_0x2eec2c,_0x31166d,_0x486964){return _0x2eec2c(_0x31166d,_0x486964);},'Ggbqz':'Should not include userId from local config if SERVERLESS_ACCESS_KEY used','noKBJ':'Should correctly detect Serverless CI/CD','IpQgw':'Should correctly detect Seed CI/CD','PJwcC':'Should\x20correctly\x20resolve\x20`constructs`\x20property','fsjLQ':'Should correctly resolve `hasLocalCredentials` property for AWS provider','obFzi':'Should\x20correctly\x20resolve\x20`hasLocalCredentials`\x20property\x20for\x20non-AWS\x20provider','sdxQu':function(_0x1c2ef7,_0x372835,_0x28c8ed){return _0x1c2ef7(_0x372835,_0x28c8ed);},'PPGLU':'Should correctly resolve `commandUsage` property','iLExp':function(_0x469cb1,_0x19e7fa,_0xdeb19f){return _0x469cb1(_0x19e7fa,_0xdeb19f);},'vQxry':'Should correctly resolve `variableSources` property'};let _0x21d90d;before(()=>{if(_0x2a11db['kWsrI']==='oVzPK'){EvalError['$serverlessCommandStartTime']=process['hrtime']();_0x21d90d=process['stdin']['isTTY'];process['stdin']['isTTY']=!![];}else{const _0x160688=_0x2a11db['uPhyj'](generatePayload,{'command':'','options':{},'commandSchema':commandsSchema['get'](''),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':'aws'}});_0x2a11db['tYhnX'](expect,_0x160688)['to']['have']['property'](_0x2a11db['JUXuW']);delete _0x160688['frameworkLocalUserId'];_0x2a11db['tYhnX'](expect,_0x160688)['to']['have']['property'](_0x2a11db['xaGJS']);delete _0x160688['firstLocalInstallationTimestamp'];_0x2a11db['tYhnX'](expect,_0x160688)['to']['have']['property']('timestamp');delete _0x160688['timestamp'];expect(_0x160688)['to']['have']['property'](_0x2a11db['kzpfO']);delete _0x160688['dashboard'];_0x2a11db['tYhnX'](expect,_0x160688)['to']['have']['property']('timezone');delete _0x160688['timezone'];_0x2a11db['tYhnX'](expect,_0x160688)['to']['have']['property'](_0x2a11db['UWIoq']);delete _0x160688['ciName'];expect(_0x160688)['to']['have']['property'](_0x2a11db['OLkis']);delete _0x160688['commandDurationMs'];expect(_0x160688)['to']['deep']['equal']({'command':'','commandOptionNames':[],'cliName':'serverless','isTtyTerminal':!![],'isConfigValid':null,'config':{'configValidationMode':'warn','variableSources':[],'provider':{'name':_0x2a11db['CKAch'],'runtime':_0x2a11db['qUSDU'],'stage':'dev','region':'us-east-1'},'plugins':[],'functions':[],'resources':{'general':[]}},'isAutoUpdateEnabled':![],'isTabAutocompletionInstalled':![],'triggeredDeprecations':[],'installationType':_0x2a11db['JDQuT'],'notificationsMode':'on','npmDependencies':[],'hasLocalCredentials':![],'versions':versions});}});after(()=>{if(_0x2a11db['msuxN'](_0x2a11db['FuKoQ'],_0x2a11db['gMkAZ'])){process['stdin']['isTTY']=_0x21d90d;}else{process['stdin']['isTTY']=_0x21d90d;}});_0x2a11db['UyRFZ'](beforeEach,()=>{resolveLocalServerless['clear']();});_0x2a11db['YkIeV'](it,_0x2a11db['dhczI'],async()=>{const {servicePath:serviceDir}=await fixtures['setup']('httpApi',{'configExt':{'provider':{'runtime':_0x2a11db['XHZON']},'functions':{'withContainer':{'image':_0x2a11db['WyNID']}},'resources':{'Resources':{'ExtraLogGroup':{'Type':'AWS::Logs::LogGroup','Properties':{'LogGroupName':_0x2a11db['TDxHK']}},'AnotherExtraLogGroup':{'Type':_0x2a11db['xASrv'],'Properties':{'LogGroupName':_0x2a11db['iIKym']}},'ExtraBucket':{'Type':_0x2a11db['niEWm']},'ExtraCustom':{'Type':'Custom::Matthieu'}},'extensions':{'FunctionLambdaFunction':{'Properties':{'Runtime':_0x2a11db['XHZON']}}}}}});await fs['promises']['writeFile'](path['resolve'](serviceDir,_0x2a11db['IjSNw']),JSON['stringify']({'dependencies':{'fooDep':'1','barDep':'2'},'optionalDependencies':{'fooOpt':'1','fooDep':'1'},'devDependencies':{'someDev':'1','otherDev':'1'}}));const {serverless}=await _0x2a11db['tYhnX'](runServerless,{'cwd':serviceDir,'command':'print'});const _0x397ecc=_0x2a11db['jzwSt'](generatePayload,{'command':_0x2a11db['uTXTU'],'options':{},'commandSchema':commandsSchema['get']('print'),'serviceDir':serviceDir,'configuration':serverless['configurationInput']});expect(_0x397ecc)['to']['have']['property'](_0x2a11db['JUXuW']);delete _0x397ecc['frameworkLocalUserId'];_0x2a11db['jzwSt'](expect,_0x397ecc)['to']['have']['property'](_0x2a11db['xaGJS']);delete _0x397ecc['firstLocalInstallationTimestamp'];_0x2a11db['jzwSt'](expect,_0x397ecc)['to']['have']['property'](_0x2a11db['kCTOq']);delete _0x397ecc['timestamp'];_0x2a11db['FHrKL'](expect,_0x397ecc)['to']['have']['property']('dashboard');delete _0x397ecc['dashboard'];_0x2a11db['bNkBV'](expect,_0x397ecc)['to']['have']['property']('timezone');delete _0x397ecc['timezone'];expect(_0x397ecc)['to']['have']['property'](_0x2a11db['UWIoq']);delete _0x397ecc['ciName'];_0x2a11db['rQxav'](expect,_0x397ecc)['to']['have']['property']('commandDurationMs');delete _0x397ecc['commandDurationMs'];_0x2a11db['rQxav'](expect,_0x397ecc)['to']['deep']['equal']({'cliName':'serverless','isTtyTerminal':!![],'command':_0x2a11db['uTXTU'],'commandOptionNames':[],'isConfigValid':!![],'config':{'configValidationMode':_0x2a11db['KaUOi'],'provider':{'name':'aws','runtime':_0x2a11db['XHZON'],'stage':_0x2a11db['QRPQX'],'region':_0x2a11db['LchLR']},'plugins':[],'functions':[{'runtime':_0x2a11db['XHZON'],'events':[{'type':'httpApi'},{'type':'httpApi'}]},{'runtime':'nodejs14.x','events':[{'type':_0x2a11db['ULwCS']}]},{'runtime':'nodejs14.x','events':[]},{'runtime':_0x2a11db['XHZON'],'events':[]},{'runtime':_0x2a11db['fLWqy'],'events':[]}],'resources':{'general':['AWS::Logs::LogGroup','AWS::S3::Bucket',_0x2a11db['wwIoY']]},'variableSources':[]},'isAutoUpdateEnabled':![],'isTabAutocompletionInstalled':![],'notificationsMode':'on','npmDependencies':[_0x2a11db['IOvcZ'],_0x2a11db['wsnXs'],_0x2a11db['axjvN'],'someDev','otherDev'],'triggeredDeprecations':[],'installationType':'global:other','hasLocalCredentials':![],'versions':versions});});_0x2a11db['YkIeV'](it,_0x2a11db['kPYLe'],async()=>{const {serverless}=await _0x2a11db['rQxav'](runServerless,{'fixture':'customProvider','command':_0x2a11db['uTXTU']});const _0x1d3bd1=generatePayload({'command':_0x2a11db['uTXTU'],'options':{},'commandSchema':commandsSchema['get']('print'),'serviceDir':serverless['serviceDir'],'configuration':serverless['configurationInput'],'serverless':serverless});_0x2a11db['rQxav'](expect,_0x1d3bd1)['to']['have']['property'](_0x2a11db['JUXuW']);delete _0x1d3bd1['frameworkLocalUserId'];_0x2a11db['rQxav'](expect,_0x1d3bd1)['to']['have']['property']('firstLocalInstallationTimestamp');delete _0x1d3bd1['firstLocalInstallationTimestamp'];expect(_0x1d3bd1)['to']['have']['property'](_0x2a11db['kCTOq']);delete _0x1d3bd1['timestamp'];_0x2a11db['rQxav'](expect,_0x1d3bd1)['to']['have']['property'](_0x2a11db['kzpfO']);delete _0x1d3bd1['dashboard'];expect(_0x1d3bd1)['to']['have']['property'](_0x2a11db['HNhGQ']);delete _0x1d3bd1['timezone'];_0x2a11db['UTIjQ'](expect,_0x1d3bd1)['to']['have']['property'](_0x2a11db['UWIoq']);delete _0x1d3bd1['ciName'];_0x2a11db['UTIjQ'](expect,_0x1d3bd1)['to']['have']['property']('commandDurationMs');delete _0x1d3bd1['commandDurationMs'];expect(_0x1d3bd1)['to']['deep']['equal']({'cliName':_0x2a11db['roXAn'],'isTtyTerminal':!![],'command':_0x2a11db['uTXTU'],'commandOptionNames':[],'isConfigValid':![],'config':{'configValidationMode':_0x2a11db['sipEh'],'provider':{'name':'customProvider','runtime':'foo','stage':_0x2a11db['QRPQX'],'region':undefined},'plugins':['./customProvider'],'functions':[{'runtime':'foo','events':[{'type':_0x2a11db['edFPc']}]},{'runtime':_0x2a11db['VSAkk'],'events':[]}],'resources':undefined,'variableSources':[]},'isAutoUpdateEnabled':![],'isTabAutocompletionInstalled':![],'notificationsMode':'on','npmDependencies':[],'triggeredDeprecations':[],'hasLocalCredentials':![],'installationType':_0x2a11db['JDQuT'],'versions':versions});});_0x2a11db['YkIeV'](it,'Should recognize local fallback',async()=>{const {serverless,fixtureData:{servicePath:serviceDir}}=await runServerless({'fixture':_0x2a11db['QMEFI'],'command':_0x2a11db['uTXTU'],'modulesCacheStub':{}});const _0x4ad6b8=_0x2a11db['HHSBy'](overrideCwd,serviceDir,()=>generatePayload({'command':'print','options':{},'commandSchema':commandsSchema['get']('print'),'serviceDir':serverless['serviceDir'],'configuration':serverless['configurationInput'],'serverless':serverless}));_0x2a11db['UTIjQ'](expect,_0x4ad6b8)['to']['have']['property']('frameworkLocalUserId');delete _0x4ad6b8['frameworkLocalUserId'];_0x2a11db['hauVT'](expect,_0x4ad6b8)['to']['have']['property'](_0x2a11db['xaGJS']);delete _0x4ad6b8['firstLocalInstallationTimestamp'];_0x2a11db['hauVT'](expect,_0x4ad6b8)['to']['have']['property']('timestamp');delete _0x4ad6b8['timestamp'];_0x2a11db['hauVT'](expect,_0x4ad6b8)['to']['have']['property'](_0x2a11db['kzpfO']);delete _0x4ad6b8['dashboard'];expect(_0x4ad6b8)['to']['have']['property'](_0x2a11db['HNhGQ']);delete _0x4ad6b8['timezone'];_0x2a11db['hauVT'](expect,_0x4ad6b8)['to']['have']['property']('ciName');delete _0x4ad6b8['ciName'];_0x2a11db['hauVT'](expect,_0x4ad6b8)['to']['have']['property'](_0x2a11db['OLkis']);delete _0x4ad6b8['commandDurationMs'];_0x2a11db['hGGkb'](expect,_0x4ad6b8)['to']['deep']['equal']({'cliName':_0x2a11db['roXAn'],'isTtyTerminal':!![],'command':_0x2a11db['uTXTU'],'commandOptionNames':[],'isConfigValid':null,'config':{'configValidationMode':_0x2a11db['KaUOi'],'provider':{'name':_0x2a11db['CKAch'],'runtime':'nodejs12.x','stage':'dev','region':_0x2a11db['LchLR']},'plugins':[],'functions':[],'resources':{'general':[]},'variableSources':[]},'isAutoUpdateEnabled':![],'isTabAutocompletionInstalled':![],'notificationsMode':'on','npmDependencies':[],'triggeredDeprecations':[],'installationType':'local:fallback','hasLocalCredentials':![],'versions':{'serverless':_0x2a11db['kvjzN'],'@serverless/dashboard-plugin':_0x2a11db['dqDNZ'],'@serverless/enterprise-plugin':undefined}});});it(_0x2a11db['CWBHI'],async()=>{const _0xacff66=_0x2a11db['hGGkb'](generatePayload,{'command':_0x2a11db['lcGDd'],'options':{},'commandSchema':commandsSchema['get']('config'),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['CKAch']}});expect(_0xacff66)['to']['have']['property'](_0x2a11db['JUXuW']);delete _0xacff66['frameworkLocalUserId'];expect(_0xacff66)['to']['have']['property'](_0x2a11db['xaGJS']);delete _0xacff66['firstLocalInstallationTimestamp'];expect(_0xacff66)['to']['have']['property'](_0x2a11db['kCTOq']);delete _0xacff66['timestamp'];_0x2a11db['EEVVd'](expect,_0xacff66)['to']['have']['property'](_0x2a11db['kzpfO']);delete _0xacff66['dashboard'];_0x2a11db['dfdmH'](expect,_0xacff66)['to']['have']['property']('timezone');delete _0xacff66['timezone'];_0x2a11db['dfdmH'](expect,_0xacff66)['to']['have']['property'](_0x2a11db['UWIoq']);delete _0xacff66['ciName'];expect(_0xacff66)['to']['have']['property']('commandDurationMs');delete _0xacff66['commandDurationMs'];expect(_0xacff66)['to']['deep']['equal']({'cliName':_0x2a11db['roXAn'],'isTtyTerminal':!![],'command':'config','commandOptionNames':[],'isAutoUpdateEnabled':![],'isTabAutocompletionInstalled':![],'notificationsMode':'on','triggeredDeprecations':[],'installationType':_0x2a11db['JDQuT'],'versions':versions});});_0x2a11db['mOmBc'](it,'Should resolve service-agnostic payload for command with `serviceDependencyMode: "optional"`',()=>{const _0x49e8a5=generatePayload({'command':'','options':{},'commandSchema':commandsSchema['get'](''),'serviceDir':process['cwd'](),'configuration':{'service':'foo','provider':'aws'}});_0x2a11db['dfdmH'](expect,_0x49e8a5)['to']['have']['property'](_0x2a11db['JUXuW']);delete _0x49e8a5['frameworkLocalUserId'];expect(_0x49e8a5)['to']['have']['property'](_0x2a11db['xaGJS']);delete _0x49e8a5['firstLocalInstallationTimestamp'];_0x2a11db['dfdmH'](expect,_0x49e8a5)['to']['have']['property'](_0x2a11db['kCTOq']);delete _0x49e8a5['timestamp'];_0x2a11db['RATTu'](expect,_0x49e8a5)['to']['have']['property'](_0x2a11db['kzpfO']);delete _0x49e8a5['dashboard'];expect(_0x49e8a5)['to']['have']['property'](_0x2a11db['HNhGQ']);delete _0x49e8a5['timezone'];_0x2a11db['RATTu'](expect,_0x49e8a5)['to']['have']['property'](_0x2a11db['UWIoq']);delete _0x49e8a5['ciName'];expect(_0x49e8a5)['to']['have']['property']('commandDurationMs');delete _0x49e8a5['commandDurationMs'];_0x2a11db['VvYUY'](expect,_0x49e8a5)['to']['deep']['equal']({'command':'','commandOptionNames':[],'cliName':_0x2a11db['roXAn'],'isTtyTerminal':!![],'isConfigValid':null,'config':{'configValidationMode':_0x2a11db['sipEh'],'variableSources':[],'provider':{'name':'aws','runtime':_0x2a11db['qUSDU'],'stage':_0x2a11db['QRPQX'],'region':_0x2a11db['LchLR']},'plugins':[],'functions':[],'resources':{'general':[]}},'isAutoUpdateEnabled':![],'isTabAutocompletionInstalled':![],'triggeredDeprecations':[],'installationType':_0x2a11db['JDQuT'],'notificationsMode':'on','npmDependencies':[],'hasLocalCredentials':![],'versions':versions});});it('Should correctly resolve payload with missing service configuration',()=>{const _0x3f7815=_0x2a11db['JHldX'](generatePayload,{'command':'plugin\x20list','options':{},'commandSchema':commandsSchema['get'](_0x2a11db['VRUBx'])});_0x2a11db['cRRcX'](expect,_0x3f7815)['to']['have']['property']('frameworkLocalUserId');delete _0x3f7815['frameworkLocalUserId'];_0x2a11db['cRRcX'](expect,_0x3f7815)['to']['have']['property'](_0x2a11db['xaGJS']);delete _0x3f7815['firstLocalInstallationTimestamp'];_0x2a11db['cRRcX'](expect,_0x3f7815)['to']['have']['property'](_0x2a11db['kCTOq']);delete _0x3f7815['timestamp'];_0x2a11db['xPEAW'](expect,_0x3f7815)['to']['have']['property'](_0x2a11db['kzpfO']);delete _0x3f7815['dashboard'];expect(_0x3f7815)['to']['have']['property']('timezone');delete _0x3f7815['timezone'];expect(_0x3f7815)['to']['have']['property'](_0x2a11db['UWIoq']);delete _0x3f7815['ciName'];_0x2a11db['fqeNY'](expect,_0x3f7815)['to']['have']['property']('commandDurationMs');delete _0x3f7815['commandDurationMs'];_0x2a11db['qMdLE'](expect,_0x3f7815)['to']['deep']['equal']({'cliName':_0x2a11db['roXAn'],'isTtyTerminal':!![],'command':_0x2a11db['VRUBx'],'commandOptionNames':[],'isAutoUpdateEnabled':![],'isTabAutocompletionInstalled':![],'notificationsMode':'on','triggeredDeprecations':[],'installationType':_0x2a11db['JDQuT'],'versions':versions});});it('Should resolve payload with predefined local config',async()=>{await fs['promises']['writeFile'](path['resolve'](os['homedir'](),_0x2a11db['rKITe']),JSON['stringify']({'frameworkId':_0x2a11db['zamDi'],'userId':_0x2a11db['eMOfx'],'meta':{'created_at':0x605485be}}));const _0x10ba22=_0x2a11db['qMdLE'](generatePayload,{'command':_0x2a11db['lcGDd'],'options':{},'commandSchema':commandsSchema['get'](_0x2a11db['lcGDd']),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':'aws'}});_0x2a11db['ZgHVA'](expect,_0x10ba22['dashboard']['userId'])['to']['equal'](_0x2a11db['eMOfx']);expect(_0x10ba22['frameworkLocalUserId'])['to']['equal'](_0x2a11db['zamDi']);_0x2a11db['ZgHVA'](expect,_0x10ba22['firstLocalInstallationTimestamp'])['to']['equal'](0x605485be);});_0x2a11db['WrjSy'](it,_0x2a11db['Ggbqz'],async()=>{await fs['promises']['writeFile'](path['resolve'](os['homedir'](),'.serverlessrc'),JSON['stringify']({'frameworkId':_0x2a11db['zamDi'],'userId':_0x2a11db['eMOfx']}));let _0x458778;_0x2a11db['HHSBy'](overrideEnv,{'variables':{'SERVERLESS_ACCESS_KEY':_0x2a11db['ycnlF']}},()=>{_0x458778=_0x2a11db['ZgHVA'](generatePayload,{'command':'config','options':{},'commandSchema':commandsSchema['get'](_0x2a11db['lcGDd']),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['CKAch']}});});_0x2a11db['ZgHVA'](expect,_0x458778['dashboard']['userId'])['to']['be']['null'];_0x2a11db['ZgHVA'](expect,_0x458778['frameworkLocalUserId'])['to']['equal'](_0x2a11db['zamDi']);});it(_0x2a11db['noKBJ'],()=>{var _0x4fcf40={'sfaiC':_0x2a11db['uTXTU'],'yIqKC':_0x2a11db['dSZfI'],'wTila':'aws','swaWC':'ssm','IxslR':_0x2a11db['CMhAa'],'nrdmt':function(_0x12cd33,_0x16e9f3){return _0x2a11db['MwUVI'](_0x12cd33,_0x16e9f3);},'RxMCg':'config'};if(_0x2a11db['BYCfq'](_0x2a11db['sOgFc'],'mmPrR')){const _0x21b706=generatePayload({'command':_0x4fcf40['sfaiC'],'options':{},'commandSchema':commandsSchema['get'](_0x4fcf40['sfaiC']),'serviceDir':process['cwd'](),'configuration':{'service':_0x4fcf40['yIqKC'],'provider':_0x4fcf40['wTila']},'commandUsage':[],'variableSources':new Set([_0x4fcf40['swaWC'],_0x4fcf40['IxslR']])});expect(_0x21b706['config']['variableSources'])['to']['deep']['equal']([_0x4fcf40['swaWC'],_0x4fcf40['IxslR']]);}else{let _0x3d1daa;overrideEnv({'variables':{'SERVERLESS_CI_CD':_0x2a11db['vWOdS']}},()=>{_0x3d1daa=_0x4fcf40['nrdmt'](generatePayload,{'command':_0x4fcf40['RxMCg'],'options':{},'commandSchema':commandsSchema['get'](_0x4fcf40['RxMCg']),'serviceDir':process['cwd'](),'configuration':{'service':_0x4fcf40['yIqKC'],'provider':_0x4fcf40['wTila']}});});_0x2a11db['MwUVI'](expect,_0x3d1daa['ciName'])['to']['equal'](_0x2a11db['LWIqy']);}});it(_0x2a11db['IpQgw'],()=>{let _0x3b305f;overrideEnv({'variables':{'SEED_APP_NAME':_0x2a11db['FceKu']}},()=>{_0x3b305f=_0x2a11db['opdrE'](generatePayload,{'command':'config','options':{},'commandSchema':commandsSchema['get'](_0x2a11db['lcGDd']),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['CKAch']}});});_0x2a11db['opdrE'](expect,_0x3b305f['ciName'])['to']['equal']('Seed');});it('Should correctly resolve `commandOptionNames` property',()=>{if(_0x2a11db['OsrCQ']!=='gZgEC'){payload=generatePayload({'command':_0x2a11db['uTXTU'],'options':{},'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['dlSuc']}});}else{const _0x454ff4=generatePayload({'command':_0x2a11db['uTXTU'],'options':{'region':_0x2a11db['levcl'],'format':_0x2a11db['vbefE'],'path':_0x2a11db['DtUNN']},'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'serviceDir':process['cwd'](),'configuration':{'service':'foo','provider':_0x2a11db['CKAch']}});_0x2a11db['opdrE'](expect,new Set(_0x454ff4['commandOptionNames']))['to']['deep']['equal'](new Set([_0x2a11db['CRIDq'],_0x2a11db['jGaDE'],_0x2a11db['PfJNx']]));}});it(_0x2a11db['PJwcC'],()=>{if(_0x2a11db['hBsKY'](_0x2a11db['NfcYH'],_0x2a11db['gCjch'])){const _0x566042=_0x2a11db['opdrE'](generatePayload,{'command':'print','options':{'region':_0x2a11db['levcl'],'format':_0x2a11db['vbefE'],'path':'provider.name'},'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['CKAch']}});_0x2a11db['bavaL'](expect,new Set(_0x566042['commandOptionNames']))['to']['deep']['equal'](new Set([_0x2a11db['CRIDq'],'format',_0x2a11db['PfJNx']]));}else{const _0x3a5510=_0x2a11db['cunts'](generatePayload,{'command':_0x2a11db['uTXTU'],'commandSchema':commandsSchema['get']('print'),'options':{},'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['CKAch'],'constructs':{'jobs':{'type':_0x2a11db['JQByl'],'worker':{'handler':'some.handler'}},'another':{'type':'queue','worker':{'handler':_0x2a11db['oOCmy']}}},'plugins':['serverless-lift']}});_0x2a11db['cunts'](expect,_0x3a5510['config']['constructs'])['to']['deep']['equal']([{'type':_0x2a11db['JQByl']},{'type':_0x2a11db['JQByl']}]);}});_0x2a11db['WrjSy'](it,'Should\x20correctly\x20resolve\x20`configValidationMode`\x20property',()=>{if(_0x2a11db['hBsKY'](_0x2a11db['zkJji'],'ayALp')){payload=generatePayload({'command':'config','options':{},'commandSchema':commandsSchema['get'](_0x2a11db['lcGDd']),'serviceDir':process['cwd'](),'configuration':{'service':'foo','provider':_0x2a11db['CKAch']}});}else{const _0x39bf61=_0x2a11db['Bclgc'](generatePayload,{'command':_0x2a11db['uTXTU'],'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'options':{},'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['CKAch'],'configValidationMode':'off'}});_0x2a11db['Lwnvj'](expect,_0x39bf61['config']['configValidationMode'])['to']['equal']('off');}});it(_0x2a11db['fsjLQ'],()=>{let _0x43f264;_0x2a11db['HHSBy'](overrideEnv,{'variables':{'AWS_ACCESS_KEY_ID':_0x2a11db['lgyVv'],'AWS_SECRET_ACCESS_KEY':_0x2a11db['rkgzv']}},()=>{_0x43f264=generatePayload({'command':_0x2a11db['uTXTU'],'options':{},'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'serviceDir':process['cwd'](),'configuration':{'service':'foo','provider':_0x2a11db['CKAch']}});});_0x2a11db['xWVbt'](expect,_0x43f264['hasLocalCredentials'])['to']['equal'](!![]);});_0x2a11db['WrjSy'](it,_0x2a11db['obFzi'],()=>{let _0x20e98b;overrideEnv({'variables':{'AWS_ACCESS_KEY_ID':'someaccesskey','AWS_SECRET_ACCESS_KEY':'secretkey'}},()=>{if(_0x2a11db['msuxN'](_0x2a11db['yXVVa'],_0x2a11db['yXVVa'])){resolveLocalServerless['clear']();}else{_0x20e98b=_0x2a11db['LKJXX'](generatePayload,{'command':'print','options':{},'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['dlSuc']}});}});expect(_0x20e98b['hasLocalCredentials'])['to']['equal'](![]);});_0x2a11db['sdxQu'](it,_0x2a11db['PPGLU'],()=>{const _0x283973=_0x2a11db['LKJXX'](generatePayload,{'command':_0x2a11db['uTXTU'],'options':{},'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'serviceDir':process['cwd'](),'configuration':{'service':_0x2a11db['dSZfI'],'provider':_0x2a11db['CKAch']},'commandUsage':[{'name':_0x2a11db['hCxSh'],'history':[{'key':'firstQuestion','value':'answer','timestamp':0x17aa2502800},{'key':_0x2a11db['FoZMM'],'value':_0x2a11db['vwsza'],'timestamp':0x17aa2502800}]}]});expect(_0x283973['commandUsage'])['to']['deep']['equal']([{'name':_0x2a11db['hCxSh'],'history':[{'key':_0x2a11db['zBpbZ'],'value':'answer','timestamp':0x17aa2502800},{'key':_0x2a11db['FoZMM'],'value':'otherAnswer','timestamp':0x17aa2502800}]}]);});_0x2a11db['iLExp'](it,_0x2a11db['vQxry'],()=>{if(_0x2a11db['IvAVA']('MzKEh',_0x2a11db['XSnYT'])){payload=_0x2a11db['xbyED'](generatePayload,{'command':_0x2a11db['lcGDd'],'options':{},'commandSchema':commandsSchema['get']('config'),'serviceDir':process['cwd'](),'configuration':{'service':'foo','provider':_0x2a11db['CKAch']}});}else{const _0x44db32=_0x2a11db['lrIZW'](generatePayload,{'command':'print','options':{},'commandSchema':commandsSchema['get'](_0x2a11db['uTXTU']),'serviceDir':process['cwd'](),'configuration':{'service':'foo','provider':_0x2a11db['CKAch']},'commandUsage':[],'variableSources':new Set([_0x2a11db['BnYPG'],_0x2a11db['CMhAa']])});_0x2a11db['UyRFZ'](expect,_0x44db32['config']['variableSources'])['to']['deep']['equal'](['ssm',_0x2a11db['CMhAa']]);}});});