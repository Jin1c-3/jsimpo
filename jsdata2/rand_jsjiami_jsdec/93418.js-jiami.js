require('../../spec_helper');const _=require('lodash');const cp=require('child_process');const os=require('os');const tty=require('tty');const path=require('path');const EE=require('events');const mockedEnv=require('mocked-env');const debug=require('debug')('test');const state=require(lib+'/tasks/state');const xvfb=require(lib+'/exec/xvfb');const spawn=require(lib+'/exec/spawn');const verify=require(lib+'/tasks/verify');const util=require(lib+'/util.js');const expect=require('chai')['expect'];const snapshot=require('../../support/snapshot');const cwd=process['cwd']();const defaultBinaryDir='/default/binary/dir';describe('lib/exec/spawn',function(){var _0x1fb076={'emDuB':'5|4|2|1|0|9|8|10|7|6|11|3','PcHLK':'/path/to/cypress','ULPRL':'exit','oLGnw':'darwin','vJSNk':'isNeeded','DQYHY':'spawn','FPvlu':'start','ubSvc':'getBinaryDir','QaPRr':function(_0x53abc9,_0x53e355,_0x1b1ac9){return _0x53abc9(_0x53e355,_0x1b1ac9);},'MThig':'returns true','rByIz':function(_0x7aeabb,_0x21d1cc){return _0x7aeabb(_0x21d1cc);},'OynXt':'--foo','XdlSo':function(_0x36eeba,_0xcf6de6){return _0x36eeba!==_0xcf6de6;},'pPBAy':'DrXcN','XbJOf':'qwRLB','HPAOB':'needsSandbox','PVyQO':'close','qIfgI':function(_0x22e5c8,_0x56f3fc,_0x1b9909){return _0x22e5c8(_0x56f3fc,_0x1b9909);},'OIsZC':function(_0x13281f,_0x2b575a){return _0x13281f===_0x2b575a;},'XWMZN':'eykKZ','qmPss':function(_0x1b6f51,_0x4145a2,_0x3df7c6){return _0x1b6f51(_0x4145a2,_0x3df7c6);},'zuCGA':'if exit event fired and close event fired','XDogI':'should have hit error handler but did not','rGYQh':'error message','QYWhX':function(_0x542273,_0x310f00){return _0x542273(_0x310f00);},'cQbtw':'test-display','roYYh':'bar','rMpiZ':function(_0x361de6,_0x1ed468){return _0x361de6!==_0x1ed468;},'FnaPI':'MNuKp','hvYfC':'[some noise here] Gtk: cannot open display: 987','tMWmD':'data','pCiwt':function(_0x12048f,_0x60b24d){return _0x12048f(_0x60b24d);},'PNwxW':'retries with xvfb if fails with display exit code','EuUvP':'the error message','wcLmb':'error','yvkEF':function(_0x31128,_0x536945){return _0x31128(_0x536945);},'gxGPh':function(_0x274e73,_0x457c48){return _0x274e73!==_0x457c48;},'SLeta':'AyHAl','HyFsq':'hODEt','egrYD':'supportsColor','zvAeD':'isatty','ExlEc':function(_0x2a34d2,_0x478f8c){return _0x2a34d2(_0x478f8c);},'OzmQs':function(_0x4780c4,_0x3bcf8e,_0x2c6170){return _0x4780c4(_0x3bcf8e,_0x2c6170);},'fvgml':function(_0x12836a,_0x1bf35b,_0x146da9){return _0x12836a(_0x1bf35b,_0x146da9);},'wuMJb':'SIGKILL','TARKy':function(_0x29c978,_0x36a580){return _0x29c978!==_0x36a580;},'ulSoe':'JeRdy','mdPZH':'win32','IMDez':'inherit','WiVPH':'linux','LDXLs':'NQTVD','DVIYn':function(_0xf94019,_0x576e65){return _0xf94019!==_0x576e65;},'kKnWF':'8|11|6|3|7|10|9|1|0|2|4|5','RaBqW':'stop','EeULk':'stdin','fClZw':'NXqZc','qmFhf':'dmkkC','NBKew':'XaKAI','UpuYr':function(_0x4cb5b3,_0x10b493,_0x2f36ad){return _0x4cb5b3(_0x10b493,_0x2f36ad);},'EHHAs':'wattttt','IUNai':'FAILWHALE','jmmnh':'asdf','ZgNuL':'write','zXgBk':'FBsVt','dkFQh':'NPdSP','MuzhF':'--no-sandbox','fvnPT':function(_0x4c14d7,_0x475e72){return _0x4c14d7(_0x475e72);},'YlyRs':'start.js','KPiCH':function(_0x1fd71e,_0x441b1a){return _0x1fd71e===_0x441b1a;},'wvTqO':'pipe','zpogf':'dFeRx','NmQGs':'gtTkK','ICeGt':function(_0x250d02,_0x19ecdb){return _0x250d02(_0x19ecdb);},'XuYfm':'MBOTU','bfLtd':'PeFBT','inEpj':'LlmBE','TpRDR':'irlJI','vxmtu':'OcBmj','iMzyB':'AiNFV','SMOzk':'azbrb','Plgzw':function(_0x3a91a5,_0x378b98){return _0x3a91a5(_0x378b98);},'jVfLB':'inEDf','mOGNL':function(_0x1ec9e4,_0x50ab8e){return _0x1ec9e4(_0x50ab8e);},'XRvQD':function(_0x528c21,_0x22b2d1){return _0x528c21(_0x22b2d1);},'FvKeN':'oEEYM','wvxEy':function(_0x18abfc,_0x25fc85){return _0x18abfc(_0x25fc85);},'AiOZE':function(_0xb6996c,_0x5e66f7){return _0xb6996c===_0x5e66f7;},'cAvPn':'PKxoP','yuTIJ':'waGeI','ftDRQ':'2018-05-19\x2015:30:30.287\x20Cypress[7850:32145]\x20***\x20WARNING:\x20Textured\x20Window','YWGmq':function(_0x465d1f,_0x1c6715){return _0x465d1f(_0x1c6715);},'UqVwT':function(_0x823c9e,_0x302c9e){return _0x823c9e!==_0x302c9e;},'WUIkV':'MJHgm','fAkqT':'XKaVs','nizNL':'uses\x20npm\x20command\x20when\x20running\x20in\x20dev\x20mode','AklJC':'does not pass --no-sandbox when running in dev mode','pubej':function(_0x53124f,_0x9f74b1,_0x51fd52){return _0x53124f(_0x9f74b1,_0x51fd52);},'DnjLk':'closes','TAmtq':function(_0x5904f9,_0x32a254,_0x362cfe){return _0x5904f9(_0x32a254,_0x362cfe);},'adoKm':'does not start xvfb when its not needed','fcSsZ':'resolves with spawned close code in the message','kZrYg':'Linux display','Lhvaw':'rejects with error from spawn','cKcgF':'does not unref by default','ugTPd':'sets\x20process.env\x20to\x20options.env','PZxXY':'forces colors and streams when supported','RrgGL':'does not set windowsHide property when in darwin','OmfTz':'does not force colors and streams when not supported','NOmMP':'pipes when on win32','MVpBB':function(_0x43516e,_0xa7bcbd,_0x4cef63){return _0x43516e(_0xa7bcbd,_0x4cef63);},'cujwD':function(_0x46bf49,_0x5bacda,_0x571283){return _0x46bf49(_0x5bacda,_0x571283);},'qfGNH':function(_0x33de87,_0xe0e5ee,_0x19fe5c){return _0x33de87(_0xe0e5ee,_0x19fe5c);},'mXmjA':'does not write to process.stderr when from xlib or libudev','nrlGw':function(_0x43b7b8,_0x11fd51,_0x50e3f1){return _0x43b7b8(_0x11fd51,_0x50e3f1);},'EJiWs':'does\x20not\x20write\x20to\x20process.stderr\x20when\x20from\x20high\x20sierra\x20warnings','JiOAb':'EPIPE','CUpld':'ENOTCONN','IZZyv':function(_0x384558,_0xa572b5,_0x55a1ac){return _0x384558(_0xa572b5,_0x55a1ac);},'bZUJB':'throws\x20process.stdin\x20errors\x20code!=EPIPE','RZCdH':function(_0x2bf6f6,_0x1da83c,_0x1d53f0){return _0x2bf6f6(_0x1da83c,_0x1d53f0);},'MMyZz':'.isGarbageLineWarning','fxkck':function(_0x81b6e6,_0x354406,_0x48bcaf){return _0x81b6e6(_0x354406,_0x48bcaf);},'rmziv':'.start'};beforeEach(function(){var _0x33d20b=_0x1fb076['emDuB']['split']('|'),_0x3d1a3e=0x0;while(!![]){switch(_0x33d20b[_0x3d1a3e++]){case'0':this['processStdin']['pipe']=sinon['stub']()['returns'](undefined);continue;case'1':this['processStdin']=new EE();continue;case'2':this['spawnedProcess']={'on':sinon['stub']()['returns'](undefined),'unref':sinon['stub']()['returns'](undefined),'stdin':{'on':sinon['stub']()['returns'](undefined),'pipe':sinon['stub']()['returns'](undefined)},'stdout':{'on':sinon['stub']()['returns'](undefined),'pipe':sinon['stub']()['returns'](undefined)},'stderr':{'pipe':sinon['stub']()['returns'](undefined),'on':sinon['stub']()['returns'](undefined)}};continue;case'3':sinon['stub'](state,'getPathToExecutable')['withArgs'](defaultBinaryDir)['returns'](_0x1fb076['PcHLK']);continue;case'4':sinon['stub'](process,_0x1fb076['ULPRL']);continue;case'5':os['platform']['returns'](_0x1fb076['oLGnw']);continue;case'6':sinon['stub'](xvfb,_0x1fb076['vJSNk'])['returns'](![]);continue;case'7':sinon['stub'](xvfb,'stop')['resolves']();continue;case'8':sinon['stub'](cp,_0x1fb076['DQYHY'])['returns'](this['spawnedProcess']);continue;case'9':sinon['stub'](process,'stdin')['value'](this['processStdin']);continue;case'10':sinon['stub'](xvfb,_0x1fb076['FPvlu'])['resolves']();continue;case'11':sinon['stub'](state,_0x1fb076['ubSvc'])['returns'](defaultBinaryDir);continue;}break;}});_0x1fb076['RZCdH'](context,_0x1fb076['MMyZz'],()=>{_0x1fb076['QaPRr'](it,_0x1fb076['MThig'],()=>{var _0x3cb9b8={'qYEFM':function(_0x132536,_0x29c645,_0x3084d0){return _0x132536(_0x29c645,_0x3084d0);}};const _0x59d4cf='\n        [46454:0702/140217.292422:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glDrawElements: framebuffer incomplete\n        [46454:0702/140217.292466:ERROR:gles2_cmd_decoder.cc(17788)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_OPERATION : glCreateAndConsumeTextureCHROMIUM: invalid mailbox name\n        [46454:0702/140217.292526:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glClear: framebuffer incomplete\n        [46454:0702/140217.292555:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glDrawElements: framebuffer incomplete\n        [46454:0702/140217.292584:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glClear: framebuffer incomplete\n        [46454:0702/140217.292612:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glDrawElements: framebuffer incomplete\'\n      ';const _0x3f351b=_['chain'](_0x59d4cf)['split']('\x0a')['invokeMap']('trim')['compact']()['value']();_['each'](_0x3f351b,_0x157426=>{_0x3cb9b8['qYEFM'](expect,spawn['isGarbageLineWarning'](_0x157426),'expected line to be garbage: '+_0x157426)['to']['be']['true'];});});});_0x1fb076['fxkck'](context,_0x1fb076['rmziv'],function(){var _0x3dfe00={'CNOPO':function(_0x2ca5cb,_0x30c57d){return _0x1fb076['DVIYn'](_0x2ca5cb,_0x30c57d);},'agqfd':_0x1fb076['zXgBk'],'ufOMW':_0x1fb076['dkFQh'],'dPbXF':_0x1fb076['MuzhF'],'vbtZY':'--foo','UBdrs':'--cwd','PmVEc':function(_0x25874c,_0x42b015){return _0x25874c(_0x42b015);},'LHTgA':_0x1fb076['PcHLK'],'rLrhh':_0x1fb076['PVyQO'],'cXOcj':'needsSandbox','VIkdv':'bar','bnfhw':function(_0xc3b310,_0x1708b6){return _0x1fb076['fvnPT'](_0xc3b310,_0x1708b6);},'JzUtu':'scripts','bhbWM':_0x1fb076['YlyRs'],'OTRJo':function(_0x382d84,_0x5a63b3){return _0x1fb076['KPiCH'](_0x382d84,_0x5a63b3);},'XTVEU':'FxCxR','aJaDm':_0x1fb076['IMDez'],'ZPyTa':_0x1fb076['wvTqO'],'ktZUQ':function(_0x5649f,_0x453147){return _0x1fb076['fvnPT'](_0x5649f,_0x453147);},'amzMJ':'node','tZPDF':function(_0x59be2a,_0x421c78){return _0x1fb076['KPiCH'](_0x59be2a,_0x421c78);},'fUhxW':_0x1fb076['zpogf'],'dxRdb':'darwin','EieHo':'uUbAD','KkGKS':_0x1fb076['NmQGs'],'dqrxm':function(_0x37960d,_0x5f1157){return _0x1fb076['ICeGt'](_0x37960d,_0x5f1157);},'TtJmk':_0x1fb076['XuYfm'],'Xunai':_0x1fb076['bfLtd'],'WgpPE':_0x1fb076['ULPRL'],'svbLQ':_0x1fb076['wuMJb'],'QlYRB':function(_0x1fb2c4,_0x3eb144){return _0x1fb076['DVIYn'](_0x1fb2c4,_0x3eb144);},'PVXEy':_0x1fb076['inEpj'],'MQxLe':_0x1fb076['TpRDR'],'tsTbC':_0x1fb076['vxmtu'],'cfJnH':function(_0x59daa7,_0x2e475e){return _0x1fb076['ICeGt'](_0x59daa7,_0x2e475e);},'kiDrR':_0x1fb076['iMzyB'],'CPZsU':'eTWec','pzLeo':'error\x20message','WbBuL':_0x1fb076['SMOzk'],'PAzDG':function(_0x101695,_0x420b84){return _0x101695(_0x420b84);},'SHmNG':'rfmJV','KTFcL':'MvYsO','MvFCu':function(_0x4bf5c8,_0x59cbf0){return _0x1fb076['ICeGt'](_0x4bf5c8,_0x59cbf0);},'RvSeD':function(_0x29b8ab,_0x2da664){return _0x1fb076['Plgzw'](_0x29b8ab,_0x2da664);},'rQuhF':_0x1fb076['egrYD'],'FHZBA':_0x1fb076['zvAeD'],'YTEIB':_0x1fb076['jVfLB'],'swqcx':function(_0x46cdf6,_0x37c738,_0x57b826){return _0x46cdf6(_0x37c738,_0x57b826);},'ztsMK':_0x1fb076['wcLmb'],'QCBji':'1|4|0|3|2','qBcJy':function(_0x1b9074,_0x51fffe){return _0x1fb076['mOGNL'](_0x1b9074,_0x51fffe);},'KABuy':_0x1fb076['jmmnh'],'msctA':'data','OTjpu':_0x1fb076['mdPZH'],'DvTcO':function(_0x55b98d,_0x270678){return _0x1fb076['XRvQD'](_0x55b98d,_0x270678);},'nvWyN':'Xlib: something foo','QcIJx':_0x1fb076['WiVPH'],'BCitY':_0x1fb076['FvKeN'],'yBbRr':function(_0x5ad67c,_0x3c0330){return _0x1fb076['wvxEy'](_0x5ad67c,_0x3c0330);},'eiXZk':function(_0x24a86e,_0x13aed2){return _0x1fb076['AiOZE'](_0x24a86e,_0x13aed2);},'FIQnh':_0x1fb076['cAvPn'],'qmrSO':_0x1fb076['yuTIJ'],'XTQPO':_0x1fb076['ftDRQ'],'ZbTYu':'write','syqye':function(_0xbaa473,_0x47ce03){return _0xbaa473(_0x47ce03);},'GtQJW':function(_0x41b9aa,_0x33a7b6){return _0x1fb076['wvxEy'](_0x41b9aa,_0x33a7b6);},'VevIg':function(_0x581b2d,_0x19b2b6){return _0x1fb076['YWGmq'](_0x581b2d,_0x19b2b6);}};if(_0x1fb076['UqVwT'](_0x1fb076['WUIkV'],_0x1fb076['fAkqT'])){it('passes args + options to spawn',function(){var _0x3f9255={'lzWJl':function(_0x158eaa,_0x424f71){return _0x1fb076['rByIz'](_0x158eaa,_0x424f71);},'zVUhV':_0x1fb076['PcHLK'],'Nytdb':_0x1fb076['OynXt'],'SEiGa':'--cwd','jHCER':'inherit','gEogC':function(_0x56807d,_0x302bb7,_0x26778d){return _0x1fb076['QaPRr'](_0x56807d,_0x302bb7,_0x26778d);}};if(_0x1fb076['XdlSo'](_0x1fb076['pPBAy'],_0x1fb076['XbJOf'])){this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);sinon['stub'](verify,_0x1fb076['HPAOB'])['returns'](![]);return spawn['start'](_0x1fb076['OynXt'],{'foo':'bar'})['then'](()=>{_0x3f9255['lzWJl'](expect,cp['spawn'])['to']['be']['calledWithMatch'](_0x3f9255['zVUhV'],['--',_0x3f9255['Nytdb'],_0x3f9255['SEiGa'],cwd],{'detached':![],'stdio':[_0x3f9255['jHCER'],'inherit','pipe']});});}else{_0x3f9255['gEogC'](expect,spawn['isGarbageLineWarning'](line),'expected\x20line\x20to\x20be\x20garbage:\x20'+line)['to']['be']['true'];}});it('uses --no-sandbox when needed',function(){var _0x23f245={'vmQPL':'trim'};this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);sinon['stub'](verify,_0x3dfe00['cXOcj'])['returns'](!![]);return spawn['start']('--foo',{'foo':_0x3dfe00['VIkdv']})['then'](()=>{if(_0x3dfe00['CNOPO'](_0x3dfe00['agqfd'],_0x3dfe00['ufOMW'])){const _0x374316=cp['spawn']['firstCall']['args']['slice'](0x0,0x2);const _0x11e9b2=[_0x3dfe00['dPbXF'],'--',_0x3dfe00['vbtZY'],_0x3dfe00['UBdrs'],cwd];_0x3dfe00['PmVEc'](expect,_0x374316)['to']['deep']['equal']([_0x3dfe00['LHTgA'],_0x11e9b2]);}else{var _0x2a508a={'CIJJJ':function(_0xfc7a3,_0x252119,_0x49f121){return _0xfc7a3(_0x252119,_0x49f121);}};const _0x47930a='\n        [46454:0702/140217.292422:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glDrawElements: framebuffer incomplete\n        [46454:0702/140217.292466:ERROR:gles2_cmd_decoder.cc(17788)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_OPERATION : glCreateAndConsumeTextureCHROMIUM: invalid mailbox name\n        [46454:0702/140217.292526:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glClear: framebuffer incomplete\n        [46454:0702/140217.292555:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glDrawElements: framebuffer incomplete\n        [46454:0702/140217.292584:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glClear: framebuffer incomplete\n        [46454:0702/140217.292612:ERROR:gles2_cmd_decoder.cc(4439)] [.RenderWorker-0x7f8bc5815a00.GpuRasterization]GL ERROR :GL_INVALID_FRAMEBUFFER_OPERATION : glDrawElements: framebuffer incomplete\'\n      ';const _0x5a7237=_['chain'](_0x47930a)['split']('\x0a')['invokeMap'](_0x23f245['vmQPL'])['compact']()['value']();_['each'](_0x5a7237,_0x175413=>{_0x2a508a['CIJJJ'](expect,spawn['isGarbageLineWarning'](_0x175413),'expected line to be garbage: '+_0x175413)['to']['be']['true'];});}});});it(_0x1fb076['nizNL'],function(){var _0x2bb520={'JIvJS':function(_0x41df10,_0x12c439){return _0x3dfe00['bnfhw'](_0x41df10,_0x12c439);},'sJzyT':function(_0x43789c,_0x416dd9){return _0x43789c!==_0x416dd9;},'cdVjB':'zzYeQ','NfWUF':'--foo','kGGbL':_0x3dfe00['UBdrs'],'ltrpt':'inherit','kdYfV':'pipe'};this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);sinon['stub'](verify,'needsSandbox')['returns'](![]);const _0x58055e=path['resolve']('..',_0x3dfe00['JzUtu'],_0x3dfe00['bhbWM']);return spawn['start'](_0x3dfe00['vbtZY'],{'dev':!![],'foo':_0x3dfe00['VIkdv']})['then'](()=>{var _0x5e6dc1={'Eirpb':function(_0x135439,_0x170b26){return _0x2bb520['JIvJS'](_0x135439,_0x170b26);},'qKCQS':'--foo'};if(_0x2bb520['sJzyT'](_0x2bb520['cdVjB'],_0x2bb520['cdVjB'])){this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0xa);return spawn['start'](_0x5e6dc1['qKCQS'])['then'](_0x19cc32=>{_0x5e6dc1['Eirpb'](expect,_0x19cc32)['to']['equal'](0xa);});}else{_0x2bb520['JIvJS'](expect,cp['spawn'])['to']['be']['calledWithMatch']('node',[_0x58055e,'--',_0x2bb520['NfWUF'],_0x2bb520['kGGbL'],cwd],{'detached':![],'stdio':[_0x2bb520['ltrpt'],'inherit',_0x2bb520['kdYfV']]});}});});it(_0x1fb076['AklJC'],function(){var _0x5d7630={'ZbRvE':function(_0x18a796,_0x1a45d1){return _0x3dfe00['ktZUQ'](_0x18a796,_0x1a45d1);},'cTGqZ':_0x3dfe00['amzMJ'],'OPwTI':_0x3dfe00['vbtZY'],'maXoA':_0x3dfe00['UBdrs'],'wtLzK':'inherit'};if(_0x3dfe00['tZPDF'](_0x3dfe00['fUhxW'],_0x3dfe00['fUhxW'])){this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);sinon['stub'](verify,'needsSandbox')['returns'](!![]);const _0x2452d0=path['resolve']('..',_0x3dfe00['JzUtu'],_0x3dfe00['bhbWM']);return spawn['start'](_0x3dfe00['vbtZY'],{'dev':!![],'foo':'bar'})['then'](()=>{var _0x18bfc5={'VIajP':function(_0x9f2131,_0x28bbe6){return _0x3dfe00['bnfhw'](_0x9f2131,_0x28bbe6);}};if(_0x3dfe00['OTRJo']('FxCxR',_0x3dfe00['XTVEU'])){expect(cp['spawn'])['to']['be']['calledWithMatch']('node',[_0x2452d0,'--',_0x3dfe00['vbtZY'],_0x3dfe00['UBdrs'],cwd],{'detached':![],'stdio':['inherit',_0x3dfe00['aJaDm'],_0x3dfe00['ZPyTa']]});}else{_0x18bfc5['VIajP'](expect,process['stderr']['write'])['not']['to']['be']['calledWith'](buf1);_0x18bfc5['VIajP'](expect,process['stderr']['write'])['not']['to']['be']['calledWith'](buf2);}});}else{this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);sinon['stub'](verify,_0x3dfe00['cXOcj'])['returns'](!![]);const _0x320cb2=path['resolve']('..',_0x3dfe00['JzUtu'],_0x3dfe00['bhbWM']);return spawn['start'](_0x3dfe00['vbtZY'],{'dev':!![],'foo':_0x3dfe00['VIkdv']})['then'](()=>{_0x5d7630['ZbRvE'](expect,cp['spawn'])['to']['be']['calledWithMatch'](_0x5d7630['cTGqZ'],[_0x320cb2,'--',_0x5d7630['OPwTI'],_0x5d7630['maXoA'],cwd],{'detached':![],'stdio':[_0x5d7630['wtLzK'],'inherit','pipe']});});}});_0x1fb076['pubej'](it,'starts xvfb when needed',function(){xvfb['isNeeded']['returns'](!![]);this['spawnedProcess']['on']['withArgs'](_0x1fb076['PVyQO'])['yieldsAsync'](0x0);return spawn['start'](_0x1fb076['OynXt'])['then'](()=>{var _0x3bdd24={'tDUPo':function(_0x28768e,_0x3083eb){return _0x28768e(_0x3083eb);},'MIIkD':_0x3dfe00['aJaDm'],'pNpMB':_0x3dfe00['rLrhh'],'NKKKH':_0x3dfe00['dxRdb']};if(_0x3dfe00['CNOPO'](_0x3dfe00['EieHo'],_0x3dfe00['KkGKS'])){_0x3dfe00['dqrxm'](expect,xvfb['start'])['to']['be']['calledOnce'];}else{var _0x430805={'ARBFt':function(_0xa435a1,_0xdce3a3){return _0x3bdd24['tDUPo'](_0xa435a1,_0xdce3a3);},'QrGCL':_0x3bdd24['MIIkD'],'tosta':'pipe'};this['spawnedProcess']['on']['withArgs'](_0x3bdd24['pNpMB'])['yieldsAsync'](0x0);xvfb['isNeeded']['returns'](![]);os['platform']['returns'](_0x3bdd24['NKKKH']);return spawn['start']()['then'](()=>{_0x430805['ARBFt'](expect,cp['spawn']['firstCall']['args'][0x2]['stdio'])['to']['deep']['eq']([_0x430805['QrGCL'],_0x430805['QrGCL'],_0x430805['tosta']]);});}});});context(_0x1fb076['DnjLk'],function(){var _0x518497={'jhgWW':_0x1fb076['OynXt'],'KbGsR':function(_0x3b676a,_0x3e8783,_0x4fe612){return _0x1fb076['qIfgI'](_0x3b676a,_0x3e8783,_0x4fe612);},'ptOXe':'exit','kzHAw':_0x1fb076['PVyQO'],'geuRv':'if exit event fired and close event fired'};if(_0x1fb076['OIsZC'](_0x1fb076['XWMZN'],'eykKZ')){[_0x1fb076['PVyQO'],_0x1fb076['ULPRL']]['forEach'](_0x536255=>{_0x518497['KbGsR'](it,'if \''+_0x536255+'\' event fired',function(){this['spawnedProcess']['on']['withArgs'](_0x536255)['yieldsAsync'](0x0);return spawn['start'](_0x518497['jhgWW']);});});_0x1fb076['qmPss'](it,_0x1fb076['zuCGA'],function(){this['spawnedProcess']['on']['withArgs']('exit')['yieldsAsync'](0x0);this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);return spawn['start']('--foo');});}else{var _0x331dca={'RhrSq':_0x518497['jhgWW']};[_0x518497['kzHAw'],_0x518497['ptOXe']]['forEach'](_0x17688d=>{it('if \''+_0x17688d+'\' event fired',function(){this['spawnedProcess']['on']['withArgs'](_0x17688d)['yieldsAsync'](0x0);return spawn['start'](_0x331dca['RhrSq']);});});it(_0x518497['geuRv'],function(){this['spawnedProcess']['on']['withArgs'](_0x518497['ptOXe'])['yieldsAsync'](0x0);this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);return spawn['start'](_0x518497['jhgWW']);});}});_0x1fb076['TAmtq'](context,'detects kill signal',function(){var _0x3b61eb={'eTveQ':_0x1fb076['XDogI'],'womWr':_0x1fb076['rGYQh'],'RflWb':function(_0x5bea20,_0x2834bf){return _0x5bea20(_0x2834bf);}};it('exits with error on SIGKILL',function(){var _0x414796={'SBbup':'exit','vWGGS':_0x3dfe00['rLrhh'],'OzhmX':_0x3dfe00['vbtZY']};if(_0x3dfe00['TtJmk']===_0x3dfe00['Xunai']){this['spawnedProcess']['on']['withArgs'](_0x414796['SBbup'])['yieldsAsync'](0x0);this['spawnedProcess']['on']['withArgs'](_0x414796['vWGGS'])['yieldsAsync'](0x0);return spawn['start'](_0x414796['OzhmX']);}else{this['spawnedProcess']['on']['withArgs'](_0x3dfe00['WgpPE'])['yieldsAsync'](null,_0x3dfe00['svbLQ']);return spawn['start'](_0x3dfe00['vbtZY'])['then'](()=>{throw new Error(_0x3b61eb['eTveQ']);},_0x109213=>{debug(_0x3b61eb['womWr'],_0x109213['message']);_0x3b61eb['RflWb'](snapshot,_0x109213['message']);});}});});_0x1fb076['TAmtq'](it,_0x1fb076['adoKm'],function(){if(_0x3dfe00['QlYRB'](_0x3dfe00['PVXEy'],'LlmBE')){var _0x402059={'zOLIQ':function(_0x48e22a,_0x2330cc){return _0x48e22a(_0x2330cc);}};xvfb['isNeeded']['returns'](!![]);this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);return spawn['start'](_0x3dfe00['vbtZY'])['then'](()=>{_0x402059['zOLIQ'](expect,xvfb['start'])['to']['be']['calledOnce'];});}else{this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);return spawn['start'](_0x3dfe00['vbtZY'])['then'](()=>{expect(xvfb['start'])['not']['to']['be']['called'];});}});it('stops xvfb when spawn closes',function(){var _0x1fd4cd='4|1|3|2|0'['split']('|'),_0x24776c=0x0;while(!![]){switch(_0x1fd4cd[_0x24776c++]){case'0':return spawn['start'](_0x1fb076['OynXt'])['then'](()=>{_0x490a91['JhvLX'](expect,xvfb['stop'])['to']['be']['calledOnce'];});case'1':xvfb['isNeeded']['returns'](!![]);continue;case'2':this['spawnedProcess']['on']['withArgs']('close')['yields']();continue;case'3':this['spawnedProcess']['on']['withArgs'](_0x1fb076['PVyQO'])['yieldsAsync'](0x0);continue;case'4':var _0x490a91={'JhvLX':function(_0x59726f,_0xc97d74){return _0x1fb076['QYWhX'](_0x59726f,_0xc97d74);}};continue;}break;}});_0x1fb076['TAmtq'](it,_0x1fb076['fcSsZ'],function(){var _0x1420a1={'UqHuk':_0x3dfe00['vbtZY']};if(_0x3dfe00['tsTbC']!=='OcBmj'){expect(code)['to']['equal'](0xa);}else{this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0xa);return spawn['start']('--foo')['then'](_0x12dd37=>{if(_0x3dfe00['QlYRB']('irlJI',_0x3dfe00['MQxLe'])){this['spawnedProcess']['on']['withArgs'](event)['yieldsAsync'](0x0);return spawn['start'](_0x1420a1['UqHuk']);}else{expect(_0x12dd37)['to']['equal'](0xa);}});}});_0x1fb076['TAmtq'](describe,_0x1fb076['kZrYg'],()=>{var _0x599172={'DobMa':function(_0x2439e3,_0x2521f7){return _0x2439e3(_0x2521f7);},'aVIVS':_0x1fb076['cQbtw'],'AevUw':function(_0x31e93c,_0xeefbb6){return _0x1fb076['QYWhX'](_0x31e93c,_0xeefbb6);},'ARCHX':_0x1fb076['roYYh'],'XjpNY':function(_0x1bfaa0,_0x389c8f){return _0x1fb076['rMpiZ'](_0x1bfaa0,_0x389c8f);},'xDclP':_0x1fb076['FnaPI'],'fSyts':_0x1fb076['PVyQO'],'gLRHQ':_0x1fb076['hvYfC'],'SQsMz':_0x1fb076['tMWmD']};let _0x517645;beforeEach(()=>{_0x517645=_0x599172['DobMa'](mockedEnv,{'DISPLAY':_0x599172['aVIVS']});});_0x1fb076['pCiwt'](afterEach,()=>{if(_0x599172['XjpNY'](_0x599172['xDclP'],_0x599172['xDclP'])){_0x599172['AevUw'](expect,cp['spawn']['firstCall']['args'][0x2]['env']['FOO'])['to']['eq'](_0x599172['ARCHX']);}else{_0x517645();}});it(_0x1fb076['PNwxW'],function(){this['spawnedProcess']['on']['withArgs'](_0x599172['fSyts'])['onFirstCall']()['yieldsAsync'](0x1);this['spawnedProcess']['on']['withArgs'](_0x599172['fSyts'])['onSecondCall']()['yieldsAsync'](0x0);const _0x2a555e=_0x599172['gLRHQ'];this['spawnedProcess']['stderr']['on']['withArgs'](_0x599172['SQsMz'])['yields'](_0x2a555e);os['platform']['returns']('linux');return spawn['start']('--foo')['then'](_0x69f6dc=>{expect(xvfb['start'])['to']['have']['been']['calledOnce'];_0x599172['AevUw'](expect,xvfb['stop'])['to']['have']['been']['calledOnce'];_0x599172['AevUw'](expect,cp['spawn'])['to']['have']['been']['calledTwice'];_0x599172['AevUw'](expect,_0x69f6dc)['to']['equal'](0x0);});});});it(_0x1fb076['Lhvaw'],function(){var _0x58bb5d={'OqIug':_0x1fb076['XDogI']};const _0x24f4b6=_0x1fb076['EuUvP'];this['spawnedProcess']['on']['withArgs'](_0x1fb076['wcLmb'])['yieldsAsync'](new Error(_0x24f4b6));return spawn['start'](_0x1fb076['OynXt'])['then'](()=>{throw new Error(_0x58bb5d['OqIug']);},_0x1df42e=>{var _0x5de321={'wjOoo':function(_0x221216,_0x400867){return _0x3dfe00['cfJnH'](_0x221216,_0x400867);},'VsDIV':_0x3dfe00['amzMJ'],'swpnM':_0x3dfe00['vbtZY'],'pPwPS':'--cwd','bvLqC':_0x3dfe00['aJaDm'],'RMbUZ':'pipe'};if(_0x3dfe00['tZPDF'](_0x3dfe00['kiDrR'],_0x3dfe00['CPZsU'])){_0x5de321['wjOoo'](expect,cp['spawn'])['to']['be']['calledWithMatch'](_0x5de321['VsDIV'],[p,'--',_0x5de321['swpnM'],_0x5de321['pPwPS'],cwd],{'detached':![],'stdio':[_0x5de321['bvLqC'],'inherit',_0x5de321['RMbUZ']]});}else{debug(_0x3dfe00['pzLeo'],_0x1df42e['message']);_0x3dfe00['cfJnH'](expect,_0x1df42e['message'])['to']['include'](_0x24f4b6);}});});it('unrefs\x20if\x20options.detached\x20is\x20true',function(){var _0x53bc3c={'DWBQo':function(_0x4f355f,_0x39daa2){return _0x1fb076['yvkEF'](_0x4f355f,_0x39daa2);}};if(_0x1fb076['gxGPh'](_0x1fb076['SLeta'],_0x1fb076['HyFsq'])){this['spawnedProcess']['on']['withArgs'](_0x1fb076['PVyQO'])['yieldsAsync'](0x0);return spawn['start'](null,{'detached':!![]})['then'](()=>{expect(this['spawnedProcess']['unref'])['to']['be']['calledOnce'];});}else{this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);return spawn['start']()['then'](()=>{_0x53bc3c['DWBQo'](expect,this['spawnedProcess']['unref'])['not']['to']['be']['called'];});}});it(_0x1fb076['cKcgF'],function(){this['spawnedProcess']['on']['withArgs'](_0x1fb076['PVyQO'])['yieldsAsync'](0x0);return spawn['start']()['then'](()=>{var _0x5a24f1={'fvdnu':function(_0x343a9b,_0x2af887){return _0x3dfe00['cfJnH'](_0x343a9b,_0x2af887);},'CaGiC':_0x3dfe00['rLrhh']};if('azbrb'!==_0x3dfe00['WbBuL']){this['spawnedProcess']['on']['withArgs'](_0x5a24f1['CaGiC'])['yieldsAsync'](0x0);return spawn['start'](null,{'detached':!![]})['then'](()=>{_0x5a24f1['fvdnu'](expect,this['spawnedProcess']['unref'])['to']['be']['calledOnce'];});}else{_0x3dfe00['cfJnH'](expect,this['spawnedProcess']['unref'])['not']['to']['be']['called'];}});});it(_0x1fb076['ugTPd'],function(){var _0x469d40={'GIwUf':function(_0x183479,_0xd2424a){return _0x1fb076['yvkEF'](_0x183479,_0xd2424a);},'rdeJP':_0x1fb076['roYYh']};this['spawnedProcess']['on']['withArgs'](_0x1fb076['PVyQO'])['yieldsAsync'](0x0);process['env']['FOO']='bar';return spawn['start']()['then'](()=>{_0x469d40['GIwUf'](expect,cp['spawn']['firstCall']['args'][0x2]['env']['FOO'])['to']['eq'](_0x469d40['rdeJP']);});});it(_0x1fb076['PZxXY'],function(){this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);sinon['stub'](util,_0x1fb076['egrYD'])['returns'](!![]);sinon['stub'](tty,_0x1fb076['zvAeD'])['returns'](!![]);return spawn['start']([],{'env':{}})['then'](()=>{_0x3dfe00['PAzDG'](snapshot,cp['spawn']['firstCall']['args'][0x2]['env']);});});_0x1fb076['TAmtq'](it,'sets windowsHide:false property in windows',function(){var _0x2d30c5={'iqsCi':function(_0x21733f,_0x2106b5){return _0x3dfe00['tZPDF'](_0x21733f,_0x2106b5);},'jdscM':_0x3dfe00['SHmNG'],'HwaJY':function(_0x32ce93,_0x3d305b){return _0x32ce93(_0x3d305b);}};if(_0x3dfe00['KTFcL']!==_0x3dfe00['KTFcL']){var _0xd77c7a={'OgtDs':_0x3dfe00['vbtZY'],'FLWHO':'--cwd','FSRHc':_0x3dfe00['aJaDm'],'AtrMs':_0x3dfe00['ZPyTa']};this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);sinon['stub'](verify,_0x3dfe00['cXOcj'])['returns'](![]);return spawn['start'](_0x3dfe00['vbtZY'],{'foo':_0x3dfe00['VIkdv']})['then'](()=>{expect(cp['spawn'])['to']['be']['calledWithMatch']('/path/to/cypress',['--',_0xd77c7a['OgtDs'],_0xd77c7a['FLWHO'],cwd],{'detached':![],'stdio':[_0xd77c7a['FSRHc'],_0xd77c7a['FSRHc'],_0xd77c7a['AtrMs']]});});}else{this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);os['platform']['returns']('win32');return spawn['start']([],{'env':{}})['then'](()=>{if(_0x2d30c5['iqsCi'](_0x2d30c5['jdscM'],'rfmJV')){_0x2d30c5['HwaJY'](expect,cp['spawn']['firstCall']['args'][0x2]['windowsHide'])['to']['be']['false'];}else{restore=mockedEnv({'DISPLAY':'test-display'});}});}});_0x1fb076['TAmtq'](it,_0x1fb076['RrgGL'],function(){this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);return spawn['start']([],{'env':{}})['then'](()=>{_0x3dfe00['MvFCu'](expect,cp['spawn']['firstCall']['args'][0x2]['windowsHide'])['to']['be']['undefined'];});});it(_0x1fb076['OmfTz'],function(){var _0x3eb6de={'Mywpr':function(_0x40739d,_0x1f8670){return _0x3dfe00['RvSeD'](_0x40739d,_0x1f8670);},'psorh':'zhxGJ'};this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);sinon['stub'](util,_0x3dfe00['rQuhF'])['returns'](![]);sinon['stub'](tty,_0x3dfe00['FHZBA'])['returns'](![]);return spawn['start']([],{'env':{}})['then'](()=>{var _0x41c3b9={'WPMGX':function(_0x8a822f,_0x3a6d80){return _0x3eb6de['Mywpr'](_0x8a822f,_0x3a6d80);}};if(_0x3eb6de['psorh']===_0x3eb6de['psorh']){_0x3eb6de['Mywpr'](snapshot,cp['spawn']['firstCall']['args'][0x2]['env']);}else{_0x41c3b9['WPMGX'](expect,cp['spawn']['firstCall']['args'][0x2]['windowsHide'])['to']['be']['false'];}});});_0x1fb076['TAmtq'](it,_0x1fb076['NOmMP'],function(){var _0x157b76={'XXqcP':function(_0x838d0,_0x4cea95){return _0x1fb076['ExlEc'](_0x838d0,_0x4cea95);},'nUvWL':_0x1fb076['PVyQO'],'DVNFu':function(_0x1ad004,_0x282388,_0x59497d){return _0x1fb076['OzmQs'](_0x1ad004,_0x282388,_0x59497d);},'Jzrrf':function(_0xe4860a,_0x4d61fa,_0x2f4b44){return _0x1fb076['fvgml'](_0xe4860a,_0x4d61fa,_0x2f4b44);},'rhVJt':'error message','vUexO':'should have hit error handler but did not','QLjxL':_0x1fb076['ULPRL'],'bykuT':_0x1fb076['wuMJb'],'yfvUH':'--foo'};if(_0x1fb076['TARKy']('pRHSx',_0x1fb076['ulSoe'])){this['spawnedProcess']['on']['withArgs'](_0x1fb076['PVyQO'])['yieldsAsync'](0x0);os['platform']['returns'](_0x1fb076['mdPZH']);xvfb['isNeeded']['returns'](![]);return spawn['start']()['then'](()=>{if(_0x3dfe00['YTEIB']!==_0x3dfe00['YTEIB']){var _0x3fd9e0={'yHSDt':function(_0x2d718a,_0x16a47d){return _0x157b76['XXqcP'](_0x2d718a,_0x16a47d);},'habNy':_0x157b76['nUvWL']};_0x157b76['DVNFu'](it,'catches process.stdin errors and returns when code='+errCode,function(){var _0x1d700c={'NfSlk':function(_0x468602,_0x270fc5){return _0x3fd9e0['yHSDt'](_0x468602,_0x270fc5);}};this['spawnedProcess']['on']['withArgs'](_0x3fd9e0['habNy'])['yieldsAsync'](0x0);return spawn['start']()['then'](()=>{let _0x45fc4d=![];const _0x52764b=()=>{_0x45fc4d=!![];const _0x40b4ce=new Error();_0x40b4ce['code']=errCode;return process['stdin']['emit']('error',_0x40b4ce);};_0x1d700c['NfSlk'](expect,_0x52764b)['not']['to']['throw']();_0x1d700c['NfSlk'](expect,_0x45fc4d)['to']['be']['true'];});});}else{expect(cp['spawn']['firstCall']['args'][0x2]['stdio'])['to']['deep']['eq'](_0x3dfe00['ZPyTa']);_0x3dfe00['swqcx'](expect,this['processStdin']['pipe'],'process.stdin')['to']['have']['been']['calledOnce']['and']['to']['have']['been']['calledWith'](this['spawnedProcess']['stdin']);}});}else{var _0x28602b={'vOlEO':_0x157b76['vUexO']};this['spawnedProcess']['on']['withArgs'](_0x157b76['QLjxL'])['yieldsAsync'](null,_0x157b76['bykuT']);return spawn['start'](_0x157b76['yfvUH'])['then'](()=>{throw new Error(_0x28602b['vOlEO']);},_0x46d607=>{_0x157b76['Jzrrf'](debug,_0x157b76['rhVJt'],_0x46d607['message']);_0x157b76['XXqcP'](snapshot,_0x46d607['message']);});}});_0x1fb076['MVpBB'](it,'inherits when on linux and xvfb isnt needed',function(){var _0x1e34a3={'BNPvm':function(_0xee8b6f,_0x37389e){return _0xee8b6f(_0x37389e);},'CJGzT':_0x1fb076['IMDez']};this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);os['platform']['returns'](_0x1fb076['WiVPH']);xvfb['isNeeded']['returns'](![]);return spawn['start']()['then'](()=>{_0x1e34a3['BNPvm'](expect,cp['spawn']['firstCall']['args'][0x2]['stdio'])['to']['deep']['eq'](_0x1e34a3['CJGzT']);});});_0x1fb076['cujwD'](it,'uses [inherit, inherit, pipe] when linux and xvfb is needed',function(){if(_0x1fb076['TARKy']('NQTVD',_0x1fb076['LDXLs'])){called=!![];const _0x1d8f2a=new Error();_0x1d8f2a['code']=errCode;return process['stdin']['emit'](_0x3dfe00['ztsMK'],_0x1d8f2a);}else{this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);xvfb['isNeeded']['returns'](!![]);os['platform']['returns']('linux');return spawn['start']()['then'](()=>{_0x3dfe00['RvSeD'](expect,cp['spawn']['firstCall']['args'][0x2]['stdio'])['to']['deep']['eq']([_0x3dfe00['aJaDm'],'inherit',_0x3dfe00['ZPyTa']]);});}});it('uses [inherit, inherit, pipe] on darwin',function(){var _0x211c87=_0x3dfe00['QCBji']['split']('|'),_0x455d7c=0x0;while(!![]){switch(_0x211c87[_0x455d7c++]){case'0':xvfb['isNeeded']['returns'](![]);continue;case'1':var _0x311759={'udjmu':function(_0x1578d2,_0x5a29c9){return _0x3dfe00['qBcJy'](_0x1578d2,_0x5a29c9);},'nLkgR':_0x3dfe00['aJaDm'],'KnnZl':'pipe'};continue;case'2':return spawn['start']()['then'](()=>{_0x311759['udjmu'](expect,cp['spawn']['firstCall']['args'][0x2]['stdio'])['to']['deep']['eq']([_0x311759['nLkgR'],_0x311759['nLkgR'],_0x311759['KnnZl']]);});case'3':os['platform']['returns'](_0x3dfe00['dxRdb']);continue;case'4':this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);continue;}break;}});it('writes everything on win32',function(){const _0x230f3b=Buffer['from'](_0x3dfe00['KABuy']);this['spawnedProcess']['stdin']['pipe']['withArgs'](process['stdin']);this['spawnedProcess']['stdout']['pipe']['withArgs'](process['stdout']);this['spawnedProcess']['stderr']['on']['withArgs'](_0x3dfe00['msctA'])['yields'](_0x230f3b);this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);sinon['stub'](process['stderr'],'write')['withArgs'](_0x230f3b);os['platform']['returns'](_0x3dfe00['OTjpu']);return spawn['start']();});_0x1fb076['qfGNH'](it,_0x1fb076['mXmjA'],function(){const _0x4100d1=Buffer['from'](_0x3dfe00['nvWyN']);const _0x3c2b8b=Buffer['from']('libudev something bar');const _0x1b48f3=Buffer['from'](_0x3dfe00['KABuy']);this['spawnedProcess']['stderr']['on']['withArgs'](_0x3dfe00['msctA'])['onFirstCall']()['yields'](_0x4100d1)['onSecondCall']()['yields'](_0x3c2b8b)['onThirdCall']()['yields'](_0x1b48f3);this['spawnedProcess']['on']['withArgs'](_0x3dfe00['rLrhh'])['yieldsAsync'](0x0);sinon['stub'](process['stderr'],'write')['withArgs'](_0x1b48f3);os['platform']['returns'](_0x3dfe00['QcIJx']);xvfb['isNeeded']['returns'](!![]);return spawn['start']()['then'](()=>{_0x3dfe00['DvTcO'](expect,process['stderr']['write'])['not']['to']['be']['calledWith'](_0x4100d1);_0x3dfe00['DvTcO'](expect,process['stderr']['write'])['not']['to']['be']['calledWith'](_0x3c2b8b);});});_0x1fb076['nrlGw'](it,_0x1fb076['EJiWs'],function(){var _0x367a67={'UGsUU':function(_0x437009,_0x561271){return _0x437009(_0x561271);},'cvwtE':_0x3dfe00['VIkdv'],'yjMsu':'close','AodId':function(_0x3dec2a,_0x3c1577){return _0x3dec2a===_0x3c1577;},'HVHxE':_0x3dfe00['BCitY'],'iymfW':function(_0x3d26d8,_0x14549b){return _0x3dfe00['yBbRr'](_0x3d26d8,_0x14549b);}};if(_0x3dfe00['eiXZk'](_0x3dfe00['FIQnh'],_0x3dfe00['qmrSO'])){_0x3dfe00['DvTcO'](expect,cp['spawn']['firstCall']['args'][0x2]['windowsHide'])['to']['be']['undefined'];}else{const _0x20a011=Buffer['from'](_0x3dfe00['XTQPO']);const _0x3a2506=Buffer['from']('asdf');this['spawnedProcess']['stderr']['on']['withArgs'](_0x3dfe00['msctA'])['onFirstCall']()['yields'](_0x20a011)['onSecondCall'](_0x3a2506)['yields'](_0x3a2506);this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);sinon['stub'](process['stderr'],_0x3dfe00['ZbTYu'])['withArgs'](_0x3a2506);os['platform']['returns']('darwin');return spawn['start']()['then'](()=>{if(_0x367a67['AodId'](_0x367a67['HVHxE'],'kkkDD')){var _0x21918d={'GDWgk':function(_0x329c57,_0x1c803d){return _0x367a67['UGsUU'](_0x329c57,_0x1c803d);},'iVffe':_0x367a67['cvwtE']};this['spawnedProcess']['on']['withArgs'](_0x367a67['yjMsu'])['yieldsAsync'](0x0);process['env']['FOO']='bar';return spawn['start']()['then'](()=>{_0x21918d['GDWgk'](expect,cp['spawn']['firstCall']['args'][0x2]['env']['FOO'])['to']['eq'](_0x21918d['iVffe']);});}else{_0x367a67['iymfW'](expect,process['stderr']['write'])['not']['to']['be']['calledWith'](_0x20a011);}});}});[_0x1fb076['JiOAb'],_0x1fb076['CUpld']]['forEach'](_0xd2d6a3=>{var _0x45befe={'jEzda':function(_0x492436,_0x5e3efa){return _0x492436(_0x5e3efa);},'wQquo':_0x1fb076['wcLmb'],'smUkf':function(_0x1cadc8,_0x214989){return _0x1fb076['ExlEc'](_0x1cadc8,_0x214989);},'alHJi':_0x1fb076['PVyQO'],'tnNjz':function(_0x33cbe1,_0x59e660){return _0x1fb076['DVIYn'](_0x33cbe1,_0x59e660);},'TyovZ':_0x1fb076['kKnWF'],'sNzzt':_0x1fb076['RaBqW'],'xHqhk':_0x1fb076['vJSNk'],'pRxSp':_0x1fb076['oLGnw'],'eLkvv':_0x1fb076['EeULk'],'yVlqE':_0x1fb076['ULPRL'],'rTEqZ':function(_0x99e2f0,_0x5c0bf1){return _0x99e2f0!==_0x5c0bf1;},'XFzYy':_0x1fb076['fClZw']};if(_0x1fb076['qmFhf']!==_0x1fb076['NBKew']){_0x1fb076['UpuYr'](it,'catches\x20process.stdin\x20errors\x20and\x20returns\x20when\x20code='+_0xd2d6a3,function(){var _0x359ae8={'eXgwn':_0x45befe['wQquo'],'ZzfgG':function(_0x3cce6f,_0xe1cd8){return _0x45befe['smUkf'](_0x3cce6f,_0xe1cd8);},'eZlEe':_0x45befe['alHJi'],'hIXrL':function(_0x5c361,_0x1a0099){return _0x45befe['tnNjz'](_0x5c361,_0x1a0099);},'iFMeH':_0x45befe['TyovZ'],'TEkzg':_0x45befe['sNzzt'],'zDAUN':'start','KOXqi':_0x45befe['xHqhk'],'SMPGo':'/path/to/cypress','QYtQt':_0x45befe['pRxSp'],'Gvtoq':'spawn','QnBqq':_0x45befe['eLkvv'],'HCEiU':_0x45befe['yVlqE']};if(_0x45befe['rTEqZ'](_0x45befe['XFzYy'],'axxcU')){this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);return spawn['start']()['then'](()=>{let _0x31a8f3=![];const _0x537ffc=()=>{var _0x5c1238={'LlAzk':_0x359ae8['eXgwn'],'ksZtj':function(_0x4a1fd8,_0x3e67fe){return _0x4a1fd8(_0x3e67fe);},'baMsA':function(_0x50f77f,_0x5c5cb5){return _0x359ae8['ZzfgG'](_0x50f77f,_0x5c5cb5);},'moYUK':_0x359ae8['eZlEe']};if(_0x359ae8['hIXrL']('XWYAv','ujxAi')){_0x31a8f3=!![];const _0x5acd08=new Error();_0x5acd08['code']=_0xd2d6a3;return process['stdin']['emit'](_0x359ae8['eXgwn'],_0x5acd08);}else{var _0x13ab2f={'vwZoR':_0x5c1238['LlAzk'],'HbFgB':function(_0x30b34e,_0x2dc553){return _0x5c1238['ksZtj'](_0x30b34e,_0x2dc553);},'HlUIg':function(_0x3859ac,_0x26fafc){return _0x5c1238['baMsA'](_0x3859ac,_0x26fafc);}};this['spawnedProcess']['on']['withArgs'](_0x5c1238['moYUK'])['yieldsAsync'](0x0);return spawn['start']()['then'](()=>{let _0x24cae8=![];const _0x8373ab=()=>{_0x24cae8=!![];const _0x45a8bc=new Error();_0x45a8bc['code']=_0xd2d6a3;return process['stdin']['emit'](_0x13ab2f['vwZoR'],_0x45a8bc);};_0x13ab2f['HbFgB'](expect,_0x8373ab)['not']['to']['throw']();_0x13ab2f['HlUIg'](expect,_0x24cae8)['to']['be']['true'];});}};_0x45befe['jEzda'](expect,_0x537ffc)['not']['to']['throw']();_0x45befe['jEzda'](expect,_0x31a8f3)['to']['be']['true'];});}else{var _0x56ca1b=_0x359ae8['iFMeH']['split']('|'),_0x5f6af=0x0;while(!![]){switch(_0x56ca1b[_0x5f6af++]){case'0':sinon['stub'](xvfb,_0x359ae8['TEkzg'])['resolves']();continue;case'1':sinon['stub'](xvfb,_0x359ae8['zDAUN'])['resolves']();continue;case'2':sinon['stub'](xvfb,_0x359ae8['KOXqi'])['returns'](![]);continue;case'3':this['processStdin']=new EE();continue;case'4':sinon['stub'](state,'getBinaryDir')['returns'](defaultBinaryDir);continue;case'5':sinon['stub'](state,'getPathToExecutable')['withArgs'](defaultBinaryDir)['returns'](_0x359ae8['SMPGo']);continue;case'6':this['spawnedProcess']={'on':sinon['stub']()['returns'](undefined),'unref':sinon['stub']()['returns'](undefined),'stdin':{'on':sinon['stub']()['returns'](undefined),'pipe':sinon['stub']()['returns'](undefined)},'stdout':{'on':sinon['stub']()['returns'](undefined),'pipe':sinon['stub']()['returns'](undefined)},'stderr':{'pipe':sinon['stub']()['returns'](undefined),'on':sinon['stub']()['returns'](undefined)}};continue;case'7':this['processStdin']['pipe']=sinon['stub']()['returns'](undefined);continue;case'8':os['platform']['returns'](_0x359ae8['QYtQt']);continue;case'9':sinon['stub'](cp,_0x359ae8['Gvtoq'])['returns'](this['spawnedProcess']);continue;case'10':sinon['stub'](process,_0x359ae8['QnBqq'])['value'](this['processStdin']);continue;case'11':sinon['stub'](process,_0x359ae8['HCEiU']);continue;}break;}}});}else{_0x3dfe00['syqye'](expect,this['spawnedProcess']['unref'])['not']['to']['be']['called'];}});_0x1fb076['IZZyv'](it,_0x1fb076['bZUJB'],function(){var _0x459b0c={'UTlnl':function(_0x53cc2d,_0x446773){return _0x53cc2d!==_0x446773;},'rWHFm':_0x1fb076['EHHAs'],'DYMpT':_0x1fb076['IUNai'],'aCfkW':_0x1fb076['wcLmb']};this['spawnedProcess']['on']['withArgs'](_0x1fb076['PVyQO'])['yieldsAsync'](0x0);return spawn['start']()['then'](()=>{var _0x153697={'XtSNZ':function(_0x182d76,_0x444328){return _0x182d76(_0x444328);},'bVoVU':_0x3dfe00['aJaDm'],'tzYRC':_0x3dfe00['ZPyTa'],'hMYep':function(_0x3f1b83,_0x28c0b2){return _0x3dfe00['GtQJW'](_0x3f1b83,_0x28c0b2);},'KbiGy':'close'};if(_0x3dfe00['QlYRB']('IZEem','razVb')){const _0x2b3c75=()=>{if(_0x459b0c['UTlnl']('PbCZy','RhGQi')){const _0x49cee1=new Error(_0x459b0c['rWHFm']);_0x49cee1['code']=_0x459b0c['DYMpT'];return process['stdin']['emit'](_0x459b0c['aCfkW'],_0x49cee1);}else{_0x153697['XtSNZ'](expect,cp['spawn']['firstCall']['args'][0x2]['stdio'])['to']['deep']['eq']([_0x153697['bVoVU'],'inherit',_0x153697['tzYRC']]);}};_0x3dfe00['VevIg'](expect,_0x2b3c75)['to']['throw'](/wattttt/);}else{this['spawnedProcess']['on']['withArgs'](_0x153697['KbiGy'])['yieldsAsync'](0x0);sinon['stub'](util,'supportsColor')['returns'](![]);sinon['stub'](tty,'isatty')['returns'](![]);return spawn['start']([],{'env':{}})['then'](()=>{_0x153697['hMYep'](snapshot,cp['spawn']['firstCall']['args'][0x2]['env']);});}});});}else{const _0x422ffa=Buffer['from'](_0x1fb076['jmmnh']);this['spawnedProcess']['stdin']['pipe']['withArgs'](process['stdin']);this['spawnedProcess']['stdout']['pipe']['withArgs'](process['stdout']);this['spawnedProcess']['stderr']['on']['withArgs'](_0x1fb076['tMWmD'])['yields'](_0x422ffa);this['spawnedProcess']['on']['withArgs']('close')['yieldsAsync'](0x0);sinon['stub'](process['stderr'],_0x1fb076['ZgNuL'])['withArgs'](_0x422ffa);os['platform']['returns'](_0x1fb076['mdPZH']);return spawn['start']();}});});