require('../spec_helper');const os=require('os');const path=require('path');const Promise=require('bluebird');const lockFile=Promise['promisifyAll'](require('lockfile'));const {fs}=require(root+'lib/util/fs');const env=require(root+'lib/util/env');const exit=require(root+'lib/util/exit');const FileUtil=require(root+'lib/util/file');describe('lib/util/file',()=>{var _0x4697ae={'CvMDD':'cypress','XkGYo':'file_spec','RfGrD':function(_0x2c9409,_0x1c21bf){return _0x2c9409(_0x1c21bf);},'fIDVK':'Must specify path to file when creating new FileUtil()','eMZyS':function(_0x406b3d,_0x2f3a22){return _0x406b3d!==_0x2f3a22;},'HjIwL':'ensure','XZLsa':'cCVJa','pFImR':'items','EfMrM':'foo','QffDo':'EEXIST','BWiUX':'bar','iAqcL':function(_0x23ffb0,_0x2ac044){return _0x23ffb0===_0x2ac044;},'cWbFm':'PRFeB','jONOs':'jbmla','wBKiC':function(_0x27bc0d,_0x264ca9){return _0x27bc0d(_0x264ca9);},'hiptM':function(_0x238e29,_0xc7d1dc,_0x20b108){return _0x238e29(_0xc7d1dc,_0x20b108);},'KfWxh':'JDYkE','MTOYN':'WKxAA','vkzTe':'MvZwV','GukWE':'foo.baz','rdTRB':function(_0x4c15a2,_0x299f7b){return _0x4c15a2(_0x299f7b);},'AqCVV':function(_0x2e7c90,_0x5c66e9){return _0x2e7c90===_0x5c66e9;},'oHPSJ':'0|4|2|3|1','JwfoA':'unlockSync','XwXKr':function(_0x169bb2,_0x579143){return _0x169bb2===_0x579143;},'Ueuto':'rVSzZ','WFmwD':'LgFXz','erqcx':'TvcAT','zdrFj':function(_0x51e035,_0x1661c8){return _0x51e035(_0x1661c8);},'CMsMW':function(_0x189d72,_0x22a75d){return _0x189d72===_0x22a75d;},'irHuZ':'mvuvC','vFTHf':'unlockAsync','EZhVp':'fail!','Sitxr':'outputJsonAsync','AMwza':function(_0x1c7c69,_0x7e6f79){return _0x1c7c69(_0x7e6f79);},'xhjHG':function(_0x5b47a8,_0x5e642c){return _0x5b47a8===_0x5e642c;},'TkevX':'default','PFdbL':'SovGA','ZIOuX':'mCBeo','uVbJt':'HKppj','SusjV':'lockAsync','BPNzs':function(_0x30b37e,_0x1406b5){return _0x30b37e!==_0x1406b5;},'AAgxp':'TfAEm','YTvlD':'bwOtg','mNSFf':'UQlmv','usPVo':'lolz','AFvCX':'YdAiG','laktb':function(_0x10419c,_0x254671){return _0x10419c!==_0x254671;},'efEYT':'ROGql','PobTu':'RCQPR','IOfBo':'jukkp','pogqg':'readJsonAsync','EZiUs':'get','rNAka':function(_0x4fd2ce,_0x471874,_0x142d16){return _0x4fd2ce(_0x471874,_0x142d16);},'rLhWk':'resolves entire object if given no key','fMWph':function(_0x2c5347,_0x41c81e,_0x5a37c8){return _0x2c5347(_0x41c81e,_0x5a37c8);},'bMkLc':'resolves value for key when one is set','ojfuk':'resolves value for path when one is set','nlsmm':'resolves\x20default\x20value\x20if\x20given\x20key\x20is\x20undefined','onbqY':function(_0x4ae3c0,_0x243aa3,_0x34e697){return _0x4ae3c0(_0x243aa3,_0x34e697);},'yaWuS':'resolves undefined if value is undefined','iQOZo':'resolves null if value is null','pFqLg':function(_0x225a6f,_0x5d8098,_0xa048d5){return _0x225a6f(_0x5d8098,_0xa048d5);},'iMjjg':'resolves empty object when contents file does not exist','Horui':'resolves empty object when contents file is empty','wgwzW':function(_0x423b7d,_0x3a6370,_0x14ad8e){return _0x423b7d(_0x3a6370,_0x14ad8e);},'ZSNsF':'resolves empty object when it can\'t get lock on file on initial read','MjSVZ':'debounces reading from disk','nzWWu':function(_0x2987d0,_0x49c861,_0x19c295){return _0x2987d0(_0x49c861,_0x19c295);},'Wllwk':'unlocks file when finished reading','yWCYv':'unlocks\x20file\x20even\x20if\x20reading\x20fails','FLnbJ':'MCZeR','Vehle':'Expected\x20`key`\x20to\x20be\x20of\x20type\x20`string`\x20or\x20`object`,\x20got\x20`number`','ufuSp':'DtnSD','RgnLD':function(_0x2760e4,_0x3a7625){return _0x2760e4(_0x3a7625);},'NjHao':function(_0x5a1b94,_0x445e49){return _0x5a1b94!==_0x445e49;},'gQycE':'Mbmpf','QAaYX':'TEOsq','kuHwB':'file.json','jgELR':function(_0x1e4f99,_0x3b5b3f){return _0x1e4f99(_0x3b5b3f);},'gtrMk':'dqCIc','wyOel':'baz','Hjiyj':'qux','sOJGS':'zsIjK','BanvW':'utf8','MnMKy':function(_0x50ef58,_0x49a4a4){return _0x50ef58!==_0x49a4a4;},'OkmYB':'EKhCz','GxEVc':'vZiEZ','GhbCN':'BHeek','cDneC':function(_0x59d8d9,_0x486c5e){return _0x59d8d9===_0x486c5e;},'nJWQy':'cbMhz','cBxwZ':function(_0x536bb1,_0xde3842){return _0x536bb1(_0xde3842);},'fHxoQ':'throws if 1st argument is not a string or plain object','cMMiu':'sets\x20value\x20for\x20given\x20key','dDydn':function(_0x3a1d50,_0x501083,_0xbc85c6){return _0x3a1d50(_0x501083,_0xbc85c6);},'alWdh':'sets values for object','nirQF':function(_0x1c1a22,_0x36398e,_0x41c11b){return _0x1c1a22(_0x36398e,_0x41c11b);},'odjep':'leaves\x20existing\x20values\x20alone','LlDgu':function(_0x5d1828,_0x35d894,_0x161af6){return _0x5d1828(_0x35d894,_0x161af6);},'QoLTM':function(_0x3acac8,_0x43c1c4,_0xdbb4fe){return _0x3acac8(_0x43c1c4,_0xdbb4fe);},'NqJlr':'locks file while writing','FufXf':function(_0x18c839,_0xd64464,_0x40bb3e){return _0x18c839(_0xd64464,_0x40bb3e);},'lMKso':'unlocks file when finished writing','opGwz':'unlocks file even if writing fails','JXEYz':function(_0x16d3ae,_0x14cc8f){return _0x16d3ae===_0x14cc8f;},'LrOjA':'cfdkl','YVfyJ':'bPWJR','NGRKW':'Edqay','ATDuD':function(_0x327804,_0x436297){return _0x327804(_0x436297);},'jAJOZ':function(_0x579a10,_0x5f09dc){return _0x579a10===_0x5f09dc;},'ZhSoo':'vTpOB','rmpnJ':'Elhmw','NcikT':'GYqPG','RqpyS':'removes\x20the\x20file','noiPE':'locks\x20file\x20while\x20removing','NHdwp':function(_0x1b894e,_0x48a7db,_0x7b7832){return _0x1b894e(_0x48a7db,_0x7b7832);},'csrHM':'unlocks\x20file\x20even\x20if\x20removing\x20fails','jIPcJ':'unlocks\x20file\x20on\x20exit','RZaUt':'#transaction','UQAdS':function(_0x1c93c0,_0x4245dc,_0x5da654){return _0x1c93c0(_0x4245dc,_0x5da654);},'Pfkpm':'#get','AZqXF':function(_0x86f778,_0x57ed4f,_0x197a8b){return _0x86f778(_0x57ed4f,_0x197a8b);},'rPGhF':'#remove'};beforeEach(function(){this['dir']=path['join'](os['tmpdir'](),_0x4697ae['CvMDD'],_0x4697ae['XkGYo']);this['path']=path['join'](this['dir'],'file.json');return fs['removeAsync'](this['dir'])['catch'](()=>{});});_0x4697ae['NHdwp'](it,'throws if path is not specified',()=>{_0x4697ae['RfGrD'](expect,()=>{return new FileUtil();})['to']['throw'](_0x4697ae['fIDVK']);});_0x4697ae['NHdwp'](it,_0x4697ae['jIPcJ'],function(){var _0x3a7f15={'kOzkZ':function(_0x1da026,_0x107f72){return _0x4697ae['RfGrD'](_0x1da026,_0x107f72);}};if(_0x4697ae['eMZyS']('mpdCh','mpdCh')){_0x3a7f15['kOzkZ'](expect,lockFile['lockAsync'])['to']['be']['called'];}else{var _0x41bbe0='3|2|4|0|1'['split']('|'),_0x3f69ef=0x0;while(!![]){switch(_0x41bbe0[_0x3f69ef++]){case'0':exit['ensure']['yield']();continue;case'1':_0x4697ae['RfGrD'](expect,lockFile['unlockSync'])['to']['be']['called'];continue;case'2':sinon['stub'](exit,_0x4697ae['HjIwL']);continue;case'3':sinon['spy'](lockFile,'unlockSync');continue;case'4':new FileUtil({'path':this['path']});continue;}break;}}});context(_0x4697ae['RZaUt'],()=>{var _0x2f60ae={'Cztsj':function(_0x5b0a0c,_0x370cd8){return _0x4697ae['wBKiC'](_0x5b0a0c,_0x370cd8);},'MKeCu':_0x4697ae['EfMrM'],'VWmEW':function(_0x4d8950,_0xb1b7cd){return _0x4697ae['iAqcL'](_0x4d8950,_0xb1b7cd);},'xJOAR':'kgloH','vIQTR':'baz','UoFcM':_0x4697ae['pFImR']};if(_0x4697ae['eMZyS']('pwVoT','zKblW')){_0x4697ae['wBKiC'](beforeEach,function(){var _0x58570a={'vLgJs':'foo'};if(_0x2f60ae['VWmEW'](_0x2f60ae['xJOAR'],_0x2f60ae['xJOAR'])){this['fileUtil']=new FileUtil({'path':this['path']});}else{var _0x7ba958={'gGTOn':function(_0x5f25f5,_0x2a3c90){return _0x2f60ae['Cztsj'](_0x5f25f5,_0x2a3c90);}};return this['fileUtil']['set'](_0x2f60ae['MKeCu'],'bar')['then'](()=>{return this['fileUtil']['get'](_0x58570a['vLgJs']);})['then'](_0x283519=>{_0x7ba958['gGTOn'](expect,_0x283519)['to']['equal']('bar');});}});_0x4697ae['hiptM'](it,'ensures\x20returned\x20promise\x20completely\x20resolves\x20before\x20moving\x20on\x20with\x20queue',function(){var _0x3ffdea={'GqCxv':_0x4697ae['XZLsa'],'nOrOt':'WyvuO','RJkCt':_0x4697ae['pFImR'],'KYmMO':_0x4697ae['EfMrM'],'lEfZq':_0x4697ae['QffDo'],'eedIW':'AOeZQ','ZADXu':_0x4697ae['BWiUX'],'yHhCP':function(_0x28c9e7,_0xfedf14){return _0x4697ae['iAqcL'](_0x28c9e7,_0xfedf14);},'LISQx':'Cabtd','PlRgx':_0x4697ae['cWbFm'],'BhvGc':_0x4697ae['CvMDD'],'umZmN':_0x4697ae['XkGYo'],'QSXIh':function(_0x4fea57,_0x64d071){return _0x4fea57!==_0x64d071;},'stusz':_0x4697ae['jONOs'],'HqkIl':function(_0xff3a53,_0x112e33){return _0xff3a53(_0x112e33);},'jWsjK':'xrRUL','HyjZZ':'readJsonAsync'};if('aDekC'!=='eTTsA'){return Promise['all']([this['fileUtil']['transaction'](_0x1b0c98=>{var _0x364bd4={'DcXVA':_0x3ffdea['lEfZq']};if(_0x3ffdea['eedIW']!=='MIbnV'){return _0x1b0c98['get']('items',[])['then'](_0x167511=>{if(_0x3ffdea['GqCxv']===_0x3ffdea['nOrOt']){return this['fileUtil']['get']();}else{return _0x1b0c98['set'](_0x3ffdea['RJkCt'],_0x167511['concat'](_0x3ffdea['KYmMO']));}});}else{sinon['stub'](lockFile,'lockAsync')['rejects']({'name':'','message':'','code':_0x364bd4['DcXVA']});return this['fileUtil']['get']();}}),this['fileUtil']['transaction'](_0x47b951=>{var _0x3e04f5={'KFtIw':'foo.baz','qZZPQ':'bar'};return _0x47b951['get']('items',[])['then'](_0x3da694=>{var _0x2fd238={'zGOZI':function(_0x4fc902,_0x4e4f73){return _0x4fc902(_0x4e4f73);},'iCazs':_0x3ffdea['ZADXu']};if(_0x3ffdea['yHhCP'](_0x3ffdea['LISQx'],_0x3ffdea['PlRgx'])){return this['fileUtil']['set'](_0x3e04f5['KFtIw'],_0x3e04f5['qZZPQ'])['then'](()=>{return this['fileUtil']['get']('foo.baz');})['then'](_0x318304=>{_0x2fd238['zGOZI'](expect,_0x318304)['to']['equal'](_0x2fd238['iCazs']);});}else{return _0x47b951['set'](_0x3ffdea['RJkCt'],_0x3da694['concat']('bar'));}});}),this['fileUtil']['transaction'](_0x377520=>{var _0x2400a8={'UCcdn':'items','sAAKz':_0x2f60ae['vIQTR']};return _0x377520['get'](_0x2f60ae['UoFcM'],[])['then'](_0x2322f5=>{return _0x377520['set'](_0x2400a8['UCcdn'],_0x2322f5['concat'](_0x2400a8['sAAKz']));});})])['then'](()=>{var _0x474b41={'fTHYQ':_0x2f60ae['MKeCu']};return this['fileUtil']['transaction'](_0x2c7863=>{var _0x276c0d={'NEMMa':_0x3ffdea['BhvGc'],'nLsoX':_0x3ffdea['umZmN'],'BfjQN':function(_0x4f0cef,_0x7b1a72){return _0x3ffdea['QSXIh'](_0x4f0cef,_0x7b1a72);},'krwNi':_0x3ffdea['stusz'],'oiXEX':function(_0x3e1e37,_0x428e1c){return _0x3ffdea['HqkIl'](_0x3e1e37,_0x428e1c);},'EGgvt':'foo','xqXId':_0x3ffdea['ZADXu']};if(_0x3ffdea['jWsjK']===_0x3ffdea['jWsjK']){return _0x2c7863['get']('items')['then'](_0x5ebcd5=>{if(_0x276c0d['BfjQN']('efrGr',_0x276c0d['krwNi'])){_0x276c0d['oiXEX'](expect,_0x5ebcd5)['to']['eql']([_0x276c0d['EGgvt'],_0x276c0d['xqXId'],'baz']);}else{this['dir']=path['join'](os['tmpdir'](),_0x276c0d['NEMMa'],_0x276c0d['nLsoX']);this['path']=path['join'](this['dir'],'file.json');return fs['removeAsync'](this['dir'])['catch'](()=>{});}});}else{return _0x2c7863['set']('items',items['concat'](_0x474b41['fTHYQ']));}});});}else{sinon['stub'](fs,_0x3ffdea['HyjZZ'])['resolves']({});return Promise['all']([this['fileUtil']['get'](),this['fileUtil']['get'](),this['fileUtil']['get']()])['then'](()=>{expect(fs['readJsonAsync'])['to']['be']['calledOnce'];});}});}else{return new FileUtil();}});_0x4697ae['UQAdS'](context,_0x4697ae['Pfkpm'],()=>{var _0x548112={'NXrsi':'bar','eLEum':_0x4697ae['pFImR'],'qYyFH':'foo.baz','AaVbX':_0x4697ae['vFTHf'],'dtaIo':_0x4697ae['Sitxr'],'AwcJr':_0x4697ae['EZhVp'],'uYPLd':_0x4697ae['EfMrM'],'CQemF':function(_0x1b5603,_0x4ea633){return _0x4697ae['eMZyS'](_0x1b5603,_0x4ea633);},'Szdqs':'frUax','MCvJV':function(_0x58cf55,_0x4d2eb6){return _0x4697ae['AMwza'](_0x58cf55,_0x4d2eb6);},'LYimj':function(_0x4b6e83,_0xb4cdfe){return _0x4697ae['xhjHG'](_0x4b6e83,_0xb4cdfe);},'PYOGB':'Vzlaq','UjzRd':_0x4697ae['TkevX'],'lciwq':'aqTTO','ZjMjl':_0x4697ae['PFdbL'],'tJPfZ':function(_0x4e355c,_0x51793){return _0x4697ae['xhjHG'](_0x4e355c,_0x51793);},'GMWDh':_0x4697ae['ZIOuX'],'CGkLU':_0x4697ae['uVbJt'],'EbKQR':_0x4697ae['SusjV'],'PvHOC':function(_0x805fc3,_0x28948a){return _0x4697ae['BPNzs'](_0x805fc3,_0x28948a);},'ZRFnq':_0x4697ae['AAgxp'],'FaUOS':_0x4697ae['YTvlD'],'TTuXV':function(_0x115316,_0xedf19){return _0x4697ae['BPNzs'](_0x115316,_0xedf19);},'aTBXf':_0x4697ae['mNSFf'],'ktVcG':_0x4697ae['usPVo'],'OTyPi':'PXyBe','EwimU':_0x4697ae['AFvCX'],'BdSZI':'file.json','nhqxa':function(_0x374a0e,_0x31a092){return _0x4697ae['laktb'](_0x374a0e,_0x31a092);},'iGYyZ':_0x4697ae['efEYT'],'qscXC':'aRwZo','nqAmo':_0x4697ae['PobTu'],'rZotp':_0x4697ae['IOfBo'],'kgwja':_0x4697ae['pogqg'],'ZIxQj':function(_0x565323,_0x3ecad7){return _0x4697ae['AMwza'](_0x565323,_0x3ecad7);},'eedbN':_0x4697ae['EZiUs']};_0x4697ae['AMwza'](beforeEach,function(){if(_0x4697ae['iAqcL'](_0x4697ae['KfWxh'],_0x4697ae['KfWxh'])){this['fileUtil']=new FileUtil({'path':this['path']});}else{var _0x29dbc0={'moTXm':_0x548112['NXrsi'],'hClNL':'baz'};return tx['get'](_0x548112['eLEum'])['then'](_0x152e13=>{expect(_0x152e13)['to']['eql'](['foo',_0x29dbc0['moTXm'],_0x29dbc0['hClNL']]);});}});_0x4697ae['rNAka'](it,_0x4697ae['rLhWk'],function(){return this['fileUtil']['get']()['then'](_0x1fa653=>{expect(_0x1fa653)['to']['eql']({});});});_0x4697ae['fMWph'](it,_0x4697ae['bMkLc'],function(){var _0x2da7cb={'EVnJu':function(_0x20594b,_0x314d44){return _0x4697ae['eMZyS'](_0x20594b,_0x314d44);},'IVLha':'WqmnC','GUqNG':_0x4697ae['MTOYN'],'geKWs':'file.json','lSYVy':_0x4697ae['vkzTe'],'mRyyC':function(_0x3f21ed,_0x2e624d){return _0x4697ae['wBKiC'](_0x3f21ed,_0x2e624d);}};return this['fileUtil']['set'](_0x4697ae['EfMrM'],_0x4697ae['BWiUX'])['then'](()=>{if(_0x2da7cb['EVnJu'](_0x2da7cb['IVLha'],_0x2da7cb['GUqNG'])){return this['fileUtil']['get']('foo');}else{this['fileUtil']=new FileUtil({'path':this['path']});}})['then'](_0x92f368=>{var _0x3d63be={'jbeCc':_0x2da7cb['geKWs']};if(_0x2da7cb['EVnJu']('HoBlR',_0x2da7cb['lSYVy'])){_0x2da7cb['mRyyC'](expect,_0x92f368)['to']['equal']('bar');}else{return fs['readFileAsync'](path['join'](this['dir'],_0x3d63be['jbeCc']),'utf8');}});});_0x4697ae['fMWph'](it,_0x4697ae['ojfuk'],function(){return this['fileUtil']['set'](_0x4697ae['GukWE'],_0x4697ae['BWiUX'])['then'](()=>{return this['fileUtil']['get'](_0x548112['qYyFH']);})['then'](_0x64b23f=>{var _0x5e07ca={'bsRJO':function(_0x469da5,_0x497849){return _0x469da5(_0x497849);},'bqqet':_0x548112['AaVbX'],'aoNLs':_0x548112['dtaIo'],'cXVwW':_0x548112['AwcJr'],'bkfIs':_0x548112['uYPLd'],'HZktZ':_0x548112['NXrsi']};if(_0x548112['CQemF'](_0x548112['Szdqs'],_0x548112['Szdqs'])){var _0x42f2b7={'qGVcG':function(_0x12f02e,_0x3f5f1d){return _0x5e07ca['bsRJO'](_0x12f02e,_0x3f5f1d);}};sinon['spy'](lockFile,_0x5e07ca['bqqet']);sinon['stub'](fs,_0x5e07ca['aoNLs'])['rejects'](new Error(_0x5e07ca['cXVwW']));return this['fileUtil']['set'](_0x5e07ca['bkfIs'],_0x5e07ca['HZktZ'])['catch'](()=>{_0x42f2b7['qGVcG'](expect,lockFile['unlockAsync'])['to']['be']['called'];});}else{_0x548112['MCvJV'](expect,_0x64b23f)['to']['equal'](_0x548112['NXrsi']);}});});_0x4697ae['fMWph'](it,_0x4697ae['nlsmm'],function(){var _0x4317b9={'GAdLv':'should have caught!','XWUkN':function(_0x47453b,_0x28d1b7){return _0x47453b(_0x28d1b7);},'NkKyE':_0x548112['AwcJr'],'JRCrN':function(_0x236e5b,_0x14111f){return _0x548112['LYimj'](_0x236e5b,_0x14111f);},'TUuYO':_0x548112['PYOGB'],'MpZMg':'DTDff','lbxtv':_0x548112['UjzRd']};return this['fileUtil']['get']('foo','default')['then'](_0x29f244=>{var _0x49bbb0={'Bjleq':_0x4317b9['GAdLv'],'KajJh':function(_0x5ca5d1,_0x179575){return _0x4317b9['XWUkN'](_0x5ca5d1,_0x179575);},'lVsyM':function(_0x341d3e,_0x2f142e){return _0x4317b9['XWUkN'](_0x341d3e,_0x2f142e);},'fcMpj':_0x4317b9['NkKyE']};if(_0x4317b9['JRCrN'](_0x4317b9['TUuYO'],_0x4317b9['MpZMg'])){var _0x504db5={'HrFVN':function(_0x4dcafa,_0x724300){return _0x49bbb0['KajJh'](_0x4dcafa,_0x724300);},'eheOv':'fail!','cmZmh':function(_0xb78356,_0x164cdd){return _0x49bbb0['lVsyM'](_0xb78356,_0x164cdd);}};sinon['spy'](lockFile,'unlockAsync');sinon['stub'](fs,'removeAsync')['rejects'](new Error(_0x49bbb0['fcMpj']));return this['fileUtil']['remove']()['then'](()=>{throw new Error(_0x49bbb0['Bjleq']);})['catch'](_0x3b9d3b=>{_0x504db5['HrFVN'](expect,_0x3b9d3b['message'])['to']['eq'](_0x504db5['eheOv']);_0x504db5['cmZmh'](expect,lockFile['unlockAsync'])['to']['be']['called'];});}else{expect(_0x29f244)['to']['equal'](_0x4317b9['lbxtv']);}});});_0x4697ae['onbqY'](it,_0x4697ae['yaWuS'],function(){var _0x13ca2b={'oWRZP':function(_0x33d54a,_0x56af74){return _0x548112['MCvJV'](_0x33d54a,_0x56af74);},'WFyJu':'baz'};if(_0x548112['LYimj'](_0x548112['ZjMjl'],'fdKhT')){_0x13ca2b['oWRZP'](expect,items)['to']['eql'](['foo','bar',_0x13ca2b['WFyJu']]);}else{return this['fileUtil']['get'](_0x548112['uYPLd'])['then'](_0x2ce38b=>{var _0x5c220e={'PJnGU':_0x548112['NXrsi']};if(_0x548112['lciwq']===_0x548112['lciwq']){_0x548112['MCvJV'](expect,_0x2ce38b)['to']['be']['undefined'];}else{return tx['set']('items',items['concat'](_0x5c220e['PJnGU']));}});}});it(_0x4697ae['iQOZo'],function(){var _0x56d3c9={'xvGBR':'foo'};return this['fileUtil']['set'](_0x4697ae['EfMrM'],null)['then'](()=>{return this['fileUtil']['get'](_0x56d3c9['xvGBR']);})['then'](_0x2ff4dc=>{_0x548112['MCvJV'](expect,_0x2ff4dc)['to']['be']['null'];});});_0x4697ae['pFqLg'](it,_0x4697ae['iMjjg'],function(){var _0x1d96ca={'SniTm':function(_0x2b34b4,_0x7aadf){return _0x548112['MCvJV'](_0x2b34b4,_0x7aadf);}};if(_0x548112['tJPfZ'](_0x548112['CGkLU'],_0x548112['CGkLU'])){return fs['removeAsync'](this['dir'])['then'](()=>{if(_0x548112['tJPfZ']('DoAPY',_0x548112['GMWDh'])){_0x1d96ca['SniTm'](expect,value)['to']['be']['null'];}else{return this['fileUtil']['get']();}})['then'](_0x58355d=>{_0x548112['MCvJV'](expect,_0x58355d)['to']['eql']({});});}else{expect(value)['to']['equal']('bar');}});it(_0x4697ae['Horui'],function(){var _0x893dff={'Vuaqf':function(_0x16b6ec,_0xa745e7){return _0x4697ae['rdTRB'](_0x16b6ec,_0xa745e7);},'uiLQc':function(_0x535476,_0xc429c5){return _0x4697ae['AqCVV'](_0x535476,_0xc429c5);}};return fs['ensureDirAsync'](this['dir'])['then'](()=>{return fs['writeFileAsync'](path['join'](this['dir'],'file.json'),'');})['then'](()=>{if(_0x893dff['uiLQc']('JtgOr','xbuWJ')){_0x893dff['Vuaqf'](expect,lockFile['unlockAsync'])['to']['be']['called'];}else{return this['fileUtil']['get']();}})['then'](_0x34c6a4=>{expect(_0x34c6a4)['to']['eql']({});});});_0x4697ae['wgwzW'](it,_0x4697ae['ZSNsF'],function(){var _0x2c837d={'gLzOa':_0x4697ae['oHPSJ'],'NcYnd':_0x4697ae['JwfoA'],'LCNXN':function(_0x25f1eb,_0x2a166e){return _0x25f1eb(_0x2a166e);},'ZXOjb':'bar'};if(_0x4697ae['XwXKr'](_0x4697ae['Ueuto'],_0x4697ae['WFmwD'])){var _0x730b38=_0x2c837d['gLzOa']['split']('|'),_0x2858fc=0x0;while(!![]){switch(_0x730b38[_0x2858fc++]){case'0':sinon['spy'](lockFile,_0x2c837d['NcYnd']);continue;case'1':_0x2c837d['LCNXN'](expect,lockFile['unlockSync'])['to']['be']['called'];continue;case'2':new FileUtil({'path':this['path']});continue;case'3':exit['ensure']['yield']();continue;case'4':sinon['stub'](exit,'ensure');continue;}break;}}else{return fs['ensureDirAsync'](this['dir'])['then'](()=>{return fs['writeJsonAsync'](this['path'],{'foo':_0x2c837d['ZXOjb']});})['then'](()=>{sinon['stub'](lockFile,_0x548112['EbKQR'])['rejects']({'name':'','message':'','code':'EEXIST'});return this['fileUtil']['get']();})['then'](_0x51f6fb=>{if(_0x548112['PvHOC'](_0x548112['ZRFnq'],_0x548112['ZRFnq'])){_0x2c837d['LCNXN'](expect,err['message'])['to']['eq']('fail!');expect(lockFile['unlockAsync'])['to']['be']['called'];}else{expect(_0x51f6fb)['to']['eql']({});}});}});_0x4697ae['wgwzW'](it,'resolves cached contents when it can\'t get lock on file after an initial read',function(){return this['fileUtil']['set']('foo','bar')['then'](()=>{if(_0x548112['FaUOS']!==_0x548112['FaUOS']){expect(lockFile['unlockAsync'])['to']['be']['called'];}else{sinon['stub'](lockFile,_0x548112['EbKQR'])['rejects']({'name':'','message':'','code':'EEXIST'});return this['fileUtil']['get']();}})['then'](_0x319f63=>{var _0x4864e8={'cpQTA':function(_0x29bc6f,_0x1ed4e0){return _0x29bc6f(_0x1ed4e0);}};if(_0x548112['TTuXV']('UQlmv',_0x548112['aTBXf'])){_0x4864e8['cpQTA'](expect,value)['to']['equal']('bar');}else{_0x548112['MCvJV'](expect,_0x319f63)['to']['eql']({'foo':_0x548112['NXrsi']});}});});_0x4697ae['wgwzW'](it,'resolves\x20empty\x20object\x20when\x20contents\x20file\x20has\x20invalid\x20json',function(){return fs['ensureDirAsync'](this['dir'])['then'](()=>{var _0x296858={'YQnTK':function(_0x13ed8e,_0x498fdc){return _0x548112['MCvJV'](_0x13ed8e,_0x498fdc);},'QWjIB':_0x548112['ktVcG'],'kYAUK':_0x548112['NXrsi']};if(_0x548112['tJPfZ'](_0x548112['OTyPi'],_0x548112['EwimU'])){var _0x1a0c6a={'wliQC':function(_0x170660,_0x27493c){return _0x296858['YQnTK'](_0x170660,_0x27493c);},'wIONg':_0x296858['QWjIB']};return this['fileUtil']['set']({'foo':_0x296858['kYAUK'],'baz':{'qux':'lolz'}})['then'](()=>{return this['fileUtil']['get']();})['then'](_0x26d3a0=>{_0x1a0c6a['wliQC'](expect,_0x26d3a0)['to']['eql']({'foo':'bar','baz':{'qux':_0x1a0c6a['wIONg']}});});}else{return fs['writeFileAsync'](path['join'](this['dir'],_0x548112['BdSZI']),'{');}})['then'](()=>{return this['fileUtil']['get']();})['then'](_0x1db4f8=>{if(_0x548112['nhqxa'](_0x548112['iGYyZ'],_0x548112['iGYyZ'])){return this['fileUtil']['get']();}else{expect(_0x1db4f8)['to']['eql']({});}});});it(_0x4697ae['MjSVZ'],function(){var _0x12b0ca={'NmBnn':function(_0x1e2a89,_0xdb2f92){return _0x548112['MCvJV'](_0x1e2a89,_0xdb2f92);},'FlUOA':_0x548112['qscXC'],'STdyf':function(_0x2d5e91,_0x51c134){return _0x548112['MCvJV'](_0x2d5e91,_0x51c134);}};if(_0x548112['tJPfZ'](_0x548112['nqAmo'],_0x548112['rZotp'])){_0x12b0ca['NmBnn'](expect,lockFile['lockAsync'])['to']['be']['called'];}else{sinon['stub'](fs,_0x548112['kgwja'])['resolves']({});return Promise['all']([this['fileUtil']['get'](),this['fileUtil']['get'](),this['fileUtil']['get']()])['then'](()=>{var _0x310a81={'qBrjx':function(_0x2bda24,_0x3d630d){return _0x2bda24(_0x3d630d);},'Tbsyt':'bar'};if('mMCgf'!==_0x12b0ca['FlUOA']){_0x12b0ca['STdyf'](expect,fs['readJsonAsync'])['to']['be']['calledOnce'];}else{_0x310a81['qBrjx'](expect,contents)['to']['eql']({'foo':_0x310a81['Tbsyt']});}});}});_0x4697ae['wgwzW'](it,'locks\x20file\x20while\x20reading',function(){var _0xfbb7f2={'fKTCT':function(_0x1c12ef,_0x5c6891){return _0x548112['ZIxQj'](_0x1c12ef,_0x5c6891);}};sinon['spy'](lockFile,_0x548112['EbKQR']);return this['fileUtil']['get']()['then'](()=>{_0xfbb7f2['fKTCT'](expect,lockFile['lockAsync'])['to']['be']['called'];});});_0x4697ae['nzWWu'](it,_0x4697ae['Wllwk'],function(){sinon['spy'](lockFile,_0x548112['AaVbX']);return this['fileUtil']['get']()['then'](()=>{_0x548112['ZIxQj'](expect,lockFile['unlockAsync'])['to']['be']['called'];});});it(_0x4697ae['yWCYv'],function(){var _0xf439f0={'UwQGV':function(_0x1ffd7c,_0x4082c2){return _0x1ffd7c!==_0x4082c2;},'OGNzU':_0x4697ae['erqcx'],'vjWnn':function(_0x369c9b,_0x42ecae){return _0x4697ae['zdrFj'](_0x369c9b,_0x42ecae);},'AxpKG':'items'};if(_0x4697ae['CMsMW'](_0x4697ae['irHuZ'],_0x4697ae['irHuZ'])){sinon['spy'](lockFile,_0x4697ae['vFTHf']);sinon['stub'](fs,'readJsonAsync')['rejects'](new Error(_0x4697ae['EZhVp']));return this['fileUtil']['get']()['catch'](()=>{var _0xdab9fb={'TsIQh':'lockAsync','hZKNx':'EEXIST'};if(_0xf439f0['UwQGV'](_0xf439f0['OGNzU'],_0xf439f0['OGNzU'])){sinon['stub'](lockFile,_0xdab9fb['TsIQh'])['rejects']({'name':'','message':'','code':_0xdab9fb['hZKNx']});return this['fileUtil']['get']();}else{_0xf439f0['vjWnn'](expect,lockFile['unlockAsync'])['to']['be']['called'];}});}else{return tx['get'](_0xf439f0['AxpKG'],[])['then'](_0x43d802=>{return tx['set']('items',_0x43d802['concat']('foo'));});}});it('times out and carries on if unlocking times out',function(){sinon['stub'](lockFile,_0x548112['EbKQR'])['resolves']();sinon['stub'](lockFile,_0x548112['AaVbX'])['callsFake'](()=>{return Promise['delay'](0x3b9aca00);});sinon['stub'](fs,_0x548112['kgwja'])['resolves']({});sinon['stub'](env,_0x548112['eedbN'])['withArgs']('FILE_UNLOCK_TIMEOUT')['returns'](0x64);return this['fileUtil']['get']();});});context('#set',()=>{var _0x4000ca={'EPeCB':_0x4697ae['QAaYX'],'HUQOz':_0x4697ae['kuHwB'],'svURP':'foo','efGDT':'bar','kJdvi':function(_0x20d24a,_0x348e8b){return _0x4697ae['jgELR'](_0x20d24a,_0x348e8b);},'lUNPL':'pRowK','NWIbt':function(_0x4dfce0,_0x5670c9){return _0x4697ae['jgELR'](_0x4dfce0,_0x5670c9);},'pKJPP':'LuCJn','kpmHa':_0x4697ae['gtrMk'],'uuONi':_0x4697ae['usPVo'],'kdAPM':_0x4697ae['wyOel'],'Xknmc':_0x4697ae['Hjiyj'],'RwIoW':function(_0x223bdc,_0x2503cb){return _0x4697ae['xhjHG'](_0x223bdc,_0x2503cb);},'eRsHg':_0x4697ae['sOJGS'],'VnFso':function(_0x2ef68c,_0x19cd13){return _0x4697ae['jgELR'](_0x2ef68c,_0x19cd13);},'ZFRoD':_0x4697ae['BanvW'],'IrwfD':function(_0x1a1a00,_0x11b83e){return _0x1a1a00!==_0x11b83e;},'tfWan':'elziL','jEOHt':function(_0x681ac5,_0x59f0ef){return _0x4697ae['MnMKy'](_0x681ac5,_0x59f0ef);},'dVfMs':_0x4697ae['OkmYB'],'LZnLw':_0x4697ae['GxEVc'],'fwwQG':'xHUjE','LXEJg':_0x4697ae['GhbCN'],'SqhKn':function(_0x497d31,_0x190b9b){return _0x497d31(_0x190b9b);},'sRPwD':_0x4697ae['vFTHf'],'AgnIn':'outputJsonAsync','lxclj':_0x4697ae['EZhVp']};if(_0x4697ae['cDneC'](_0x4697ae['nJWQy'],'cbMhz')){_0x4697ae['cBxwZ'](beforeEach,function(){this['fileUtil']=new FileUtil({'path':this['path']});});it(_0x4697ae['fHxoQ'],function(){if(_0x4697ae['FLnbJ']===_0x4697ae['FLnbJ']){_0x4697ae['AMwza'](expect,()=>{if(_0x4000ca['EPeCB']===_0x4000ca['EPeCB']){return this['fileUtil']['set'](0x1);}else{return this['fileUtil']['get']();}})['to']['throw'](_0x4697ae['Vehle']);expect(()=>{return this['fileUtil']['set']([]);})['to']['throw']('Expected `key` to be of type `string` or `object`, got `array`');}else{return fs['writeFileAsync'](path['join'](this['dir'],_0x4000ca['HUQOz']),'');}});_0x4697ae['nzWWu'](it,_0x4697ae['cMMiu'],function(){var _0x264234={'xdCSj':'lockAsync','bCGBO':_0x4000ca['efGDT'],'acEyw':'foo','IBNET':function(_0x1d0c21,_0x2e7f4b){return _0x4000ca['kJdvi'](_0x1d0c21,_0x2e7f4b);}};if(_0x4000ca['lUNPL']!==_0x4000ca['lUNPL']){return this['fileUtil']['set'](_0x264234['acEyw'],_0x264234['bCGBO'])['then'](()=>{sinon['stub'](lockFile,_0x264234['xdCSj'])['rejects']({'name':'','message':'','code':'EEXIST'});return this['fileUtil']['get']();})['then'](_0x1a289a=>{expect(_0x1a289a)['to']['eql']({'foo':_0x264234['bCGBO']});});}else{return this['fileUtil']['set'](_0x4000ca['svURP'],_0x4000ca['efGDT'])['then'](()=>{return this['fileUtil']['get'](_0x4000ca['svURP']);})['then'](_0x13cf1b=>{_0x264234['IBNET'](expect,_0x13cf1b)['to']['equal'](_0x264234['bCGBO']);});}});_0x4697ae['dDydn'](it,'sets\x20value\x20for\x20given\x20path',function(){var _0x294518={'MpXHF':function(_0x55d8f5,_0x2e5031){return _0x55d8f5(_0x2e5031);}};if(_0x4697ae['xhjHG'](_0x4697ae['ufuSp'],_0x4697ae['ufuSp'])){return this['fileUtil']['set'](_0x4697ae['GukWE'],_0x4697ae['BWiUX'])['then'](()=>{return this['fileUtil']['get']();})['then'](_0x3a5730=>{expect(_0x3a5730)['to']['eql']({'foo':{'baz':_0x4000ca['efGDT']}});});}else{_0x294518['MpXHF'](expect,()=>{return new FileUtil();})['to']['throw']('Must specify path to file when creating new FileUtil()');}});it(_0x4697ae['alWdh'],function(){var _0x51e7ed={'ytLFS':'foo'};return this['fileUtil']['set']({'foo':_0x4000ca['efGDT'],'baz':{'qux':_0x4000ca['uuONi']}})['then'](()=>{var _0x21a84a={'sCQvL':_0x4000ca['svURP'],'fZKer':function(_0xf5b27f,_0x4de008){return _0x4000ca['NWIbt'](_0xf5b27f,_0x4de008);},'BRKBU':_0x4000ca['efGDT']};if(_0x4000ca['pKJPP']!==_0x4000ca['kpmHa']){return this['fileUtil']['get']();}else{return this['fileUtil']['set'](_0x51e7ed['ytLFS'],'bar')['then'](()=>{return this['fileUtil']['get'](_0x21a84a['sCQvL']);})['then'](_0x427064=>{_0x21a84a['fZKer'](expect,_0x427064)['to']['equal'](_0x21a84a['BRKBU']);});}})['then'](_0x3e420f=>{expect(_0x3e420f)['to']['eql']({'foo':_0x4000ca['efGDT'],'baz':{'qux':'lolz'}});});});_0x4697ae['nirQF'](it,_0x4697ae['odjep'],function(){var _0x3655fc={'Oqixq':function(_0x119fd7,_0x21cf92){return _0x4000ca['VnFso'](_0x119fd7,_0x21cf92);},'SwhFx':_0x4000ca['efGDT']};return this['fileUtil']['set'](_0x4000ca['svURP'],_0x4000ca['efGDT'])['then'](()=>{return this['fileUtil']['set'](_0x4000ca['kdAPM'],_0x4000ca['Xknmc']);})['then'](()=>{return this['fileUtil']['get']();})['then'](_0x36e273=>{if(_0x4000ca['RwIoW'](_0x4000ca['eRsHg'],'zsIjK')){_0x4000ca['NWIbt'](expect,_0x36e273)['to']['eql']({'foo':_0x4000ca['efGDT'],'baz':'qux'});}else{_0x3655fc['Oqixq'](expect,JSON['parse'](_0x36e273))['to']['eql']({'foo':_0x3655fc['SwhFx']});}});});_0x4697ae['LlDgu'](it,'updates\x20file\x20on\x20disk',function(){var _0x5462ef={'inUFy':_0x4000ca['ZFRoD'],'UuWHf':_0x4000ca['efGDT']};return this['fileUtil']['set'](_0x4000ca['svURP'],_0x4000ca['efGDT'])['then'](()=>{return fs['readFileAsync'](path['join'](this['dir'],'file.json'),_0x5462ef['inUFy']);})['then'](_0x4c67da=>{expect(JSON['parse'](_0x4c67da))['to']['eql']({'foo':_0x5462ef['UuWHf']});});});_0x4697ae['QoLTM'](it,_0x4697ae['NqJlr'],function(){var _0x2e5265={'vWFEb':function(_0x1acf18,_0x4ded2d){return _0x4697ae['RgnLD'](_0x1acf18,_0x4ded2d);},'XoEpm':_0x4697ae['vFTHf'],'dUCID':'foo'};if(_0x4697ae['NjHao'](_0x4697ae['gQycE'],_0x4697ae['gQycE'])){sinon['spy'](lockFile,_0x2e5265['XoEpm']);return this['fileUtil']['set'](_0x2e5265['dUCID'],'bar')['then'](()=>{_0x2e5265['vWFEb'](expect,lockFile['unlockAsync'])['to']['be']['called'];});}else{sinon['spy'](lockFile,_0x4697ae['SusjV']);return this['fileUtil']['set'](_0x4697ae['EfMrM'],'bar')['then'](()=>{var _0x4dedb8={'rpTgC':function(_0x3bfc6c,_0x155b06){return _0x4000ca['VnFso'](_0x3bfc6c,_0x155b06);}};if(_0x4000ca['IrwfD'](_0x4000ca['tfWan'],_0x4000ca['tfWan'])){_0x4dedb8['rpTgC'](expect,contents)['to']['eql']({'foo':'bar','baz':{'qux':'lolz'}});}else{expect(lockFile['lockAsync'])['to']['be']['called'];}});}});_0x4697ae['FufXf'](it,_0x4697ae['lMKso'],function(){var _0x54b7f8={'SWGZa':function(_0x5a9cbf,_0x4f63b7){return _0x5a9cbf(_0x4f63b7);},'Qgdsf':_0x4697ae['BWiUX']};sinon['spy'](lockFile,'unlockAsync');return this['fileUtil']['set']('foo','bar')['then'](()=>{if(_0x4000ca['jEOHt'](_0x4000ca['dVfMs'],_0x4000ca['LZnLw'])){_0x4000ca['VnFso'](expect,lockFile['unlockAsync'])['to']['be']['called'];}else{_0x54b7f8['SWGZa'](expect,contents)['to']['eql']({'foo':{'baz':_0x54b7f8['Qgdsf']}});}});});it(_0x4697ae['opGwz'],function(){sinon['spy'](lockFile,_0x4000ca['sRPwD']);sinon['stub'](fs,_0x4000ca['AgnIn'])['rejects'](new Error(_0x4000ca['lxclj']));return this['fileUtil']['set']('foo',_0x4000ca['efGDT'])['catch'](()=>{var _0x4198e2={'oUweU':_0x4000ca['efGDT']};if(_0x4000ca['fwwQG']===_0x4000ca['LXEJg']){return this['fileUtil']['set']('foo.baz',_0x4198e2['oUweU'])['then'](()=>{return this['fileUtil']['get']();})['then'](_0x45c66f=>{expect(_0x45c66f)['to']['eql']({'foo':{'baz':_0x4198e2['oUweU']}});});}else{_0x4000ca['SqhKn'](expect,lockFile['unlockAsync'])['to']['be']['called'];}});});}else{var _0x3baaa9={'FHhAK':function(_0xf8bfdb,_0x1cf27e){return _0xf8bfdb(_0x1cf27e);}};return this['fileUtil']['get']()['then'](_0x7c3882=>{_0x3baaa9['FHhAK'](expect,_0x7c3882)['to']['eql']({});});}});_0x4697ae['AZqXF'](context,_0x4697ae['rPGhF'],()=>{var _0x24043e={'LuZpc':function(_0x5cd9f5,_0x16e1c5){return _0x4697ae['jAJOZ'](_0x5cd9f5,_0x16e1c5);},'alkbt':_0x4697ae['ZhSoo'],'cWnvH':function(_0x24a901,_0x413911){return _0x4697ae['MnMKy'](_0x24a901,_0x413911);},'jqmsM':_0x4697ae['rmpnJ'],'kNnft':function(_0x37b537,_0x50a99e){return _0x37b537(_0x50a99e);},'eFajJ':_0x4697ae['EZhVp']};if(_0x4697ae['MnMKy'](_0x4697ae['NcikT'],_0x4697ae['NcikT'])){return this['fileUtil']['get']();}else{beforeEach(function(){var _0x4f435c={'GSvoP':_0x4697ae['TkevX']};if(_0x4697ae['JXEYz'](_0x4697ae['LrOjA'],_0x4697ae['YVfyJ'])){expect(value)['to']['equal'](_0x4f435c['GSvoP']);}else{this['fileUtil']=new FileUtil({'path':this['path']});}});it(_0x4697ae['RqpyS'],function(){return this['fileUtil']['remove']()['then'](()=>{return fs['statAsync'](this['path']);})['catch'](()=>{});});it(_0x4697ae['noiPE'],function(){sinon['spy'](lockFile,'lockAsync');return this['fileUtil']['remove']()['then'](()=>{if(_0x24043e['LuZpc'](_0x24043e['alkbt'],'vTpOB')){expect(lockFile['lockAsync'])['to']['be']['called'];}else{var _0x562837={'FtWcX':function(_0x2d19d5,_0x2f0cb4){return _0x2d19d5(_0x2f0cb4);}};return fs['removeAsync'](this['dir'])['then'](()=>{return this['fileUtil']['get']();})['then'](_0x5b7b7e=>{_0x562837['FtWcX'](expect,_0x5b7b7e)['to']['eql']({});});}});});_0x4697ae['NHdwp'](it,'unlocks file when finished removing',function(){var _0x2385c6={'AIfRM':function(_0x4f79bd,_0x416d5c){return _0x4697ae['MnMKy'](_0x4f79bd,_0x416d5c);},'nghPo':_0x4697ae['NGRKW'],'ialhn':function(_0x11d1ff,_0x49b5a8){return _0x4697ae['ATDuD'](_0x11d1ff,_0x49b5a8);}};sinon['spy'](lockFile,_0x4697ae['vFTHf']);return this['fileUtil']['remove']()['then'](()=>{if(_0x2385c6['AIfRM']('xvUXh',_0x2385c6['nghPo'])){_0x2385c6['ialhn'](expect,lockFile['unlockAsync'])['to']['be']['called'];}else{sinon['spy'](lockFile,'unlockAsync');return this['fileUtil']['get']()['then'](()=>{expect(lockFile['unlockAsync'])['to']['be']['called'];});}});});_0x4697ae['NHdwp'](it,_0x4697ae['csrHM'],function(){var _0x106e0b={'CDkTa':'should have caught!'};sinon['spy'](lockFile,'unlockAsync');sinon['stub'](fs,'removeAsync')['rejects'](new Error('fail!'));return this['fileUtil']['remove']()['then'](()=>{throw new Error(_0x106e0b['CDkTa']);})['catch'](_0x48bf0c=>{if(_0x24043e['cWnvH'](_0x24043e['jqmsM'],_0x24043e['jqmsM'])){return this['fileUtil']['get']();}else{_0x24043e['kNnft'](expect,_0x48bf0c['message'])['to']['eq'](_0x24043e['eFajJ']);_0x24043e['kNnft'](expect,lockFile['unlockAsync'])['to']['be']['called'];}});});}});});