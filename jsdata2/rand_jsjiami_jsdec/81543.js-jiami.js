const debug=require('@tryghost/debug')('members');const {URL}=require('url');const cors=require('cors');const bodyParser=require('body-parser');const express=require('../../../shared/express');const urlUtils=require('../../../shared/url-utils');const membersService=require('../../services/members');const middleware=membersService['middleware'];const shared=require('../shared');module['exports']=function setupMembersApp(){var _0x592bcf={'pZMTI':function(_0x3ff256,_0x3e7ec7){return _0x3ff256(_0x3e7ec7);},'KDGMW':'Members App setup start','yrCnI':'members','qvcHP':'private','VZPXL':function(_0x229a13,_0x2f16f7){return _0x229a13(_0x2f16f7);},'eTTLX':'/api/member','yHhoN':'1mb','cfQsM':'/api/session','zRdgj':'/api/site','ieQzR':'/api/send-magic-link','EpNht':'/api/subscriptions/:id','FQUzf':'/api','RxQkU':'/webhooks','MtNwc':'Members App setup end'};_0x592bcf['pZMTI'](debug,_0x592bcf['KDGMW']);const _0x130f90=express(_0x592bcf['yrCnI']);_0x130f90['use'](shared['middlewares']['maintenance']);_0x130f90['use'](shared['middlewares']['cacheControl'](_0x592bcf['qvcHP']));const _0x42cc79=new URL(urlUtils['getSiteUrl']());_0x130f90['use'](_0x592bcf['VZPXL'](cors,_0x42cc79['origin']));_0x130f90['use'](middleware['createSessionFromMagicLink']);_0x130f90['post']('/webhooks/stripe',middleware['stripeWebhooks']);_0x130f90['get'](_0x592bcf['eTTLX'],middleware['getMemberData']);_0x130f90['put'](_0x592bcf['eTTLX'],bodyParser['json']({'limit':_0x592bcf['yHhoN']}),middleware['updateMemberData']);_0x130f90['get'](_0x592bcf['cfQsM'],middleware['getIdentityToken']);_0x130f90['delete'](_0x592bcf['cfQsM'],middleware['deleteSession']);_0x130f90['get'](_0x592bcf['zRdgj'],middleware['getMemberSiteData']);_0x130f90['post'](_0x592bcf['ieQzR'],bodyParser['json'](),shared['middlewares']['brute']['membersAuth'],(_0x174ef3,_0x361c52,_0x3b36b0)=>membersService['api']['middleware']['sendMagicLink'](_0x174ef3,_0x361c52,_0x3b36b0));_0x130f90['post']('/api/create-stripe-checkout-session',(_0x24b359,_0x502fee,_0x5a0be9)=>membersService['api']['middleware']['createCheckoutSession'](_0x24b359,_0x502fee,_0x5a0be9));_0x130f90['post']('/api/create-stripe-update-session',(_0x153e84,_0x1c40ea,_0x47ccd3)=>membersService['api']['middleware']['createCheckoutSetupSession'](_0x153e84,_0x1c40ea,_0x47ccd3));_0x130f90['put'](_0x592bcf['EpNht'],(_0x2850c5,_0x30b8bd,_0x42ccd3)=>membersService['api']['middleware']['updateSubscription'](_0x2850c5,_0x30b8bd,_0x42ccd3));_0x130f90['use'](_0x592bcf['FQUzf'],shared['middlewares']['errorHandler']['resourceNotFound']);_0x130f90['use'](_0x592bcf['FQUzf'],shared['middlewares']['errorHandler']['handleJSONResponseV2']);_0x130f90['use'](_0x592bcf['RxQkU'],shared['middlewares']['errorHandler']['resourceNotFound']);_0x130f90['use']('/webhooks',shared['middlewares']['errorHandler']['handleJSONResponseV2']);debug(_0x592bcf['MtNwc']);return _0x130f90;};