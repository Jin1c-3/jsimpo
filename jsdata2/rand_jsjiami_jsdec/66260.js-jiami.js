module['exports']={'read':read,'readSSHPrivate':readSSHPrivate,'write':write};var assert=require('assert-plus');var asn1=require('asn1');var Buffer=require('safer-buffer')['Buffer'];var algs=require('../algs');var utils=require('../utils');var crypto=require('crypto');var Key=require('../key');var PrivateKey=require('../private-key');var pem=require('./pem');var rfc4253=require('./rfc4253');var SSHBuffer=require('../ssh-buffer');var errors=require('../errors');var bcrypt;function read(_0x25fce0,_0x2ca87b){return pem['read'](_0x25fce0,_0x2ca87b);}var MAGIC='openssh-key-v1';function readSSHPrivate(_0x4bfd0a,_0xb7576,_0x3caad9){var _0x5b7bec={'RrnEw':'utf-8','ZBBPV':'string','ZEbVZ':function(_0x23139b,_0x3f76ef){return _0x23139b!==_0x3f76ef;},'dUDUY':'options.passphrase','BYsJF':function(_0x327e61,_0x371298){return _0x327e61===_0x371298;},'ceEIE':'aes128-ctr','JXQrM':'bcrypt','aXGEd':'options.cipher','VOkSa':function(_0x3caa9b,_0x3117c6){return _0x3caa9b+_0x3117c6;},'oNfVm':function(_0x49e1bc,_0x4dad79){return _0x49e1bc>_0x4dad79;},'cIcID':'bad decrypt','cqHVJ':'qnCjO','VMFUV':'Incorrect\x20passphrase\x20','ZPGZq':'supplied,\x20could\x20not\x20decrypt\x20key','dFiMi':'bad magic string','NTNIc':function(_0x982bd7,_0x41194b){return _0x982bd7+_0x41194b;},'ZAGRY':'OpenSSH-format\x20key\x20file\x20contains\x20','nByYY':'public','yRfrz':'excess bytes left after key','DTzAI':'none','toPMN':function(_0x3e1239,_0x336d51){return _0x3e1239!==_0x336d51;},'itzQy':'OpenSSH-format\x20key\x20uses\x20KDF\x20\x22none\x22\x20','dFyqa':'but specifies a cipher other than "none"','eYokO':'tXvSW','kgqwE':function(_0x1403bf,_0x294a95){return _0x1403bf(_0x294a95);},'AwTUD':function(_0x4cfd7d,_0xc358b5){return _0x4cfd7d===_0xc358b5;},'BmuEF':function(_0x1bd9dd,_0x549e69){return _0x1bd9dd!==_0x549e69;},'hYyiG':'iXGTo','fMxEi':'OpenSSH','GrlKn':'bcrypt_pbkdf function returned ','fIIYZ':'failure,\x20parameters\x20invalid','EVwFi':'error','JuZEV':function(_0x4d6adf,_0x10e581){return _0x4d6adf!==_0x10e581;},'QXZXa':function(_0x238aa7,_0x46944f){return _0x238aa7!==_0x46944f;},'RTlnF':'decrypt\x20key'};_0xb7576=new SSHBuffer({'buffer':_0xb7576});var _0x192c47=_0xb7576['readCString']();assert['strictEqual'](_0x192c47,MAGIC,_0x5b7bec['dFiMi']);var _0xfcc0a9=_0xb7576['readString']();var _0x59fcd6=_0xb7576['readString']();var _0x435c8f=_0xb7576['readBuffer']();var _0x58bc4d=_0xb7576['readInt']();if(_0x5b7bec['ZEbVZ'](_0x58bc4d,0x1)){throw new Error(_0x5b7bec['NTNIc'](_0x5b7bec['ZAGRY'],'multiple keys: this is unsupported.'));}var _0x21a087=_0xb7576['readBuffer']();if(_0x5b7bec['BYsJF'](_0x4bfd0a,_0x5b7bec['nByYY'])){assert['ok'](_0xb7576['atEnd'](),_0x5b7bec['yRfrz']);return rfc4253['read'](_0x21a087);}var _0x51bd9c=_0xb7576['readBuffer']();assert['ok'](_0xb7576['atEnd'](),_0x5b7bec['yRfrz']);var _0x279094=new SSHBuffer({'buffer':_0x435c8f});switch(_0x59fcd6){case _0x5b7bec['DTzAI']:if(_0x5b7bec['toPMN'](_0xfcc0a9,_0x5b7bec['DTzAI'])){if(_0x5b7bec['BYsJF']('iDYmu','fSxuK')){_0x3caad9['passphrase']=Buffer['from'](_0x3caad9['passphrase'],_0x5b7bec['RrnEw']);}else{throw new Error(_0x5b7bec['itzQy']+_0x5b7bec['dFyqa']);}}break;case _0x5b7bec['JXQrM']:var _0x1b2859=_0x279094['readBuffer']();var _0x34b566=_0x279094['readInt']();var _0x1211ef=utils['opensshCipherInfo'](_0xfcc0a9);if(_0x5b7bec['BYsJF'](bcrypt,undefined)){if(_0x5b7bec['toPMN'](_0x5b7bec['eYokO'],_0x5b7bec['eYokO'])){passphrase=_0x3caad9['passphrase'];if(typeof passphrase===_0x5b7bec['ZBBPV'])passphrase=Buffer['from'](passphrase,'utf-8');if(_0x5b7bec['ZEbVZ'](passphrase,undefined)){var _0x464393='0|5|1|2|4|3'['split']('|'),_0x52a5c8=0x0;while(!![]){switch(_0x464393[_0x52a5c8++]){case'0':assert['buffer'](passphrase,_0x5b7bec['dUDUY']);continue;case'1':_0xfcc0a9=_0x3caad9['cipher'];continue;case'2':if(_0x5b7bec['BYsJF'](_0xfcc0a9,undefined))_0xfcc0a9=_0x5b7bec['ceEIE'];continue;case'3':_0x59fcd6=_0x5b7bec['JXQrM'];continue;case'4':_0x1211ef=utils['opensshCipherInfo'](_0xfcc0a9);continue;case'5':assert['optionalString'](_0x3caad9['cipher'],_0x5b7bec['aXGEd']);continue;}break;}}}else{bcrypt=_0x5b7bec['kgqwE'](require,'bcrypt-pbkdf');}}if(_0x5b7bec['AwTUD'](typeof _0x3caad9['passphrase'],_0x5b7bec['ZBBPV'])){if(_0x5b7bec['BmuEF'](_0x5b7bec['hYyiG'],_0x5b7bec['hYyiG'])){assert['buffer'](passphrase,'options.passphrase');assert['optionalString'](_0x3caad9['cipher'],_0x5b7bec['aXGEd']);_0xfcc0a9=_0x3caad9['cipher'];if(_0xfcc0a9===undefined)_0xfcc0a9=_0x5b7bec['ceEIE'];_0x1211ef=utils['opensshCipherInfo'](_0xfcc0a9);_0x59fcd6='bcrypt';}else{_0x3caad9['passphrase']=Buffer['from'](_0x3caad9['passphrase'],_0x5b7bec['RrnEw']);}}if(!Buffer['isBuffer'](_0x3caad9['passphrase'])){throw new errors[('KeyEncryptedError')](_0x3caad9['filename'],_0x5b7bec['fMxEi']);}var _0x58c829=new Uint8Array(_0x3caad9['passphrase']);var _0x28ce17=new Uint8Array(_0x1b2859);var _0x497206=new Uint8Array(_0x1211ef['keySize']+_0x1211ef['blockSize']);var _0x26eb14=bcrypt['pbkdf'](_0x58c829,_0x58c829['length'],_0x28ce17,_0x28ce17['length'],_0x497206,_0x497206['length'],_0x34b566);if(_0x5b7bec['BmuEF'](_0x26eb14,0x0)){throw new Error(_0x5b7bec['NTNIc'](_0x5b7bec['GrlKn'],_0x5b7bec['fIIYZ']));}_0x497206=Buffer['from'](_0x497206);var _0x4b1386=_0x497206['slice'](0x0,_0x1211ef['keySize']);var _0x27e7d1=_0x497206['slice'](_0x1211ef['keySize'],_0x1211ef['keySize']+_0x1211ef['blockSize']);var _0xfcf539=crypto['createDecipheriv'](_0x1211ef['opensslName'],_0x4b1386,_0x27e7d1);_0xfcf539['setAutoPadding'](![]);var _0x42d2fd,_0x12ab49=[];_0xfcf539['once'](_0x5b7bec['EVwFi'],function(_0x358ece){if(_0x358ece['toString']()['indexOf'](_0x5b7bec['cIcID'])!==-0x1){if(_0x5b7bec['ZEbVZ'](_0x5b7bec['cqHVJ'],'akfxT')){throw new Error(_0x5b7bec['VMFUV']+_0x5b7bec['ZPGZq']);}else{var _0x27001a=_0x5b7bec['VOkSa'](i,0x46);if(_0x5b7bec['oNfVm'](_0x27001a,tmp['length']))_0x27001a=tmp['length'];o+=_0xb7576['write'](tmp['slice'](i,_0x27001a),o);_0xb7576[o++]=0xa;i=_0x27001a;}}throw _0x358ece;});_0xfcf539['write'](_0x51bd9c);_0xfcf539['end']();while(_0x5b7bec['JuZEV'](_0x42d2fd=_0xfcf539['read'](),null))_0x12ab49['push'](_0x42d2fd);_0x51bd9c=Buffer['concat'](_0x12ab49);break;default:throw new Error(_0x5b7bec['NTNIc'](_0x5b7bec['NTNIc']('OpenSSH-format key uses unknown KDF "',_0x59fcd6),'\x22'));}_0xb7576=new SSHBuffer({'buffer':_0x51bd9c});var _0x5543f9=_0xb7576['readInt']();var _0x4a0a6c=_0xb7576['readInt']();if(_0x5b7bec['QXZXa'](_0x5543f9,_0x4a0a6c)){throw new Error('Incorrect\x20passphrase\x20supplied,\x20could\x20not\x20'+_0x5b7bec['RTlnF']);}var _0x458783={};var _0x3c3801=rfc4253['readInternal'](_0x458783,'private',_0xb7576['remainder']());_0xb7576['skip'](_0x458783['consumed']);var _0xe83bcb=_0xb7576['readString']();_0x3c3801['comment']=_0xe83bcb;return _0x3c3801;}function write(_0x2c394a,_0x5e6488){var _0xf3cc73={'lIMEY':function(_0x42f473,_0x4d38a2){return _0x42f473!==_0x4d38a2;},'adHSx':'bad\x20decrypt','LQSKo':'Incorrect\x20passphrase\x20','XMrCV':'supplied, could not decrypt key','vYwCD':function(_0x1f3431,_0x496452){return _0x1f3431+_0x496452;},'buIiy':function(_0x5de0f0,_0x4de2f4){return _0x5de0f0!==_0x4de2f4;},'IgaHM':'xPojd','pNYCf':'none','bJgYP':function(_0x360b9e,_0x39c688){return _0x360b9e===_0x39c688;},'ZYPOn':'string','AdDEp':'utf-8','CODtu':'2|3|4|0|5|1','uEGnk':'aes128-ctr','NBgrD':'options.cipher','gYxrG':function(_0x20d87e,_0x318d06){return _0x20d87e!==_0x318d06;},'szBGr':function(_0x2fd33e,_0x2e35b8){return _0x2fd33e%_0x2e35b8;},'VJhfu':function(_0x203912,_0x27c41f){return _0x203912===_0x27c41f;},'oZiPV':'UYOax','CVyVq':'bcrypt-pbkdf','oxVJR':function(_0x1a6bb0,_0x231766){return _0x1a6bb0+_0x231766;},'lDJBg':function(_0xc81a97,_0x31192c){return _0xc81a97!==_0x31192c;},'OtnDG':function(_0x1ee8ef,_0x2c55c4){return _0x1ee8ef+_0x2c55c4;},'rMtdi':'failure, parameters invalid','ICich':'error','rHYis':function(_0x13ff69,_0x3db7e7){return _0x13ff69+_0x3db7e7;},'YTGwF':'Unsupported\x20kdf\x20','nnGhi':'rfc4253','cjXcs':'OPENSSH PUBLIC KEY','igXdR':'base64','fSrUb':function(_0xb57dcf,_0x54059d){return _0xb57dcf+_0x54059d;},'kIcct':function(_0x32f16b,_0xa461d6){return _0x32f16b/_0xa461d6;},'QBeja':function(_0x184c20,_0x2cf068){return _0x184c20*_0x2cf068;},'KhQWL':function(_0x583e2d,_0xa4bb8f){return _0x583e2d+_0xa4bb8f;},'ybTvf':'-----BEGIN ','cLWFL':'-----\n','BVsfm':function(_0xf20724,_0x2852b6){return _0xf20724<_0x2852b6;},'hGIvt':function(_0x4f99de,_0x5563b4){return _0x4f99de+_0x5563b4;},'iJjkA':'-----END '};var _0x453b9b;if(PrivateKey['isPrivateKey'](_0x2c394a))_0x453b9b=_0x2c394a['toPublic']();else _0x453b9b=_0x2c394a;var _0x5af437='none';var _0x11dfd0=_0xf3cc73['pNYCf'];var _0x59fc49=Buffer['alloc'](0x0);var _0x487eaa={'blockSize':0x8};var _0x1534ba;if(_0xf3cc73['buIiy'](_0x5e6488,undefined)){_0x1534ba=_0x5e6488['passphrase'];if(_0xf3cc73['bJgYP'](typeof _0x1534ba,_0xf3cc73['ZYPOn']))_0x1534ba=Buffer['from'](_0x1534ba,_0xf3cc73['AdDEp']);if(_0x1534ba!==undefined){var _0x497ffd=_0xf3cc73['CODtu']['split']('|'),_0x19f6dd=0x0;while(!![]){switch(_0x497ffd[_0x19f6dd++]){case'0':if(_0xf3cc73['bJgYP'](_0x5af437,undefined))_0x5af437=_0xf3cc73['uEGnk'];continue;case'1':_0x11dfd0='bcrypt';continue;case'2':assert['buffer'](_0x1534ba,'options.passphrase');continue;case'3':assert['optionalString'](_0x5e6488['cipher'],_0xf3cc73['NBgrD']);continue;case'4':_0x5af437=_0x5e6488['cipher'];continue;case'5':_0x487eaa=utils['opensshCipherInfo'](_0x5af437);continue;}break;}}}var _0x2e4f5e;if(PrivateKey['isPrivateKey'](_0x2c394a)){if('JuvMY'==='JuvMY'){_0x2e4f5e=new SSHBuffer({});var _0x2d7865=crypto['randomBytes'](0x4)['readUInt32BE'](0x0);_0x2e4f5e['writeInt'](_0x2d7865);_0x2e4f5e['writeInt'](_0x2d7865);_0x2e4f5e['write'](_0x2c394a['toBuffer']('rfc4253'));_0x2e4f5e['writeString'](_0x2c394a['comment']||'');var _0x3540d9=0x1;while(_0xf3cc73['gYxrG'](_0xf3cc73['szBGr'](_0x2e4f5e['_offset'],_0x487eaa['blockSize']),0x0))_0x2e4f5e['writeChar'](_0x3540d9++);_0x2e4f5e=_0x2e4f5e['toBuffer']();}else{if(_0xf3cc73['lIMEY'](e['toString']()['indexOf'](_0xf3cc73['adHSx']),-0x1)){throw new Error(_0xf3cc73['LQSKo']+_0xf3cc73['XMrCV']);}throw e;}}switch(_0x11dfd0){case _0xf3cc73['pNYCf']:break;case 'bcrypt':var _0x4bc718=crypto['randomBytes'](0x10);var _0x57712d=0x10;var _0x2b3c39=new SSHBuffer({});_0x2b3c39['writeBuffer'](_0x4bc718);_0x2b3c39['writeInt'](_0x57712d);_0x59fc49=_0x2b3c39['toBuffer']();if(_0xf3cc73['VJhfu'](bcrypt,undefined)){if(_0xf3cc73['VJhfu'](_0xf3cc73['oZiPV'],_0xf3cc73['oZiPV'])){bcrypt=require(_0xf3cc73['CVyVq']);}else{throw new Error(_0xf3cc73['vYwCD'](_0xf3cc73['LQSKo'],'supplied, could not decrypt key'));}}var _0x40f1f6=new Uint8Array(_0x1534ba);var _0x4e2f0b=new Uint8Array(_0x4bc718);var _0x394728=new Uint8Array(_0xf3cc73['oxVJR'](_0x487eaa['keySize'],_0x487eaa['blockSize']));var _0x27b86e=bcrypt['pbkdf'](_0x40f1f6,_0x40f1f6['length'],_0x4e2f0b,_0x4e2f0b['length'],_0x394728,_0x394728['length'],_0x57712d);if(_0xf3cc73['lDJBg'](_0x27b86e,0x0)){throw new Error(_0xf3cc73['OtnDG']('bcrypt_pbkdf function returned ',_0xf3cc73['rMtdi']));}_0x394728=Buffer['from'](_0x394728);var _0xf309ee=_0x394728['slice'](0x0,_0x487eaa['keySize']);var _0x54fa91=_0x394728['slice'](_0x487eaa['keySize'],_0x487eaa['keySize']+_0x487eaa['blockSize']);var _0x38ab11=crypto['createCipheriv'](_0x487eaa['opensslName'],_0xf309ee,_0x54fa91);_0x38ab11['setAutoPadding'](![]);var _0x4b3570,_0x50c217=[];_0x38ab11['once'](_0xf3cc73['ICich'],function(_0x37b16a){if(_0xf3cc73['buIiy'](_0xf3cc73['IgaHM'],_0xf3cc73['IgaHM'])){return pem['read'](_0xda191,_0x5e6488);}else{throw _0x37b16a;}});_0x38ab11['write'](_0x2e4f5e);_0x38ab11['end']();while(_0xf3cc73['lDJBg'](_0x4b3570=_0x38ab11['read'](),null))_0x50c217['push'](_0x4b3570);_0x2e4f5e=Buffer['concat'](_0x50c217);break;default:throw new Error(_0xf3cc73['rHYis'](_0xf3cc73['YTGwF'],_0x11dfd0));}var _0xda191=new SSHBuffer({});_0xda191['writeCString'](MAGIC);_0xda191['writeString'](_0x5af437);_0xda191['writeString'](_0x11dfd0);_0xda191['writeBuffer'](_0x59fc49);_0xda191['writeInt'](0x1);_0xda191['writeBuffer'](_0x453b9b['toBuffer'](_0xf3cc73['nnGhi']));if(_0x2e4f5e)_0xda191['writeBuffer'](_0x2e4f5e);_0xda191=_0xda191['toBuffer']();var _0x2e6c0e;if(PrivateKey['isPrivateKey'](_0x2c394a))_0x2e6c0e='OPENSSH PRIVATE KEY';else _0x2e6c0e=_0xf3cc73['cjXcs'];var _0x8b6602=_0xda191['toString'](_0xf3cc73['igXdR']);var _0xd808e4=_0xf3cc73['rHYis'](_0xf3cc73['rHYis'](_0xf3cc73['rHYis'](_0xf3cc73['fSrUb'](_0xf3cc73['fSrUb'](_0x8b6602['length'],_0xf3cc73['kIcct'](_0x8b6602['length'],0x46)),0x12),0x10),_0xf3cc73['QBeja'](_0x2e6c0e['length'],0x2)),0xa);_0xda191=Buffer['alloc'](_0xd808e4);var _0x35f086=0x0;_0x35f086+=_0xda191['write'](_0xf3cc73['KhQWL'](_0xf3cc73['KhQWL'](_0xf3cc73['ybTvf'],_0x2e6c0e),_0xf3cc73['cLWFL']),_0x35f086);for(var _0x115ff0=0x0;_0xf3cc73['BVsfm'](_0x115ff0,_0x8b6602['length']);){var _0x19fdc0=_0x115ff0+0x46;if(_0x19fdc0>_0x8b6602['length'])_0x19fdc0=_0x8b6602['length'];_0x35f086+=_0xda191['write'](_0x8b6602['slice'](_0x115ff0,_0x19fdc0),_0x35f086);_0xda191[_0x35f086++]=0xa;_0x115ff0=_0x19fdc0;}_0x35f086+=_0xda191['write'](_0xf3cc73['KhQWL'](_0xf3cc73['hGIvt'](_0xf3cc73['iJjkA'],_0x2e6c0e),_0xf3cc73['cLWFL']),_0x35f086);return _0xda191['slice'](0x0,_0x35f086);}