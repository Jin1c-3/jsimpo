"use strict";module.exports=function e(s,r,a){var t="";var i=s.schema.$async===true,l=s.util.schemaHasRulesExcept(s.schema,s.RULES.all,"$ref"),o=s.self._getId(s.schema);if(s.opts.strictKeywords){var f=s.util.schemaUnknownRules(s.schema,s.RULES.keywords);if(f){var n="unknown keyword: "+f;if(s.opts.strictKeywords==="log")s.logger.warn(n);else throw new Error(n)}}if(s.isTop){t+=" var validate = ";if(i){s.async=true;t+="async "}t+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ";if(o&&(s.opts.sourceCode||s.opts.processCode)){t+=" "+("/*# sourceURL="+o+" */")+" "}}if(typeof s.schema=="boolean"||!(l||s.schema.$ref)){var r="false schema";var u=s.level;var h=s.dataLevel;var c=s.schema[r];var d=s.schemaPath+s.util.getProperty(r);var p=s.errSchemaPath+"/"+r;var v=!s.opts.allErrors;var m;var y="data"+(h||"");var g="valid"+u;if(s.schema===false){if(s.isTop){v=true}else{t+=" var "+g+" = false; "}var w=w||[];w.push(t);t="";if(s.createErrors!==false){t+=" { keyword: '"+(m||"false schema")+"' , dataPath: (dataPath || '') + "+s.errorPath+" , schemaPath: "+s.util.toQuotedString(p)+" , params: {} ";if(s.opts.messages!==false){t+=" , message: 'boolean schema is false' "}if(s.opts.verbose){t+=" , schema: false , parentSchema: validate.schema"+s.schemaPath+" , data: "+y+" "}t+=" } "}else{t+=" {} "}var E=t;t=w.pop();if(!s.compositeRule&&v){if(s.async){t+=" throw new ValidationError(["+E+"]); "}else{t+=" validate.errors = ["+E+"]; return false; "}}else{t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}}else{if(s.isTop){if(i){t+=" return data; "}else{t+=" validate.errors = null; return true; "}}else{t+=" var "+g+" = true; "}}if(s.isTop){t+=" }; return validate; "}return t}if(s.isTop){var P=s.isTop,u=s.level=0,h=s.dataLevel=0,y="data";s.rootId=s.resolve.fullPath(s.self._getId(s.root.schema));s.baseId=s.baseId||s.rootId;delete s.isTop;s.dataPathArr=[""];if(s.schema.default!==undefined&&s.opts.useDefaults&&s.opts.strictDefaults){var b="default is ignored in the schema root";if(s.opts.strictDefaults==="log")s.logger.warn(b);else throw new Error(b)}t+=" var vErrors = null; ";t+=" var errors = 0;     ";t+=" if (rootData === undefined) rootData = data; "}else{var u=s.level,h=s.dataLevel,y="data"+(h||"");if(o)s.baseId=s.resolve.url(s.baseId,o);if(i&&!s.async)throw new Error("async schema in sync schema");t+=" var errs_"+u+" = errors;"}var g="valid"+u,v=!s.opts.allErrors,D="",S="";var m;var R=s.schema.type,T=Array.isArray(R);if(R&&s.opts.nullable&&s.schema.nullable===true){if(T){if(R.indexOf("null")==-1)R=R.concat("null")}else if(R!="null"){R=[R,"null"];T=true}}if(T&&R.length==1){R=R[0];T=false}if(s.schema.$ref&&l){if(s.opts.extendRefs=="fail"){throw new Error('$ref: validation keywords used in schema at path "'+s.errSchemaPath+'" (see option extendRefs)')}else if(s.opts.extendRefs!==true){l=false;s.logger.warn('$ref: keywords ignored in schema at path "'+s.errSchemaPath+'"')}}if(s.schema.$comment&&s.opts.$comment){t+=" "+s.RULES.all.$comment.code(s,"$comment")}if(R){if(s.opts.coerceTypes){var k=s.util.coerceToTypes(s.opts.coerceTypes,R)}var $=s.RULES.types[R];if(k||T||$===true||$&&!re($)){var d=s.schemaPath+".type",p=s.errSchemaPath+"/type";var d=s.schemaPath+".type",p=s.errSchemaPath+"/type",L=T?"checkDataTypes":"checkDataType";t+=" if ("+s.util[L](R,y,s.opts.strictNumbers,true)+") { ";if(k){var j="dataType"+u,A="coerced"+u;t+=" var "+j+" = typeof "+y+"; var "+A+" = undefined; ";if(s.opts.coerceTypes=="array"){t+=" if ("+j+" == 'object' && Array.isArray("+y+") && "+y+".length == 1) { "+y+" = "+y+"[0]; "+j+" = typeof "+y+"; if ("+s.util.checkDataType(s.schema.type,y,s.opts.strictNumbers)+") "+A+" = "+y+"; } "}t+=" if ("+A+" !== undefined) ; ";var I=k;if(I){var U,x=-1,_=I.length-1;while(x<_){U=I[x+=1];if(U=="string"){t+=" else if ("+j+" == 'number' || "+j+" == 'boolean') "+A+" = '' + "+y+"; else if ("+y+" === null) "+A+" = ''; "}else if(U=="number"||U=="integer"){t+=" else if ("+j+" == 'boolean' || "+y+" === null || ("+j+" == 'string' && "+y+" && "+y+" == +"+y+" ";if(U=="integer"){t+=" && !("+y+" % 1)"}t+=")) "+A+" = +"+y+"; "}else if(U=="boolean"){t+=" else if ("+y+" === 'false' || "+y+" === 0 || "+y+" === null) "+A+" = false; else if ("+y+" === 'true' || "+y+" === 1) "+A+" = true; "}else if(U=="null"){t+=" else if ("+y+" === '' || "+y+" === 0 || "+y+" === false) "+A+" = null; "}else if(s.opts.coerceTypes=="array"&&U=="array"){t+=" else if ("+j+" == 'string' || "+j+" == 'number' || "+j+" == 'boolean' || "+y+" == null) "+A+" = ["+y+"]; "}}}t+=" else {   ";var w=w||[];w.push(t);t="";if(s.createErrors!==false){t+=" { keyword: '"+(m||"type")+"' , dataPath: (dataPath || '') + "+s.errorPath+" , schemaPath: "+s.util.toQuotedString(p)+" , params: { type: '";if(T){t+=""+R.join(",")}else{t+=""+R}t+="' } ";if(s.opts.messages!==false){t+=" , message: 'should be ";if(T){t+=""+R.join(",")}else{t+=""+R}t+="' "}if(s.opts.verbose){t+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+s.schemaPath+" , data: "+y+" "}t+=" } "}else{t+=" {} "}var E=t;t=w.pop();if(!s.compositeRule&&v){if(s.async){t+=" throw new ValidationError(["+E+"]); "}else{t+=" validate.errors = ["+E+"]; return false; "}}else{t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } if ("+A+" !== undefined) {  ";var N=h?"data"+(h-1||""):"parentData",V=h?s.dataPathArr[h]:"parentDataProperty";t+=" "+y+" = "+A+"; ";if(!h){t+="if ("+N+" !== undefined)"}t+=" "+N+"["+V+"] = "+A+"; } "}else{var w=w||[];w.push(t);t="";if(s.createErrors!==false){t+=" { keyword: '"+(m||"type")+"' , dataPath: (dataPath || '') + "+s.errorPath+" , schemaPath: "+s.util.toQuotedString(p)+" , params: { type: '";if(T){t+=""+R.join(",")}else{t+=""+R}t+="' } ";if(s.opts.messages!==false){t+=" , message: 'should be ";if(T){t+=""+R.join(",")}else{t+=""+R}t+="' "}if(s.opts.verbose){t+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+s.schemaPath+" , data: "+y+" "}t+=" } "}else{t+=" {} "}var E=t;t=w.pop();if(!s.compositeRule&&v){if(s.async){t+=" throw new ValidationError(["+E+"]); "}else{t+=" validate.errors = ["+E+"]; return false; "}}else{t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}}t+=" } "}}if(s.schema.$ref&&!l){t+=" "+s.RULES.all.$ref.code(s,"$ref")+" ";if(v){t+=" } if (errors === ";if(P){t+="0"}else{t+="errs_"+u}t+=") { ";S+="}"}}else{var O=s.RULES;if(O){var $,Q=-1,C=O.length-1;while(Q<C){$=O[Q+=1];if(re($)){if($.type){t+=" if ("+s.util.checkDataType($.type,y,s.opts.strictNumbers)+") { "}if(s.opts.useDefaults){if($.type=="object"&&s.schema.properties){var c=s.schema.properties,J=Object.keys(c);var K=J;if(K){var H,q=-1,z=K.length-1;while(q<z){H=K[q+=1];var B=c[H];if(B.default!==undefined){var F=y+s.util.getProperty(H);if(s.compositeRule){if(s.opts.strictDefaults){var b="default is ignored for: "+F;if(s.opts.strictDefaults==="log")s.logger.warn(b);else throw new Error(b)}}else{t+=" if ("+F+" === undefined ";if(s.opts.useDefaults=="empty"){t+=" || "+F+" === null || "+F+" === '' "}t+=" ) "+F+" = ";if(s.opts.useDefaults=="shared"){t+=" "+s.useDefault(B.default)+" "}else{t+=" "+JSON.stringify(B.default)+" "}t+="; "}}}}}else if($.type=="array"&&Array.isArray(s.schema.items)){var G=s.schema.items;if(G){var B,x=-1,M=G.length-1;while(x<M){B=G[x+=1];if(B.default!==undefined){var F=y+"["+x+"]";if(s.compositeRule){if(s.opts.strictDefaults){var b="default is ignored for: "+F;if(s.opts.strictDefaults==="log")s.logger.warn(b);else throw new Error(b)}}else{t+=" if ("+F+" === undefined ";if(s.opts.useDefaults=="empty"){t+=" || "+F+" === null || "+F+" === '' "}t+=" ) "+F+" = ";if(s.opts.useDefaults=="shared"){t+=" "+s.useDefault(B.default)+" "}else{t+=" "+JSON.stringify(B.default)+" "}t+="; "}}}}}}var W=$.rules;if(W){var X,Y=-1,Z=W.length-1;while(Y<Z){X=W[Y+=1];if(ae(X)){var ee=X.code(s,X.keyword,$.type);if(ee){t+=" "+ee+" ";if(v){D+="}"}}}}}if(v){t+=" "+D+" ";D=""}if($.type){t+=" } ";if(R&&R===$.type&&!k){t+=" else { ";var d=s.schemaPath+".type",p=s.errSchemaPath+"/type";var w=w||[];w.push(t);t="";if(s.createErrors!==false){t+=" { keyword: '"+(m||"type")+"' , dataPath: (dataPath || '') + "+s.errorPath+" , schemaPath: "+s.util.toQuotedString(p)+" , params: { type: '";if(T){t+=""+R.join(",")}else{t+=""+R}t+="' } ";if(s.opts.messages!==false){t+=" , message: 'should be ";if(T){t+=""+R.join(",")}else{t+=""+R}t+="' "}if(s.opts.verbose){t+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+s.schemaPath+" , data: "+y+" "}t+=" } "}else{t+=" {} "}var E=t;t=w.pop();if(!s.compositeRule&&v){if(s.async){t+=" throw new ValidationError(["+E+"]); "}else{t+=" validate.errors = ["+E+"]; return false; "}}else{t+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}t+=" } "}}if(v){t+=" if (errors === ";if(P){t+="0"}else{t+="errs_"+u}t+=") { ";S+="}"}}}}}if(v){t+=" "+S+" "}if(P){if(i){t+=" if (errors === 0) return data;           ";t+=" else throw new ValidationError(vErrors); "}else{t+=" validate.errors = vErrors; ";t+=" return errors === 0;       "}t+=" }; return validate;"}else{t+=" var "+g+" = errors === errs_"+u+";"}function re(e){var r=e.rules;for(var a=0;a<r.length;a++)if(ae(r[a]))return true}function ae(e){return s.schema[e.keyword]!==undefined||e.implements&&se(e)}function se(e){var r=e.implements;for(var a=0;a<r.length;a++)if(s.schema[r[a]]!==undefined)return true}return t};