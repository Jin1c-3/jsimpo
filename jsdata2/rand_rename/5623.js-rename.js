"use strict";var test=require("tap").test,generator=require("inline-source-map"),convert=require("..");var gen=generator().addMappings("foo.js",[{original:{line:2,column:3},generated:{line:5,column:10}}],{line:5}).addGeneratedMappings("bar.js","var a = 2;\nconsole.log(a)",{line:23,column:22}),base64=gen.base64Encode(),comment=gen.inlineMappingUrl(),json=gen.toString(),obj=JSON.parse(json);test("different formats",function(o){o.equal(convert.fromComment(comment).toComment(),comment,"comment -> comment");o.equal(convert.fromComment(comment).toBase64(),base64,"comment -> base64");o.equal(convert.fromComment(comment).toJSON(),json,"comment -> json");o.deepEqual(convert.fromComment(comment).toObject(),obj,"comment -> object");o.equal(convert.fromBase64(base64).toBase64(),base64,"base64 -> base64");o.equal(convert.fromBase64(base64).toComment(),comment,"base64 -> comment");o.equal(convert.fromBase64(base64).toJSON(),json,"base64 -> json");o.deepEqual(convert.fromBase64(base64).toObject(),obj,"base64 -> object");o.equal(convert.fromJSON(json).toJSON(),json,"json -> json");o.equal(convert.fromJSON(json).toBase64(),base64,"json -> base64");o.equal(convert.fromJSON(json).toComment(),comment,"json -> comment");o.deepEqual(convert.fromJSON(json).toObject(),obj,"json -> object");o.end()});test("to object returns a copy",function(o){var e=convert.fromJSON(json);var n=e.toObject();n.version="99";o.equal(e.toObject().version,3,"setting property on returned object does not affect original");o.end()});test("to multi-line map",function(o){var e=convert.fromObject(obj);var n=e.toComment({multiline:true});o.similar(n,/^\/\*# sourceMappingURL=.+ \*\/$/);o.end()});test("from source",function(o){var e=["function foo() {",' console.log("hello I am foo");',' console.log("who are you");',"}","","foo();",""].join("\n"),n="//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlcyI6WyJmdW5jdGlvbiBmb28oKSB7XG4gY29uc29sZS5sb2coXCJoZWxsbyBJIGFtIGZvb1wiKTtcbiBjb25zb2xlLmxvZyhcIndobyBhcmUgeW91XCIpO1xufVxuXG5mb28oKTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSJ9",t="//# sourceMappingURL=data:application/json;base64,otherZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlcyI6WyJmdW5jdGlvbiBmb28oKSB7XG4gY29uc29sZS5sb2coXCJoZWxsbyBJIGFtIGZvb1wiKTtcbiBjb25zb2xlLmxvZyhcIndobyBhcmUgeW91XCIpO1xufVxuXG5mb28oKTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSJ9";function s(o){var e=convert.fromSource(o);return e?e.toComment():null}o.equal(s(e),null,"no comment returns null");o.equal(s(e+n),n,"beginning of last line");o.equal(s(e+"    "+n),n,"indented of last line");o.equal(s(e+"   "+n+"\n\n"),n,"indented on last non empty line");o.equal(s(e+n+'\nconsole.log("more code");\nfoo()\n'),n,"in the middle of code");o.equal(s(e+t+"\n"+n),n,"finds last map in source");o.end()});test("from source with a large source",function(o){var e=["function foo() {",' console.log("hello I am foo");',' console.log("who are you");',"}","","foo();",""].join("\n"),n="//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlcyI6WyJmdW5jdGlvbiBmb28oKSB7XG4gY29uc29sZS5sb2coXCJoZWxsbyBJIGFtIGZvb1wiKTtcbiBjb25zb2xlLmxvZyhcIndobyBhcmUgeW91XCIpO1xufVxuXG5mb28oKTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSJ9",t="//# sourceMappingURL=data:application/json;base64,otherZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlcyI6WyJmdW5jdGlvbiBmb28oKSB7XG4gY29uc29sZS5sb2coXCJoZWxsbyBJIGFtIGZvb1wiKTtcbiBjb25zb2xlLmxvZyhcIndobyBhcmUgeW91XCIpO1xufVxuXG5mb28oKTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSJ9";function s(o){var e=convert.fromSource(o,true);return e?e.toComment():null}o.equal(s(e),null,"no comment returns null");o.equal(s(e+n),n,"beginning of last line");o.equal(s(e+"    "+n),n,"indented of last line");o.equal(s(e+"   "+n+"\n\n"),n,"indented on last non empty line");o.equal(s(e+n+'\nconsole.log("more code");\nfoo()\n'),n,"in the middle of code");o.equal(s(e+t+"\n"+n),n,"finds last map in source");o.end()});test("remove comments",function(o){var e=["function foo() {",' console.log("hello I am foo");',' console.log("who are you");',"}","","foo();",""].join("\n"),n="//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlcyI6WyJmdW5jdGlvbiBmb28oKSB7XG4gY29uc29sZS5sb2coXCJoZWxsbyBJIGFtIGZvb1wiKTtcbiBjb25zb2xlLmxvZyhcIndobyBhcmUgeW91XCIpO1xufVxuXG5mb28oKTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSJ9",t="//# sourceMappingURL=data:application/json;base64,ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlcyI6WyJmdW5jdGlvbiBmb28oKSB7XG4gY29uc29sZS5sb2coXCJoZWxsbyBJIGFtIGZvb1wiKTtcbiBjb25zb2xlLmxvZyhcIndobyBhcmUgeW91XCIpO1xufVxuXG5mb28oKTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSJ9",s='\nconsole.log("more code");\nfoo()\n';o.equal(convert.removeComments(e+n),e,"from last line");o.equal(convert.removeComments(e+n+s),e+s,"from the middle of code");o.equal(convert.removeComments(e+t+s+n),e+s,"multiple comments from the middle of code");o.end()});test("remove map file comments",function(o){var e=["function foo() {",' console.log("hello I am foo");',' console.log("who are you");',"}","","foo();",""].join("\n"),n="//# sourceMappingURL=foo.js.map",t="/*# sourceMappingURL=foo.js.map */";o.equal(convert.removeMapFileComments(e+n),e,"// style filemap comment");o.equal(convert.removeMapFileComments(e+t),e,"/* */ style filemap comment");o.end()});test("pretty json",function(o){var e=convert.fromJSON(json).toJSON(2),n=JSON.stringify(obj,null,2);o.equal(e,n,"pretty prints json when space is given");o.end()});test("adding properties",function(o){var e=convert.fromJSON(json).addProperty("foo","bar").toJSON(),n=JSON.parse(json);n.foo="bar";o.equal(e,JSON.stringify(n),"includes added property");o.end()});test("setting properties",function(o){var e=convert.fromJSON(json).setProperty("version","2").setProperty("mappings",";;;UACG").setProperty("should add","this").toJSON(),n=JSON.parse(json);n.version="2";n.mappings=";;;UACG";n["should add"]="this";o.equal(e,JSON.stringify(n),"includes new property and changes existing properties");o.end()});test("getting properties",function(o){var e=convert.fromJSON(json);o.equal(e.getProperty("version"),3,"gets version");o.deepEqual(e.getProperty("sources"),["foo.js","bar.js"],"gets sources");o.end()});test("return null fromSource when largeSource is true",function(o){var e=convert.fromSource("",true),n=null;o.equal(e,n,"return value should be null");o.end()});