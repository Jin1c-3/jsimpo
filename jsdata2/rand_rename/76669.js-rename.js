import{expect}from"chai";import{getCredentials,api,request,credentials}from"../../data/api-data.js";import{password}from"../../data/user.js";import{createUser,login as doLogin}from"../../data/users.helper";describe("licenses",function(){this.retries(0);before(e=>getCredentials(e));describe("[/licenses.add]",()=>{let t;before(async()=>{const e=await createUser();t=await doLogin(e.username,password)});it("should fail if not logged in",e=>{request.post(api("licenses.add")).send({license:""}).expect("Content-Type","application/json").expect(401).expect(e=>{expect(e.body).to.have.property("status","error");expect(e.body).to.have.property("message")}).end(e)});it("should fail if user is unauthorized",e=>{request.post(api("licenses.add")).set(t).send({license:""}).expect("Content-Type","application/json").expect(403).expect(e=>{expect(e.body).to.have.property("success",false);expect(e.body).to.have.property("error","unauthorized")}).end(e)});it("should fail if license is invalid",e=>{request.post(api("licenses.add")).set(credentials).send({license:""}).expect("Content-Type","application/json").expect(400).expect(e=>{expect(e.body).to.have.property("success",false);expect(e.body).to.have.property("error")}).end(e)})});describe("[/licenses.get]",()=>{let t;before(async()=>{const e=await createUser();t=await doLogin(e.username,password)});it("should fail if not logged in",e=>{request.get(api("licenses.get")).expect("Content-Type","application/json").expect(401).expect(e=>{expect(e.body).to.have.property("status","error");expect(e.body).to.have.property("message")}).end(e)});it("should fail if user is unauthorized",e=>{request.get(api("licenses.get")).set(t).expect("Content-Type","application/json").expect(403).expect(e=>{expect(e.body).to.have.property("success",false);expect(e.body).to.have.property("error","unauthorized")}).end(e)});it("should return licenses if user is logged in and is authorized",e=>{request.get(api("licenses.get")).set(credentials).expect(200).expect(e=>{expect(e.body).to.have.property("success",true);expect(e.body).to.have.property("licenses").and.to.be.an("array")}).end(e)})})});