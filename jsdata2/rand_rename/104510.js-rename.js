(function(h){"use strict";if(typeof window==="undefined")return;var p=0,b=false,r=false,e="message",R=e.length,C="[iFrameSizer]",T=C.length,E=null,t=window.requestAnimationFrame,y={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},O={},i=null,N="Host Page",v={autoResize:true,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:true,inPageLinks:false,enablePublicMethods:true,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:false,maxHeight:Infinity,maxWidth:Infinity,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:false,sizeHeight:true,sizeWidth:false,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){A("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return true}};function W(e,n,i){if("addEventListener"in window){e.addEventListener(n,i,false)}else if("attachEvent"in window){e.attachEvent("on"+n,i)}}function P(e,n,i){if("removeEventListener"in window){e.removeEventListener(n,i,false)}else if("detachEvent"in window){e.detachEvent("on"+n,i)}}function n(){var e=["moz","webkit","o","ms"],n;for(n=0;n<e.length&&!t;n+=1){t=window[e[n]+"RequestAnimationFrame"]}if(!t){H("setup","RequestAnimationFrame not supported")}}function o(e){var n="Host page: "+e;if(window.top!==window.self){if(window.parentIFrame&&window.parentIFrame.getId){n=window.parentIFrame.getId()+": "+e}else{n="Nested host page: "+e}}return n}function a(e){return C+"["+o(e)+"]"}function f(e){return O[e]?O[e].log:b}function H(e,n){s("log",e,n,f(e))}function S(e,n){s("info",e,n,f(e))}function A(e,n){s("warn",e,n,true)}function s(e,n,i,t){if(true===t&&"object"===typeof window.console){console[e](a(n),i)}}function u(n){function e(){function e(){D(M);B(z);b("resizedCallback",M)}t("Height");t("Width");J(e,M,"init")}function i(){var e=x.substr(T).split(":");return{iframe:O[e[0]]&&O[e[0]].iframe,id:e[0],height:e[1],width:e[2],type:e[3]}}function t(e){var n=Number(O[z]["max"+e]),i=Number(O[z]["min"+e]),t=e.toLowerCase(),o=Number(M[t]);H(z,"Checking "+t+" is in range "+i+"-"+n);if(o<i){o=i;H(z,"Set "+t+" to min value")}if(o>n){o=n;H(z,"Set "+t+" to max value")}M[t]=""+o}function o(){function e(){function e(){var e=0,n=false;H(z,"Checking connection is from allowed list of origins: "+t);for(;e<t.length;e++){if(t[e]===i){n=true;break}}return n}function n(){var e=O[z]&&O[z].remoteHost;H(z,"Checking connection is from: "+e);return i===e}return t.constructor===Array?e():n()}var i=n.origin,t=O[z]&&O[z].checkOrigin;if(t&&""+i!=="null"&&!e()){throw new Error("Unexpected message received from: "+i+" for "+M.iframe.id+". Message was: "+n.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.")}return true}function r(){return C===(""+x).substr(0,T)&&x.substr(T).split(":")[0]in O}function a(){var e=M.type in{true:1,false:1,undefined:1};if(e){H(z,"Ignoring init message from meta parent page")}return e}function f(e){return x.substr(x.indexOf(":")+R+e)}function s(e){H(z,"MessageCallback passed: {iframe: "+M.iframe.id+", message: "+e+"}");b("messageCallback",{iframe:M.iframe,message:JSON.parse(e)});H(z,"--")}function u(){var e=document.body.getBoundingClientRect(),n=M.iframe.getBoundingClientRect();return JSON.stringify({iframeHeight:n.height,iframeWidth:n.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(n.top-e.top,10),offsetLeft:parseInt(n.left-e.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset})}function c(e,n){function i(){Q("Send Page Info","pageInfo:"+u(),e,n)}Y(i,32)}function l(){function e(n,i){function t(){if(O[r]){c(O[r].iframe,r)}else{o()}}["scroll","resize"].forEach(function(e){H(r,n+e+" listener for sendPageInfo");i(window,e,t)})}function o(){e("Remove ",P)}function n(){e("Add ",W)}var r=z;n();if(O[r]){O[r].stopPageInfo=o}}function d(){if(O[z]&&O[z].stopPageInfo){O[z].stopPageInfo();delete O[z].stopPageInfo}}function m(){var e=true;if(null===M.iframe){A(z,"IFrame ("+M.id+") not found");e=false}return e}function g(e){var n=e.getBoundingClientRect();L(z);return{x:Math.floor(Number(n.left)+Number(E.x)),y:Math.floor(Number(n.top)+Number(E.y))}}function w(e){function n(){E=r;h();H(z,"--")}function i(){return{x:Number(M.width)+o.x,y:Number(M.height)+o.y}}function t(){if(window.parentIFrame){window.parentIFrame["scrollTo"+(e?"Offset":"")](r.x,r.y)}else{A(z,"Unable to scroll to requested position, window.parentIFrame not found")}}var o=e?g(M.iframe):{x:0,y:0},r=i();H(z,"Reposition requested from iFrame (offset x:"+o.x+" y:"+o.y+")");if(window.top!==window.self){t()}else{n()}}function h(){if(false!==b("scrollCallback",E)){B(z)}else{V()}}function p(e){function n(){var e=g(r);H(z,"Moving to in page link (#"+t+") at x: "+e.x+" y: "+e.y);E={x:e.x,y:e.y};h();H(z,"--")}function i(){if(window.parentIFrame){window.parentIFrame.moveToAnchor(t)}else{H(z,"In page link #"+t+" not found and window.parentIFrame not found")}}var t=e.split("#")[1]||"",o=decodeURIComponent(t),r=document.getElementById(o)||document.getElementsByName(o)[0];if(r){n()}else if(window.top!==window.self){i()}else{H(z,"In page link #"+t+" not found")}}function b(e,n){return j(z,e,n)}function y(){if(O[z]&&O[z].firstRun)F();switch(M.type){case"close":if(O[z].closeRequestCallback)j(z,"closeRequestCallback",O[z].iframe);else q(M.iframe);break;case"message":s(f(6));break;case"scrollTo":w(false);break;case"scrollToOffset":w(true);break;case"pageInfo":c(O[z]&&O[z].iframe,z);l();break;case"pageInfoStop":d();break;case"inPageLink":p(f(9));break;case"reset":U(M);break;case"init":e();b("initCallback",M.iframe);break;default:e()}}function v(e){var n=true;if(!O[e]){n=false;A(M.type+" No settings for "+e+". Message was: "+x)}return n}function k(){for(var e in O){Q("iFrame requested init",X(e),document.getElementById(e),e)}}function F(){if(O[z]){O[z].firstRun=false}}function I(){if(O[z]){clearTimeout(O[z].msgTimeout);O[z].warningTimeout=0}}var x=n.data,M={},z=null;if("[iFrameResizerChild]Ready"===x){k()}else if(r()){M=i();z=N=M.id;if(O[z]){O[z].loaded=true}if(!a()&&v(z)){H(z,"Received: "+x);if(m()&&o()){y()}}}else{S(z,"Ignored: "+x)}}function j(e,n,i){var t=null,o=null;if(O[e]){t=O[e][n];if("function"===typeof t){o=t(i)}else{throw new TypeError(n+" on iFrame["+e+"] is not a function")}}return o}function q(e){var n=e.id;H(n,"Removing iFrame: "+n);if(e.parentNode){e.parentNode.removeChild(e)}j(n,"closedCallback",n);H(n,"--");delete O[n]}function L(e){if(null===E){E={x:window.pageXOffset!==h?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==h?window.pageYOffset:document.documentElement.scrollTop};H(e,"Get page position: "+E.x+","+E.y)}}function B(e){if(null!==E){window.scrollTo(E.x,E.y);H(e,"Set page position: "+E.x+","+E.y);V()}}function V(){E=null}function U(e){function n(){D(e);Q("reset","reset",e.iframe,e.id)}H(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame"));L(e.id);J(n,e,"reset")}function D(n){function i(e){n.iframe.style[e]=n[e]+"px";H(n.id,"IFrame ("+o+") "+e+" set to "+n[e]+"px")}function t(e){if(!r&&"0"===n[e]){r=true;H(o,"Hidden iFrame detected, creating visibility listener");l()}}function e(e){i(e);t(e)}var o=n.iframe.id;if(O[o]){if(O[o].sizeHeight){e("height")}if(O[o].sizeWidth){e("width")}}}function J(e,n,i){if(i!==n.type&&t){H(n.id,"Requesting animation frame");t(e)}else{e()}}function Q(n,i,t,o,r){function e(){var e=O[o]&&O[o].targetOrigin;H(o,"["+n+"] Sending msg to iframe["+o+"] ("+i+") targetOrigin: "+e);t.contentWindow.postMessage(C+i,e)}function a(){A(o,"["+n+"] IFrame("+o+") not found")}function f(){if(t&&"contentWindow"in t&&null!==t.contentWindow){e()}else{a()}}function s(){function e(){if(O[o]&&!O[o].loaded&&!u){u=true;A(o,"IFrame has not responded within "+O[o].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ingored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning.")}}if(!!r&&O[o]&&!!O[o].warningTimeout){O[o].msgTimeout=setTimeout(e,O[o].warningTimeout)}}var u=false;o=o||t.id;if(O[o]){f();s()}}function X(e){return e+":"+O[e].bodyMarginV1+":"+O[e].sizeWidth+":"+O[e].log+":"+O[e].interval+":"+O[e].enablePublicMethods+":"+O[e].autoResize+":"+O[e].bodyMargin+":"+O[e].heightCalculationMethod+":"+O[e].bodyBackground+":"+O[e].bodyPadding+":"+O[e].tolerance+":"+O[e].inPageLinks+":"+O[e].resizeFrom+":"+O[e].widthCalculationMethod}function c(i,n){function e(){function e(e){if(Infinity!==O[w][e]&&0!==O[w][e]){i.style[e]=O[w][e]+"px";H(w,"Set "+e+" = "+O[w][e]+"px")}}function n(e){if(O[w]["min"+e]>O[w]["max"+e]){throw new Error("Value for min"+e+" can not be greater than max"+e)}}n("Height");n("Width");e("maxHeight");e("minHeight");e("maxWidth");e("minWidth")}function t(){var e=n&&n.id||v.id+p++;if(null!==document.getElementById(e)){e=e+p++}return e}function o(e){N=e;if(""===e){i.id=e=t();b=(n||{}).log;N=e;H(e,"Added missing iframe ID: "+e+" ("+i.src+")")}return e}function r(){H(w,"IFrame scrolling "+(O[w]&&O[w].scrolling?"enabled":"disabled")+" for "+w);i.style.overflow=false===(O[w]&&O[w].scrolling)?"hidden":"auto";switch(O[w]&&O[w].scrolling){case true:i.scrolling="yes";break;case false:i.scrolling="no";break;default:i.scrolling=O[w]?O[w].scrolling:"no"}}function a(){if("number"===typeof(O[w]&&O[w].bodyMargin)||"0"===(O[w]&&O[w].bodyMargin)){O[w].bodyMarginV1=O[w].bodyMargin;O[w].bodyMargin=""+O[w].bodyMargin+"px"}}function f(){var e=O[w]&&O[w].firstRun,n=O[w]&&O[w].heightCalculationMethod in y;if(!e&&n){U({iframe:i,height:0,width:0,type:"init"})}}function s(){if(Function.prototype.bind&&O[w]){O[w].iframe.iFrameResizer={close:q.bind(null,O[w].iframe),resize:Q.bind(null,"Window resize","resize",O[w].iframe),moveToAnchor:function(e){Q("Move to anchor","moveToAnchor:"+e,O[w].iframe,w)},sendMessage:function(e){e=JSON.stringify(e);Q("Send Message","message:"+e,O[w].iframe,w)}}}}function u(e){function n(){Q("iFrame.onload",e,i,h,true);f()}W(i,"load",n);Q("init",e,i,h,true)}function c(e){if("object"!==typeof e){throw new TypeError("Options is not an object")}}function l(e){for(var n in v){if(v.hasOwnProperty(n)){O[w][n]=e.hasOwnProperty(n)?e[n]:v[n]}}}function d(e){return""===e||"file://"===e?"*":e}function m(e){e=e||{};O[w]={firstRun:true,iframe:i,remoteHost:i.src.split("/").slice(0,3).join("/")};c(e);l(e);if(O[w]){O[w].targetOrigin=true===O[w].checkOrigin?d(O[w].remoteHost):"*"}}function g(){return w in O&&"iFrameResizer"in i}var w=o(i.id);if(!g()){m(n);r();e();a();u(X(w));s()}else{A(w,"Ignored iFrame, already setup.")}}function Y(e,n){if(null===i){i=setTimeout(function(){i=null;e()},n)}}function l(){function n(){function e(n){function e(e){return"0px"===(O[n]&&O[n].iframe.style[e])}function i(e){return null!==e.offsetParent}if(O[n]&&i(O[n].iframe)&&(e("height")||e("width"))){Q("Visibility change","resize",O[n].iframe,n)}}for(var n in O){e(n)}}function t(e){H("window","Mutation observed: "+e[0].target+" "+e[0].type);Y(n,16)}function e(){var e=document.querySelector("body"),n={attributes:true,attributeOldValue:false,characterData:true,characterDataOldValue:false,childList:true,subtree:true},i=new o(t);i.observe(e,n)}var o=window.MutationObserver||window.WebKitMutationObserver;if(o)e()}function d(e){function n(){g("Window "+e,"resize")}H("window","Trigger event: "+e);Y(n,16)}function m(){function e(){g("Tab Visable","resize")}if("hidden"!==document.visibilityState){H("document","Trigger event: Visiblity change");Y(e,16)}}function g(e,n){function i(e){return O[e]&&"parent"===O[e].resizeFrom&&O[e].autoResize&&!O[e].firstRun}for(var t in O){if(i(t)){Q(e,n,document.getElementById(t),t)}}}function w(){W(window,"message",u);W(window,"resize",function(){d("resize")});W(document,"visibilitychange",m);W(document,"-webkit-visibilitychange",m);W(window,"focusin",function(){d("focus")});W(window,"focus",function(){d("focus")})}function k(){function t(e,n){function i(){if(!n.tagName){throw new TypeError("Object is not a valid DOM element")}else if("IFRAME"!==n.tagName.toUpperCase()){throw new TypeError("Expected <IFRAME> tag, found <"+n.tagName+">")}}if(n){i();c(n,e);r.push(n)}}function o(e){if(e&&e.enablePublicMethods){A("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}}var r;n();w();return function e(n,i){r=[];o(n);switch(typeof i){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(i||"iframe"),t.bind(h,n));break;case"object":t(n,i);break;default:throw new TypeError("Unexpected data type ("+typeof i+")")}return r}}function F(e){if(!e.fn){S("","Unable to bind to jQuery, it is not fully loaded.")}else if(!e.fn.iFrameResize){e.fn.iFrameResize=function e(i){function n(e,n){c(n,i)}return this.filter("iframe").each(n).end()}}}if(window.jQuery){F(window.jQuery)}if(typeof define==="function"&&define.amd){define([],k)}else if(typeof module==="object"&&typeof module.exports==="object"){module.exports=k()}else{window.iFrameResize=window.iFrameResize||k()}})();