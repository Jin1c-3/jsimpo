define(function(e,t,a){"use strict";var n=brackets.getModule("spec/SpecRunnerUtils");var o,r;describe("HealthData",function(){beforeEach(function(){n.createTestWindowAndRun(this,function(e){o=e})});afterEach(function(){n.closeTestWindow();o=null});describe("Data Send to Server",function(){var a=24*60*60*1e3,n=30*60*1e3,t,i;beforeEach(function(){r=o.brackets.test.PreferencesManager;t=r.getExtensionPrefs("healthData");i=o.brackets.test.HealthDataManager;this.addMatchers({toBeGreaterOrEqualTo:function(e){this.message=function(){return"Expected "+this.actual+" to be >= "+e};return this.actual>=e}})});afterEach(function(){i=null;t=null;r=null});it("should send data to server when opted in",function(){var e=Date.now();r.setViewState("nextHealthDataSendTime",e);r.setViewState("healthDataNotificationShown",true);var t=i.checkHealthDataSend();waitsForDone(t,"Send Data to Server",4e3);expect(r.getViewState("nextHealthDataSendTime")).toBeGreaterOrEqualTo(e+a)});it("should not send data right away on first launch",function(){var e=Date.now();r.setViewState("nextHealthDataSendTime",null);r.setViewState("healthDataNotificationShown",true);var t=i.checkHealthDataSend();waitsForFail(t,"Send Data to Server",4e3);expect(r.getViewState("nextHealthDataSendTime")).toBeGreaterOrEqualTo(e+n)});it("should not send data to server when opted out",function(){r.setViewState("nextHealthDataSendTime",Date.now());t.set("healthDataTracking",false);var e=i.checkHealthDataSend();waitsForFail(e,"Send Data to Server",4e3)})});describe("Notification popup",function(){var e;beforeEach(function(){e=o.brackets.test.HealthDataPopup});afterEach(function(){e=null});it("should show notification popup",function(){e.showFirstLaunchTooltip();expect($(o.document).find("#healthdata-firstlaunch-popup").length).toBe(1)})});describe("Health Data Statistics is displayed",function(){var t;beforeEach(function(){t=o.brackets.test.HealthDataPreview});afterEach(function(){t=null});it("should show file preview dialog",function(){runs(function(){var e=t.previewHealthData();waitsForDone(e,"Health Data File Preview",4e3)});runs(function(){expect($(o.document).find(".health-data-preview.instance").length).toBe(1)})})})})});