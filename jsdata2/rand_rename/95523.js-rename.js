var path=require("path");var assert=require("assert");exports.testDir=path.dirname(__filename);exports.fixturesDir=path.join(exports.testDir,"fixtures");exports.libDir=path.join(exports.testDir,"../lib");exports.tmpDir=path.join(exports.testDir,"tmp");exports.PORT=12346;if(process.platform==="win32"){exports.PIPE="\\\\.\\pipe\\libuv-test"}else{exports.PIPE=exports.tmpDir+"/test.sock"}var util=require("util");for(var i in util)exports[i]=util[i];function protoCtrChain(r){var e=[];for(;r;r=r.__proto__){e.push(r.constructor)}return e.join()}exports.indirectInstanceOf=function(r,e){if(r instanceof e){return true}var t=protoCtrChain(e.prototype);var s=protoCtrChain(r);return s.slice(-t.length)===t};exports.ddCommand=function(r,e){if(process.platform==="win32"){var t=path.resolve(exports.fixturesDir,"create-file.js");return'"'+process.argv[0]+'" "'+t+'" "'+r+'" '+e*1024}else{return'dd if=/dev/zero of="'+r+'" bs=1024 count='+e}};exports.spawnPwd=function(r){var e=require("child_process").spawn;if(process.platform==="win32"){return e("cmd.exe",["/c","cd"],r)}else{return e("pwd",[],r)}};exports.globalCheck=true;process.on("exit",function(){if(!exports.globalCheck)return;var r=[setTimeout,setInterval,global.setImmediate,clearTimeout,clearInterval,global.clearImmediate,console,Buffer,process,global];if(global.errno){r.push(errno)}if(global.gc){r.push(gc)}if(global.DTRACE_HTTP_SERVER_RESPONSE){r.push(DTRACE_HTTP_SERVER_RESPONSE);r.push(DTRACE_HTTP_SERVER_REQUEST);r.push(DTRACE_HTTP_CLIENT_RESPONSE);r.push(DTRACE_HTTP_CLIENT_REQUEST);r.push(DTRACE_NET_STREAM_END);r.push(DTRACE_NET_SERVER_CONNECTION);r.push(DTRACE_NET_SOCKET_READ);r.push(DTRACE_NET_SOCKET_WRITE)}if(global.COUNTER_NET_SERVER_CONNECTION){r.push(COUNTER_NET_SERVER_CONNECTION);r.push(COUNTER_NET_SERVER_CONNECTION_CLOSE);r.push(COUNTER_HTTP_SERVER_REQUEST);r.push(COUNTER_HTTP_SERVER_RESPONSE);r.push(COUNTER_HTTP_CLIENT_REQUEST);r.push(COUNTER_HTTP_CLIENT_RESPONSE)}if(global.ArrayBuffer){r.push(ArrayBuffer);r.push(Int8Array);r.push(Uint8Array);r.push(Uint8ClampedArray);r.push(Int16Array);r.push(Uint16Array);r.push(Int32Array);r.push(Uint32Array);r.push(Float32Array);r.push(Float64Array);r.push(DataView)}for(var e in global){var t=false;for(var s in r){if(global[e]===r[s]){t=true;break}}if(!t){console.error("Unknown global: %s",e);assert.ok(false,"Unknown global found")}}});var mustCallChecks=[];function runCallChecks(){var r=mustCallChecks.filter(function(r){return r.actual!==r.expected});r.forEach(function(r){console.log("Mismatched %s function calls. Expected %d, actual %d.",r.name,r.expected,r.actual);console.log(r.stack.split("\n").slice(2).join("\n"))});if(r.length)process.exit(1)}exports.mustCall=function(r,e){if(typeof e!=="number")e=1;var t={expected:e,actual:0,stack:(new Error).stack,name:r.name||"<anonymous>"};if(mustCallChecks.length===0)process.on("exit",runCallChecks);mustCallChecks.push(t);return function(){t.actual++;return r.apply(this,arguments)}};