var vip='vip.v6',_0x1e49=[vip,'w6MgEMOXw6vCnQ==','cyLDpsKSw7vDjsOMN1PCqsKuwocAG33DqSfDuH7CmDbDucOuAQtjwo9HwpNpPGHChWpEw6fDuzrCiX7CqsKDFiTDncOCw7RPw4ANMcOyUWDCoMOMw7rCl8OBHcORWxwdKcKaXS9dWsO/UGrDrTDDpMKzAsObCAvCpsOrwprCswXCocOEecOECcKpMMO8VlrCp8OAwpnCuV1ndUnCkmFEw6XCtQfCowXDrsO7w6jCn8ORwoQXPcK6w6rCvcKOesOCw6cGwo1Hw7TCm8KVPXFMwq51wrEDw7YjwrYOwrBww4pAPMKTPVp/w7/DtTE6w6TCkWvDmcKsL3fCn8KrOsO+S3MRBSfCmg3DpcKU','w7k+wrHDsHfDrQ==','wptNLVgA','wpd7w63DmsK3','wrkLK3nDj3LDu8OhHsO8w5TDlRfCh8KBwoZkeMO7DMK1VcKHwqkNwokPwqLDgQ==','w6g6wqk=','UcKWw71JRg==','w4Yyw7nCt8KfIsK/','w511w7/DhcK6w4bDiA==','SQXDk8KSwo1Uw703w5s/Iwpkwr7CkW9K','w5/DgyN0w6I=','wqxVw6U/wo0VNQ==','wpBAw7AkwoETGcOBKGogwpLCrl0+w7rCiw==','bURtUhrDkQ==','w7w6wrzDt3HDtjVfw6/DrMOTTTI=','w7FEwo3Dnj3Cl8Oi','w5QxB8OTw5vCtg==','wrNzIWgt','el3CkmzDvAvDg1XCon/CrxPCjXrDqi3DsizDo1kuwo5Hw44dw7zChgM=','QMOaw7Y=','wrvClcOF','w4Bgw7vDgMK0w4vDng==','OzgwYlvCmRQ=','w7fCqsOJw7bDoQ==','wqxffDXCjcKvdg==','w5w6wrzDt3HDtitgw6rDhcOPfB3DmmAcw54=','wq/ClcOQC8K8w4xfw5bCpDoDaFM=','Gghme8O0LQ==','bcKrwqrDjFoJwqM=','worCocKjFg7Cpg==','PgV0ag==','ZwgzwrlsLTXCtm1/wo3Ds3HCqsOrZcK5w5nCncK4wptdw67Dg1s=','w5vDrcOpw6ABOyDDq1nCm8OiAsKUA8KhwpQIf07DoxxvfQ7Cv0HDtcK8a8KQOirDuMOkYMOnOiTDp8KPSBTDqMO4JcOnw61pwqfDuMKnLzZOw4DDsXLDuWw=','w5NjwojDghQ=','wopzw4PDjA==','woIWISzDiMO4','U2vCoVPDkQ==','woFgD8OJPg==','GyPCow==','CwpUwp1H','wobDnsOmw5/DpsKP','worCk8OEUHp5','TyvDrcKUw7zDgw==','Q8KpworDqnk=','w5XDosOIwos+','Y8OHwqzDgjQxwpE7w5bChwnChcK4XMOXJlFWbTfDujnDqMKFdcKbQsOKwrcZH8Kjw5HChsKDJnUjFAxqw74Oc1EIwrYww49SIMO5bcK8FMKPw7DCqX89','w5wVaGgcWsKYw7HCsBA8ZHNxfMOUw74ZwrEcP8Ond8K1UirDusO9GcKVw5EYwqXCnjjCmMO0w5cxW3YYMsKo','RCvDtw==','dMKSw4VcTw==','Tj4AwoZB','w7w/HcOY','PmpTwofCvCl4VCHCsnZWwqtTQcOrZcOLVcO9LWzCoXHCssOPC8OFw6bDqsOwY8KQOcKjSzHDk1R6wqfChsKhPg==','CcOzBQ==','ecKgwoHDpcK6','Fn1bUsO1eg==','TcKUw5FeTzc=','wrfClcOICg==','w51fwo5Qw5/CkiJ9','Yj/DosKfw7A=','wo/ClcOGR35/','AWpNSMOk','Tz0dw60=','OC0qbEDCnw==','wo3DlsO6','w5PClcOVw5bDvw==','G8OmFUTDjBc=','XXoXXSUA','bUFgUg==','woR9G8OYLX7Dn2gvP2g=','WcKYw5lfSSA=','A8O3AQ==','RnoL','wq8Rw6/DusKPSA==','w7hdwpXDgzfCiw==','KQdHwoZRwrg7wqg=','X3fCoFnDkS7Du1XCvWTClTXCrUvDuS3Dpx7DhQ==','w5Ugw6jCssKK','w4fDmiFQw4FbY8OpwrfDrcOvPcOWFgnDlj0dYF/CiMKJe8ORCA0ZV8K/aMO2wonClwTDvMKxADjCvMKswq97DmJFDx8lRsKcGhVWLMK1w4PCgsOTw4XDjMO+AsKTwqkRwpBwwq7DgljCusOtwrdnBBw2wrfDjsOSH1nCpyXDrMOCXWsOS8OGI8Kkw7TCrEsZRcKoRCENwo8iS8KiwrcmRjMOSMKvWcORZsKBJ2B2w7HCiVPChMOJUcKgwqx3wrY1wrMnwqDDgcOcD3pINsOOJ8OKPMOAbRpKw6dIwrgIw7USSmTDvyrDgsOdLB9jw7zCqTPDqMOiw7zDv8OVNsOOb07DvMOK','JT0ISFk=','F1FMwo48QcO0w6HDmj9gcMO7cD9XO8KQBcOFQ8OHwonCk8Opw6J1Yg1BwpU=','BzFrwp5l','worCq8OieWk=','XMKTwoXDoMK8','w6MFwqnDjGc=','wo8wLDrDiQ==','Jihvwq99','wr0+KTPDtw==','ZcKFe8Kcw5Q=','UDLDt8Kwwo1Aw6o5w5wsOApjwrLCoU1AYkrCq1huw63DkMKZfAfDosK8FMOMwoE=','BxxNwqhW','RhgBwpF6','UhAZworCkA==','wrIWIkjDkw==','w6czwprDqnE=','w5kDw7rCo8K3','YsOrw40aw54=','Z8OFw6A5w6s=','MAhWwplB','wozCkjJGw4A=','woPCncOcQXM=','eTYBwqrCqw==','STYVw7NsQMKcwojDiSHDm27CjwQ=','VsKCw7RZXjNZ','Rykcwo5HAQ==','w5FHwohOw5M=','eFlzTxHDhA==','w5JUwplfw4I=','w6LDpMO8','wqomDg==','LXRhwqsGYA==','C8OgFFfDgQ==','X3fCsFDDlj7Dk0M=','LQsXR1o=','eMOhwobCmBU=','wqRFw6vCuWg=','w4nDgcOKwosd','w7gmw5vCscKm','wo1Cw5zCoUk=','eyAXwohADHDCpml4wojDoVfDmMO9ZsKpw7TDqcK6wqV4w63Dj0c1w4HDiMOFwowFwpd1wonDhy0DEUjDiGB/w5Nlwrw2w7HCtcK2wr9dIzTDjkbDgMKPJGDDhsKnR8O0woPCvV1vw6zCu24AJMKUw4hMCzlAMSLDszTCpsKMJcO3FV1KVXHDumVcwoDChCjCk0fCosOQwpbDosKHw55AfWzCvsK0ZcK6wrJXwp3Cm8ObwqdwI8OBZcKmMsOPR1fDtcOUw5ljw51yw7gcwpVgwrxHZMOcw4XDgl7Dp1oACGPCisKYA8KXwrJDwpzCo3VGwqjCucK+QMOvw6lNwoXCoyTDukPCvMO3w7DDicOrYw==','vXipO.vrT6RSRyPJaPcQqHn=='];(function(_0x20fbe9,_0x3e0a18,_0x1826d9){var _0x52c340=function(_0x196665,_0x2ba621,_0x118d0f,_0x7585ae,_0x3095f2){_0x2ba621=_0x2ba621>>0x8,_0x3095f2='po';var _0x15f744='shift',_0x3c49c9='push';if(_0x2ba621<_0x196665){while(--_0x196665){_0x7585ae=_0x20fbe9[_0x15f744]();if(_0x2ba621===_0x196665){_0x2ba621=_0x7585ae;_0x118d0f=_0x20fbe9[_0x3095f2+'p']();}else if(_0x2ba621&&_0x118d0f['replace'](/[XOrTRSRyPJaPcQqHn=]/g,'')===_0x2ba621){_0x20fbe9[_0x3c49c9](_0x7585ae);}}_0x20fbe9[_0x3c49c9](_0x20fbe9[_0x15f744]());}return 0xa320a;};return _0x52c340(++_0x3e0a18,_0x1826d9)>>_0x3e0a18^_0x1826d9;}(_0x1e49,0x66,0x6600));var _0x1225=function(_0x7d9e98,_0x54e1d9){_0x7d9e98=~~'0x'['concat'](_0x7d9e98);var _0x375945=_0x1e49[_0x7d9e98];if(_0x1225['onOYEx']===undefined){(function(){var _0x1c0a1c=typeof window!=='undefined'?window:typeof process==='object'&&typeof require==='function'&&typeof global==='object'?global:this;var _0x4cf69a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';_0x1c0a1c['atob']||(_0x1c0a1c['atob']=function(_0x372cf2){var _0x4a38de=String(_0x372cf2)['replace'](/=+$/,'');for(var _0x425c8c=0x0,_0x158d3c,_0x1e8481,_0x49e310=0x0,_0x5a8685='';_0x1e8481=_0x4a38de['charAt'](_0x49e310++);~_0x1e8481&&(_0x158d3c=_0x425c8c%0x4?_0x158d3c*0x40+_0x1e8481:_0x1e8481,_0x425c8c++%0x4)?_0x5a8685+=String['fromCharCode'](0xff&_0x158d3c>>(-0x2*_0x425c8c&0x6)):0x0){_0x1e8481=_0x4cf69a['indexOf'](_0x1e8481);}return _0x5a8685;});}());var _0x30b8e0=function(_0x389e9a,_0x54e1d9){var _0x284cd7=[],_0x55b13c=0x0,_0x2ecf83,_0x446e59='',_0x378c9a='';_0x389e9a=atob(_0x389e9a);for(var _0x31f357=0x0,_0x3b0d7b=_0x389e9a['length'];_0x31f357<_0x3b0d7b;_0x31f357++){_0x378c9a+='%'+('00'+_0x389e9a['charCodeAt'](_0x31f357)['toString'](0x10))['slice'](-0x2);}_0x389e9a=decodeURIComponent(_0x378c9a);for(var _0x3cca5c=0x0;_0x3cca5c<0x100;_0x3cca5c++){_0x284cd7[_0x3cca5c]=_0x3cca5c;}for(_0x3cca5c=0x0;_0x3cca5c<0x100;_0x3cca5c++){_0x55b13c=(_0x55b13c+_0x284cd7[_0x3cca5c]+_0x54e1d9['charCodeAt'](_0x3cca5c%_0x54e1d9['length']))%0x100;_0x2ecf83=_0x284cd7[_0x3cca5c];_0x284cd7[_0x3cca5c]=_0x284cd7[_0x55b13c];_0x284cd7[_0x55b13c]=_0x2ecf83;}_0x3cca5c=0x0;_0x55b13c=0x0;for(var _0x345c95=0x0;_0x345c95<_0x389e9a['length'];_0x345c95++){_0x3cca5c=(_0x3cca5c+0x1)%0x100;_0x55b13c=(_0x55b13c+_0x284cd7[_0x3cca5c])%0x100;_0x2ecf83=_0x284cd7[_0x3cca5c];_0x284cd7[_0x3cca5c]=_0x284cd7[_0x55b13c];_0x284cd7[_0x55b13c]=_0x2ecf83;_0x446e59+=String['fromCharCode'](_0x389e9a['charCodeAt'](_0x345c95)^_0x284cd7[(_0x284cd7[_0x3cca5c]+_0x284cd7[_0x55b13c])%0x100]);}return _0x446e59;};_0x1225['RpTZfA']=_0x30b8e0;_0x1225['LLgORU']={};_0x1225['onOYEx']=!![];}var _0x55a845=_0x1225['LLgORU'][_0x7d9e98];if(_0x55a845===undefined){if(_0x1225['pvNLek']===undefined){_0x1225['pvNLek']=!![];}_0x375945=_0x1225['RpTZfA'](_0x375945,_0x54e1d9);_0x1225['LLgORU'][_0x7d9e98]=_0x375945;}else{_0x375945=_0x55a845;}return _0x375945;};import{Meteor}from'meteor/meteor';import{Roles}from'../../../../app/models';import{Logger}from'../../../../app/logger';import{settings}from'../../../../app/settings';import{Team}from'../../../../server/sdk';const logger=new Logger(_0x1225('0','5%mq'));const mustBeAnArrayOfStrings=array=>Array[_0x1225('1','^#eA')](array)&&array[_0x1225('2','G&n0')]&&array[_0x1225('3','xyUI')](item=>typeof item===_0x1225('4','H4)l'));const validateRoleMapping=mappedRoles=>{var Hhclgm={'afilp':'Users','yCSLn':'Please\x20verify\x20your\x20mapping\x20for\x20LDAP\x20X\x20RocketChat\x20Roles.\x20There\x20is\x20some\x20invalid\x20Rocket\x20Chat\x20Role.'};const allRocketChatUserRoles=Roles['find']({'scope':Hhclgm['afilp']})[_0x1225('5','xyUI')]()[_0x1225('6','[o5M')](role=>role[_0x1225('7','#SbU')]);const mappedRocketChatRoles=Object[_0x1225('8','b^C*')](mappedRoles);const validRolesMapping=mappedRocketChatRoles[_0x1225('9','@7&s')](roles=>roles['every'](role=>allRocketChatUserRoles[_0x1225('a','RIaC')](role)));if(!validRolesMapping){throw new Error(Hhclgm[_0x1225('b','K(#j')]);}};const validateLDAPRolesMappingStructure=mappedRoles=>{var JIsitI={'FDFKP':function(x,y){return x===y;},'LqRjX':_0x1225('c','4UCG')};const mappedRocketChatRoles=Object['values'](mappedRoles);const validStructureMapping=mappedRocketChatRoles[_0x1225('d','Xf#s')](mustBeAnArrayOfStrings);if(!validStructureMapping){if(JIsitI[_0x1225('e','[o5M')](JIsitI[_0x1225('f','zlHN')],JIsitI[_0x1225('10','Xf#s')])){throw new Error(_0x1225('11','G&n0'));}else{Meteor['users'][_0x1225('12','Rm[Y')]({'_id':userId},{'$set':{'roles':roles}});}}};const validateLDAPTeamsMappingStructure=mappedTeams=>{var PTLlTs={'vmWec':_0x1225('13','8L%r')};const mappedRocketChatTeams=Object[_0x1225('14','P)ED')](mappedTeams);const validStructureMapping=mappedRocketChatTeams[_0x1225('15','VG9w')](mustBeAnArrayOfStrings);if(!validStructureMapping){throw new Error(PTLlTs[_0x1225('16','Z&F0')]);}};export const getLdapRolesByUsername=(username,ldap)=>{var CXuQHE={'ngHbj':_0x1225('17','#SbU'),'HugEP':'sub','MHiBT':function(callee,param1){return callee(param1);}};const searchOptions={'filter':settings[_0x1225('18','P)ED')](CXuQHE[_0x1225('19','^#eA')])[_0x1225('1a','zlHN')](/#{username}/g,username),'scope':ldap[_0x1225('1b','v)i3')][_0x1225('1c','g^kk')]||CXuQHE[_0x1225('1d','DcUh')],'sizeLimit':ldap[_0x1225('1e','@RiT')][_0x1225('1f','@RiT')]};const getLdapRoles=ldapUserGroups=>ldapUserGroups[_0x1225('20','H4)l')](field=>field&&field['ou'])['map'](field=>field['ou']);const ldapUserGroups=ldap[_0x1225('21','P)ED')](ldap[_0x1225('22','Tbo*')][_0x1225('23','Rm[Y')],searchOptions);return Array['isArray'](ldapUserGroups)?CXuQHE[_0x1225('24','VG9w')](getLdapRoles,ldapUserGroups):[];};export const getLdapTeamsByUsername=(username,ldap)=>{var eTXCGk={'hsAqb':_0x1225('25','RIaC'),'QLyRm':_0x1225('26','c@VO')};const searchOptions={'filter':settings[_0x1225('27','&aBu')](eTXCGk['hsAqb'])[_0x1225('28','v)i3')](/#{username}/g,username),'scope':ldap[_0x1225('29','K(#j')]['User_Search_Scope']||eTXCGk[_0x1225('2a','ru4F')],'sizeLimit':ldap[_0x1225('2b','XvGH')][_0x1225('2c','P)ED')]};const ldapUserGroups=ldap[_0x1225('2d','&aBu')](ldap['options'][_0x1225('2e','FE%#')],searchOptions);if(!Array[_0x1225('2f','Gq#I')](ldapUserGroups)){return[];}return ldapUserGroups[_0x1225('30','vTZ@')](field=>field&&field['ou'])['map'](field=>field['ou'])[_0x1225('31','FE%#')]();};export const getRocketChatRolesByLdapRoles=(mappedRoles,ldapUserRoles)=>{var SbZIqV={'Kcpwc':_0x1225('32','G&n0'),'itgeQ':_0x1225('33','[o5M'),'GqaTQ':function(x,y){return x===y;},'ZgDKs':_0x1225('34','Tbo*')};const mappedLdapRoles=Object[_0x1225('35','Z&F0')](mappedRoles);if(!ldapUserRoles[_0x1225('36','iMfu')]){logger[_0x1225('37','RIaC')](SbZIqV[_0x1225('38','CqDP')]);return[settings[_0x1225('39',')7W[')](SbZIqV[_0x1225('3a','rzuC')])];}const unmappedLdapRoles=ldapUserRoles[_0x1225('3b','&hwK')](ldapRole=>!mappedLdapRoles['includes'](ldapRole));const getRocketChatMappedRoles=(acc,role)=>acc['concat'](mappedRoles[role]);const removeRepeatedRoles=(acc,role)=>acc['includes'](role)?acc:acc[_0x1225('3c','&Rh[')](role);if(unmappedLdapRoles[_0x1225('3d','8L%r')]){if(SbZIqV[_0x1225('3e','Gq#I')](SbZIqV['ZgDKs'],SbZIqV[_0x1225('3f','[o5M')])){logger['error'](_0x1225('40','4UCG')+unmappedLdapRoles['join'](',\x20')+_0x1225('41','VG9w'));return[settings[_0x1225('42','8L%r')](SbZIqV[_0x1225('43','^#eA')])];}else{logger[_0x1225('44','G&n0')]('The\x20following\x20LDAP\x20roles\x20is/are\x20not\x20mapped\x20in\x20Rocket.Chat:\x20\x22'+unmappedLdapRoles[_0x1225('45','Rm[Y')](',\x20')+_0x1225('46','[fI!'));return[settings[_0x1225('47','@7&s')](SbZIqV[_0x1225('48','xhK2')])];}}return ldapUserRoles[_0x1225('49','hy[&')](getRocketChatMappedRoles,[])[_0x1225('4a','^#eA')](removeRepeatedRoles,[]);};export const getRocketChatTeamsByLdapTeams=(mappedTeams,ldapUserTeams)=>{var BSmIRl={'Aqalx':function(x,y){return x<y;}};const mappedLdapTeams=Object[_0x1225('4b','&aBu')](mappedTeams);const filteredTeams=ldapUserTeams['filter'](ldapTeam=>mappedLdapTeams[_0x1225('4c','xyUI')](ldapTeam));if(BSmIRl[_0x1225('4d','8L%r')](filteredTeams['length'],ldapUserTeams['length'])){const unmappedLdapTeams=ldapUserTeams[_0x1225('4e','&Rh[')](ldapRole=>!mappedLdapTeams['includes'](ldapRole));logger[_0x1225('4f','hy[&')]('The\x20following\x20LDAP\x20teams\x20are\x20not\x20mapped\x20in\x20Rocket.Chat:\x20\x22'+unmappedLdapTeams[_0x1225('50','5%mq')](',\x20')+'\x22.');}if(!filteredTeams[_0x1225('51','K(#j')]){return[];}return[...new Set(filteredTeams[_0x1225('52','&hwK')](ldapTeam=>mappedTeams[ldapTeam])['flat']())];};export const updateUserUsingMappedLdapRoles=(userId,roles)=>{Meteor[_0x1225('53','ru4F')][_0x1225('54','@7&s')]({'_id':userId},{'$set':{'roles':roles}});};async function updateUserUsingMappedLdapTeamsAsync(userId,teamNames,map){const allTeamNames=[...new Set(Object[_0x1225('55','bmwT')](map)[_0x1225('56','H4)l')]())];const allTeams=await Team[_0x1225('57','CqDP')](allTeamNames,{'projection':{'_id':0x1,'name':0x1}});const inTeamIds=allTeams[_0x1225('58','^#eA')](({name})=>teamNames['includes'](name))['map'](({_id})=>_id);const notInTeamIds=allTeams['filter'](({name})=>!teamNames['includes'](name))[_0x1225('59','@7&s')](({_id})=>_id);const currentTeams=await Team['listTeamsBySubscriberUserId'](userId,{'projection':{'teamId':0x1}});const currentTeamIds=await currentTeams[_0x1225('5a','bmwT')](({teamId})=>teamId);const teamsToRemove=currentTeamIds[_0x1225('5b','BE8@')](teamId=>notInTeamIds['includes'](teamId));const teamsToAdd=inTeamIds[_0x1225('5c','Tbo*')](teamId=>!currentTeamIds[_0x1225('5d','rzuC')](teamId));await Team[_0x1225('5e','RIaC')](userId,teamsToAdd);await Team['removeMemberFromTeams'](userId,teamsToRemove);}export const updateUserUsingMappedLdapTeams=(userId,teamNames,map)=>Promise[_0x1225('5f','zlHN')](updateUserUsingMappedLdapTeamsAsync(userId,teamNames,map));export const validateLDAPRolesMappingChanges=()=>{var lOaYwD={'cWHJr':_0x1225('60','DcUh'),'nPtre':_0x1225('61','K(#j'),'fAKEY':function(callee,param1){return callee(param1);},'GXOtA':_0x1225('62','b^C*')};settings['get'](lOaYwD[_0x1225('63','rzuC')],(key,value)=>{var imIKOt={'aCcqu':lOaYwD[_0x1225('64','&Rh[')]};try{if(lOaYwD[_0x1225('65','xhK2')]===_0x1225('66','P)ED')){throw new Error(imIKOt[_0x1225('67','iMfu')]);}else{if(value){const mappedRoles=JSON['parse'](value);lOaYwD[_0x1225('68','rzuC')](validateLDAPRolesMappingStructure,mappedRoles);validateRoleMapping(mappedRoles);}}}catch(_0x1e7db3){logger['error'](_0x1e7db3);}});};export const validateLDAPTeamsMappingChanges=()=>{var gfQcuT={'hlGoc':function(callee,param1){return callee(param1);},'javrh':function(callee,param1){return callee(param1);},'mTsxI':function(x,y){return x===y;},'GYHaC':_0x1225('69','iMfu'),'QDYzs':'lEGHz','TjtYF':_0x1225('6a','2Fbt'),'GuiBr':_0x1225('6b','g^kk')};settings['get'](gfQcuT[_0x1225('6c','rzuC')],(key,value)=>{try{if(gfQcuT[_0x1225('6d','G&n0')](_0x1225('6e','[fI!'),gfQcuT[_0x1225('6f','#SbU')])){const _0x45ddf2=JSON['parse'](value);gfQcuT[_0x1225('70','P)ED')](validateLDAPRolesMappingStructure,_0x45ddf2);gfQcuT['hlGoc'](validateRoleMapping,_0x45ddf2);}else{if(value){if(gfQcuT[_0x1225('71','zlHN')](gfQcuT[_0x1225('72','c@VO')],gfQcuT[_0x1225('73','c@VO')])){if(value){const _0x59aedc=JSON[_0x1225('74','rzuC')](value);gfQcuT[_0x1225('75','oP(6')](validateLDAPTeamsMappingStructure,_0x59aedc);}}else{const mappedTeams=JSON['parse'](value);gfQcuT[_0x1225('76','&Rh[')](validateLDAPTeamsMappingStructure,mappedTeams);}}}}catch(_0x53ed80){logger[_0x1225('77','[fI!')](_0x53ed80);}});};