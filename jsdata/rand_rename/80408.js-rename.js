import{emitter,listeners}from"../mixins";function getSlider(t){return{name:"U-Slider",mixins:[emitter,listeners],props:{name:{type:String,default:""},min:{type:[Number,String],default:0},max:{type:[Number,String],default:100},value:{type:[Number,String],default:0},step:{type:[Number,String],default:1},disabled:{type:[Boolean,String],default:false},color:{type:String,default:"#e9e9e9"},backgroundColor:{type:String,default:"#e9e9e9"},activeColor:{type:String,default:"#007aff"},selectedColor:{type:String,default:"#007aff"},blockColor:{type:String,default:"#ffffff"},blockSize:{type:[Number,String],default:28},showValue:{type:[Boolean,String],default:false}},data(){return{left:0,width:0,sliderValue:Number(this.value),sliderThumbValue:0}},computed:{trackStyle(){return{backgroundColor:this._getBgColor()}},trackActiveStyle(){return{backgroundColor:this._getActiveColor(),width:this.thumbValue+"px"}},thumbStyle(){return{width:this.blockSize+"px",height:this.blockSize+"px",marginTop:-this.blockSize/2+"px",left:this.thumbValue+"px",backgroundColor:this.blockColor}},thumbValue(){return(this.sliderValue-Number(this.min))/(Number(this.max)-Number(this.min))*this.width}},watch:{value(e){this.sliderValue=Number(e)}},mounted(){this._x0=0;this._x1=0;this.$eventOld=null;setTimeout(()=>{const e=t.requireModule("dom");e.getComponentRect(this.$refs["slider-track"],e=>{this.left=e.size.left;this.width=e.size.width})},50)},created(){this.$dispatch("Form","uni-form-group-update",{type:"add",vm:this})},beforeDestroy(){this.$dispatch("Form","uni-form-group-update",{type:"remove",vm:this})},methods:{_handleStart(e){if(e.changedTouches.length===1&&!this._$eventOld){this._$eventOld=e;const t=e.changedTouches[0].pageX;this._x0=this._x1=t;this._onTrack("start",t)}},_handleMove(e){if(e.changedTouches.length===1&&this._$eventOld){const t=e.changedTouches[0].pageX;this._onTrack("move",t);this._x1=t}},_handleEnd(e){if(e.changedTouches.length===1&&this._$eventOld){const t=e.changedTouches[0].pageX;this._$eventOld=null;this._onTrack("end",t)}},_onTrack:function(e,t){if(!this.disabled){if(e==="move"){this._onUserChangedValue({x:t});this.$trigger("changing",{value:this.sliderValue})}else if(e==="end"){this._onUserChangedValue({x:t});this.$trigger("change",{value:this.sliderValue})}}},_onUserChangedValue(e){let t=e.x;if(t<0){t=0}if(t>this.width){t=this.width}this.sliderValue=this._filterValue(t)},_filterValue(e){let t=e/this.width*(Number(this.max)-Number(this.min));const i=Number(this.step);if(i>0&&t>i&&t%i/i!==0){t-=t%i}return parseInt(t+Number(this.min))},_getBgColor(){return this.backgroundColor!=="#e9e9e9"?this.backgroundColor:this.color!=="#007aff"?this.color:"#007aff"},_getActiveColor(){return this.activeColor!=="#007aff"?this.activeColor:this.selectedColor!=="#e9e9e9"?this.selectedColor:"#e9e9e9"},_resetFormData(){this.sliderValue=this.min},_getFormData(){const e={};if(this.name!==""){e["value"]=this.sliderValue;e["key"]=this.name}return e}},render(e){const t=this;return e("div",t._g({staticClass:["uni-slider"]},t.$listeners),[e("div",{staticClass:["uni-slider-wrapper"]},[e("div",{staticClass:["uni-slider-tap-area"],on:{touchstart:t._handleStart,touchmove:t._handleMove,touchend:t._handleEnd}},[e("div",{ref:"slider-track",staticClass:["uni-slider-handle-wrapper"],style:t.trackStyle},[e("div",{staticClass:["uni-slider-track"],style:t.trackActiveStyle})]),e("div",{ref:"uni-slider-handle",staticClass:["uni-slider-thumb"],style:t.thumbStyle})]),t.showValue?e("u-text",{staticClass:["uni-slider-value"]},[t._v(t._s(t.sliderValue))]):t._e()])])},style:{"uni-slider":{marginTop:"12",marginRight:0,marginBottom:"12",marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0},"uni-slider-wrapper":{flexDirection:"row",alignItems:"center",minHeight:"30"},"uni-slider-tap-area":{position:"relative",flex:1,paddingTop:"15",paddingRight:0,paddingBottom:"15",paddingLeft:0},"uni-slider-handle-wrapper":{position:"relative",marginTop:0,marginRight:"18",marginBottom:0,marginLeft:"18",height:"2",borderRadius:"5",backgroundColor:"#e9e9e9",transitionProperty:"backgroundColor",transitionDuration:300,transitionTimingFunction:"ease"},"@TRANSITION":{"uni-slider-handle-wrapper":{property:"backgroundColor",duration:300,timingFunction:"ease"},"uni-slider-track":{property:"backgroundColor",duration:300,timingFunction:"ease"},"uni-slider-thumb":{property:"borderColor",duration:300,timingFunction:"ease"}},"uni-slider-track":{flex:1,height:"2",borderRadius:"6",backgroundColor:"#007aff",transitionProperty:"backgroundColor",transitionDuration:300,transitionTimingFunction:"ease"},"uni-slider-thumb":{position:"absolute",width:"28",height:"28",borderRadius:50,boxShadow:"0 0 4px #ebebeb",transitionProperty:"borderColor",transitionDuration:300,transitionTimingFunction:"ease"},"uni-slider-step":{position:"absolute",width:100,height:"2",background:"transparent",zIndex:1},"uni-slider-value":{color:"#888888",fontSize:"14",marginRight:"14"}}}}export default function init(e,t){e.component("u-slider",getSlider(t))}