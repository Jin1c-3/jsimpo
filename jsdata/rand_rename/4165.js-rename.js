define(["jquery","underscore","backbone","collections/todos","views/todos","text!templates/stats.html","common"],function(e,t,i,l,s,n,o){"use strict";var r=i.View.extend({el:".todoapp",template:t.template(n),events:{"keypress .new-todo":"createOnEnter","click .clear-completed":"clearCompleted","click .toggle-all":"toggleAllComplete"},initialize:function(){this.allCheckbox=this.$(".toggle-all")[0];this.$input=this.$(".new-todo");this.$footer=this.$(".footer");this.$main=this.$(".main");this.$todoList=this.$(".todo-list");this.listenTo(l,"add",this.addOne);this.listenTo(l,"reset",this.addAll);this.listenTo(l,"change:completed",this.filterOne);this.listenTo(l,"filter",this.filterAll);this.listenTo(l,"all",t.debounce(this.render,0));l.fetch({reset:true})},render:function(){var e=l.completed().length;var t=l.remaining().length;if(l.length){this.$main.show();this.$footer.show();this.$footer.html(this.template({completed:e,remaining:t}));this.$(".filters li a").removeClass("selected").filter('[href="#/'+(o.TodoFilter||"")+'"]').addClass("selected")}else{this.$main.hide();this.$footer.hide()}this.allCheckbox.checked=!t},addOne:function(e){var t=new s({model:e});this.$todoList.append(t.render().el)},addAll:function(){this.$todoList.empty();l.each(this.addOne,this)},filterOne:function(e){e.trigger("visible")},filterAll:function(){l.each(this.filterOne,this)},newAttributes:function(){return{title:this.$input.val().trim(),order:l.nextOrder(),completed:false}},createOnEnter:function(e){if(e.which!==o.ENTER_KEY||!this.$input.val().trim()){return}l.create(this.newAttributes());this.$input.val("")},clearCompleted:function(){t.invoke(l.completed(),"destroy");return false},toggleAllComplete:function(){var t=this.allCheckbox.checked;l.each(function(e){e.save({completed:t})})}});return r});