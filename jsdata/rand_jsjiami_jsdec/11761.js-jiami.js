'use strict';const fs=require('fs');const path=require('path');const {createTestBuilder}=require('../../../../test/helpers/builder');const {createStrapiInstance}=require('../../../../test/helpers/strapi');const {createAuthRequest}=require('../../../../test/helpers/request');let strapi;let rq;let baseRq;const uploadImg=()=>{var _0x45fd72={'ZsaEF':function(_0x3ff05,_0x7dd91e){return _0x3ff05(_0x7dd91e);},'qQTRh':'POST','ALeQg':'rec.jpg'};return _0x45fd72['ZsaEF'](baseRq,{'method':_0x45fd72['qQTRh'],'url':'/upload','formData':{'files':fs['createReadStream'](path['join'](__dirname,_0x45fd72['ALeQg']))}});};const components={'singleMedia':{'name':'single-media','attributes':{'media':{'type':'media'}}},'multipleMedia':{'name':'multiple-media','attributes':{'media':{'type':'media','multiple':!![]}}},'withNested':{'name':'with-nested','attributes':{'singleMedia':{'type':'component','component':'default.single-media'},'multipleMedia':{'type':'component','component':'default.multiple-media'}}}};const ct={'name':'withdynamiczonemedia','attributes':{'field':{'type':'dynamiczone','components':['default.single-media','default.multiple-media','default.with-nested']}}};describe['each']([['CONTENT\x20MANAGER','/content-manager/collection-types/application::withdynamiczonemedia.withdynamiczonemedia'],['GENERATED API','/withdynamiczonemedias']])('[%s] => Not required dynamiczone',(_0x2861fc,_0x4ed48d)=>{var _0x1448f4={'IhpEY':function(_0x269ae3,_0x53533c){return _0x269ae3(_0x53533c);},'WRXrW':function(_0x2d5a2a){return _0x2d5a2a();},'qPoWL':function(_0x1f62c3,_0x1a2095){return _0x1f62c3(_0x1a2095);},'svEHe':'POST','ebybI':'default.single-media','ypniw':'default.multiple-media','khfDb':'PUT','PJQUx':function(_0x5dd875,_0x1eebc3){return _0x5dd875(_0x1eebc3);},'AIRqx':function(_0x2212cd,_0x5a345c){return _0x2212cd(_0x5a345c);},'WLiej':function(_0x5d780e){return _0x5d780e();},'foRyF':function(_0x59d309,_0x4ab504){return _0x59d309(_0x4ab504);},'cCIqi':'GET','nNjZi':function(_0x3b61b2,_0x3ba69c,_0x5dfbc3){return _0x3b61b2(_0x3ba69c,_0x5dfbc3);},'czDmz':'The medias are correctly related to the components on creation','akIAj':function(_0x4d229c,_0x29fa06,_0x3fe9c7){return _0x4d229c(_0x29fa06,_0x3fe9c7);},'rHbxf':'The media are populated on the components','UsAXs':function(_0x4b16a6,_0x1d4585){return _0x4b16a6(_0x1d4585);},'DVNcS':function(_0x36d363,_0x1c98da){return _0x36d363(_0x1c98da);},'wZjBO':'default.with-nested','gFuGL':function(_0x5773bf,_0x51304d){return _0x5773bf(_0x51304d);},'NnoXt':'Contains components with nested components having medias'};const _0x519c7e=createTestBuilder();_0x1448f4['gFuGL'](beforeAll,async()=>{await _0x519c7e['addComponent'](components['singleMedia'])['addComponent'](components['multipleMedia'])['addComponent'](components['withNested'])['addContentType'](ct)['build']();strapi=await createStrapiInstance();baseRq=await createAuthRequest({'strapi':strapi});rq=await _0x1448f4['IhpEY'](createAuthRequest,{'strapi':strapi});rq['setURLPrefix'](_0x4ed48d);});afterAll(async()=>{await strapi['destroy']();await _0x519c7e['cleanup']();});describe('Contains components with medias',()=>{var _0x2a84c7={'OTdwj':function(_0x4dd786,_0x3e0aad){return _0x4dd786(_0x3e0aad);},'AgKVB':'POST','JNSMo':'default.multiple-media','YAeaF':function(_0x57ac61,_0x3c907e){return _0x1448f4['AIRqx'](_0x57ac61,_0x3c907e);},'NgIMo':_0x1448f4['ebybI'],'gVmSm':function(_0x5d0281){return _0x1448f4['WLiej'](_0x5d0281);},'xPutE':function(_0x2ed2d4,_0x448dd4){return _0x1448f4['foRyF'](_0x2ed2d4,_0x448dd4);},'OeSbU':function(_0x324af8,_0x2eafd5){return _0x1448f4['foRyF'](_0x324af8,_0x2eafd5);},'whfXI':_0x1448f4['cCIqi'],'oaRsH':function(_0x1e2ea1,_0x2a686a){return _0x1448f4['foRyF'](_0x1e2ea1,_0x2a686a);}};_0x1448f4['nNjZi'](test,_0x1448f4['czDmz'],async()=>{const _0x2f15a0=await uploadImg();expect(_0x2f15a0['statusCode'])['toBe'](0xc8);const _0x3e0f43=_0x2f15a0['body'][0x0]['id'];const _0x1bbe04=await _0x2a84c7['OTdwj'](rq,{'method':_0x2a84c7['AgKVB'],'url':'/','body':{'field':[{'__component':'default.single-media','media':_0x3e0f43},{'__component':_0x2a84c7['JNSMo'],'media':[_0x3e0f43,_0x3e0f43]}]}});_0x2a84c7['OTdwj'](expect,_0x1bbe04['statusCode'])['toBe'](0xc8);expect(Array['isArray'](_0x1bbe04['body']['field']))['toBe'](!![]);_0x2a84c7['YAeaF'](expect,_0x1bbe04['body'])['toMatchObject']({'field':[{'id':expect['anything'](),'__component':_0x2a84c7['NgIMo'],'media':{'id':_0x3e0f43,'url':expect['any'](String)}},{'id':expect['anything'](),'__component':'default.multiple-media','media':expect['arrayContaining']([expect['objectContaining']({'id':_0x3e0f43,'url':expect['any'](String)})])}]});});_0x1448f4['nNjZi'](test,'The\x20medias\x20are\x20correctly\x20related\x20to\x20the\x20components\x20on\x20edition',async()=>{const _0x38b5cb=await _0x1448f4['WRXrW'](uploadImg);_0x1448f4['qPoWL'](expect,_0x38b5cb['statusCode'])['toBe'](0xc8);const _0x158383=_0x38b5cb['body'][0x0]['id'];const _0x32a5ac=await rq({'method':_0x1448f4['svEHe'],'url':'/','body':{'field':[{'__component':_0x1448f4['ebybI'],'media':_0x158383},{'__component':_0x1448f4['ypniw'],'media':[_0x158383,_0x158383]}]}});_0x1448f4['qPoWL'](expect,_0x32a5ac['statusCode'])['toBe'](0xc8);expect(Array['isArray'](_0x32a5ac['body']['field']))['toBe'](!![]);const _0x5471ad=await uploadImg();_0x1448f4['qPoWL'](expect,_0x5471ad['statusCode'])['toBe'](0xc8);const _0x51e1d5=_0x5471ad['body'][0x0]['id'];const _0x18d0ca=await _0x1448f4['qPoWL'](rq,{'method':_0x1448f4['khfDb'],'url':'/'+_0x32a5ac['body']['id'],'body':{'field':[{'__component':_0x1448f4['ebybI'],'media':_0x51e1d5},{'__component':_0x1448f4['ypniw'],'media':[_0x51e1d5,_0x51e1d5]}]}});_0x1448f4['PJQUx'](expect,_0x18d0ca['body'])['toMatchObject']({'field':[{'id':expect['anything'](),'__component':'default.single-media','media':{'id':_0x51e1d5,'url':expect['any'](String)}},{'id':expect['anything'](),'__component':'default.multiple-media','media':expect['arrayContaining']([expect['objectContaining']({'id':_0x51e1d5,'url':expect['any'](String)})])}]});});_0x1448f4['akIAj'](test,_0x1448f4['rHbxf'],async()=>{const _0x607674=await _0x2a84c7['gVmSm'](uploadImg);_0x2a84c7['xPutE'](expect,_0x607674['statusCode'])['toBe'](0xc8);const _0x82885f=_0x607674['body'][0x0]['id'];const _0x4eee28=await _0x2a84c7['OeSbU'](rq,{'method':_0x2a84c7['AgKVB'],'url':'/','body':{'field':[{'__component':_0x2a84c7['NgIMo'],'media':_0x82885f},{'__component':_0x2a84c7['JNSMo'],'media':[_0x82885f,_0x82885f]}]}});_0x2a84c7['OeSbU'](expect,_0x4eee28['statusCode'])['toBe'](0xc8);const _0x4d6994=await _0x2a84c7['OeSbU'](rq,{'method':_0x2a84c7['whfXI'],'url':'/'+_0x4eee28['body']['id']});_0x2a84c7['oaRsH'](expect,_0x4d6994['body'])['toMatchObject']({'field':[{'id':expect['anything'](),'__component':_0x2a84c7['NgIMo'],'media':{'id':_0x82885f,'url':expect['any'](String)}},{'id':expect['anything'](),'__component':'default.multiple-media','media':expect['arrayContaining']([expect['objectContaining']({'id':_0x82885f,'url':expect['any'](String)})])}]});});});describe(_0x1448f4['NnoXt'],()=>{var _0xd2d06a={'rhBhP':function(_0xaa3d16){return _0xaa3d16();},'fuAtU':function(_0x43bb92,_0x22c45d){return _0x1448f4['UsAXs'](_0x43bb92,_0x22c45d);},'OtKvQ':function(_0x4ea3ce,_0x33e26a){return _0x1448f4['DVNcS'](_0x4ea3ce,_0x33e26a);},'yFvOE':_0x1448f4['svEHe'],'FOiJT':_0x1448f4['wZjBO']};_0x1448f4['akIAj'](test,'The medias are correctly related to the nested components on creation',async()=>{const _0x434dac=await _0xd2d06a['rhBhP'](uploadImg);_0xd2d06a['fuAtU'](expect,_0x434dac['statusCode'])['toBe'](0xc8);const _0x375aab=_0x434dac['body'][0x0]['id'];const _0x1dd4ed=await _0xd2d06a['OtKvQ'](rq,{'method':_0xd2d06a['yFvOE'],'url':'/','body':{'field':[{'__component':_0xd2d06a['FOiJT'],'singleMedia':{'media':_0x375aab},'multipleMedia':{'media':[_0x375aab,_0x375aab]}}]}});expect(_0x1dd4ed['statusCode'])['toBe'](0xc8);_0xd2d06a['OtKvQ'](expect,Array['isArray'](_0x1dd4ed['body']['field']))['toBe'](!![]);_0xd2d06a['OtKvQ'](expect,_0x1dd4ed['body'])['toMatchObject']({'field':[{'id':expect['anything'](),'__component':_0xd2d06a['FOiJT'],'singleMedia':{'media':{'id':_0x375aab,'url':expect['any'](String)}},'multipleMedia':{'media':expect['arrayContaining']([expect['objectContaining']({'id':_0x375aab,'url':expect['any'](String)})])}}]});});});});