import _0x3b2790 from'cheerio';import _0x5db303 from'fs-extra';import{findPort,killApp,launchApp,nextBuild,nextStart,renderViaHTTP}from'next-test-utils';import{join}from'path';jest['setTimeout'](0x3e8*0x3c*0x2);const appDir=join(__dirname,'..');const appPage=join(appDir,'pages/_app.js');const indexPage=join(appDir,'pages/index.js');let app;let appPort;let indexPageContent;const runTests=isDev=>{var dPYlTH={'nclaP':function(callee){return callee();},'OWhLz':function(callee,param1,param2){return callee(param1,param2);},'MmMBq':function(callee,param1){return callee(param1);},'uNhCb':function(x,y){return x!==y;},'ockMZ':function(callee){return callee();},'NMfaa':function(callee,param1){return callee(param1);},'FWnxI':'#__NEXT_DATA__','YFXww':function(callee,param1){return callee(param1);},'BJjAw':'utf8','PyVoy':function(callee,param1){return callee(param1);},'zfYFF':function(callee,param1,param2){return callee(param1,param2);},'hTjkt':'should have gip in NEXT_DATA for page with getInitialProps','obhai':function(callee,param1,param2){return callee(param1,param2);},'tLiXo':'should only have appGip in NEXT_DATA for page without getInitialProps and _app with getInitialProps'};const getData=async()=>{if(isDev){appPort=await dPYlTH['nclaP'](findPort);app=await dPYlTH['OWhLz'](launchApp,appDir,appPort);}else{const {code}=await dPYlTH['MmMBq'](nextBuild,appDir);if(dPYlTH['uNhCb'](code,0x0))throw new Error('build faild, exit code: '+code);appPort=await dPYlTH['ockMZ'](findPort);app=await dPYlTH['OWhLz'](nextStart,appDir,appPort);}const html=await dPYlTH['OWhLz'](renderViaHTTP,appPort,'/');await dPYlTH['NMfaa'](killApp,app);const $=_0x3b2790['load'](html);return JSON['parse'](dPYlTH['NMfaa']($,dPYlTH['FWnxI'])['text']());};dPYlTH['OWhLz'](it,'should not have gip or appGip in NEXT_DATA for page without getInitialProps',async()=>{const data=await dPYlTH['ockMZ'](getData);dPYlTH['YFXww'](expect,data['gip'])['toBe'](undefined);expect(data['appGip'])['toBe'](undefined);});dPYlTH['zfYFF'](it,dPYlTH['hTjkt'],async()=>{indexPageContent=await _0x5db303['readFile'](indexPage,dPYlTH['BJjAw']);await _0x5db303['writeFile'](indexPage,'\n      const Page = () => \'hi\'\n      Page.getInitialProps = () => ({ hello: \'world\' })\n      export default Page\n    ');const data=await getData();dPYlTH['YFXww'](expect,data['gip'])['toBe'](!![]);});dPYlTH['obhai'](it,'should\x20have\x20gip\x20and\x20appGip\x20in\x20NEXT_DATA\x20for\x20page\x20with\x20getInitialProps\x20and\x20_app\x20with\x20getInitialProps',async()=>{await _0x5db303['writeFile'](appPage,'\n      const App = ({ Component, pageProps }) => <Component {...pageProps} />\n      App.getInitialProps = async (ctx) => {\n        let pageProps = {}\n        if (ctx.Component.getInitialProps) {\n          pageProps = await ctx.Component.getInitialProps(ctx.ctx)\n        }\n        return { pageProps }\n      }\n      export default App\n    ');const data=await getData();expect(data['gip'])['toBe'](!![]);expect(data['appGip'])['toBe'](!![]);});it(dPYlTH['tLiXo'],async()=>{await _0x5db303['writeFile'](indexPage,indexPageContent);const data=await dPYlTH['ockMZ'](getData);await _0x5db303['remove'](appPage);expect(data['gip'])['toBe'](undefined);dPYlTH['PyVoy'](expect,data['appGip'])['toBe'](!![]);});};describe('gip\x20identifiers',()=>{var JlxbhM={'fjUzt':function(callee,param1){return callee(param1);},'nlZHl':function(callee){return callee();},'styaG':function(callee,param1,param2){return callee(param1,param2);},'KHpDj':function(callee,param1,param2){return callee(param1,param2);},'MqNYe':'production\x20mode'};JlxbhM['styaG'](describe,'dev mode',()=>{JlxbhM['fjUzt'](runTests,!![]);});JlxbhM['KHpDj'](describe,JlxbhM['MqNYe'],()=>{JlxbhM['nlZHl'](runTests);});});