const jobsManager=require('../../utils/jobs/manager');jest['spyOn'](jobsManager,'enqueueJob');jest['spyOn'](jobsManager,'removeInProgressJob');jest['mock']('uuid/v4',()=>()=>'1234');import{jobsV2Reducer as _0x171470}from'../reducers/jobsv2';describe('Job v2 actions/reducer',()=>{var _0x3c47b6={'hBcHc':function(_0x3ca8be,_0x332298,_0x353f80){return _0x3ca8be(_0x332298,_0x353f80);},'ChiuL':function(_0x20d7e7,_0x440aad,_0x2a4167){return _0x20d7e7(_0x440aad,_0x2a4167);},'jMekx':function(_0x4c4ac6,_0x40f79f){return _0x4c4ac6!==_0x40f79f;},'TLHMJ':'jqwhC','MgnbA':'sALdK','TYfKN':'vJgXO','qCMRS':function(_0x3760a3,_0xe07343){return _0x3760a3===_0xe07343;},'DaxaQ':'mXdZf','Asrzg':function(_0x682b2f,_0x56aec0){return _0x682b2f(_0x56aec0);},'RpblH':'aUkvE','BIcSz':'UHDXz','tVtyI':function(_0x3ed45a){return _0x3ed45a();},'CboqT':function(_0x2fe99c){return _0x2fe99c();},'vKjCA':function(_0x20c20b,_0x4d1255){return _0x20c20b(_0x4d1255);},'PWhop':function(_0x300b4a,_0x4687a1){return _0x300b4a(_0x4687a1);},'BSEUw':function(_0x3c430c,_0x272775){return _0x3c430c(_0x272775);},'PZFeU':function(_0x1340ea,_0x36b4ab){return _0x1340ea(_0x36b4ab);},'wKZVq':function(_0xa6135d,_0x56164e){return _0xa6135d(_0x56164e);},'XepuK':function(_0x192b12,_0x266e93){return _0x192b12===_0x266e93;},'AdHCW':'ZOcpW','wfPDz':'DyTjy','TZVZI':function(_0x577d2f){return _0x577d2f();},'CNoeq':function(_0x13115a){return _0x13115a();},'cdips':function(_0x47eec0,_0x4f9d22,_0x2a0050){return _0x47eec0(_0x4f9d22,_0x2a0050);},'DolFq':function(_0x4529ea,_0x514ff8,_0x56eb28){return _0x4529ea(_0x514ff8,_0x56eb28);}};const _0x4ec1a5={'name':'test-plugin','version':'1.0.0','resolve':'/node_modules/test-plugin'};const _0x40a799=_0xc371c4=>{return{'program':{'directory':__dirname},'jobsV2':_0x3c47b6['hBcHc'](_0x171470,undefined,{}),..._0xc371c4};};beforeEach(()=>{if(_0x3c47b6['jMekx'](_0x3c47b6['TLHMJ'],_0x3c47b6['MgnbA'])){jobsManager['enqueueJob']['mockClear']();jobsManager['enqueueJob']['mockImplementation'](()=>Promise['resolve']('myresult'));}else{return{'program':{'directory':__dirname},'jobsV2':_0x3c47b6['ChiuL'](_0x171470,undefined,{}),...defaultState};}});const _0x39aaf0=_0x57a14e=>{if('FgHiF'!=='SythK'){const _0xf2bebb=_0x103747=>_0x171470(_0x3093de()['jobsV2'],_0x103747);const _0x3093de=()=>_0x57a14e;return _0x3daba4=>_0x3daba4(_0xf2bebb,_0x3093de);}else{jobsManager['enqueueJob']['mockClear']();jobsManager['enqueueJob']['mockImplementation'](()=>Promise['resolve']('myresult'));}};const _0x4d13c8=()=>{var _0x55f907={'ZBpGt':function(_0x543f4e,_0x3b046b){return _0x543f4e(_0x3b046b);}};if(_0x3c47b6['qCMRS'](_0x3c47b6['DaxaQ'],'mXdZf')){let _0x5c403d;jest['isolateModules'](()=>{if(_0x3c47b6['TYfKN']!==_0x3c47b6['TYfKN']){const _0x18052b=_0x5e0427=>_0x171470(_0x27f4cb()['jobsV2'],_0x5e0427);const _0x27f4cb=()=>globalState;return _0x1f3c59=>_0x1f3c59(_0x18052b,_0x27f4cb);}else{const {actions,internalActions}=require('../actions');_0x5c403d={'actions':actions,'internalActions':internalActions};}});return _0x5c403d;}else{let _0x275051;jest['isolateModules'](()=>{const {actions,internalActions}=_0x55f907['ZBpGt'](require,'../actions');_0x275051={'actions':actions,'internalActions':internalActions};});return _0x275051;}};it('should enqueueJob',async()=>{var _0x5b9494={'JeHUI':function(_0x177adc){return _0x177adc();},'hWAIe':function(_0x375407,_0x4c5fd0,_0x43dc3e){return _0x3c47b6['ChiuL'](_0x375407,_0x4c5fd0,_0x43dc3e);},'neYRX':function(_0x1c639d,_0x35e0e3){return _0x3c47b6['Asrzg'](_0x1c639d,_0x35e0e3);}};if(_0x3c47b6['RpblH']!==_0x3c47b6['BIcSz']){const {actions}=_0x3c47b6['tVtyI'](_0x4d13c8);const _0x50ed15=_0x3c47b6['tVtyI'](_0x40a799);const _0x2dbc41=_0x39aaf0(_0x50ed15);const _0x3e0f05=_0x3c47b6['Asrzg'](_0x2dbc41,actions['createJobV2']({'name':'TEST_JOB','inputPaths':[],'outputDir':'/public/static','args':{}},_0x4ec1a5));expect(_0x50ed15['jobsV2'])['toMatchSnapshot']();_0x3c47b6['Asrzg'](expect,_0x50ed15['jobsV2']['complete']['size'])['toBe'](0x0);_0x3c47b6['Asrzg'](expect,_0x50ed15['jobsV2']['incomplete']['size'])['toBe'](0x1);await _0x3e0f05;const _0x33e86c=Array['from'](_0x50ed15['jobsV2']['complete']['values']());_0x3c47b6['Asrzg'](expect,_0x50ed15['jobsV2']['complete']['size'])['toBe'](0x1);_0x3c47b6['Asrzg'](expect,_0x33e86c[0x0])['toEqual']({'result':'myresult','inputPaths':[]});expect(jobsManager['removeInProgressJob'])['toHaveBeenCalledTimes'](0x1);_0x3c47b6['Asrzg'](expect,jobsManager['enqueueJob'])['toMatchSnapshot']();}else{const {internalActions}=_0x5b9494['JeHUI'](_0x4d13c8);const {jobsV2}=_0x5b9494['JeHUI'](_0x40a799);jobsV2['complete']['set']('1234',{});jobsV2['incomplete']['set']('12345',{});_0x5b9494['hWAIe'](_0x171470,jobsV2,internalActions['removeStaleJob']('1234'));expect(jobsV2['complete']['size'])['toBe'](0x0);expect(jobsV2['incomplete']['size'])['toBe'](0x1);_0x171470(jobsV2,internalActions['removeStaleJob']('12345'));expect(jobsV2['complete']['size'])['toBe'](0x0);_0x5b9494['neYRX'](expect,jobsV2['incomplete']['size'])['toBe'](0x0);}});_0x3c47b6['DolFq'](it,'should return the result when job already ran',async()=>{const {actions}=_0x3c47b6['CboqT'](_0x4d13c8);const _0x211f1d=_0x3c47b6['CboqT'](_0x40a799);const _0x16d600=_0x3c47b6['vKjCA'](_0x39aaf0,_0x211f1d);const _0x35270f={'name':'TEST_JOB','inputPaths':[],'outputDir':'/public/static','args':{}};await _0x3c47b6['PWhop'](expect,_0x3c47b6['BSEUw'](_0x16d600,actions['createJobV2'](_0x35270f,_0x4ec1a5)))['resolves']['toBe']('myresult');await expect(_0x16d600(actions['createJobV2'](_0x35270f,_0x4ec1a5)))['resolves']['toBe']('myresult');_0x3c47b6['PZFeU'](expect,jobsManager['enqueueJob'])['toHaveBeenCalledTimes'](0x1);});_0x3c47b6['DolFq'](it,'should remove a stale job',async()=>{var _0xd921fd={'BIOgz':function(_0x4e8aa1,_0x2c0efa){return _0x3c47b6['wKZVq'](_0x4e8aa1,_0x2c0efa);}};if(_0x3c47b6['XepuK'](_0x3c47b6['AdHCW'],_0x3c47b6['wfPDz'])){const {actions,internalActions}=_0xd921fd['BIOgz'](require,'../actions');allActions={'actions':actions,'internalActions':internalActions};}else{const {internalActions}=_0x3c47b6['TZVZI'](_0x4d13c8);const {jobsV2}=_0x3c47b6['CNoeq'](_0x40a799);jobsV2['complete']['set']('1234',{});jobsV2['incomplete']['set']('12345',{});_0x3c47b6['cdips'](_0x171470,jobsV2,internalActions['removeStaleJob']('1234'));expect(jobsV2['complete']['size'])['toBe'](0x0);_0x3c47b6['wKZVq'](expect,jobsV2['incomplete']['size'])['toBe'](0x1);_0x3c47b6['DolFq'](_0x171470,jobsV2,internalActions['removeStaleJob']('12345'));expect(jobsV2['complete']['size'])['toBe'](0x0);_0x3c47b6['wKZVq'](expect,jobsV2['incomplete']['size'])['toBe'](0x0);}});});