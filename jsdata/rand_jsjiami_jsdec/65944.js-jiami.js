const pacote=require('pacote');const cacache=require('cacache');const Advisory=require('./advisory.js');const {homedir}=require('os');const jsonParse=require('json-parse-even-better-errors');const _packument=Symbol('packument');const _cachePut=Symbol('cachePut');const _cacheGet=Symbol('cacheGet');const _cacheData=Symbol('cacheData');const _packuments=Symbol('packuments');const _cache=Symbol('cache');const _options=Symbol('options');const _advisories=Symbol('advisories');const _calculate=Symbol('calculate');class Calculator{constructor(_0xc8df8d={}){var _0x5bc6ca={'jZcqv':function(_0x1f6d74){return _0x1f6d74();},'lbHBn':'/.npm/_cacache'};this[_options]={..._0xc8df8d};this[_cache]=this[_options]['cache']||_0x5bc6ca['jZcqv'](homedir)+_0x5bc6ca['lbHBn'];this[_options]['cache']=this[_cache];this[_packuments]=new Map();this[_cacheData]=new Map();this[_advisories]=new Map();}get['cache'](){return this[_cache];}get['options'](){return{...this[_options]};}async['calculate'](_0xb83db9,_0x41cc12){const _0x5bef45='security-advisory:'+_0xb83db9+':'+_0x41cc12['id'];if(this[_advisories]['has'](_0x5bef45))return this[_advisories]['get'](_0x5bef45);const _0x57cd8a=this[_calculate](_0xb83db9,_0x41cc12);this[_advisories]['set'](_0x5bef45,_0x57cd8a);return _0x57cd8a;}async[_calculate](_0x1c987f,_0x13bade){var _0x2cd25c={'ESsLB':'time','GrDZu':'timeEnd'};const _0x27c06c='security-advisory:'+_0x1c987f+':'+_0x13bade['id'];const _0x30f695='metavuln:calculate:'+_0x27c06c;process['emit']('time',_0x30f695);const _0x3db325=new Advisory(_0x1c987f,_0x13bade,this[_options]);const [_0xf9ed2e,_0x30e6df]=await Promise['all']([this[_cacheGet](_0x3db325),this[_packument](_0x1c987f)]);process['emit'](_0x2cd25c['ESsLB'],'metavuln:load:'+_0x27c06c);_0x3db325['load'](_0xf9ed2e,_0x30e6df);process['emit'](_0x2cd25c['GrDZu'],'metavuln:load:'+_0x27c06c);if(_0x3db325['updated'])await this[_cachePut](_0x3db325);this[_advisories]['set'](_0x27c06c,_0x3db325);process['emit'](_0x2cd25c['GrDZu'],_0x30f695);return _0x3db325;}async[_cachePut](_0x41f117){const {name,id}=_0x41f117;const _0xbb925e='security-advisory:'+name+':'+id;process['emit']('time','metavuln:cache:put:'+_0xbb925e);const _0x45b4e9=JSON['stringify'](_0x41f117);const _0x20a3b8={...this[_options]};this[_cacheData]['set'](_0xbb925e,jsonParse(_0x45b4e9));await cacache['put'](this[_cache],_0xbb925e,_0x45b4e9,_0x20a3b8)['catch'](()=>{});process['emit']('timeEnd','metavuln:cache:put:'+_0xbb925e);}async[_cacheGet](_0x343d67){var _0x4d6026={'CseLs':'timeEnd','RTtYQ':'time'};const {name,id}=_0x343d67;const _0x46d4ed='security-advisory:'+name+':'+id;if(this[_cacheData]['has'](_0x46d4ed))return this[_cacheData]['get'](_0x46d4ed);process['emit'](_0x4d6026['RTtYQ'],'metavuln:cache:get:'+_0x46d4ed);const _0x431c58=cacache['get'](this[_cache],_0x46d4ed,{...this[_options]})['catch'](()=>({'data':'{}'}))['then'](({data})=>{data=jsonParse(data);process['emit'](_0x4d6026['CseLs'],'metavuln:cache:get:'+_0x46d4ed);this[_cacheData]['set'](_0x46d4ed,data);return data;});this[_cacheData]['set'](_0x46d4ed,_0x431c58);return _0x431c58;}async[_packument](_0x46f686){var _0x4a8f02={'rJYZR':'timeEnd'};if(this[_packuments]['has'](_0x46f686))return this[_packuments]['get'](_0x46f686);process['emit']('time','metavuln:packument:'+_0x46f686);const _0x151f6d=pacote['packument'](_0x46f686,{...this[_options]})['catch'](_0x53a725=>{return{'name':_0x46f686,'versions':{}};})['then'](_0x194e6b=>{process['emit'](_0x4a8f02['rJYZR'],'metavuln:packument:'+_0x46f686);this[_packuments]['set'](_0x46f686,_0x194e6b);return _0x194e6b;});this[_packuments]['set'](_0x46f686,_0x151f6d);return _0x151f6d;}}module['exports']=Calculator;