'use strict';jest['mock']('npm-registry-fetch');jest['mock']('@lerna/otplease',()=>({'otplease':(_0x279d06,_0x502596)=>Promise['resolve'](_0x279d06(_0x502596))}));const fetch=require('npm-registry-fetch');const npmDistTag=require('..');const stubLog={'verbose':jest['fn'](),'info':jest['fn'](),'warn':jest['fn']()};const baseOptions=Object['freeze']({'log':stubLog,'defaultTag':'latest'});fetch['mockImplementation'](()=>Promise['resolve']());fetch['json']['mockImplementation'](()=>Promise['resolve']({}));describe('npmDistTag.add()',()=>{var _0x4c1d98={'xSdfN':'@scope/some-pkg@1.0.1','anMbS':'added-tag','uGJzO':'PUT','UmwHl':'1.0.1','Frmnv':'application/json','aJfuo':'dupe-tag','tKAsU':'1.0.0','AYQEv':function(_0x5d2721,_0x4b9c97){return _0x5d2721(_0x4b9c97);},'sspSs':function(_0x572225,_0x51909e){return _0x572225(_0x51909e);},'ZXdhg':'legacy','HGKda':function(_0x3b6649,_0x1e76bf,_0x385fe2){return _0x3b6649(_0x1e76bf,_0x385fe2);},'yyQkg':function(_0x26315d,_0x369369,_0x4d1022){return _0x26315d(_0x369369,_0x4d1022);},'bMIJe':'does not attempt to add duplicate of existing tag','kqjNl':function(_0x134765,_0x40c9f8,_0x92c2a8){return _0x134765(_0x40c9f8,_0x92c2a8);},'ScjWl':'supports npm v6 opts.tag fallback'};_0x4c1d98['HGKda'](it,'adds\x20a\x20dist-tag\x20for\x20a\x20given\x20package@version',async()=>{const _0x3923ca={...baseOptions};const _0x4b2372=await npmDistTag['add'](_0x4c1d98['xSdfN'],_0x4c1d98['anMbS'],_0x3923ca);expect(_0x4b2372)['toEqual']({'added-tag':'1.0.1'});expect(fetch)['toHaveBeenLastCalledWith']('/-/package/@scope%2fsome-pkg/dist-tags/added-tag',expect['objectContaining']({'method':_0x4c1d98['uGJzO'],'body':JSON['stringify'](_0x4c1d98['UmwHl']),'headers':{'content-type':_0x4c1d98['Frmnv']}}));});_0x4c1d98['yyQkg'](it,_0x4c1d98['bMIJe'],async()=>{fetch['json']['mockImplementationOnce'](()=>Promise['resolve']({'latest':'1.0.0','dupe-tag':'1.0.1'}));const _0x8af455={...baseOptions};const _0x261895=await npmDistTag['add'](_0x4c1d98['xSdfN'],_0x4c1d98['aJfuo'],_0x8af455);expect(_0x261895)['toEqual']({'latest':_0x4c1d98['tKAsU'],'dupe-tag':'1.0.1'});_0x4c1d98['AYQEv'](expect,fetch)['not']['toHaveBeenCalled']();_0x4c1d98['AYQEv'](expect,stubLog['warn'])['toHaveBeenLastCalledWith']('dist-tag','@scope/some-pkg@dupe-tag already set to 1.0.1');});it('defaults\x20tag\x20argument\x20to\x20opts.defaultTag',async()=>{fetch['json']['mockImplementationOnce'](()=>Promise['resolve']({'latest':'1.0.0'}));const _0x22b40f={...baseOptions};const _0x435ee8=await npmDistTag['add'](_0x4c1d98['xSdfN'],undefined,_0x22b40f);_0x4c1d98['sspSs'](expect,_0x435ee8)['toEqual']({'latest':'1.0.1'});});_0x4c1d98['kqjNl'](it,_0x4c1d98['ScjWl'],async()=>{fetch['json']['mockImplementationOnce'](()=>Promise['resolve']({'legacy':'1.0.0'}));const _0x145404={'log':stubLog,'tag':_0x4c1d98['ZXdhg']};const _0x4fabf3=await npmDistTag['add']('@scope/some-pkg@1.0.1',undefined,_0x145404);expect(_0x4fabf3)['toEqual']({'legacy':_0x4c1d98['UmwHl']});});});describe('npmDistTag.remove()',()=>{var _0x357e60={'zFntx':'removed-tag','JXkdt':function(_0x4ac213,_0x4e9a0b){return _0x4ac213(_0x4e9a0b);},'IenCW':'@scope/some-pkg@1.0.1','bseMM':function(_0x3d8605,_0x44c28e){return _0x3d8605(_0x44c28e);},'lzCdk':function(_0x1012de,_0x2bac65){return _0x1012de(_0x2bac65);},'Qzenv':'dist-tag','ivuaV':'"missing-tag" is not a dist-tag on @scope/some-pkg','LBwOH':'removes an existing dist-tag for a given package','csCXy':function(_0x5be16c,_0x132af8,_0x1cce4b){return _0x5be16c(_0x132af8,_0x1cce4b);},'LPTHP':'does not attempt removal of nonexistent tag'};it(_0x357e60['LBwOH'],async()=>{fetch['json']['mockImplementationOnce'](()=>Promise['resolve']({'latest':'1.0.0','removed-tag':'1.0.1'}));const _0x5cf505={...baseOptions};const _0x59bb17=await npmDistTag['remove']('@scope/some-pkg@1.0.1',_0x357e60['zFntx'],_0x5cf505);expect(_0x59bb17)['not']['toHaveProperty'](_0x357e60['zFntx']);_0x357e60['JXkdt'](expect,fetch)['toHaveBeenLastCalledWith']('/-/package/@scope%2fsome-pkg/dist-tags/removed-tag',expect['objectContaining']({'method':'DELETE'}));});_0x357e60['csCXy'](it,_0x357e60['LPTHP'],async()=>{const _0x444805={...baseOptions};const _0x1fba75=await npmDistTag['remove'](_0x357e60['IenCW'],'missing-tag',_0x444805);expect(_0x1fba75)['toEqual']({});_0x357e60['bseMM'](expect,fetch)['not']['toHaveBeenCalled']();_0x357e60['lzCdk'](expect,stubLog['info'])['toHaveBeenLastCalledWith'](_0x357e60['Qzenv'],_0x357e60['ivuaV']);});});describe('npmDistTag.list()',()=>{var _0x17c2ec={'kVDDt':'@scope/some-pkg','udSMb':function(_0x3805fa,_0x26def9){return _0x3805fa(_0x26def9);},'dEcrM':function(_0x1e3f14,_0x2bd239,_0x34aacc){return _0x1e3f14(_0x2bd239,_0x34aacc);},'LplSz':'returns dictionary of dist-tags','fwfTh':'handles disastrous results gracefully'};_0x17c2ec['dEcrM'](it,_0x17c2ec['LplSz'],async()=>{fetch['json']['mockImplementationOnce'](()=>Promise['resolve']({'latest':'1.0.0','other-tag':'1.0.1','_etag':'should-be-removed'}));const _0x3cd0fc={...baseOptions};const _0x367de8=await npmDistTag['list'](_0x17c2ec['kVDDt'],_0x3cd0fc);_0x17c2ec['udSMb'](expect,_0x367de8)['toEqual']({'latest':'1.0.0','other-tag':'1.0.1'});_0x17c2ec['udSMb'](expect,fetch['json'])['toHaveBeenLastCalledWith']('/-/package/@scope%2fsome-pkg/dist-tags',expect['objectContaining']({'preferOnline':!![],'spec':expect['objectContaining']({'name':_0x17c2ec['kVDDt']})}));});_0x17c2ec['dEcrM'](it,_0x17c2ec['fwfTh'],async()=>{fetch['json']['mockImplementationOnce'](()=>Promise['resolve'](null));const _0x17e93f={...baseOptions};const _0x539bb0=await npmDistTag['list'](_0x17c2ec['kVDDt'],_0x17e93f);_0x17c2ec['udSMb'](expect,_0x539bb0)['toEqual']({});});});