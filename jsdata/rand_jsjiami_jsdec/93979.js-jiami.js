require('../spec_helper');const _=require('lodash');const http=require('http');const Bluebird=require('bluebird');const Request=require(root+'lib/request');const snapshot=require('snap-shot-it');const request=Request({'timeout':0x64});const testAttachingCookiesWith=function(_0x395e0c){var _0x36ddf3={'nyztV':function(_0x3233fd,_0x14cb40){return _0x3233fd(_0x14cb40);},'SZCKq':'setCookiesOnBrowser','NAMzo':'http://localhost:1234','ryNxz':'one=1','jicxE':'/second','bdESZ':'/third'};const _0x465b28=sinon['spy'](request,_0x36ddf3['SZCKq']);const _0x4e3aa1=sinon['spy'](request,'setRequestCookieHeader');_0x36ddf3['nyztV'](nock,_0x36ddf3['NAMzo'])['get']('/')['reply'](0x12e,'',{'set-cookie':_0x36ddf3['ryNxz'],'location':_0x36ddf3['jicxE']})['get'](_0x36ddf3['jicxE'])['reply'](0x12e,'',{'set-cookie':'two=2','location':'/third'})['get'](_0x36ddf3['bdESZ'])['reply'](0xc8,'',{'set-cookie':'three=3'});return _0x395e0c()['then'](()=>{var _0x43f4a7={'jqTDS':'set-cookie','FqJwe':'args.1'};return _0x36ddf3['nyztV'](snapshot,{'setCalls':_0x465b28['getCalls']()['map'](_0x5eabb5=>{return{'currentUrl':_0x5eabb5['args'][0x1],'setCookie':_0x5eabb5['args'][0x0]['headers'][_0x43f4a7['jqTDS']]};}),'getCalls':_0x4e3aa1['getCalls']()['map'](_0x4ab4f2=>{return{'newUrl':_['get'](_0x4ab4f2,_0x43f4a7['FqJwe'])};})});});};describe('lib/request',()=>{var _0x417396={'qjQSD':'/login','ZVnsI':'http://localhost:8080/dashboard','OMMCZ':'/dashboard','EiOVH':'POST','xUHNg':'http://localhost:8080/login','XxYPD':'dashboard','BhOqp':'redirectedToUrl','ZfrNh':function(_0x17730c,_0x16c0dc){return _0x17730c!==_0x16c0dc;},'kfOcf':'YuGCg','xtNoU':'set:cookie','SKCWn':'response','reDbT':'error','aQhed':function(_0x45bf39,_0x4c95e3){return _0x45bf39===_0x4c95e3;},'dQJvx':'uLJbq','nIQjO':'xNhaF','SpWJb':function(_0x4ead67,_0x3f14c3){return _0x4ead67(_0x3f14c3);},'puuzg':'ECONNREFUSED','tLEjt':'ECONNRESET','YJKVm':function(_0x300e43,_0x5a95c6){return _0x300e43(_0x5a95c6);},'JQEHx':function(_0x298b44,_0x4ef98d){return _0x298b44(_0x4ef98d);},'NWoZg':'wCIHA','vrKHl':function(_0x3e8aab,_0x4e2d55,_0x53cda3){return _0x3e8aab(_0x4e2d55,_0x53cda3);},'AIZLe':'does not divide by 10 when err.code != ECONNREFUSED','zliol':function(_0x118f97,_0x43281d){return _0x118f97(_0x43281d);},'KykHi':function(_0x51aee8,_0x11ba90){return _0x51aee8(_0x11ba90);},'TQhgQ':function(_0xede4af,_0x42f76c,_0x104d4e){return _0xede4af(_0x42f76c,_0x104d4e);},'rAnvZ':'delaysRemaining to retryIntervals clone','LyyYu':function(_0x1b7073,_0xc1515d,_0x100964){return _0x1b7073(_0xc1515d,_0x100964);},'dCQCp':'delaysRemaining\x20can\x20be\x20overridden','reNAo':'MRlQY','YcqtQ':'bar','GYrSt':'body','jeaEO':function(_0x5edc98,_0x2cf36c){return _0x5edc98(_0x2cf36c);},'JXsMU':'<html>foo</html>','aZqNP':function(_0x4d05a5,_0xe1f82d){return _0x4d05a5(_0xe1f82d);},'iHDBP':'*/*','UcyDE':'http://localhost:8080/headers','TVega':function(_0x7be597){return _0x7be597();},'vJyrv':function(_0x303701,_0x194af7){return _0x303701(_0x194af7);},'tNLTJ':function(_0x5ac0ff,_0x362e89,_0x41019a){return _0x5ac0ff(_0x362e89,_0x41019a);},'FKpjU':'sets status to statusCode and deletes statusCode','pxpWN':'picks out status body and headers','odiHG':function(_0x3af840,_0x2ad05a){return _0x3af840(_0x2ad05a);},'srknj':'http://localhost:9988/never-ends','XOkZL':function(_0x14e39a,_0x1ce134){return _0x14e39a===_0x1ce134;},'rMrHJ':function(_0x23b01d,_0x58eab8){return _0x23b01d!==_0x58eab8;},'UYimi':'rWKyb','DyCCQ':'args.1','hUufc':'cHTyw','JzEQh':'SRgZB','CyFlb':'kmUGr','WHdRm':'xyUIh','lUvos':function(_0x16b378,_0x4d5e70){return _0x16b378!==_0x4d5e70;},'bgrZd':'oJDVT','JnFzz':function(_0xda79fa,_0x3c8996){return _0xda79fa(_0x3c8996);},'EZBtc':'cXEjY','vDnAa':'does\x20not\x20retry\x20on\x20a\x20timeout','JUINr':'retries 4x on a connection reset','oLhYz':function(_0x1883e4,_0x3b9f71){return _0x1883e4(_0x3b9f71);},'TkEan':'<html></html>','jNMUq':'user-agent','cAfcW':'custom-agent','FPZuI':'derp','pgWuV':'create','DZbYL':'test','bukRD':'/never-ends','DJdyM':'/econnreset','YzIFC':'PSsOQ','jHxQD':function(_0xf30a28,_0x44e179){return _0xf30a28(_0x44e179);},'gftEH':'http://localhost:8080','txTYC':'Tqmkc','FaFPn':'BfjYV','udisJ':'retry','XgGdj':'should not reach','HwRDR':'ESOCKETTIMEDOUT','dccxK':'http://localhost:1234/','ARAew':function(_0x42a1a5,_0x5c0e03){return _0x42a1a5(_0x5c0e03);},'FUgNO':'sfBQw','TbRtU':function(_0x133bd1,_0x1762e5,_0x423b01){return _0x133bd1(_0x1762e5,_0x423b01);},'IyiTh':'koDzM','Uhdom':function(_0x53f377,_0xd976ca){return _0x53f377(_0xd976ca);},'nHvia':'retries\x20for\x20streams','XRGNU':function(_0x47e489,_0x4cab47,_0x6613a6){return _0x47e489(_0x4cab47,_0x6613a6);},'xpdgT':'retries for promises','fldAA':function(_0x58ade5,_0x335d6a){return _0x58ade5(_0x335d6a);},'eobRc':'status','oeSFm':'isOkStatusCode','AdhJk':'requestHeaders','hBaUH':function(_0x328b78,_0x11b7c2){return _0x328b78(_0x11b7c2);},'CAeiP':'hello','JXSmh':'text/html','Vvzoz':function(_0x6e1574,_0x3a922c){return _0x6e1574(_0x3a922c);},'zRHcH':'foobarbaz','LPzwZ':function(_0x160741,_0xb407d9){return _0x160741(_0xb407d9);},'RQnNl':'www.github.com','PnWcL':'http://www.github.com','ohgEJ':function(_0x3c6839,_0x51fe65){return _0x3c6839!==_0x51fe65;},'QgQMg':'ePeaB','IdFnz':'BoDwH','KxMZR':'dVJdE','NOUmg':'init','anQPN':'http://www.github.com/foo','dNZWx':function(_0x31e318,_0x5bf024){return _0x31e318===_0x5bf024;},'cdrIr':'rVWaN','pOAel':function(_0x2a1ebf,_0xbed1ec){return _0x2a1ebf(_0xbed1ec);},'NrYgg':'/foo','oQTgl':'Error: connect ECONNREFUSED 127.0.0.1:1111','RCwOB':function(_0x1e9755,_0x4b721d){return _0x1e9755(_0x4b721d);},'Odfan':'https://www.google.com/login','kvTZC':'vfMhi','TzGbV':function(_0x300697,_0x375d7d){return _0x300697(_0x375d7d);},'JaOLp':'/status.json','FTbim':'application/json','GyBWG':'http://localhost:8080/status.json','QdWvU':function(_0x323536,_0x5d05f0){return _0x323536===_0x5d05f0;},'hVMqx':'EsKGC','sKECe':'application/vnd.api+json','WXmlg':'{bad: \'json\'}','tNSJs':function(_0xe5c14a,_0x135435){return _0xe5c14a(_0x135435);},'jNxTd':'it\x20worked','ZWLPO':'EqrcG','xYlsj':'connection','TODkk':'keep-alive','WDcZb':'http://localhost:8080/foo','ZOzfA':'eBCQZ','FatkH':'sets\x20to\x20*/*\x20by\x20default','OhmCs':function(_0x112296,_0x52f9cc,_0x541696){return _0x112296(_0x52f9cc,_0x541696);},'OatCI':'can\x20override\x20accept\x20header','DuTuc':function(_0x21538e,_0x40a00a,_0x3203c8){return _0x21538e(_0x40a00a,_0x3203c8);},'miSnV':'can override Accept header','eMlIl':'MQAFw','FPhsj':'ZunJa','GsNHY':function(_0x5c49a8,_0x55adbb,_0x3418f3){return _0x5c49a8(_0x55adbb,_0x3418f3);},'JJQym':'can accept qs','ysjWX':function(_0xbcf8c8,_0x2fb1c9){return _0xbcf8c8(_0x2fb1c9);},'dSQux':'login','TxThV':function(_0x152e3d,_0x1a28fd){return _0x152e3d(_0x1a28fd);},'glIWs':function(_0x1dc47e,_0x2abf96){return _0x1dc47e!==_0x2abf96;},'onGuj':function(_0x906939,_0x48a8f7){return _0x906939(_0x48a8f7);},'mguxw':function(_0x3fe7c6,_0x21f414){return _0x3fe7c6!==_0x21f414;},'PwGeU':'TlFhf','vrcSF':'by default follow redirects','ZlFue':'follows non-GET redirects by default','JKQmz':function(_0x1c5bba,_0x220dbd,_0x7a77bb){return _0x1c5bba(_0x220dbd,_0x7a77bb);},'gLXZv':'resolves\x20redirectedToUrl\x20on\x20relative\x20redirects','lNaOc':'resolves redirectedToUrl to another domain','ydlcp':'0|3|6|2|4|7|8|5|1','FkaEo':'headers','FnZne':'duration','KgJlI':'allRequestResponses','OPtex':'requestBody','JRswY':function(_0x389aff,_0x3dda1a){return _0x389aff(_0x3dda1a);},'DWonQ':function(_0x3364c2,_0x9c6833){return _0x3364c2(_0x9c6833);},'awHjU':'cpcmD','KiQad':'6|8|2|4|5|9|1|7|3|0','Vcgwv':'/auth','ejngd':'http://www.github.com/dashboard','ktEuo':'log in','doFtn':'redirects','jtZkj':'301:\x20http://www.github.com/auth','IsdcD':'302: http://www.github.com/login','GHsni':function(_0x26c5a6,_0x4c9d3d){return _0x26c5a6(_0x4c9d3d);},'KEmfQ':function(_0x242547,_0x17c952){return _0x242547(_0x17c952);},'cEyLc':function(_0x223526,_0x2409be){return _0x223526(_0x2409be);},'TCDOB':'123','BVgmH':'text/plain','HKOWN':'pWEXQ','GRquM':'foACW','gHXSm':'quux','GFXTH':'uscSx','tnQgU':'iPddv','WuJci':function(_0x252dfc,_0xb0b7a2){return _0x252dfc!==_0xb0b7a2;},'tCIDH':'accept','kZAtP':'/headers','YHKHy':'/foo?bar=baz&q=1','FOAMO':function(_0x38ba3e,_0x5ebacf){return _0x38ba3e(_0x5ebacf);},'RSliz':'mvQWo','wbUoT':'foo=bar&baz=quux','HoFiz':function(_0x2419cb,_0x30e271){return _0x2419cb(_0x30e271);},'QpHoG':'CibYC','cahsV':function(_0x1c1457,_0x5d1c49,_0x58f370){return _0x1c1457(_0x5d1c49,_0x58f370);},'yZNeo':'dqdxN','TIXcD':'sets strictSSL=false','Jclrw':function(_0x4f7a1c,_0x5c1176,_0x4fb892){return _0x4f7a1c(_0x5c1176,_0x4fb892);},'ySGkQ':'sets simple=false','urPWB':function(_0x5a6b37,_0x347b86,_0x5ef384){return _0x5a6b37(_0x347b86,_0x5ef384);},'RIRll':'catches errors','YFZza':function(_0x5198af,_0x58eead,_0x5102bb){return _0x5198af(_0x58eead,_0x5102bb);},'KpwcX':'parses response body as json if content-type application/json response headers','XCYuq':'parses response body as json if content-type application/vnd.api+json response headers','Iskrp':'revives\x20from\x20parsing\x20bad\x20json','qexQx':function(_0x791ece,_0x24fd4d,_0x39af5a){return _0x791ece(_0x24fd4d,_0x39af5a);},'UFhew':function(_0x4ef54f,_0x44baf6,_0x2cb6d3){return _0x4ef54f(_0x44baf6,_0x2cb6d3);},'hEzQk':'sends connection: keep-alive by default','Fpyil':function(_0x3f939a,_0x4699da,_0x1264a1){return _0x3f939a(_0x4699da,_0x1264a1);},'wnrXR':'allows overriding user-agent in headers','ugsRA':function(_0x53251c,_0x11b815,_0x1e3c4a){return _0x53251c(_0x11b815,_0x1e3c4a);},'RxnXC':'accept header','iXFsD':function(_0x3244bc,_0x586be1,_0x2e1f21){return _0x3244bc(_0x586be1,_0x2e1f21);},'wrcKC':'form=true','AczrM':function(_0x310981,_0x36992b,_0x2cc01c){return _0x310981(_0x36992b,_0x2cc01c);},'gXdhY':'bad\x20headers','HIhyv':function(_0x1d56e7,_0x26b412){return _0x1d56e7(_0x26b412);},'mLjCk':function(_0x3dc863,_0x1e88a5){return _0x3dc863(_0x1e88a5);},'kFifE':function(_0x267f74,_0x8d1ad4){return _0x267f74(_0x8d1ad4);},'cvqtn':function(_0x1450ee,_0x49a2f7){return _0x1450ee(_0x49a2f7);},'ZOafo':'ukSsV','daFPL':'rBijA','okOTt':'IbFRJ','jkEXa':function(_0x330b76,_0x347c26){return _0x330b76===_0x347c26;},'lynMN':'vNqRJ','vQlmQ':function(_0x377174,_0x246bc1){return _0x377174(_0x246bc1);},'OxszI':function(_0x260fcd,_0x3f42b2,_0xcf0546){return _0x260fcd(_0x3f42b2,_0xcf0546);},'DsIjd':'gets\x20+\x20attaches\x20the\x20cookies\x20at\x20each\x20redirect','qXoLZ':function(_0xbeb9e0,_0x355874,_0x55ad72){return _0xbeb9e0(_0x355874,_0x55ad72);},'cxgwq':'is defined','thALo':function(_0x35e64c,_0x3f0fef,_0x141b3a){return _0x35e64c(_0x3f0fef,_0x141b3a);},'xiYDS':function(_0x452413,_0x536dec,_0x1fa604){return _0x452413(_0x536dec,_0x1fa604);},'zeVqG':'#create','pNcsP':'#sendStream'};beforeEach(function(){var _0x4fb938={'DsoBF':function(_0x238212,_0x3dfb90){return _0x238212(_0x3dfb90);},'QsrbM':_0x417396['XxYPD'],'uyzYq':_0x417396['BhOqp']};if(_0x417396['ZfrNh'](_0x417396['kfOcf'],_0x417396['kfOcf'])){nock('http://localhost:8080')['post'](_0x417396['qjQSD'])['reply'](0x12e,'',{'location':_0x417396['ZVnsI']})['get'](_0x417396['OMMCZ'])['reply'](0xc8,'dashboard');return request['sendPromise']({},this['fn'],{'method':_0x417396['EiOVH'],'url':_0x417396['xUHNg'],'cookies':![]})['then'](_0x3c3814=>{_0x4fb938['DsoBF'](expect,_0x3c3814['status'])['to']['eq'](0xc8);expect(_0x3c3814['body'])['to']['eq'](_0x4fb938['QsrbM']);expect(_0x3c3814)['not']['to']['have']['property'](_0x4fb938['uyzYq']);});}else{this['fn']=sinon['stub']();this['fn']['withArgs'](_0x417396['xtNoU'])['resolves']({});this['fn']['withArgs']('get:cookies')['resolves']([]);}});_0x417396['qXoLZ'](it,_0x417396['cxgwq'],()=>{var _0x26ad4b={'aWiaC':_0x417396['SKCWn'],'iXjvW':_0x417396['reDbT'],'wPVwU':function(_0x432ebc){return _0x432ebc();}};if(_0x417396['aQhed'](_0x417396['dQJvx'],_0x417396['nIQjO'])){const _0x4ac696=_0x26ad4b['wPVwU'](fn);return new Promise((_0x208797,_0x2ab172)=>{_0x4ac696['on'](_0x26ad4b['aWiaC'],_0x208797);_0x4ac696['on'](_0x26ad4b['iXjvW'],_0x2ab172);});}else{_0x417396['SpWJb'](expect,request)['to']['be']['an']('object');}});_0x417396['thALo'](context,'#getDelayForRetry',()=>{var _0x490225={'VupZL':_0x417396['NWoZg']};_0x417396['vrKHl'](it,'divides\x20by\x2010\x20when\x20delay\x20>=\x201000\x20and\x20err.code\x20=\x20ECONNREFUSED',()=>{const _0x5ac6dc=[0x1,0x2,0x3,0x4];const _0x412021=[0x0,0x3e7,0x3e8,0x7d0];const _0x4690a7={'code':_0x417396['puuzg']};const _0x214379=sinon['stub']();_0x5ac6dc['forEach'](()=>{var _0x554de9={'RvcCK':'http://localhost:9988/foo'};if(_0x490225['VupZL']===_0x490225['VupZL']){return request['getDelayForRetry']({'err':_0x4690a7,'onNext':_0x214379,'retryIntervals':_0x5ac6dc,'delaysRemaining':_0x412021});}else{return request['sendPromise']({},this['fn'],{'url':_0x554de9['RvcCK'],'cookies':![],'json':!![],'body':{'x-text':'אבגד'}});}});expect(_0x412021)['to']['be']['empty'];expect(_0x214379['args'])['to']['deep']['eq']([[0x0,0x1],[0x3e7,0x2],[0x64,0x3],[0xc8,0x4]]);});it(_0x417396['AIZLe'],()=>{const _0x29c5b7=[0x1,0x2,0x3,0x4];const _0xd86c16=[0x7d0,0x7d0,0x7d0,0x7d0];const _0x264c14={'code':_0x417396['tLEjt']};const _0x4d95bb=sinon['stub']();request['getDelayForRetry']({'err':_0x264c14,'onNext':_0x4d95bb,'retryIntervals':_0x29c5b7,'delaysRemaining':_0xd86c16});_0x417396['YJKVm'](expect,_0xd86c16)['to']['have']['length'](0x3);_0x417396['JQEHx'](expect,_0x4d95bb)['to']['be']['calledWith'](0x7d0,0x1);});_0x417396['vrKHl'](it,'calls onElse when delaysRemaining is exhausted',()=>{const _0x4151a9=[0x1,0x2,0x3,0x4];const _0x36824c=[];const _0x40267f=sinon['stub']();const _0xacd521=sinon['stub']();request['getDelayForRetry']({'onElse':_0xacd521,'onNext':_0x40267f,'retryIntervals':_0x4151a9,'delaysRemaining':_0x36824c});_0x417396['JQEHx'](expect,_0xacd521)['to']['be']['calledWithExactly']();expect(_0x40267f)['not']['to']['be']['called'];});});_0x417396['xiYDS'](context,'#setDefaults',()=>{_0x417396['TQhgQ'](it,_0x417396['rAnvZ'],()=>{const _0x16d979=[0x1,0x2,0x3,0x4];const _0x5046f8=request['setDefaults']({'retryIntervals':_0x16d979});expect(_0x5046f8['retryIntervals'])['to']['eq'](_0x16d979);_0x417396['zliol'](expect,_0x5046f8['delaysRemaining'])['not']['to']['eq'](_0x16d979);_0x417396['zliol'](expect,_0x5046f8['delaysRemaining'])['to']['deep']['eq'](_0x16d979);});it('retryIntervals to [0, 1000, 2000, 2000] by default',()=>{const _0x4f9a61=request['setDefaults']({});expect(_0x4f9a61['retryIntervals'])['to']['deep']['eq']([0x0,0x3e8,0x7d0,0x7d0]);});_0x417396['LyyYu'](it,_0x417396['dCQCp'],()=>{const _0x3310fa=[0x1];const _0x42ad32=request['setDefaults']({'delaysRemaining':_0x3310fa});_0x417396['KykHi'](expect,_0x42ad32['delaysRemaining'])['to']['eq'](_0x3310fa);});});_0x417396['xiYDS'](context,'#normalizeResponse',()=>{var _0x41ae90={'HiUrY':function(_0x46832e,_0x534986){return _0x46832e(_0x534986);},'bdGlc':_0x417396['iHDBP'],'wtpWi':'/headers','uOpPZ':_0x417396['UcyDE'],'yQrRf':function(_0x5b4266){return _0x417396['TVega'](_0x5b4266);},'EkeLD':function(_0x18b992,_0x49a0e4){return _0x417396['aZqNP'](_0x18b992,_0x49a0e4);},'xdcRU':function(_0xc19b91,_0x59c9c6){return _0x417396['vJyrv'](_0xc19b91,_0x59c9c6);}};beforeEach(function(){this['push']=sinon['stub']();});_0x417396['tNLTJ'](it,_0x417396['FKpjU'],function(){if(_0x417396['reNAo']!=='QjOXM'){_0x417396['KykHi'](expect,request['normalizeResponse'](this['push'],{'statusCode':0x194,'request':{'headers':{'foo':_0x417396['YcqtQ']},'body':_0x417396['GYrSt']}}))['to']['deep']['eq']({'status':0x194,'statusText':'Not\x20Found','isOkStatusCode':![],'requestHeaders':{'foo':'bar'},'requestBody':'body'});_0x417396['jeaEO'](expect,this['push'])['to']['be']['calledOnce'];}else{_0x41ae90['HiUrY'](nock,'http://localhost:8080')['matchHeader']('accept',_0x41ae90['bdGlc'])['get'](_0x41ae90['wtpWi'])['reply'](0xc8);return request['sendPromise']({},this['fn'],{'url':_0x41ae90['uOpPZ'],'cookies':![]})['then'](_0x51e9a3=>{expect(_0x51e9a3['status'])['to']['eq'](0xc8);});}});it(_0x417396['pxpWN'],function(){if(_0x417396['aQhed']('VuWxL','gwaJk')){_0x41ae90['yQrRf'](beginFn);_0x41ae90['EkeLD'](expect,request['create'])['to']['be']['calledOnce'];_0x41ae90['xdcRU'](expect,request['create'])['to']['be']['calledWith'](options);}else{_0x417396['jeaEO'](expect,request['normalizeResponse'](this['push'],{'foo':'bar','req':{},'originalHeaders':{},'headers':{'Content-Length':0x32},'body':'<html>foo</html>','statusCode':0xc8,'request':{'headers':{'foo':'bar'},'body':'body'}}))['to']['deep']['eq']({'body':_0x417396['JXsMU'],'headers':{'Content-Length':0x32},'status':0xc8,'statusText':'OK','isOkStatusCode':!![],'requestHeaders':{'foo':'bar'},'requestBody':_0x417396['GYrSt']});_0x417396['aZqNP'](expect,this['push'])['to']['be']['calledOnce'];}});});_0x417396['xiYDS'](context,_0x417396['zeVqG'],()=>{var _0x34cf6e={'rQkxm':function(_0x5d3cd9){return _0x417396['TVega'](_0x5d3cd9);},'wVvMB':_0x417396['jNMUq'],'bzJdi':_0x417396['cAfcW'],'lDoyS':_0x417396['FPZuI'],'sNmeC':_0x417396['pgWuV'],'ycUuT':_0x417396['DZbYL'],'ZRAJE':'http://localhost:8080/foo','CqTCZ':_0x417396['bukRD'],'uSXXG':_0x417396['DJdyM'],'obhAR':_0x417396['YzIFC'],'eBSna':function(_0x185bf6,_0x38d048){return _0x417396['jHxQD'](_0x185bf6,_0x38d048);},'ddIux':'error','MxwAk':_0x417396['GYrSt'],'PaNgW':_0x417396['JXsMU'],'lLlow':_0x417396['pxpWN'],'EcQiQ':_0x417396['xUHNg'],'GxZnd':_0x417396['gftEH'],'DESxb':_0x417396['OMMCZ'],'urPsI':_0x417396['qjQSD'],'vAXMO':function(_0x3d01c7,_0x2925eb){return _0x417396['XOkZL'](_0x3d01c7,_0x2925eb);},'zpatT':_0x417396['txTYC'],'Ldkdz':_0x417396['FaFPn'],'huUok':_0x417396['udisJ'],'DFNfz':_0x417396['XgGdj'],'wOEdP':function(_0x5825ab,_0x1d5db3){return _0x417396['jHxQD'](_0x5825ab,_0x1d5db3);},'nDxDz':_0x417396['HwRDR'],'Sadde':_0x417396['srknj'],'JQlNh':_0x417396['dccxK'],'MVcZE':function(_0x1065c2,_0x410737){return _0x417396['ARAew'](_0x1065c2,_0x410737);},'SeyoG':_0x417396['FUgNO'],'nPNkU':function(_0x2fca1f,_0x2f04fa,_0x357ef5){return _0x417396['TbRtU'](_0x2fca1f,_0x2f04fa,_0x357ef5);},'BQutl':_0x417396['JUINr']};if(_0x417396['XOkZL'](_0x417396['IyiTh'],_0x417396['IyiTh'])){_0x417396['Uhdom'](beforeEach,function(_0x3303a5){if('PSsOQ'===_0x34cf6e['obhAR']){this['hits']=0x0;this['srv']=http['createServer']((_0x144546,_0x702b50)=>{var _0x20815f={'Zouhf':function(_0x446167){return _0x34cf6e['rQkxm'](_0x446167);},'zCZzm':function(_0x1dec4e,_0x16f48f){return _0x1dec4e(_0x16f48f);},'jAJyV':function(_0x422bda,_0x360d2b){return _0x422bda(_0x360d2b);},'qTDXi':_0x34cf6e['wVvMB'],'tIajU':_0x34cf6e['bzJdi'],'WStBn':'/foo','PXUnk':_0x34cf6e['lDoyS'],'Vwcxf':_0x34cf6e['sNmeC'],'fBMYw':_0x34cf6e['ycUuT'],'sSXss':_0x34cf6e['ZRAJE']};if('zRULY'==='zRULY'){this['hits']++;switch(_0x144546['url']){case _0x34cf6e['CqTCZ']:_0x702b50['writeHead'](0xc8);return _0x702b50['write']('foo\n');case _0x34cf6e['uSXXG']:return _0x144546['socket']['destroy']();default:break;}}else{_0x20815f['jAJyV'](nock,'http://localhost:8080')['matchHeader'](_0x20815f['qTDXi'],_0x20815f['tIajU'])['get'](_0x20815f['WStBn'])['reply'](0xc8,_0x20815f['PXUnk']);sinon['spy'](request,_0x20815f['Vwcxf']);this['fn']['resolves']({});const _0x57de19={'user-agent':_0x20815f['fBMYw']};const _0x421c09={'url':_0x20815f['sSXss'],'cookies':![],'headers':{'user-agent':_0x20815f['tIajU']}};return request['sendStream'](_0x57de19,this['fn'],_0x421c09)['then'](_0x5d2f83=>{_0x20815f['Zouhf'](_0x5d2f83);_0x20815f['zCZzm'](expect,request['create'])['to']['be']['calledOnce'];_0x20815f['jAJyV'](expect,request['create'])['to']['be']['calledWith'](_0x421c09);});}});this['srv']['listen'](0x2704,_0x3303a5);}else{this['srv']=http['createServer']((_0xd30479,_0x6d96ca)=>{_0x6d96ca['writeHead'](0xc8);_0x6d96ca['end']();});this['srv']['listen'](0x2704,_0x3303a5);}});_0x417396['Uhdom'](afterEach,function(){return this['srv']['close']();});context(_0x417396['nHvia'],()=>{var _0x5b0f5e={'HhSWz':function(_0xf3e756,_0x3784a4){return _0x417396['odiHG'](_0xf3e756,_0x3784a4);},'EoJFi':_0x417396['srknj'],'aiuGR':'retry','GpukW':function(_0x188265,_0xdd22c6){return _0x417396['odiHG'](_0x188265,_0xdd22c6);},'qqGgm':function(_0x232175,_0x181d79){return _0x417396['XOkZL'](_0x232175,_0x181d79);},'mtcll':'HrYRx','ohKhU':'GPYcd','EXMKc':function(_0x115e9c,_0x847c73){return _0x417396['rMrHJ'](_0x115e9c,_0x847c73);},'LxLhg':_0x417396['UYimi'],'mEdwW':'error','yTHVm':'http://localhost:8080','qIvzR':'/status.json','dkkwS':'http://localhost:8080/status.json','qvuLm':_0x417396['DyCCQ'],'eKHMt':_0x417396['hUufc'],'MBWrz':function(_0x3a0b40,_0x7d98e0){return _0x3a0b40===_0x7d98e0;},'iiwDu':_0x417396['JzEQh'],'GghlO':_0x417396['CyFlb'],'ojmMC':_0x417396['WHdRm'],'XVxrw':function(_0x2db6e3,_0x349265){return _0x417396['lUvos'](_0x2db6e3,_0x349265);},'rjLIg':_0x417396['bgrZd'],'wQTTE':function(_0x447eae,_0x451e1c){return _0x417396['JnFzz'](_0x447eae,_0x451e1c);},'SOfNl':function(_0x3f176a,_0x492e22){return _0x3f176a(_0x492e22);},'iQTNK':'ENOTFOUND','oSwfQ':function(_0x410a6f,_0x5a3a18){return _0x417396['JnFzz'](_0x410a6f,_0x5a3a18);},'NRTfk':function(_0x496f25,_0x518e46){return _0x496f25!==_0x518e46;},'cYkqR':_0x417396['EZBtc'],'ppVNf':'http://will-never-exist.invalid.example.com'};if('agagr'!=='agagr'){const _0x56b33a=request['setDefaults']({});_0x34cf6e['eBSna'](expect,_0x56b33a['retryIntervals'])['to']['deep']['eq']([0x0,0x3e8,0x7d0,0x7d0]);}else{_0x417396['tNLTJ'](it,_0x417396['vDnAa'],()=>{var _0x41155c={'dFlWK':_0x34cf6e['ddIux'],'uuxzC':_0x34cf6e['MxwAk'],'MkXOK':_0x34cf6e['PaNgW'],'CFlDX':function(_0x3665ab,_0x2e15d6,_0x42a37c){return _0x3665ab(_0x2e15d6,_0x42a37c);},'IGefO':'sets status to statusCode and deletes statusCode','Rnfme':_0x34cf6e['lLlow'],'yJois':function(_0x97ee11,_0x2ee505){return _0x34cf6e['eBSna'](_0x97ee11,_0x2ee505);},'nnMUy':_0x34cf6e['EcQiQ'],'kXCpI':function(_0x1b39da,_0x303938){return _0x34cf6e['eBSna'](_0x1b39da,_0x303938);},'xegpv':_0x34cf6e['GxZnd'],'WmzHu':_0x34cf6e['DESxb'],'TNqvL':_0x34cf6e['urPsI'],'QdfSr':'login'};if(_0x34cf6e['vAXMO'](_0x34cf6e['zpatT'],_0x34cf6e['Ldkdz'])){var _0x3db680={'EsGPx':function(_0x28174a,_0x307858){return _0x5b0f5e['HhSWz'](_0x28174a,_0x307858);}};const _0x3a3bae=request['setDefaults']({'url':_0x5b0f5e['EoJFi'],'timeout':0x3e8});const _0x2e3829=request['create'](_0x3a3bae);let _0x385a1b=0x0;_0x2e3829['on'](_0x5b0f5e['aiuGR'],()=>{_0x385a1b++;});const _0x3adb68=Bluebird['fromCallback'](_0x4978ce=>{_0x2e3829['on'](_0x41155c['dFlWK'],_0x4978ce);});return _0x5b0f5e['GpukW'](expect,_0x3adb68)['to']['be']['rejected']['then'](_0x1deeb9=>{_0x3db680['EsGPx'](expect,_0x1deeb9['code'])['to']['eq']('ESOCKETTIMEDOUT');_0x3db680['EsGPx'](expect,_0x385a1b)['to']['eq'](0x0);});}else{const _0x216164=request['setDefaults']({'url':'http://localhost:9988/never-ends','timeout':0x3e8});const _0x4338c7=request['create'](_0x216164);let _0x1c561e=0x0;_0x4338c7['on'](_0x34cf6e['huUok'],()=>{if(_0x5b0f5e['qqGgm'](_0x5b0f5e['mtcll'],_0x5b0f5e['ohKhU'])){var _0x53f2a3={'IhzuU':'bar','xIvNn':_0x41155c['uuxzC'],'VpBNL':function(_0x26503c,_0x43e8fe){return _0x26503c(_0x43e8fe);},'BEVfb':_0x41155c['MkXOK']};beforeEach(function(){this['push']=sinon['stub']();});_0x41155c['CFlDX'](it,_0x41155c['IGefO'],function(){expect(request['normalizeResponse'](this['push'],{'statusCode':0x194,'request':{'headers':{'foo':_0x53f2a3['IhzuU']},'body':_0x53f2a3['xIvNn']}}))['to']['deep']['eq']({'status':0x194,'statusText':'Not Found','isOkStatusCode':![],'requestHeaders':{'foo':_0x53f2a3['IhzuU']},'requestBody':'body'});_0x53f2a3['VpBNL'](expect,this['push'])['to']['be']['calledOnce'];});it(_0x41155c['Rnfme'],function(){_0x53f2a3['VpBNL'](expect,request['normalizeResponse'](this['push'],{'foo':'bar','req':{},'originalHeaders':{},'headers':{'Content-Length':0x32},'body':_0x53f2a3['BEVfb'],'statusCode':0xc8,'request':{'headers':{'foo':_0x53f2a3['IhzuU']},'body':_0x53f2a3['xIvNn']}}))['to']['deep']['eq']({'body':_0x53f2a3['BEVfb'],'headers':{'Content-Length':0x32},'status':0xc8,'statusText':'OK','isOkStatusCode':!![],'requestHeaders':{'foo':_0x53f2a3['IhzuU']},'requestBody':'body'});_0x53f2a3['VpBNL'](expect,this['push'])['to']['be']['calledOnce'];});}else{_0x1c561e++;}});const _0x2c2e1f=Bluebird['fromCallback'](_0x2a5201=>{if(_0x5b0f5e['EXMKc'](_0x5b0f5e['LxLhg'],'LcBcj')){_0x4338c7['on'](_0x5b0f5e['mEdwW'],_0x2a5201);}else{var _0x502964={'RjIHC':function(_0x2228e4,_0x2380ff){return _0x41155c['yJois'](_0x2228e4,_0x2380ff);},'istzp':function(_0x14a818,_0x312192){return _0x41155c['yJois'](_0x14a818,_0x312192);},'MgQUN':_0x41155c['nnMUy']};_0x41155c['kXCpI'](nock,_0x41155c['xegpv'])['get'](_0x41155c['WmzHu'])['reply'](0x12e,'',{'location':_0x41155c['nnMUy']})['get'](_0x41155c['TNqvL'])['reply'](0xc8,_0x41155c['QdfSr']);return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/dashboard','cookies':![],'followRedirect':![]})['then'](_0x1cdc1a=>{_0x502964['RjIHC'](expect,_0x1cdc1a['status'])['to']['eq'](0x12e);_0x502964['istzp'](expect,_0x1cdc1a['body'])['to']['eq']('');_0x502964['istzp'](expect,_0x1cdc1a['redirectedToUrl'])['to']['eq'](_0x502964['MgQUN']);});}});return _0x34cf6e['eBSna'](expect,_0x2c2e1f)['to']['be']['rejected']['then'](_0x45f2a7=>{expect(_0x45f2a7['code'])['to']['eq']('ESOCKETTIMEDOUT');expect(_0x1c561e)['to']['eq'](0x0);});}});_0x417396['tNLTJ'](it,_0x417396['JUINr'],()=>{var _0x5819cd={'QOEoy':function(_0x21f199,_0x212c56){return _0x5b0f5e['GpukW'](_0x21f199,_0x212c56);},'swUHr':function(_0x233309,_0x53753f){return _0x233309!==_0x53753f;},'uQNvD':_0x5b0f5e['ojmMC']};if(_0x5b0f5e['XVxrw']('oJDVT',_0x5b0f5e['rjLIg'])){_0x5b0f5e['GpukW'](nock,_0x5b0f5e['yTHVm'])['get'](_0x5b0f5e['qIvzR'])['reply'](0xc8,'{bad:\x20\x27json\x27}',{'Content-Type':'application/json'});return request['sendPromise']({},this['fn'],{'url':_0x5b0f5e['dkkwS'],'cookies':![]})['then'](_0x35ac69=>{expect(_0x35ac69['body'])['to']['eq']('{bad:\x20\x27json\x27}');});}else{const _0x335d06={'url':'http://localhost:9988/econnreset','retryIntervals':[0x0,0x1,0x2,0x3],'timeout':0x3e8};const _0x18b646=request['create'](_0x335d06);let _0x537fe4=0x0;_0x18b646['on']('retry',()=>{var _0x3a981f={'EIofD':_0x5b0f5e['qvuLm'],'CoPzx':function(_0x23a897,_0x11ef0d){return _0x23a897(_0x11ef0d);}};if(_0x5b0f5e['EXMKc'](_0x5b0f5e['eKHMt'],_0x5b0f5e['eKHMt'])){var _0x5dfb9c={'KraUV':'set-cookie'};return _0x3a981f['CoPzx'](snapshot,{'setCalls':set['getCalls']()['map'](_0x2a4c57=>{return{'currentUrl':_0x2a4c57['args'][0x1],'setCookie':_0x2a4c57['args'][0x0]['headers'][_0x5dfb9c['KraUV']]};}),'getCalls':get['getCalls']()['map'](_0x4defad=>{return{'newUrl':_['get'](_0x4defad,_0x3a981f['EIofD'])};})});}else{_0x537fe4++;}});const _0x5cce17=Bluebird['fromCallback'](_0x58c5e0=>{var _0x2f86ea={'ZJKVs':function(_0x460eed,_0x4a7bfe){return _0x5819cd['QOEoy'](_0x460eed,_0x4a7bfe);}};if(_0x5819cd['swUHr']('xyUIh',_0x5819cd['uQNvD'])){_0x2f86ea['ZJKVs'](expect,err['message'])['to']['eq']('Error:\x20connect\x20ECONNREFUSED\x20127.0.0.1:1111');}else{_0x18b646['on']('error',_0x58c5e0);}});return expect(_0x5cce17)['to']['be']['rejected']['then'](_0x48e3cf=>{if(_0x5b0f5e['MBWrz'](_0x5b0f5e['iiwDu'],_0x5b0f5e['GghlO'])){res['writeHead'](0xc8);res['end']();}else{_0x5b0f5e['GpukW'](expect,_0x48e3cf['code'])['to']['eq']('ECONNRESET');_0x5b0f5e['GpukW'](expect,_0x537fe4)['to']['eq'](0x4);}});}});_0x417396['tNLTJ'](it,'retries\x204x\x20on\x20a\x20NXDOMAIN\x20(ENOTFOUND)',()=>{var _0x22a566={'YJhlD':_0x5b0f5e['mEdwW']};if(_0x5b0f5e['NRTfk'](_0x5b0f5e['cYkqR'],_0x5b0f5e['cYkqR'])){_0x5b0f5e['wQTTE'](expect,resp['status'])['to']['eq'](0xc8);}else{nock['enableNetConnect']();const _0xeafd1={'url':_0x5b0f5e['ppVNf'],'retryIntervals':[0x0,0x1,0x2,0x3],'timeout':0x3e8};const _0x5bfe1f=request['create'](_0xeafd1);let _0x3e010b=0x0;_0x5bfe1f['on']('retry',()=>{_0x3e010b++;});const _0x257169=Bluebird['fromCallback'](_0x3c14cc=>{_0x5bfe1f['on'](_0x22a566['YJhlD'],_0x3c14cc);});return expect(_0x257169)['to']['be']['rejected']['then'](_0x471056=>{_0x5b0f5e['SOfNl'](expect,_0x471056['code'])['to']['eq'](_0x5b0f5e['iQTNK']);_0x5b0f5e['oSwfQ'](expect,_0x3e010b)['to']['eq'](0x4);});}});}});_0x417396['XRGNU'](context,_0x417396['xpdgT'],()=>{var _0x4dd19b={'xjUjQ':function(_0x2459d8,_0x3dc7b6){return _0x34cf6e['vAXMO'](_0x2459d8,_0x3dc7b6);},'PLYyN':'dmzQi','RompI':function(_0x569f1a,_0x141cda){return _0x569f1a(_0x141cda);},'VNNye':'ECONNRESET','UazJq':function(_0x3daf28,_0x1a9c7f){return _0x34cf6e['MVcZE'](_0x3daf28,_0x1a9c7f);}};if(_0x34cf6e['SeyoG']===_0x34cf6e['SeyoG']){_0x34cf6e['nPNkU'](it,'does not retry on a timeout',function(){var _0x3cd14d={'SBTol':_0x34cf6e['DFNfz'],'ajtAl':function(_0x41eda7,_0x4003dd){return _0x34cf6e['wOEdP'](_0x41eda7,_0x4003dd);},'PoorI':_0x34cf6e['nDxDz'],'toMnW':function(_0x2938d3,_0x389109){return _0x34cf6e['wOEdP'](_0x2938d3,_0x389109);}};const _0x39750c={'url':_0x34cf6e['Sadde'],'timeout':0x64};return request['create'](_0x39750c,!![])['then'](()=>{throw new Error(_0x3cd14d['SBTol']);})['catch'](_0x645ad5=>{_0x3cd14d['ajtAl'](expect,_0x645ad5['error']['code'])['to']['eq'](_0x3cd14d['PoorI']);_0x3cd14d['toMnW'](expect,this['hits'])['to']['eq'](0x1);});});it(_0x34cf6e['BQutl'],function(){var _0x26241c={'UUkAp':'should not reach'};const _0xd0748={'url':'http://localhost:9988/econnreset','retryIntervals':[0x0,0x1,0x2,0x3],'timeout':0xfa};return request['create'](_0xd0748,!![])['then'](()=>{throw new Error(_0x26241c['UUkAp']);})['catch'](_0x10958b=>{if(_0x4dd19b['xjUjQ']('RDAqF',_0x4dd19b['PLYyN'])){return{'currentUrl':call['args'][0x1],'setCookie':call['args'][0x0]['headers']['set-cookie']};}else{_0x4dd19b['RompI'](expect,_0x10958b['error']['code'])['to']['eq'](_0x4dd19b['VNNye']);_0x4dd19b['UazJq'](expect,this['hits'])['to']['eq'](0x5);}});});}else{return request['sendPromise']({},this['fn'],{'url':_0x34cf6e['JQlNh']});}});}else{_0x417396['oLhYz'](expect,resp['status'])['to']['eq'](0xc8);_0x417396['oLhYz'](expect,resp['body'])['to']['eq'](_0x417396['TkEan']);expect(init)['not']['to']['be']['calledWithMatch']({'body':body});}});context('#sendPromise',()=>{var _0x1b42b7={'UmQhd':function(_0x3df4ff,_0x13a790){return _0x3df4ff===_0x13a790;},'njpMZ':'SOEeG','RhXVN':_0x417396['ydlcp'],'jFvLb':function(_0x1fda10,_0x5cb1d6){return _0x1fda10(_0x5cb1d6);},'XktIU':_0x417396['eobRc'],'PnLHk':_0x417396['GYrSt'],'vMiKJ':_0x417396['FkaEo'],'GkaUU':_0x417396['FnZne'],'Pngdc':_0x417396['oeSFm'],'ERGsG':'statusText','uTFez':_0x417396['KgJlI'],'Xnjkb':_0x417396['OPtex'],'ZEAHu':_0x417396['AdhJk'],'uPgcQ':_0x417396['zRHcH'],'qcsKC':'gzip, deflate','uiYtJ':_0x417396['TODkk'],'PbEkW':_0x417396['RQnNl'],'iIsVX':_0x417396['CAeiP'],'VUpPc':'text/html','bFcWK':function(_0x212f2b,_0x373598){return _0x417396['onGuj'](_0x212f2b,_0x373598);},'kVJHu':function(_0x531bf3,_0x4d6eb1){return _0x417396['onGuj'](_0x531bf3,_0x4d6eb1);},'IjHiC':'*/*','neAjH':function(_0xab1f9a,_0x36d49b){return _0x417396['onGuj'](_0xab1f9a,_0x36d49b);},'SYuHE':function(_0x4e2bf9,_0x3d9cdb){return _0x417396['JRswY'](_0x4e2bf9,_0x3d9cdb);},'kUwSB':function(_0x1fca1f,_0x425c59){return _0x417396['DWonQ'](_0x1fca1f,_0x425c59);},'qWYkn':_0x417396['anQPN'],'jfyzE':'yXiKy','kBSiQ':_0x417396['awHjU'],'ELovG':'http://www.github.com','OHlrj':'/foo','ZccrN':_0x417396['KiQad'],'DqEja':_0x417396['FTbim'],'BQAcB':_0x417396['Vcgwv'],'kWxxo':_0x417396['ejngd'],'clmiI':'http://www.github.com/auth','Evdvl':'/login','nbMsp':'http://www.github.com/login','qLZuL':_0x417396['ktEuo'],'wnAuj':function(_0x279fba,_0x3ae6e8){return _0x279fba(_0x3ae6e8);},'BPBrd':_0x417396['doFtn'],'WZPTt':_0x417396['jtZkj'],'MkrIE':_0x417396['IsdcD'],'aCIJc':function(_0x2480be,_0x17c9b3){return _0x417396['DWonQ'](_0x2480be,_0x17c9b3);},'ydSyn':function(_0x122aff,_0x4fcd8a){return _0x417396['GHsni'](_0x122aff,_0x4fcd8a);},'BVcPF':function(_0x284ff8,_0x35abf2){return _0x417396['GHsni'](_0x284ff8,_0x35abf2);},'gLyfM':'http://localhost:8080','mBGeO':_0x417396['OMMCZ'],'bWVQg':_0x417396['Odfan'],'pUyvy':_0x417396['dSQux'],'wJwxv':_0x417396['ZVnsI'],'UEdeI':function(_0x3b81be,_0x584555){return _0x417396['GHsni'](_0x3b81be,_0x584555);},'hCldL':function(_0x1db5d4,_0x423bb4){return _0x417396['KEmfQ'](_0x1db5d4,_0x423bb4);},'EytCD':function(_0x4a28e8,_0x17324e){return _0x417396['cEyLc'](_0x4a28e8,_0x17324e);},'GOqNN':_0x417396['TCDOB'],'zkjwy':_0x417396['BVgmH'],'kEFFv':'http://localhost:8080/foo','fwzqn':_0x417396['FPZuI'],'LgUWA':_0x417396['HKOWN'],'vJQAG':_0x417396['GRquM'],'kkatH':_0x417396['YcqtQ'],'ogjaP':_0x417396['gHXSm'],'KQlsK':_0x417396['jNMUq'],'PAOVs':_0x417396['cAfcW'],'lFrzu':_0x417396['DZbYL'],'yKaqY':function(_0x5d1e4a,_0xea90eb){return _0x417396['mguxw'](_0x5d1e4a,_0xea90eb);},'LnqIO':_0x417396['GFXTH'],'uvvTw':function(_0x31e252,_0x3ac3f8){return _0x31e252(_0x3ac3f8);},'snguO':'iSmPH','iPqSE':_0x417396['tnQgU'],'VFoED':'true','ArSRs':function(_0x28f30c,_0x2d7646){return _0x28f30c(_0x2d7646);},'fcudj':_0x417396['GyBWG'],'tGrDz':function(_0x55159d,_0x5e93de){return _0x417396['WuJci'](_0x55159d,_0x5e93de);},'zMwMp':'WkhxM','TkbSx':function(_0x2d2a34,_0x218ab1){return _0x417396['cEyLc'](_0x2d2a34,_0x218ab1);},'eRahH':'zILSB','rCjfq':'yuAWh','KimFO':_0x417396['tCIDH'],'KQnKu':_0x417396['kZAtP'],'nBGmR':_0x417396['UcyDE'],'AYTAm':function(_0x3715d4,_0x519317){return _0x3715d4(_0x519317);},'dQZce':_0x417396['YHKHy'],'iExfn':_0x417396['xUHNg'],'RtWHk':_0x417396['BhOqp'],'KQbdU':function(_0x3f2acf,_0x220287){return _0x417396['FOAMO'](_0x3f2acf,_0x220287);},'mvfvq':function(_0x42463b,_0x517df8){return _0x42463b(_0x517df8);},'XVcxL':_0x417396['RSliz'],'MiGoT':_0x417396['NOUmg'],'jHJgl':_0x417396['EiOVH'],'mVlbw':'application/x-www-form-urlencoded','uxlJQ':_0x417396['wbUoT'],'cYIiR':'evTwg','luDCb':function(_0xc501a6,_0x1b2441){return _0x417396['HoFiz'](_0xc501a6,_0x1b2441);},'Fmyzk':function(_0x30e39a,_0x76f39f,_0x2dbb7c){return _0x30e39a(_0x76f39f,_0x2dbb7c);},'sSpDG':'takes converts body to x-www-form-urlencoded and sets header','shntC':function(_0x26b8cc,_0x52ba5c,_0x5e6422){return _0x417396['JKQmz'](_0x26b8cc,_0x52ba5c,_0x5e6422);},'jkfgm':'does not set json=true','QxHqo':'connection','hgwUH':'iGXgy','LoJil':_0x417396['QpHoG'],'jHHjK':function(_0x48705a,_0x218866){return _0x48705a(_0x218866);},'hjWBU':function(_0x36e333,_0xcd6bd2){return _0x417396['HoFiz'](_0x36e333,_0xcd6bd2);},'NbtQh':function(_0x61d1c9,_0x366ffb,_0x5b808b){return _0x417396['cahsV'](_0x61d1c9,_0x366ffb,_0x5b808b);}};if(_0x417396['yZNeo']!==_0x417396['yZNeo']){this['push']=sinon['stub']();}else{it(_0x417396['TIXcD'],function(){var _0x28a251={'VFZts':function(_0x188636,_0x10b38a){return _0x417396['fldAA'](_0x188636,_0x10b38a);},'yBJmG':_0x417396['eobRc'],'upJeE':_0x417396['GYrSt'],'yjmtr':'duration','VeGfM':_0x417396['oeSFm'],'btyPW':'allRequestResponses','VHNLX':_0x417396['AdhJk'],'mnuVk':function(_0x65cf02,_0x45938d){return _0x417396['hBaUH'](_0x65cf02,_0x45938d);},'RdCPP':_0x417396['CAeiP'],'qpJPn':function(_0x1c9346,_0x106b6b){return _0x417396['hBaUH'](_0x1c9346,_0x106b6b);},'nWdky':_0x417396['JXSmh'],'lzQdt':function(_0x3f38a9,_0x27b7b4){return _0x417396['Vvzoz'](_0x3f38a9,_0x27b7b4);},'uNAQs':_0x417396['zRHcH'],'BWXul':function(_0x167816,_0x25ca7c){return _0x417396['LPzwZ'](_0x167816,_0x25ca7c);},'zwSjk':'gzip, deflate','WftFx':_0x417396['RQnNl'],'JBXAQ':'http://www.github.com/foo','pgJDl':_0x417396['PnWcL'],'IVEmv':'/foo','LAuso':'/status.json','XEFQg':'http://localhost:8080/status.json','OXbOo':function(_0x812db0,_0x46a9f2){return _0x417396['ohgEJ'](_0x812db0,_0x46a9f2);},'MMGKP':_0x417396['QgQMg']};if(_0x417396['IdFnz']===_0x417396['KxMZR']){_0x28a251['BWXul'](nock,_0x28a251['pgJDl'])['get'](_0x28a251['IVEmv'])['reply'](0xc8,_0x28a251['RdCPP'],{'Content-Type':_0x28a251['nWdky']});return request['sendPromise']({},this['fn'],{'url':_0x28a251['JBXAQ'],'cookies':![],'body':_0x28a251['uNAQs']})['then'](_0x4ce782=>{_0x28a251['VFZts'](expect,_0x4ce782)['to']['have']['keys'](_0x28a251['yBJmG'],_0x28a251['upJeE'],'headers',_0x28a251['yjmtr'],_0x28a251['VeGfM'],'statusText',_0x28a251['btyPW'],'requestBody',_0x28a251['VHNLX']);_0x28a251['mnuVk'](expect,_0x4ce782['status'])['to']['eq'](0xc8);_0x28a251['mnuVk'](expect,_0x4ce782['statusText'])['to']['eq']('OK');_0x28a251['mnuVk'](expect,_0x4ce782['body'])['to']['eq'](_0x28a251['RdCPP']);_0x28a251['qpJPn'](expect,_0x4ce782['headers'])['to']['deep']['eq']({'content-type':_0x28a251['nWdky']});_0x28a251['lzQdt'](expect,_0x4ce782['isOkStatusCode'])['to']['be']['true'];_0x28a251['lzQdt'](expect,_0x4ce782['requestBody'])['to']['eq'](_0x28a251['uNAQs']);_0x28a251['BWXul'](expect,_0x4ce782['requestHeaders'])['to']['deep']['eq']({'accept':'*/*','accept-encoding':_0x28a251['zwSjk'],'connection':'keep-alive','content-length':0x9,'host':_0x28a251['WftFx']});expect(_0x4ce782['allRequestResponses'])['to']['deep']['eq']([{'Request Body':_0x28a251['uNAQs'],'Request Headers':{'accept':'*/*','accept-encoding':'gzip, deflate','connection':'keep-alive','content-length':0x9,'host':_0x28a251['WftFx']},'Request URL':_0x28a251['JBXAQ'],'Response Body':_0x28a251['RdCPP'],'Response Headers':{'content-type':'text/html'},'Response Status':0xc8}]);});}else{const _0x35dcc7=sinon['spy'](request['rp']['Request']['prototype'],_0x417396['NOUmg']);_0x417396['LPzwZ'](nock,'http://www.github.com')['get']('/foo')['reply'](0xc8,'hello',{'Content-Type':_0x417396['JXSmh']});return request['sendPromise']({},this['fn'],{'url':_0x417396['anQPN'],'cookies':![]})['then'](()=>{var _0x4f95d4={'ZHhFG':'http://localhost:8080','YKhGz':_0x28a251['LAuso'],'kicnV':_0x28a251['XEFQg']};if(_0x28a251['OXbOo'](_0x28a251['MMGKP'],'ePeaB')){var _0xb0a00a={'UNBZi':function(_0x1afdd7,_0x577fe6){return _0x1afdd7(_0x577fe6);}};nock(_0x4f95d4['ZHhFG'])['get'](_0x4f95d4['YKhGz'])['reply'](0xc8,JSON['stringify']({'status':'ok'}),{'Content-Type':'application/vnd.api+json'});return request['sendPromise']({},this['fn'],{'url':_0x4f95d4['kicnV'],'cookies':![]})['then'](_0x333372=>{_0xb0a00a['UNBZi'](expect,_0x333372['body'])['to']['deep']['eq']({'status':'ok'});});}else{expect(_0x35dcc7)['to']['be']['calledWithMatch']({'strictSSL':![]});}});}});_0x417396['Jclrw'](it,_0x417396['ySGkQ'],function(){var _0x33bf49={'BaZTt':function(_0x3428fd,_0xe4edaf){return _0x417396['LPzwZ'](_0x3428fd,_0xe4edaf);}};if(_0x417396['dNZWx'](_0x417396['cdrIr'],'UkTUH')){const _0x58bacf=[0x1];const _0x25348d=request['setDefaults']({'delaysRemaining':_0x58bacf});_0x33bf49['BaZTt'](expect,_0x25348d['delaysRemaining'])['to']['eq'](_0x58bacf);}else{_0x417396['pOAel'](nock,_0x417396['PnWcL'])['get'](_0x417396['NrYgg'])['reply'](0x1f4,'');return request['sendPromise']({},this['fn'],{'url':'http://www.github.com/foo','cookies':![]});}});_0x417396['urPWB'](it,'sets resolveWithFullResponse=true',function(){var _0x2bb19e={'wuUrk':function(_0x7d42a0,_0x376116){return _0x1b42b7['kUwSB'](_0x7d42a0,_0x376116);},'kYxbE':'http://www.github.com','RvnXt':'/foo','eGrWs':_0x1b42b7['qWYkn']};if(_0x1b42b7['jfyzE']!==_0x1b42b7['kBSiQ']){nock(_0x1b42b7['ELovG'])['get'](_0x1b42b7['OHlrj'])['reply'](0xc8,'hello',{'Content-Type':_0x1b42b7['VUpPc']});return request['sendPromise']({},this['fn'],{'url':_0x1b42b7['qWYkn'],'cookies':![],'body':_0x1b42b7['uPgcQ']})['then'](_0x3574ca=>{if(_0x1b42b7['UmQhd'](_0x1b42b7['njpMZ'],_0x1b42b7['njpMZ'])){var _0x10e4dc=_0x1b42b7['RhXVN']['split']('|'),_0x1c09b5=0x0;while(!![]){switch(_0x10e4dc[_0x1c09b5++]){case'0':_0x1b42b7['jFvLb'](expect,_0x3574ca)['to']['have']['keys'](_0x1b42b7['XktIU'],_0x1b42b7['PnLHk'],_0x1b42b7['vMiKJ'],_0x1b42b7['GkaUU'],_0x1b42b7['Pngdc'],_0x1b42b7['ERGsG'],_0x1b42b7['uTFez'],_0x1b42b7['Xnjkb'],_0x1b42b7['ZEAHu']);continue;case'1':expect(_0x3574ca['allRequestResponses'])['to']['deep']['eq']([{'Request Body':_0x1b42b7['uPgcQ'],'Request Headers':{'accept':'*/*','accept-encoding':_0x1b42b7['qcsKC'],'connection':_0x1b42b7['uiYtJ'],'content-length':0x9,'host':_0x1b42b7['PbEkW']},'Request URL':'http://www.github.com/foo','Response Body':_0x1b42b7['iIsVX'],'Response Headers':{'content-type':_0x1b42b7['VUpPc']},'Response Status':0xc8}]);continue;case'2':_0x1b42b7['bFcWK'](expect,_0x3574ca['body'])['to']['eq']('hello');continue;case'3':_0x1b42b7['bFcWK'](expect,_0x3574ca['status'])['to']['eq'](0xc8);continue;case'4':_0x1b42b7['kVJHu'](expect,_0x3574ca['headers'])['to']['deep']['eq']({'content-type':_0x1b42b7['VUpPc']});continue;case'5':_0x1b42b7['kVJHu'](expect,_0x3574ca['requestHeaders'])['to']['deep']['eq']({'accept':_0x1b42b7['IjHiC'],'accept-encoding':_0x1b42b7['qcsKC'],'connection':_0x1b42b7['uiYtJ'],'content-length':0x9,'host':'www.github.com'});continue;case'6':_0x1b42b7['neAjH'](expect,_0x3574ca['statusText'])['to']['eq']('OK');continue;case'7':_0x1b42b7['SYuHE'](expect,_0x3574ca['isOkStatusCode'])['to']['be']['true'];continue;case'8':expect(_0x3574ca['requestBody'])['to']['eq']('foobarbaz');continue;}break;}}else{_0x2bb19e['wuUrk'](nock,_0x2bb19e['kYxbE'])['get'](_0x2bb19e['RvnXt'])['reply'](0x1f4,'');return request['sendPromise']({},this['fn'],{'url':_0x2bb19e['eGrWs'],'cookies':![]});}});}else{_0x1b42b7['SYuHE'](expect,err['error']['code'])['to']['eq']('ESOCKETTIMEDOUT');_0x1b42b7['SYuHE'](expect,this['hits'])['to']['eq'](0x1);}});_0x417396['urPWB'](it,'includes redirects',function(){this['fn']['resolves']();_0x1b42b7['aCIJc'](nock,_0x1b42b7['ELovG'])['get']('/dashboard')['reply'](0x12d,null,{'location':_0x1b42b7['BQAcB']})['get'](_0x1b42b7['BQAcB'])['reply'](0x12e,null,{'location':'/login'})['get']('/login')['reply'](0xc8,'log in',{'Content-Type':_0x1b42b7['VUpPc']});return request['sendPromise']({},this['fn'],{'url':_0x1b42b7['kWxxo'],'cookies':![]})['then'](_0x448ee8=>{var _0x2d6ef6=_0x1b42b7['ZccrN']['split']('|'),_0x3859cb=0x0;while(!![]){switch(_0x2d6ef6[_0x3859cb++]){case'0':expect(_0x448ee8['allRequestResponses'])['to']['deep']['eq']([{'Request Body':null,'Request Headers':{'accept':'*/*','accept-encoding':_0x1b42b7['qcsKC'],'connection':'keep-alive','host':_0x1b42b7['PbEkW']},'Request URL':'http://www.github.com/dashboard','Response Body':null,'Response Headers':{'content-type':_0x1b42b7['DqEja'],'location':_0x1b42b7['BQAcB']},'Response Status':0x12d},{'Request Body':null,'Request Headers':{'accept':_0x1b42b7['IjHiC'],'accept-encoding':'gzip, deflate','connection':_0x1b42b7['uiYtJ'],'host':_0x1b42b7['PbEkW'],'referer':_0x1b42b7['kWxxo']},'Request URL':_0x1b42b7['clmiI'],'Response Body':null,'Response Headers':{'content-type':_0x1b42b7['DqEja'],'location':_0x1b42b7['Evdvl']},'Response Status':0x12e},{'Request Body':null,'Request Headers':{'accept':'*/*','accept-encoding':_0x1b42b7['qcsKC'],'connection':_0x1b42b7['uiYtJ'],'host':_0x1b42b7['PbEkW'],'referer':'http://www.github.com/auth'},'Request URL':_0x1b42b7['nbMsp'],'Response Body':_0x1b42b7['qLZuL'],'Response Headers':{'content-type':'text/html'},'Response Status':0xc8}]);continue;case'1':expect(_0x448ee8['requestBody'])['to']['be']['undefined'];continue;case'2':expect(_0x448ee8['statusText'])['to']['eq']('OK');continue;case'3':_0x1b42b7['wnAuj'](expect,_0x448ee8['requestHeaders'])['to']['deep']['eq']({'accept':_0x1b42b7['IjHiC'],'accept-encoding':'gzip, deflate','connection':'keep-alive','referer':_0x1b42b7['clmiI'],'host':'www.github.com'});continue;case'4':expect(_0x448ee8['body'])['to']['eq'](_0x1b42b7['qLZuL']);continue;case'5':expect(_0x448ee8['headers'])['to']['deep']['eq']({'content-type':'text/html'});continue;case'6':_0x1b42b7['wnAuj'](expect,_0x448ee8)['to']['have']['keys']('status','body',_0x1b42b7['vMiKJ'],_0x1b42b7['GkaUU'],_0x1b42b7['Pngdc'],_0x1b42b7['ERGsG'],_0x1b42b7['uTFez'],_0x1b42b7['BPBrd'],_0x1b42b7['Xnjkb'],_0x1b42b7['ZEAHu']);continue;case'7':expect(_0x448ee8['redirects'])['to']['deep']['eq']([_0x1b42b7['WZPTt'],_0x1b42b7['MkrIE']]);continue;case'8':expect(_0x448ee8['status'])['to']['eq'](0xc8);continue;case'9':_0x1b42b7['aCIJc'](expect,_0x448ee8['isOkStatusCode'])['to']['be']['true'];continue;}break;}});});it(_0x417396['RIRll'],function(){var _0x17504d={'GzNvf':'should\x20have\x20failed\x20but\x20didnt','kWIWX':function(_0x1164ea,_0x4550cb){return _0x1164ea(_0x4550cb);},'PjTQP':_0x417396['oQTgl']};nock['enableNetConnect']();const _0x563d0b=Request({'timeout':0x7d0});return _0x563d0b['sendPromise']({},this['fn'],{'url':'http://localhost:1111/foo','cookies':![]})['then'](()=>{throw new Error(_0x17504d['GzNvf']);})['catch'](_0x2835a0=>{_0x17504d['kWIWX'](expect,_0x2835a0['message'])['to']['eq'](_0x17504d['PjTQP']);});});_0x417396['YFZza'](it,_0x417396['KpwcX'],function(){var _0xab6dfd={'TfOpZ':function(_0x457769,_0x9f02e8){return _0x417396['RCwOB'](_0x457769,_0x9f02e8);},'iBofq':_0x417396['Odfan']};if(_0x417396['kvTZC']!=='ZkEpg'){_0x417396['TzGbV'](nock,_0x417396['gftEH'])['get'](_0x417396['JaOLp'])['reply'](0xc8,JSON['stringify']({'status':'ok'}),{'Content-Type':_0x417396['FTbim']});return request['sendPromise']({},this['fn'],{'url':_0x417396['GyBWG'],'cookies':![]})['then'](_0xa97142=>{_0x1b42b7['ydSyn'](expect,_0xa97142['body'])['to']['deep']['eq']({'status':'ok'});});}else{_0x1b42b7['BVcPF'](nock,_0x1b42b7['gLyfM'])['get'](_0x1b42b7['mBGeO'])['reply'](0x12d,'',{'location':_0x1b42b7['bWVQg']})['get']('/login')['reply'](0xc8,_0x1b42b7['pUyvy']);return request['sendPromise']({},this['fn'],{'url':_0x1b42b7['wJwxv'],'cookies':![],'followRedirect':![]})['then'](_0x2794ee=>{expect(_0x2794ee['status'])['to']['eq'](0x12d);_0xab6dfd['TfOpZ'](expect,_0x2794ee['redirectedToUrl'])['to']['eq'](_0xab6dfd['iBofq']);});}});it(_0x417396['XCYuq'],function(){var _0x223a3e={'NDYyt':_0x417396['DyCCQ'],'gUhwL':function(_0x3cb7d2,_0x24c8cb){return _0x417396['QdWvU'](_0x3cb7d2,_0x24c8cb);},'WGBAx':_0x417396['hVMqx'],'TRdhy':function(_0x48fb0a,_0x19e7a2){return _0x417396['TzGbV'](_0x48fb0a,_0x19e7a2);}};_0x417396['TzGbV'](nock,_0x417396['gftEH'])['get']('/status.json')['reply'](0xc8,JSON['stringify']({'status':'ok'}),{'Content-Type':_0x417396['sKECe']});return request['sendPromise']({},this['fn'],{'url':_0x417396['GyBWG'],'cookies':![]})['then'](_0x4e50be=>{var _0x4f2dd3={'tVhry':_0x223a3e['NDYyt']};if(_0x223a3e['gUhwL']('ZeVvf',_0x223a3e['WGBAx'])){return{'newUrl':_['get'](call,_0x4f2dd3['tVhry'])};}else{_0x223a3e['TRdhy'](expect,_0x4e50be['body'])['to']['deep']['eq']({'status':'ok'});}});});_0x417396['YFZza'](it,_0x417396['Iskrp'],function(){_0x417396['TzGbV'](nock,_0x417396['gftEH'])['get'](_0x417396['JaOLp'])['reply'](0xc8,_0x417396['WXmlg'],{'Content-Type':_0x417396['FTbim']});return request['sendPromise']({},this['fn'],{'url':_0x417396['GyBWG'],'cookies':![]})['then'](_0xf12a08=>{var _0x5c7338={'XOkwu':'ECONNREFUSED','YGFAb':function(_0x465e6d,_0x3ff14c){return _0x465e6d(_0x3ff14c);},'SZiqC':function(_0x227af5,_0xe4dcd2){return _0x1b42b7['BVcPF'](_0x227af5,_0xe4dcd2);}};if('nTzGL'!=='nTzGL'){const _0x4f09b2=[0x1,0x2,0x3,0x4];const _0x24329b=[0x0,0x3e7,0x3e8,0x7d0];const _0x483b02={'code':_0x5c7338['XOkwu']};const _0x2cb9b4=sinon['stub']();_0x4f09b2['forEach'](()=>{return request['getDelayForRetry']({'err':_0x483b02,'onNext':_0x2cb9b4,'retryIntervals':_0x4f09b2,'delaysRemaining':_0x24329b});});_0x5c7338['YGFAb'](expect,_0x24329b)['to']['be']['empty'];_0x5c7338['SZiqC'](expect,_0x2cb9b4['args'])['to']['deep']['eq']([[0x0,0x1],[0x3e7,0x2],[0x64,0x3],[0xc8,0x4]]);}else{_0x1b42b7['UEdeI'](expect,_0xf12a08['body'])['to']['eq']('{bad:\x20\x27json\x27}');}});});_0x417396['qexQx'](it,'sets duration on response',function(){_0x1b42b7['EytCD'](nock,_0x1b42b7['gLyfM'])['get'](_0x1b42b7['OHlrj'])['delay'](0xa)['reply'](0xc8,_0x1b42b7['GOqNN'],{'Content-Type':_0x1b42b7['zkjwy']});return request['sendPromise']({},this['fn'],{'url':_0x1b42b7['kEFFv'],'cookies':![]})['then'](_0x400c8e=>{expect(_0x400c8e['duration'])['to']['be']['a']('Number');_0x1b42b7['hCldL'](expect,_0x400c8e['duration'])['to']['be']['gt'](0x0);});});_0x417396['UFhew'](it,'sends\x20up\x20user-agent\x20headers',function(){var _0x5c5eeb={'ecEML':function(_0x29746c,_0x329e40){return _0x29746c(_0x329e40);},'eCTWM':_0x1b42b7['kkatH'],'VXMoK':_0x1b42b7['ogjaP'],'EOvnK':'http://localhost:8080/login','pRzxK':_0x1b42b7['KQlsK'],'znbih':_0x1b42b7['PAOVs'],'ySCLl':'derp','AHnym':_0x1b42b7['lFrzu'],'MiaSs':_0x1b42b7['kEFFv']};if(_0x1b42b7['yKaqY'](_0x1b42b7['LnqIO'],'uscSx')){var _0x5e28ed={'JLMKT':function(_0x7fe644,_0x73f2d9){return _0x5c5eeb['ecEML'](_0x7fe644,_0x73f2d9);},'fJJAC':function(_0x5a062b,_0x237fae){return _0x5c5eeb['ecEML'](_0x5a062b,_0x237fae);}};const _0x56e736=sinon['spy'](request['rp']['Request']['prototype'],'init');const _0x4e8312={'foo':_0x5c5eeb['eCTWM'],'baz':_0x5c5eeb['VXMoK']};return request['sendPromise']({},this['fn'],{'url':_0x5c5eeb['EOvnK'],'method':'POST','cookies':![],'form':!![],'json':!![],'body':_0x4e8312})['then'](_0xa722f7=>{_0x5e28ed['JLMKT'](expect,_0xa722f7['status'])['to']['eq'](0xc8);_0x5e28ed['fJJAC'](expect,_0xa722f7['body'])['to']['eq']('<html></html>');expect(_0x56e736)['not']['to']['be']['calledWithMatch']({'body':_0x4e8312});});}else{_0x1b42b7['uvvTw'](nock,'http://localhost:8080')['matchHeader'](_0x1b42b7['KQlsK'],_0x1b42b7['uPgcQ'])['get']('/foo')['reply'](0xc8,_0x1b42b7['fwzqn']);const _0x5ce0d9={};_0x5ce0d9[_0x1b42b7['KQlsK']]=_0x1b42b7['uPgcQ'];return request['sendPromise'](_0x5ce0d9,this['fn'],{'url':_0x1b42b7['kEFFv'],'cookies':![]})['then'](_0x956f8f=>{var _0x365cad={'MtIUK':_0x1b42b7['fwzqn']};if(_0x1b42b7['LgUWA']===_0x1b42b7['vJQAG']){nock('http://localhost:8080')['matchHeader'](_0x5c5eeb['pRzxK'],_0x5c5eeb['znbih'])['get']('/foo')['reply'](0xc8,_0x5c5eeb['ySCLl']);const _0x3c4bad={'user-agent':_0x5c5eeb['AHnym']};return request['sendPromise'](_0x3c4bad,this['fn'],{'url':_0x5c5eeb['MiaSs'],'cookies':![],'headers':{'User-Agent':'custom-agent'}})['then'](_0x8d4a55=>{expect(_0x8d4a55['body'])['to']['eq'](_0x365cad['MtIUK']);});}else{expect(_0x956f8f['body'])['to']['eq']('derp');}});}});_0x417396['UFhew'](it,_0x417396['hEzQk'],function(){var _0x937ff1={'eoRBj':function(_0x37b3df,_0x2fd2e2){return _0x417396['tNSJs'](_0x37b3df,_0x2fd2e2);},'SYgjp':_0x417396['jNxTd'],'cyWkR':function(_0x4a2842,_0x18b342){return _0x417396['tNSJs'](_0x4a2842,_0x18b342);},'HciQj':function(_0x2f680c,_0x5b30f5){return _0x417396['tNSJs'](_0x2f680c,_0x5b30f5);},'higjv':_0x417396['Odfan']};if(_0x417396['QdWvU'](_0x417396['ZWLPO'],'EqrcG')){_0x417396['tNSJs'](nock,'http://localhost:8080')['matchHeader'](_0x417396['xYlsj'],_0x417396['TODkk'])['get'](_0x417396['NrYgg'])['reply'](0xc8,_0x417396['jNxTd']);return request['sendPromise']({},this['fn'],{'url':_0x417396['WDcZb'],'cookies':![]})['then'](_0x3d4425=>{_0x937ff1['eoRBj'](expect,_0x3d4425['body'])['to']['eq'](_0x937ff1['SYgjp']);});}else{_0x937ff1['cyWkR'](expect,resp['status'])['to']['eq'](0x12d);_0x937ff1['HciQj'](expect,resp['redirectedToUrl'])['to']['eq'](_0x937ff1['higjv']);}});_0x417396['Fpyil'](it,'lower\x20cases\x20headers',function(){var _0x3231c4={'BJdUY':function(_0x80c65,_0x4a1e0b){return _0x80c65(_0x4a1e0b);}};if(_0x1b42b7['snguO']!==_0x1b42b7['iPqSE']){nock(_0x1b42b7['gLyfM'])['matchHeader'](_0x1b42b7['lFrzu'],_0x1b42b7['VFoED'])['get'](_0x1b42b7['OHlrj'])['reply'](0xc8,_0x1b42b7['fwzqn']);const _0x15ff10={};_0x15ff10[_0x1b42b7['KQlsK']]=_0x1b42b7['uPgcQ'];return request['sendPromise'](_0x15ff10,this['fn'],{'url':_0x1b42b7['kEFFv'],'cookies':![],'headers':{'TEST':!![]}})['then'](_0x53e9ae=>{expect(_0x53e9ae['body'])['to']['eq'](_0x1b42b7['fwzqn']);});}else{return _0x3231c4['BJdUY'](testAttachingCookiesWith,()=>{return request['sendPromise']({},this['fn'],{'url':'http://localhost:1234/'});});}});_0x417396['Fpyil'](it,_0x417396['wnrXR'],function(){var _0x3da400={'dEVNC':function(_0x2c2c08,_0x520caf){return _0x1b42b7['ArSRs'](_0x2c2c08,_0x520caf);},'bjJHs':_0x1b42b7['fcudj'],'WuzQH':function(_0x534919,_0x51ee7a){return _0x1b42b7['tGrDz'](_0x534919,_0x51ee7a);},'NtFLr':_0x1b42b7['zMwMp'],'ffITu':_0x1b42b7['fwzqn']};_0x1b42b7['TkbSx'](nock,_0x1b42b7['gLyfM'])['matchHeader']('user-agent',_0x1b42b7['PAOVs'])['get'](_0x1b42b7['OHlrj'])['reply'](0xc8,'derp');const _0x142f05={'user-agent':_0x1b42b7['lFrzu']};return request['sendPromise'](_0x142f05,this['fn'],{'url':_0x1b42b7['kEFFv'],'cookies':![],'headers':{'User-Agent':_0x1b42b7['PAOVs']}})['then'](_0x2bfed1=>{var _0x364c62={'SOHBH':function(_0x514759,_0x5a4c7b){return _0x3da400['dEVNC'](_0x514759,_0x5a4c7b);},'JRila':'/status.json','VeUGI':_0x3da400['bjJHs']};if(_0x3da400['WuzQH'](_0x3da400['NtFLr'],'WkhxM')){_0x364c62['SOHBH'](nock,'http://localhost:8080')['get'](_0x364c62['JRila'])['reply'](0xc8,JSON['stringify']({'status':'ok'}),{'Content-Type':'application/json'});return request['sendPromise']({},this['fn'],{'url':_0x364c62['VeUGI'],'cookies':![]})['then'](_0x1c80c6=>{expect(_0x1c80c6['body'])['to']['deep']['eq']({'status':'ok'});});}else{_0x3da400['dEVNC'](expect,_0x2bfed1['body'])['to']['eq'](_0x3da400['ffITu']);}});});_0x417396['ugsRA'](context,_0x417396['RxnXC'],()=>{var _0x3bda79={'KrnJM':function(_0x58408f,_0x20a179){return _0x417396['tNSJs'](_0x58408f,_0x20a179);},'yvoVq':function(_0x576e92,_0x4c4447){return _0x576e92(_0x4c4447);},'PZNhS':_0x417396['gftEH'],'gtaPG':_0x417396['xUHNg'],'uGWym':'login','GGWlE':_0x417396['ZVnsI'],'anMhX':function(_0x22680f,_0x24b35f){return _0x417396['tNSJs'](_0x22680f,_0x24b35f);},'xjkUj':'bar','nVkeH':_0x417396['JXsMU'],'JxJTf':_0x417396['GYrSt']};if(_0x417396['QdWvU'](_0x417396['ZOzfA'],_0x417396['ZOzfA'])){it(_0x417396['FatkH'],function(){if(_0x1b42b7['tGrDz'](_0x1b42b7['eRahH'],_0x1b42b7['rCjfq'])){_0x1b42b7['TkbSx'](nock,_0x1b42b7['gLyfM'])['matchHeader'](_0x1b42b7['KimFO'],'*/*')['get'](_0x1b42b7['KQnKu'])['reply'](0xc8);return request['sendPromise']({},this['fn'],{'url':_0x1b42b7['nBGmR'],'cookies':![]})['then'](_0x1977e9=>{_0x3bda79['KrnJM'](expect,_0x1977e9['status'])['to']['eq'](0xc8);});}else{var _0x3f5959={'WVcpa':function(_0x5d7dac,_0x61c6f6){return _0x3bda79['KrnJM'](_0x5d7dac,_0x61c6f6);},'DskRB':function(_0x1a2196,_0x3607c9){return _0x1a2196(_0x3607c9);}};_0x3bda79['yvoVq'](nock,_0x3bda79['PZNhS'])['get']('/dashboard')['reply'](0x12e,'',{'location':_0x3bda79['gtaPG']})['get']('/login')['reply'](0xc8,_0x3bda79['uGWym']);return request['sendPromise']({},this['fn'],{'url':_0x3bda79['GGWlE'],'cookies':![]})['then'](_0x4a5973=>{_0x3f5959['WVcpa'](expect,_0x4a5973['status'])['to']['eq'](0xc8);_0x3f5959['DskRB'](expect,_0x4a5973)['not']['to']['have']['property']('redirectedToUrl');});}});_0x417396['OhmCs'](it,_0x417396['OatCI'],function(){var _0x2b26cf={'OdwBQ':function(_0x3b6a3c,_0x4cd409){return _0x1b42b7['TkbSx'](_0x3b6a3c,_0x4cd409);}};_0x1b42b7['TkbSx'](nock,_0x1b42b7['gLyfM'])['matchHeader']('accept','text/html')['get'](_0x1b42b7['KQnKu'])['reply'](0xc8);return request['sendPromise']({},this['fn'],{'url':_0x1b42b7['nBGmR'],'cookies':![],'headers':{'accept':_0x1b42b7['VUpPc']}})['then'](_0x32d272=>{_0x2b26cf['OdwBQ'](expect,_0x32d272['status'])['to']['eq'](0xc8);});});_0x417396['DuTuc'](it,_0x417396['miSnV'],function(){_0x1b42b7['TkbSx'](nock,'http://localhost:8080')['matchHeader']('accept',_0x1b42b7['zkjwy'])['get'](_0x1b42b7['KQnKu'])['reply'](0xc8);return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/headers','cookies':![],'headers':{'Accept':_0x1b42b7['zkjwy']}})['then'](_0x55274f=>{expect(_0x55274f['status'])['to']['eq'](0xc8);});});}else{_0x3bda79['anMhX'](expect,request['normalizeResponse'](this['push'],{'foo':_0x3bda79['xjkUj'],'req':{},'originalHeaders':{},'headers':{'Content-Length':0x32},'body':_0x3bda79['nVkeH'],'statusCode':0xc8,'request':{'headers':{'foo':_0x3bda79['xjkUj']},'body':'body'}}))['to']['deep']['eq']({'body':_0x3bda79['nVkeH'],'headers':{'Content-Length':0x32},'status':0xc8,'statusText':'OK','isOkStatusCode':!![],'requestHeaders':{'foo':'bar'},'requestBody':_0x3bda79['JxJTf']});expect(this['push'])['to']['be']['calledOnce'];}});_0x417396['iXFsD'](context,'qs',()=>{var _0x2dd02c={'cGdin':function(_0x33bd65,_0x7c825d){return _0x417396['tNSJs'](_0x33bd65,_0x7c825d);},'pIXph':_0x417396['eMlIl'],'BZBqz':function(_0x5a27b0,_0x49e25e){return _0x417396['tNSJs'](_0x5a27b0,_0x49e25e);}};if(_0x417396['FPhsj']!==_0x417396['FPhsj']){_0x2dd02c['cGdin'](expect,resp['status'])['to']['eq'](0xc8);}else{_0x417396['GsNHY'](it,_0x417396['JJQym'],function(){_0x1b42b7['AYTAm'](nock,_0x1b42b7['gLyfM'])['get'](_0x1b42b7['dQZce'])['reply'](0xc8);return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/foo','cookies':![],'qs':{'bar':'baz','q':0x1}})['then'](_0x4a0027=>{if(_0x2dd02c['pIXph']!=='iSYya'){_0x2dd02c['BZBqz'](expect,_0x4a0027['status'])['to']['eq'](0xc8);}else{expect(_0x4a0027['status'])['to']['eq'](0xc8);}});});}});context('followRedirect',()=>{var _0x211e22={'TRNfy':function(_0xccca6d,_0x3f600c){return _0x417396['tNSJs'](_0xccca6d,_0x3f600c);},'rOzCd':'vQRrG','IHpqr':function(_0x20cacd,_0x1d9de1){return _0x417396['ysjWX'](_0x20cacd,_0x1d9de1);},'xQDKL':_0x417396['BhOqp'],'CjtIG':function(_0x4301b0,_0x521a2a){return _0x4301b0(_0x521a2a);},'ktxnr':_0x417396['gftEH'],'NnYup':_0x417396['OMMCZ'],'qXwwm':'/login','OvYIL':_0x417396['dSQux'],'spdtT':_0x417396['ZVnsI'],'emeyZ':_0x417396['xUHNg'],'XjCjQ':function(_0x510af2,_0x3a2b5a){return _0x417396['TxThV'](_0x510af2,_0x3a2b5a);},'DcaXA':function(_0x36806b,_0xa251e5){return _0x417396['glIWs'](_0x36806b,_0xa251e5);},'GZaXj':'nbDWi','MzvKg':function(_0x1e9e84,_0x2d9b87){return _0x417396['onGuj'](_0x1e9e84,_0x2d9b87);},'GqKuk':function(_0x3b86f4,_0x57797e){return _0x417396['mguxw'](_0x3b86f4,_0x57797e);},'AjTSo':_0x417396['PwGeU'],'obPaV':_0x417396['Odfan']};_0x417396['onGuj'](beforeEach,function(){this['fn']['resolves']();});it(_0x417396['vrcSF'],function(){_0x211e22['CjtIG'](nock,_0x211e22['ktxnr'])['get'](_0x211e22['NnYup'])['reply'](0x12e,'',{'location':'http://localhost:8080/login'})['get'](_0x211e22['qXwwm'])['reply'](0xc8,_0x211e22['OvYIL']);return request['sendPromise']({},this['fn'],{'url':_0x211e22['spdtT'],'cookies':![],'followRedirect':!![]})['then'](_0x5d6a0c=>{var _0x2e7218={'nklTC':function(_0x5ee7c0,_0x2f623b){return _0x211e22['TRNfy'](_0x5ee7c0,_0x2f623b);},'JRgJt':function(_0x5794b5,_0x2e17fb){return _0x5794b5(_0x2e17fb);}};if(_0x211e22['rOzCd']===_0x211e22['rOzCd']){_0x211e22['IHpqr'](expect,_0x5d6a0c['status'])['to']['eq'](0xc8);_0x211e22['IHpqr'](expect,_0x5d6a0c['body'])['to']['eq']('login');_0x211e22['IHpqr'](expect,_0x5d6a0c)['not']['to']['have']['property'](_0x211e22['xQDKL']);}else{const _0x47a0e5=[0x1,0x2,0x3,0x4];const _0x44cb5c=[];const _0x482800=sinon['stub']();const _0x387d1e=sinon['stub']();request['getDelayForRetry']({'onElse':_0x387d1e,'onNext':_0x482800,'retryIntervals':_0x47a0e5,'delaysRemaining':_0x44cb5c});_0x2e7218['nklTC'](expect,_0x387d1e)['to']['be']['calledWithExactly']();_0x2e7218['JRgJt'](expect,_0x482800)['not']['to']['be']['called'];}});});_0x417396['GsNHY'](it,_0x417396['ZlFue'],function(){var _0x63c769={'pofXx':function(_0x45c3f3,_0x397ff1){return _0x45c3f3(_0x397ff1);},'OHLYD':'dashboard'};nock('http://localhost:8080')['post'](_0x1b42b7['Evdvl'])['reply'](0x12e,'',{'location':_0x1b42b7['wJwxv']})['get'](_0x1b42b7['mBGeO'])['reply'](0xc8,'dashboard');return request['sendPromise']({},this['fn'],{'method':'POST','url':_0x1b42b7['iExfn'],'cookies':![]})['then'](_0x172346=>{_0x63c769['pofXx'](expect,_0x172346['status'])['to']['eq'](0xc8);_0x63c769['pofXx'](expect,_0x172346['body'])['to']['eq'](_0x63c769['OHLYD']);expect(_0x172346)['not']['to']['have']['property']('redirectedToUrl');});});_0x417396['GsNHY'](it,'can turn off following redirects',function(){var _0x54d9a8={'LxgEw':function(_0x5993ff,_0x3cb6da){return _0x5993ff!==_0x3cb6da;},'ZHaZC':'rDlmU','uYZlM':function(_0x2f875e,_0x5c78d5){return _0x2f875e(_0x5c78d5);}};_0x211e22['CjtIG'](nock,_0x211e22['ktxnr'])['get'](_0x211e22['NnYup'])['reply'](0x12e,'',{'location':_0x211e22['emeyZ']})['get']('/login')['reply'](0xc8,'login');return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/dashboard','cookies':![],'followRedirect':![]})['then'](_0x2c7e96=>{if(_0x54d9a8['LxgEw'](_0x54d9a8['ZHaZC'],_0x54d9a8['ZHaZC'])){retries++;}else{_0x54d9a8['uYZlM'](expect,_0x2c7e96['status'])['to']['eq'](0x12e);_0x54d9a8['uYZlM'](expect,_0x2c7e96['body'])['to']['eq']('');_0x54d9a8['uYZlM'](expect,_0x2c7e96['redirectedToUrl'])['to']['eq']('http://localhost:8080/login');}});});_0x417396['JKQmz'](it,_0x417396['gLXZv'],function(){var _0xbc7ff={'DAjTt':_0x211e22['emeyZ']};if(_0x211e22['DcaXA'](_0x211e22['GZaXj'],'vIhor')){_0x211e22['MzvKg'](nock,'http://localhost:8080')['get']('/dashboard')['reply'](0x12e,'',{'location':_0x211e22['qXwwm']})['get'](_0x211e22['qXwwm'])['reply'](0xc8,_0x211e22['OvYIL']);return request['sendPromise']({},this['fn'],{'url':_0x211e22['spdtT'],'cookies':![],'followRedirect':![]})['then'](_0x1f2096=>{expect(_0x1f2096['status'])['to']['eq'](0x12e);expect(_0x1f2096['redirectedToUrl'])['to']['eq'](_0xbc7ff['DAjTt']);});}else{_0x211e22['XjCjQ'](expect,request)['to']['be']['an']('object');}});it(_0x417396['lNaOc'],function(){var _0x49f949={'ivIrB':function(_0x30fdbe,_0x2e1ae7){return _0x211e22['MzvKg'](_0x30fdbe,_0x2e1ae7);}};if(_0x211e22['GqKuk'](_0x211e22['AjTSo'],_0x211e22['AjTSo'])){_0x211e22['MzvKg'](expect,resp['body'])['to']['eq']('derp');}else{_0x211e22['MzvKg'](nock,'http://localhost:8080')['get'](_0x211e22['NnYup'])['reply'](0x12d,'',{'location':_0x211e22['obPaV']})['get']('/login')['reply'](0xc8,'login');return request['sendPromise']({},this['fn'],{'url':_0x211e22['spdtT'],'cookies':![],'followRedirect':![]})['then'](_0x3aa9f4=>{_0x49f949['ivIrB'](expect,_0x3aa9f4['status'])['to']['eq'](0x12d);_0x49f949['ivIrB'](expect,_0x3aa9f4['redirectedToUrl'])['to']['eq']('https://www.google.com/login');});}});it('does not included redirectedToUrl when following redirects',function(){var _0x397ccf={'zaUqS':function(_0x17a191,_0x1b0b4e){return _0x1b42b7['AYTAm'](_0x17a191,_0x1b0b4e);},'wkoPg':_0x1b42b7['RtWHk'],'vPfOy':function(_0x21a0b3,_0x491638){return _0x1b42b7['KQbdU'](_0x21a0b3,_0x491638);},'oACfp':_0x1b42b7['vMiKJ'],'ozNav':'duration','LpULK':_0x1b42b7['uTFez'],'WrNEy':_0x1b42b7['ZEAHu'],'kAGtn':function(_0x54307c,_0x4a971d){return _0x1b42b7['mvfvq'](_0x54307c,_0x4a971d);},'MwovW':_0x1b42b7['iIsVX'],'RZMCr':function(_0x58f633,_0x33bdd7){return _0x1b42b7['mvfvq'](_0x58f633,_0x33bdd7);},'KDsZo':_0x1b42b7['VUpPc'],'uMEJp':function(_0x22980d,_0x42b276){return _0x1b42b7['mvfvq'](_0x22980d,_0x42b276);},'sKToy':_0x1b42b7['uPgcQ'],'KwbMr':_0x1b42b7['IjHiC'],'dYKdr':'gzip,\x20deflate','OTPQI':'keep-alive','drnad':_0x1b42b7['PbEkW'],'Kdnil':function(_0x4dbfe3,_0x2d777d){return _0x4dbfe3(_0x2d777d);},'QVDdx':_0x1b42b7['qWYkn']};if(_0x1b42b7['tGrDz'](_0x1b42b7['XVcxL'],'IFheR')){_0x1b42b7['mvfvq'](nock,_0x1b42b7['gLyfM'])['get'](_0x1b42b7['mBGeO'])['reply'](0x12e,'',{'location':_0x1b42b7['iExfn']})['get'](_0x1b42b7['Evdvl'])['reply'](0xc8,_0x1b42b7['pUyvy']);return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/dashboard','cookies':![]})['then'](_0x4051f0=>{_0x397ccf['zaUqS'](expect,_0x4051f0['status'])['to']['eq'](0xc8);_0x397ccf['zaUqS'](expect,_0x4051f0)['not']['to']['have']['property'](_0x397ccf['wkoPg']);});}else{_0x397ccf['vPfOy'](expect,resp)['to']['have']['keys']('status','body',_0x397ccf['oACfp'],_0x397ccf['ozNav'],'isOkStatusCode','statusText',_0x397ccf['LpULK'],'requestBody',_0x397ccf['WrNEy']);expect(resp['status'])['to']['eq'](0xc8);_0x397ccf['vPfOy'](expect,resp['statusText'])['to']['eq']('OK');_0x397ccf['kAGtn'](expect,resp['body'])['to']['eq'](_0x397ccf['MwovW']);_0x397ccf['RZMCr'](expect,resp['headers'])['to']['deep']['eq']({'content-type':_0x397ccf['KDsZo']});_0x397ccf['uMEJp'](expect,resp['isOkStatusCode'])['to']['be']['true'];_0x397ccf['uMEJp'](expect,resp['requestBody'])['to']['eq'](_0x397ccf['sKToy']);_0x397ccf['uMEJp'](expect,resp['requestHeaders'])['to']['deep']['eq']({'accept':_0x397ccf['KwbMr'],'accept-encoding':_0x397ccf['dYKdr'],'connection':_0x397ccf['OTPQI'],'content-length':0x9,'host':_0x397ccf['drnad']});_0x397ccf['Kdnil'](expect,resp['allRequestResponses'])['to']['deep']['eq']([{'Request Body':_0x397ccf['sKToy'],'Request Headers':{'accept':_0x397ccf['KwbMr'],'accept-encoding':_0x397ccf['dYKdr'],'connection':'keep-alive','content-length':0x9,'host':_0x397ccf['drnad']},'Request URL':_0x397ccf['QVDdx'],'Response Body':_0x397ccf['MwovW'],'Response Headers':{'content-type':_0x397ccf['KDsZo']},'Response Status':0xc8}]);}});_0x417396['JKQmz'](it,'gets + attaches the cookies at each redirect',function(){var _0x3bd726={'mDMvU':'http://localhost:1234/'};return _0x1b42b7['mvfvq'](testAttachingCookiesWith,()=>{return request['sendPromise']({},this['fn'],{'url':_0x3bd726['mDMvU']});});});});_0x417396['iXFsD'](context,_0x417396['wrcKC'],()=>{var _0x26cb98={'aRScd':function(_0x266307,_0x1a7d50){return _0x1b42b7['mvfvq'](_0x266307,_0x1a7d50);},'uMiUH':'Content-Type','UJXmn':_0x1b42b7['mVlbw'],'mGXSj':_0x1b42b7['Evdvl'],'zKvVj':_0x1b42b7['uxlJQ'],'CzOYH':'<html></html>','ASAgJ':_0x1b42b7['iExfn'],'YDqWL':_0x1b42b7['jHJgl'],'LimGp':'bar','HmVkQ':_0x1b42b7['ogjaP'],'hJzfa':function(_0x23ece6,_0x42a73a){return _0x1b42b7['tGrDz'](_0x23ece6,_0x42a73a);},'Ekshj':_0x1b42b7['cYIiR'],'Bfmqt':function(_0x3170ff,_0x964825){return _0x1b42b7['mvfvq'](_0x3170ff,_0x964825);},'BGviS':function(_0x6596a9,_0x18ee35){return _0x1b42b7['luDCb'](_0x6596a9,_0x18ee35);}};_0x1b42b7['luDCb'](beforeEach,()=>{_0x26cb98['aRScd'](nock,'http://localhost:8080')['matchHeader'](_0x26cb98['uMiUH'],_0x26cb98['UJXmn'])['post'](_0x26cb98['mGXSj'],_0x26cb98['zKvVj'])['reply'](0xc8,_0x26cb98['CzOYH']);});_0x1b42b7['Fmyzk'](it,_0x1b42b7['sSpDG'],function(){var _0x15fc8d={'OkiTd':function(_0x30a537,_0x23a60d){return _0x26cb98['aRScd'](_0x30a537,_0x23a60d);}};return request['sendPromise']({},this['fn'],{'url':_0x26cb98['ASAgJ'],'method':_0x26cb98['YDqWL'],'cookies':![],'form':!![],'body':{'foo':_0x26cb98['LimGp'],'baz':_0x26cb98['HmVkQ']}})['then'](_0x9edd3d=>{_0x15fc8d['OkiTd'](expect,_0x9edd3d['status'])['to']['eq'](0xc8);expect(_0x9edd3d['body'])['to']['eq']('<html></html>');});});_0x1b42b7['shntC'](it,'does not send body',function(){const _0x53c6a4=sinon['spy'](request['rp']['Request']['prototype'],'init');const _0x3b9e4d={'foo':'bar','baz':'quux'};return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/login','method':_0x26cb98['YDqWL'],'cookies':![],'form':!![],'json':!![],'body':_0x3b9e4d})['then'](_0x5a2a78=>{var _0x1370be={'mgmQx':function(_0x41d8d8,_0x567692){return _0x26cb98['aRScd'](_0x41d8d8,_0x567692);}};if(_0x26cb98['hJzfa'](_0x26cb98['Ekshj'],_0x26cb98['Ekshj'])){_0x1370be['mgmQx'](expect,_0x5a2a78['status'])['to']['eq'](0xc8);}else{_0x26cb98['aRScd'](expect,_0x5a2a78['status'])['to']['eq'](0xc8);expect(_0x5a2a78['body'])['to']['eq'](_0x26cb98['CzOYH']);_0x26cb98['aRScd'](expect,_0x53c6a4)['not']['to']['be']['calledWithMatch']({'body':_0x3b9e4d});}});});_0x1b42b7['shntC'](it,_0x1b42b7['jkfgm'],function(){const _0x40e064=sinon['spy'](request['rp']['Request']['prototype'],_0x1b42b7['MiGoT']);return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/login','method':_0x1b42b7['jHJgl'],'cookies':![],'form':!![],'json':!![],'body':{'foo':'bar','baz':_0x1b42b7['ogjaP']}})['then'](_0x409d50=>{_0x26cb98['Bfmqt'](expect,_0x409d50['status'])['to']['eq'](0xc8);_0x26cb98['Bfmqt'](expect,_0x409d50['body'])['to']['eq']('<html></html>');_0x26cb98['BGviS'](expect,_0x40e064)['not']['to']['be']['calledWithMatch']({'json':!![]});});});});_0x417396['AczrM'](context,_0x417396['gXdhY'],()=>{var _0x2caf0f={'rkxZd':function(_0x3a44a1,_0x5cd4d5){return _0x3a44a1(_0x5cd4d5);},'UuQjE':'ESOCKETTIMEDOUT','pDyyv':function(_0x404398,_0x1770aa){return _0x1b42b7['UmQhd'](_0x404398,_0x1770aa);},'KNdUv':_0x1b42b7['LoJil'],'RESwu':function(_0x3128d2,_0x91eb52){return _0x3128d2!==_0x91eb52;}};_0x1b42b7['jHHjK'](beforeEach,function(_0x83a17d){this['srv']=http['createServer']((_0x15195f,_0x1dd30f)=>{_0x1dd30f['writeHead'](0xc8);_0x1dd30f['end']();});this['srv']['listen'](0x2704,_0x83a17d);});_0x1b42b7['hjWBU'](afterEach,function(){return this['srv']['close']();});_0x1b42b7['NbtQh'](it,'recovers from bad headers',function(){var _0x96ad2e={'USJcR':function(_0x3f4f6b,_0x366890){return _0x2caf0f['rkxZd'](_0x3f4f6b,_0x366890);},'eGZae':_0x2caf0f['UuQjE'],'BaeTE':function(_0x5c819e,_0x5b241a){return _0x2caf0f['rkxZd'](_0x5c819e,_0x5b241a);},'WbOjb':function(_0x574ab4,_0x1698e6){return _0x2caf0f['pDyyv'](_0x574ab4,_0x1698e6);},'CDeRW':_0x2caf0f['KNdUv'],'dhAmW':'TypeError [ERR_INVALID_CHAR]: Invalid character in header content ["x-text"]'};if(_0x2caf0f['RESwu']('tMjiu','tMjiu')){return request['getDelayForRetry']({'err':err,'onNext':onNext,'retryIntervals':retryIntervals,'delaysRemaining':delaysRemaining});}else{return request['sendPromise']({},this['fn'],{'url':'http://localhost:9988/foo','cookies':![],'headers':{'x-text':'אבגד'}})['then'](()=>{throw new Error('should have failed');})['catch'](_0x4cddb3=>{if(_0x96ad2e['WbOjb'](_0x96ad2e['CDeRW'],_0x96ad2e['CDeRW'])){expect(_0x4cddb3['message'])['to']['eq'](_0x96ad2e['dhAmW']);}else{_0x96ad2e['USJcR'](expect,_0x4cddb3['code'])['to']['eq'](_0x96ad2e['eGZae']);_0x96ad2e['BaeTE'](expect,retries)['to']['eq'](0x0);}});}});_0x1b42b7['NbtQh'](it,'handles\x20weird\x20content\x20in\x20the\x20body\x20just\x20fine',function(){var _0x45cceb={'xzWkF':'it\x20worked','ILYtd':function(_0x5075da,_0x283643){return _0x1b42b7['luDCb'](_0x5075da,_0x283643);},'CSrTT':_0x1b42b7['QxHqo'],'ZRxgv':_0x1b42b7['uiYtJ'],'JqKNT':_0x1b42b7['OHlrj'],'udKDe':_0x1b42b7['kEFFv']};if('iGXgy'===_0x1b42b7['hgwUH']){return request['sendPromise']({},this['fn'],{'url':'http://localhost:9988/foo','cookies':![],'json':!![],'body':{'x-text':'אבגד'}});}else{_0x45cceb['ILYtd'](nock,'http://localhost:8080')['matchHeader'](_0x45cceb['CSrTT'],_0x45cceb['ZRxgv'])['get'](_0x45cceb['JqKNT'])['reply'](0xc8,_0x45cceb['xzWkF']);return request['sendPromise']({},this['fn'],{'url':_0x45cceb['udKDe'],'cookies':![]})['then'](_0x4c3216=>{expect(_0x4c3216['body'])['to']['eq'](_0x45cceb['xzWkF']);});}});});}});context(_0x417396['pNcsP'],()=>{_0x417396['OxszI'](it,_0x417396['wnrXR'],function(){var _0x3fb4b3={'GTtYn':'http://localhost:8080','xJOjy':'accept','KVlBu':'text/html','YgTcL':'/headers','sLwTx':'http://localhost:8080/headers','ExeIt':function(_0xc71a98,_0x260c68){return _0xc71a98(_0x260c68);},'QcCyq':function(_0x202c53,_0x5db6ab){return _0x417396['QdWvU'](_0x202c53,_0x5db6ab);},'CrECo':function(_0x2ab24d){return _0x417396['TVega'](_0x2ab24d);}};_0x417396['HIhyv'](nock,_0x417396['gftEH'])['matchHeader'](_0x417396['jNMUq'],_0x417396['cAfcW'])['get']('/foo')['reply'](0xc8,'derp');sinon['spy'](request,'create');this['fn']['resolves']({});const _0x13c8f3={'user-agent':_0x417396['DZbYL']};const _0x3c2048={'url':_0x417396['WDcZb'],'cookies':![],'headers':{'user-agent':_0x417396['cAfcW']}};return request['sendStream'](_0x13c8f3,this['fn'],_0x3c2048)['then'](_0x56cbb9=>{var _0x151cce={'cUOhx':function(_0x3cfe79,_0x582098){return _0x3fb4b3['ExeIt'](_0x3cfe79,_0x582098);}};if(_0x3fb4b3['QcCyq']('rEvkL','rEvkL')){_0x3fb4b3['CrECo'](_0x56cbb9);_0x3fb4b3['ExeIt'](expect,request['create'])['to']['be']['calledOnce'];_0x3fb4b3['ExeIt'](expect,request['create'])['to']['be']['calledWith'](_0x3c2048);}else{nock(_0x3fb4b3['GTtYn'])['matchHeader'](_0x3fb4b3['xJOjy'],_0x3fb4b3['KVlBu'])['get'](_0x3fb4b3['YgTcL'])['reply'](0xc8);return request['sendPromise']({},this['fn'],{'url':_0x3fb4b3['sLwTx'],'cookies':![],'headers':{'accept':_0x3fb4b3['KVlBu']}})['then'](_0x4c6993=>{_0x151cce['cUOhx'](expect,_0x4c6993['status'])['to']['eq'](0xc8);});}});});it(_0x417396['DsIjd'],function(){var _0x32d215={'mCnpw':function(_0x1e106f,_0x25c0a9){return _0x417396['mLjCk'](_0x1e106f,_0x25c0a9);},'sVZcY':function(_0x13fa73,_0x19ce81){return _0x417396['kFifE'](_0x13fa73,_0x19ce81);},'owHDq':_0x417396['tLEjt'],'KVVjD':'http://localhost:9988/econnreset','DXacO':'retry','jVCHb':function(_0x4ea265,_0x561af1){return _0x417396['kFifE'](_0x4ea265,_0x561af1);},'MdXAO':function(_0x50fbbf,_0x337ed2){return _0x417396['cvqtn'](_0x50fbbf,_0x337ed2);},'qdpHg':_0x417396['gftEH'],'sfgSM':_0x417396['qjQSD'],'jeAeq':_0x417396['dSQux'],'aWLPo':_0x417396['ZOafo'],'Uewzy':function(_0x598750){return _0x417396['TVega'](_0x598750);},'cbcSL':'error','VZMHS':function(_0xe14ada,_0x36328c){return _0x417396['QdWvU'](_0xe14ada,_0x36328c);},'rNgnl':_0x417396['daFPL'],'ynCtF':_0x417396['okOTt'],'zNcNo':'http://localhost:1234/'};if(_0x417396['jkEXa']('AKvME',_0x417396['lynMN'])){_0x32d215['mCnpw'](expect,resp['duration'])['to']['be']['a']('Number');_0x32d215['sVZcY'](expect,resp['duration'])['to']['be']['gt'](0x0);}else{return _0x417396['vQlmQ'](testAttachingCookiesWith,()=>{var _0x51aae2={'xuVMb':_0x32d215['cbcSL']};if(_0x32d215['VZMHS'](_0x32d215['rNgnl'],_0x32d215['ynCtF'])){var _0x53de64={'LeMyv':function(_0x5d8b7f,_0x25505a){return _0x5d8b7f(_0x25505a);},'zavJE':_0x32d215['owHDq']};const _0x5c9912={'url':_0x32d215['KVVjD'],'retryIntervals':[0x0,0x1,0x2,0x3],'timeout':0x3e8};const _0x2ba5a6=request['create'](_0x5c9912);let _0x1b6869=0x0;_0x2ba5a6['on'](_0x32d215['DXacO'],()=>{_0x1b6869++;});const _0x99d13d=Bluebird['fromCallback'](_0x2b3c82=>{_0x2ba5a6['on']('error',_0x2b3c82);});return _0x32d215['jVCHb'](expect,_0x99d13d)['to']['be']['rejected']['then'](_0x277ad4=>{_0x53de64['LeMyv'](expect,_0x277ad4['code'])['to']['eq'](_0x53de64['zavJE']);_0x53de64['LeMyv'](expect,_0x1b6869)['to']['eq'](0x4);});}else{return request['sendStream']({},this['fn'],{'url':_0x32d215['zNcNo'],'followRedirect':_['stubTrue']})['then'](_0x48181c=>{var _0x5395d8={'mGyqj':function(_0x2ee080,_0x137567){return _0x32d215['MdXAO'](_0x2ee080,_0x137567);},'pOtWD':function(_0xafce61,_0xb95dee){return _0x32d215['MdXAO'](_0xafce61,_0xb95dee);},'RedLb':function(_0x172023,_0x3fa388){return _0x172023(_0x3fa388);},'kQtOV':_0x32d215['qdpHg'],'yXQQK':_0x32d215['sfgSM'],'qFGfo':_0x32d215['jeAeq']};if(_0x32d215['aWLPo']!=='ukSsV'){_0x5395d8['RedLb'](nock,_0x5395d8['kQtOV'])['get']('/dashboard')['reply'](0x12e,'',{'location':_0x5395d8['yXQQK']})['get']('/login')['reply'](0xc8,_0x5395d8['qFGfo']);return request['sendPromise']({},this['fn'],{'url':'http://localhost:8080/dashboard','cookies':![],'followRedirect':![]})['then'](_0x548a43=>{_0x5395d8['mGyqj'](expect,_0x548a43['status'])['to']['eq'](0x12e);_0x5395d8['pOtWD'](expect,_0x548a43['redirectedToUrl'])['to']['eq']('http://localhost:8080/login');});}else{const _0x38f4b7=_0x32d215['Uewzy'](_0x48181c);return new Promise((_0x184e4e,_0x16c7b8)=>{_0x38f4b7['on']('response',_0x184e4e);_0x38f4b7['on'](_0x51aae2['xuVMb'],_0x16c7b8);});}});}});}});});});