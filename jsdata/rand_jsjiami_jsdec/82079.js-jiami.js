const Promise=require('bluebird');const ObjectId=require('bson-objectid');const _=require('lodash');const logging=require('@tryghost/logging');module['exports']['config']={'transaction':!![],'irreversible':!![]};module['exports']['up']=_0x351103=>{var _0x5aa425={'yoAkH':function(_0x1790b8,_0x261e96){return _0x1790b8!==_0x261e96;},'FLUgI':'VXtpd','ukgHJ':'Skipping populating members table: found 0 subscribers','hcgdD':'dMwIu','Eiaey':function(_0x3db770){return _0x3db770();},'YaBbw':'ycngn','yxtPo':'mvxAL','EdsTe':'xhCVN','hxpYc':'created_at','HRcxv':'created_by','dfYtr':'updated_by'};const _0x2ce511=_['merge']({'context':{'internal':!![]},'migrating':!![]},_0x351103);const _0x2b33da=['name','email',_0x5aa425['hxpYc'],_0x5aa425['HRcxv'],'updated_at',_0x5aa425['dfYtr']];return _0x2ce511['transacting']('subscribers')['select']()['then'](_0x97a30=>{var _0x174364={'yFSuA':function(_0xc7874,_0x36339f){return _0xc7874!==_0x36339f;},'WAHYC':_0x5aa425['hcgdD'],'zdrAG':function(_0x14cb9b){return _0x5aa425['Eiaey'](_0x14cb9b);},'WdZjc':function(_0x2994b6){return _0x5aa425['Eiaey'](_0x2994b6);}};if(_0x5aa425['yoAkH'](_0x5aa425['YaBbw'],_0x5aa425['YaBbw'])){return Promise['reject']();}else{if(_0x97a30&&_0x97a30['length']>0x0){logging['info']('Adding '+_0x97a30['length']+' entries to members');let _0x405dd2=_['map'](_0x97a30,_0xfa6816=>{let _0x228440=_0x2b33da['reduce'](function(_0x2f886a,_0x53acf2){if(_0x174364['yFSuA']('dMwIu',_0x174364['WAHYC'])){return _0x2ce511['transacting']('members')['insert'](_0x228440);}else{return Object['assign'](_0x2f886a,{[_0x53acf2]:_0xfa6816[_0x53acf2]});}},{});_0x228440['id']=_0x174364['zdrAG'](ObjectId)['toHexString']();return _0x228440;});return Promise['map'](_0x405dd2,_0xa90288=>{if(_0x5aa425['yoAkH'](_0x5aa425['FLUgI'],_0x5aa425['FLUgI'])){let _0xb01ae3=_0x2b33da['reduce'](function(_0xf5c688,_0x352cba){return Object['assign'](_0xf5c688,{[_0x352cba]:subscriber[_0x352cba]});},{});_0xb01ae3['id']=_0x174364['WdZjc'](ObjectId)['toHexString']();return _0xb01ae3;}else{return _0x2ce511['transacting']('members')['insert'](_0xa90288);}});}else{if(_0x5aa425['yxtPo']!==_0x5aa425['EdsTe']){logging['info'](_0x5aa425['ukgHJ']);return Promise['resolve']();}else{logging['info'](_0x5aa425['ukgHJ']);return Promise['resolve']();}}}});};module['exports']['down']=()=>{return Promise['reject']();};