'use strict';const _=require('lodash');const yup=require('yup');const {formatYupErrors,nameToSlug}=require('strapi-utils');const pluralize=require('pluralize');const {modelTypes,DEFAULT_TYPES,typeKinds}=require('../../services/constants');const createSchema=require('./model-schema');const {removeEmptyDefaults,removeDeletedUIDTargetFields}=require('./data-transform');const {nestedComponentSchema}=require('./component');const VALID_RELATIONS={[typeKinds['SINGLE_TYPE']]:['oneWay','manyWay'],[typeKinds['COLLECTION_TYPE']]:['oneWay','manyWay','oneToOne','oneToMany','manyToOne','manyToMany']};const VALID_TYPES=[...DEFAULT_TYPES,'uid','component','dynamiczone'];const createContentTypeSchema=(_0x26fa22,{isEdition=![]}={})=>{var _0x112649={'Pginm':'contentType.kind','sbECb':function(_0x4123f9,_0x266f54,_0x22e6a5,_0x244e9c){return _0x4123f9(_0x266f54,_0x22e6a5,_0x244e9c);},'gMOSz':function(_0x252f76,_0x251cdc){return _0x252f76(_0x251cdc);},'viMWg':function(_0x21258e){return _0x21258e();}};const _0x2de05d=_['get'](_0x26fa22,_0x112649['Pginm'],typeKinds['COLLECTION_TYPE']);const _0x2c919a=_0x112649['sbECb'](createSchema,VALID_TYPES,VALID_RELATIONS[_0x2de05d]||[],{'modelType':modelTypes['CONTENT_TYPE']})['shape']({'name':yup['string']()['test'](hasPluralName)['test'](_0x112649['gMOSz'](alreadyUsedContentTypeName,isEdition))['test'](_0x112649['viMWg'](forbiddenContentTypeNameValidator))['min'](0x1)['required']()});return yup['object']({'contentType':_0x2c919a['required']()['noUnknown'](),'components':nestedComponentSchema})['noUnknown']();};const validateContentTypeInput=_0x4afa86=>{return createContentTypeSchema(_0x4afa86)['validate'](_0x4afa86,{'strict':!![],'abortEarly':![]})['catch'](_0x478894=>Promise['reject'](formatYupErrors(_0x478894)));};const validateUpdateContentTypeInput=_0x5bfd57=>{var _0x406d19={'GlSvD':'uid','OxEIQ':function(_0x587ae5,_0x243d98){return _0x587ae5(_0x243d98);},'mtUgx':function(_0x6057af,_0x25ef81){return _0x6057af===_0x25ef81;},'LaOit':'QWVtA','xbAmz':'kjLva','oNMas':function(_0x4046f6,_0xc7e4ad){return _0x4046f6(_0xc7e4ad);},'FkHpo':'components','DkkcS':function(_0x224bc5,_0x441501){return _0x224bc5===_0x441501;},'vPafX':'pqrMp'};if(_['has'](_0x5bfd57,'contentType')){if(_0x406d19['mtUgx'](_0x406d19['LaOit'],_0x406d19['xbAmz'])){_0x5bfd57['components']['forEach'](_0x3ac1cb=>{if(_['has'](_0x3ac1cb,_0x406d19['GlSvD'])){_0x406d19['OxEIQ'](removeEmptyDefaults,_0x3ac1cb);}});}else{_0x406d19['oNMas'](removeEmptyDefaults,_0x5bfd57['contentType']);}}if(_['has'](_0x5bfd57,_0x406d19['FkHpo'])&&Array['isArray'](_0x5bfd57['components'])){if(_0x406d19['DkkcS'](_0x406d19['vPafX'],_0x406d19['vPafX'])){_0x5bfd57['components']['forEach'](_0x5bfd57=>{if(_['has'](_0x5bfd57,'uid')){removeEmptyDefaults(_0x5bfd57);}});}else{if(isEdition)return!![];if(usedNames['includes'](_0x406d19['OxEIQ'](nameToSlug,value))){return![];}return!![];}}removeDeletedUIDTargetFields(_0x5bfd57['contentType']);return createContentTypeSchema(_0x5bfd57,{'isEdition':!![]})['validate'](_0x5bfd57,{'strict':!![],'abortEarly':![]})['catch'](_0x5b5292=>Promise['reject'](formatYupErrors(_0x5b5292)));};const forbiddenContentTypeNameValidator=()=>{var _0x7fae75={'zMhhn':function(_0x14e533,_0x258c86){return _0x14e533(_0x258c86);},'aHbwp':'content-type-builder','VduHG':'forbiddenContentTypeName'};const _0x24b05e=strapi['plugins'][_0x7fae75['aHbwp']]['services']['builder']['getReservedNames']()['models'];return{'name':_0x7fae75['VduHG'],'message':'Content Type name cannot be one of '+_0x24b05e['join'](',\x20'),'test':_0x3c2e12=>{if(_0x24b05e['includes'](_0x7fae75['zMhhn'](nameToSlug,_0x3c2e12))){return![];}return!![];}};};const hasPluralName={'name':'hasPluralName','message':'Content Type name `${value}` cannot be pluralized. \nSuggestion: add Item after the name (e.g News -> NewsItem).','test':_0x4080b2=>{var _0x551eb1={'TkoJb':function(_0x58bd43,_0xa1448e){return _0x58bd43===_0xa1448e;},'wJHdj':function(_0x2feba4,_0x548a97){return _0x2feba4===_0x548a97;},'IPLjZ':'Vfmgm'};if(_0x551eb1['TkoJb'](pluralize['singular'](_0x4080b2),pluralize(_0x4080b2))){if(_0x551eb1['wJHdj']('Vfmgm',_0x551eb1['IPLjZ'])){return![];}else{return![];}}return!![];}};const alreadyUsedContentTypeName=_0xf252b9=>{var _0xfbd19a={'ARBAp':function(_0xe5799c,_0xaef5c9){return _0xe5799c===_0xaef5c9;},'EdiLS':'woneK','qwNZS':'npqJj','odAMl':'nameAlreadyUsed'};const _0x270938=Object['values'](strapi['contentTypes'])['map'](_0x4635cb=>_0x4635cb['modelName']);return{'name':_0xfbd19a['odAMl'],'message':'Content\x20Type\x20name\x20`${value}`\x20is\x20already\x20being\x20used.','test':_0x289f53=>{if(_0xfbd19a['ARBAp'](_0xfbd19a['EdiLS'],_0xfbd19a['qwNZS'])){return![];}else{if(_0xf252b9)return!![];if(_0x270938['includes'](nameToSlug(_0x289f53))){return![];}return!![];}}};};const validateKind=_0x1d9292=>{return yup['string']()['oneOf']([typeKinds['SINGLE_TYPE'],typeKinds['COLLECTION_TYPE']])['validate'](_0x1d9292)['catch'](_0x47ebcd=>Promise['reject'](formatYupErrors(_0x47ebcd)));};module['exports']={'validateContentTypeInput':validateContentTypeInput,'validateUpdateContentTypeInput':validateUpdateContentTypeInput,'validateKind':validateKind};