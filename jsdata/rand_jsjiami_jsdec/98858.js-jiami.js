'use strict';/* eslint-disable no-unused-expressions */const _=require('lodash');const chai=require('chai');const path=require('path');const fs=require('fs-extra');const os=require('os');const proxyquire=require('proxyquire');const sinon=require('sinon');const overrideEnv=require('process-utils/override-env');const AwsProvider=require('../../../../../lib/plugins/aws/provider');const Serverless=require('../../../../../lib/Serverless');const runServerless=require('../../../../utils/run-serverless');chai['use'](require('chai-as-promised'));chai['use'](require('sinon-chai'));const expect=chai['expect'];describe('AwsProvider',()=>{var _0x457846={'mFkIb':function(_0x3c03ce){return _0x3c03ce();},'MhvLQ':function(_0x2d4de9,_0xcc3ffd){return _0x2d4de9(_0xcc3ffd);},'fHfXs':function(_0x42dec7,_0x4affa0){return _0x42dec7!==_0x4affa0;},'DQNBJ':'mUwOz','nVFnH':function(_0x35ed4c,_0x4733c7){return _0x35ed4c(_0x4733c7);},'PRklh':'aws','mxbve':'foo','jzXek':function(_0x56d55e,_0x276ae6){return _0x56d55e(_0x276ae6);},'CILce':'my-stage','daMYE':'my_stage','aceXZ':'env','xrlNP':'secret','ntOEn':'my.deployment.bucket','dQxip':'zQyPO','btxun':'should do nothing if not defined','UhAGF':function(_0x262a8c,_0x484d55,_0x31df66){return _0x262a8c(_0x484d55,_0x31df66);},'jVVQV':'should\x20do\x20nothing\x20if\x20the\x20value\x20is\x20a\x20string','DXwnZ':function(_0x10c2ba,_0x2486da){return _0x10c2ba(_0x2486da);},'BomDN':'should set Serverless instance','RTcce':function(_0x2dc32c,_0x389b0a,_0x5abad5){return _0x2dc32c(_0x389b0a,_0x5abad5);},'EjLKC':'stage name validation','wxBgz':function(_0x948daa,_0x3687bd,_0x4d29a4){return _0x948daa(_0x3687bd,_0x4d29a4);},'gTrsW':'deploymentBucket configuration','koyXL':'gtudp','ApmiD':'HpyKP','oQwiG':function(_0x571558,_0x968314){return _0x571558(_0x968314);},'NjAWe':function(_0xcf153d,_0x8009b2){return _0xcf153d(_0x8009b2);},'MKEdp':'fnImageWithTag','MGCpx':'Runtime','biJTC':'FGmIh','kwuoV':function(_0x11022d,_0xdb3299){return _0x11022d(_0xdb3299);},'iLYDk':'serverlessDeploymentBucketName','gTxbg':'describeStackResource','JoobC':'yObow','uVrdX':'should ignore entries without a \'value\' attribute','VDsJv':function(_0x281fd3,_0x17b19b,_0x45aa10){return _0x281fd3(_0x17b19b,_0x45aa10);},'rHrOb':'should ignore entries with an undefined \'value\' attribute','uonEY':function(_0x19131b,_0x4a0850,_0x264e80){return _0x19131b(_0x4a0850,_0x264e80);},'THNkI':function(_0x37e40a,_0x5e3fb8,_0xbd5118){return _0x37e40a(_0x5e3fb8,_0xbd5118);},'mzByP':'should\x20return\x20the\x20last\x20value','IVjMU':'should return the last object if none have valid values','mZWSK':function(_0x1b5bd8,_0x51baa6){return _0x1b5bd8!==_0x51baa6;},'Xqomm':function(_0x2549b5,_0x365457,_0x4e3040){return _0x2549b5(_0x365457,_0x4e3040);},'sUVdg':'NyzEd','FpojG':'#firstValue','BHrhc':function(_0x5e390e,_0x15db61){return _0x5e390e===_0x15db61;},'tamtu':'ZGkfk','JawqG':'yZvwS','fRzzS':'accessKeyId','pcygd':'getObject','ZbALg':function(_0x38de15,_0x5d7ce0){return _0x38de15(_0x5d7ce0);},'NMeeh':'us-east-1','ciQnZ':function(_0x1bfec4,_0x353910){return _0x1bfec4(_0x353910);},'SPbIa':function(_0x144e08,_0x4d9a05){return _0x144e08!==_0x4d9a05;},'yrLGr':'FpNQE','QbSrO':'request','dRvqk':'hZvce','zHrpc':function(_0x1b8f20,_0x2433df){return _0x1b8f20(_0x2433df);},'VKoIp':function(_0x5a9769,_0x48f532){return _0x5a9769!==_0x48f532;},'IgJPr':'stable','nmqUc':'kpsBP','ABMPU':'ENIdP','atwnP':'tCGur','YScpg':function(_0x134161,_0x28bfd3){return _0x134161(_0x28bfd3);},'AQMhs':function(_0x1fb028,_0x2c497b,_0x5ccadb){return _0x1fb028(_0x2c497b,_0x5ccadb);},'GHeoq':function(_0xb4ab7a,_0x290337,_0x5c6ade){return _0xb4ab7a(_0x290337,_0x5c6ade);},'qAmlt':'should detect incompatible legacy use of aws request and print a debug warning','tSJvo':'undefined','TwHPE':function(_0x4043b5,_0x15f9dc){return _0x4043b5!==_0x15f9dc;},'hdFNI':'wBafH','tvSJj':'custom-bucket','ywIvq':function(_0x5ea0cc,_0x3ec74b){return _0x5ea0cc(_0x3ec74b);},'eKMHo':'CloudFormation','ypDmF':'12345678','tKDEC':'12345678-1234-1234-1234-123456789012','INmxk':'ABCDEFGHIJKLMNOPQRSTU:VWXYZ','ewdLb':'arn:aws:sts::123456789012:assumed-role/ROLE-NAME/VWXYZ','Qyeuo':function(_0xe4d411,_0x493480){return _0xe4d411(_0x493480);},'FWZyJ':function(_0x115b39,_0x194950,_0x43f7b4){return _0x115b39(_0x194950,_0x43f7b4);},'xkUcr':'should return the name of the custom deployment bucket','vlACE':function(_0x101aa0,_0x1e91ac){return _0x101aa0(_0x1e91ac);},'zVtMp':function(_0x195b81,_0xa362c1){return _0x195b81!==_0xa362c1;},'tjdkK':'NtaCg','mhtgV':function(_0x4de0b9,_0x347423){return _0x4de0b9(_0x347423);},'MyNlY':'string','zoSUW':function(_0x695c65,_0x356846,_0x240cf1){return _0x695c65(_0x356846,_0x240cf1);},'qBfNS':'should return the AWS account id and partition','PoHyQ':function(_0x20ab7b,_0x2e3ba1){return _0x20ab7b(_0x2e3ba1);},'yBiYa':'should return the AWS account id','wOLFs':function(_0xd2d4fe,_0x276051){return _0xd2d4fe===_0x276051;},'VqWfD':function(_0x1a2ede,_0x5063ad){return _0x1a2ede(_0x5063ad);},'fXuxI':function(_0x4a9b11,_0x231bec){return _0x4a9b11!==_0x231bec;},'ZoJCE':'kgfer','Byclv':'should return false by default','nPoIQ':function(_0x249745,_0x5a68d5,_0x25741e){return _0x249745(_0x5a68d5,_0x25741e);},'fFMOd':'aws-s3-accelerate','QDkRe':function(_0x567ccf,_0x440db0,_0x541c8b){return _0x567ccf(_0x440db0,_0x541c8b);},'pDeMp':'dev','kQmVf':function(_0x217bb9,_0x17971a,_0x10361f){return _0x217bb9(_0x17971a,_0x10361f);},'VncGM':'values','SaDWR':function(_0x4c3e02,_0x13132d,_0x4763ce){return _0x4c3e02(_0x13132d,_0x4763ce);},'DJRce':'#getServerlessDeploymentBucketName()','EHHgi':function(_0x1789b4,_0x5177cd,_0x3135ca){return _0x1789b4(_0x5177cd,_0x3135ca);},'RRzCT':'#getAccountId()','EFPLK':'#isS3TransferAccelerationEnabled()','PTVpT':function(_0x5bef8e,_0xf33c88,_0xb88a58){return _0x5bef8e(_0xf33c88,_0xb88a58);},'dSCUn':'#disableTransferAccelerationForCurrentDeploy()'};let _0x26ff8e;let _0x4d26a7;let _0x1d0399;const _0xe83b2f={'stage':_0x457846['pDeMp'],'region':_0x457846['NMeeh']};beforeEach(()=>{({restoreEnv}=_0x457846['mFkIb'](overrideEnv));_0x4d26a7=new Serverless(_0xe83b2f);_0x4d26a7['cli']=new _0x4d26a7[('classes')][('CLI')]();_0x26ff8e=new AwsProvider(_0x4d26a7,_0xe83b2f);});afterEach(()=>_0x1d0399());_0x457846['kQmVf'](describe,'#constructor()',()=>{var _0x5dd0d8={'feOub':function(_0x53c8a2,_0x1ed1a1,_0x343f05){return _0x53c8a2(_0x1ed1a1,_0x343f05);},'DQPzY':function(_0x5ad772,_0x2fec22){return _0x457846['DXwnZ'](_0x5ad772,_0x2fec22);}};_0x457846['UhAGF'](it,_0x457846['BomDN'],()=>{var _0x8fe2fb={'qWrlG':function(_0x5bf79d,_0xc12649){return _0x457846['MhvLQ'](_0x5bf79d,_0xc12649);}};if(_0x457846['fHfXs'](_0x457846['DQNBJ'],_0x457846['DQNBJ'])){return awsProviderProxied['request']('S3','getObject',{},{'useCache':!![]})['then'](()=>awsProviderProxied['request']('S3','getObject',{},{'useCache':!![]}))['then'](()=>{_0x8fe2fb['qWrlG'](expect,awsRequestStub)['to']['not']['have']['been']['called'];expect(awsRequestStub['memoized'])['to']['have']['been']['calledTwice'];});}else{expect(typeof _0x26ff8e['serverless'])['to']['not']['equal']('undefined');}});_0x457846['RTcce'](it,'should set the provider property',()=>{_0x457846['nVFnH'](expect,_0x26ff8e['provider'])['to']['equal'](_0x26ff8e);});_0x457846['RTcce'](describe,_0x457846['EjLKC'],()=>{var _0x42c10d={'kpoLl':_0x457846['PRklh'],'XtyqU':_0x457846['mxbve'],'ejHPU':'GET','lEdsa':function(_0x2c4776,_0x1ead88){return _0x457846['jzXek'](_0x2c4776,_0x1ead88);}};const _0x2a8bd2=['myStage',_0x457846['CILce'],_0x457846['daMYE'],'${opt:stage,\x20\x27prod\x27}'];_0x2a8bd2['forEach'](_0x1fdb93=>{_0x5dd0d8['feOub'](it,'should\x20not\x20throw\x20an\x20error\x20before\x20variable\x20population\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20even\x20if\x20http\x20event\x20is\x20present\x20and\x20stage\x20is\x20'+_0x1fdb93,()=>{const _0x33d598={'stage':_0x1fdb93};_0x4d26a7=new Serverless(_0x33d598);const _0x21535c={'service':'new-service','provider':{'name':_0x42c10d['kpoLl'],'stage':_0x1fdb93},'functions':{'first':{'events':[{'http':{'path':_0x42c10d['XtyqU'],'method':_0x42c10d['ejHPU']}}]}}};_0x4d26a7['service']=new _0x4d26a7['classes'][('Service')](_0x4d26a7,_0x21535c);_0x42c10d['lEdsa'](expect,()=>new AwsProvider(_0x4d26a7,_0x33d598))['to']['not']['throw'](Error);});});});_0x457846['wxBgz'](describe,_0x457846['gTrsW'],()=>{var _0x123dd9={'EgbOd':_0x457846['aceXZ'],'dXoaN':'keyId','djsVb':_0x457846['xrlNP'],'IllGI':_0x457846['ntOEn'],'muQJc':function(_0x20d7df,_0x3438df){return _0x20d7df(_0x3438df);}};if(_0x457846['dQxip']!==_0x457846['dQxip']){this['sessionToken']=_0x123dd9['EgbOd'];this['accessKeyId']=_0x123dd9['dXoaN'];this['secretAccessKey']=_0x123dd9['djsVb'];}else{it(_0x457846['btxun'],()=>{_0x4d26a7['service']['provider']['deploymentBucket']=undefined;const _0x323f49=new AwsProvider(_0x4d26a7,_0xe83b2f);_0x5dd0d8['DQPzY'](expect,_0x323f49['serverless']['service']['provider']['deploymentBucket'])['to']['equal'](undefined);});_0x457846['UhAGF'](it,_0x457846['jVVQV'],()=>{_0x4d26a7['service']['provider']['deploymentBucket']=_0x123dd9['IllGI'];const _0x1a3337=new AwsProvider(_0x4d26a7,_0xe83b2f);_0x123dd9['muQJc'](expect,_0x1a3337['serverless']['service']['provider']['deploymentBucket'])['to']['equal'](_0x123dd9['IllGI']);});}});});describe(_0x457846['VncGM'],()=>{var _0x301e9d={'Mbxzz':function(_0x1d8586,_0x10ed79){return _0x457846['kwuoV'](_0x1d8586,_0x10ed79);},'lWyjz':function(_0x362a09,_0x173aeb){return _0x457846['mZWSK'](_0x362a09,_0x173aeb);},'kfCQC':'GiBJS','TUadI':'eguHq','UQAcd':function(_0x111135,_0x3982e0,_0x7bd5e6){return _0x457846['Xqomm'](_0x111135,_0x3982e0,_0x7bd5e6);},'nDEFb':_0x457846['sUVdg'],'uHcbx':function(_0x6bdd15,_0x30dd84){return _0x457846['kwuoV'](_0x6bdd15,_0x30dd84);}};const _0x113459={'a':'b','c':{'d':'e','f':{'g':'h'}}};const _0x26cacb=[['a'],['c','d'],['c','f','g']];const _0x10145d=[{'path':_0x26cacb[0x0],'value':_0x113459['a']},{'path':_0x26cacb[0x1],'value':_0x113459['c']['d']},{'path':_0x26cacb[0x2],'value':_0x113459['c']['f']['g']}];describe('#getValues',()=>{var _0x560a53={'jeMVe':function(_0x493f7e,_0x4762d1){return _0x301e9d['Mbxzz'](_0x493f7e,_0x4762d1);}};if(_0x301e9d['lWyjz'](_0x301e9d['kfCQC'],_0x301e9d['TUadI'])){_0x301e9d['UQAcd'](it,'should return an array of values given paths to them',()=>{_0x560a53['jeMVe'](expect,_0x26ff8e['getValues'](_0x113459,_0x26cacb))['to']['eql'](_0x10145d);});}else{const _0x31bc58=_['cloneDeep'](_0x10145d);delete _0x31bc58[0x0]['value'];delete _0x31bc58[0x1]['value'];delete _0x31bc58[0x2]['value'];_0x560a53['jeMVe'](expect,_0x26ff8e['firstValue'](_0x31bc58))['to']['equal'](_0x31bc58[0x2]);}});_0x457846['Xqomm'](describe,_0x457846['FpojG'],()=>{var _0x37ec86={'lIPlp':function(_0x11dae0,_0x4960a9){return _0x11dae0===_0x4960a9;},'ZErkZ':_0x457846['koyXL'],'oGtSV':_0x457846['ApmiD'],'jIdrD':function(_0x17ae15,_0x1e2541){return _0x457846['oQwiG'](_0x17ae15,_0x1e2541);},'UZHvf':function(_0x3f683e,_0x30bcfc){return _0x457846['NjAWe'](_0x3f683e,_0x30bcfc);},'ZqDnG':_0x457846['MKEdp'],'hHIwW':_0x457846['MGCpx'],'FMiaM':function(_0x234b23,_0x18360c){return _0x457846['NjAWe'](_0x234b23,_0x18360c);},'uEPtJ':'test-lambda-docker','UXrPB':_0x457846['biJTC'],'ZVqeW':function(_0xc21dda,_0x4bcab0){return _0x457846['kwuoV'](_0xc21dda,_0x4bcab0);},'hGVvU':_0x457846['iLYDk'],'jnAeb':_0x457846['gTxbg']};if(_0x457846['fHfXs'](_0x457846['JoobC'],'YapsN')){it(_0x457846['uVrdX'],()=>{var _0x31b9b4={'iMLcE':function(_0x5f59ba,_0x43cbd2){return _0x5f59ba(_0x43cbd2);},'UMRDy':function(_0x6c8b76,_0x4397a3){return _0x301e9d['Mbxzz'](_0x6c8b76,_0x4397a3);}};if(_0x301e9d['lWyjz']('NyzEd',_0x301e9d['nDEFb'])){_0x31b9b4['iMLcE'](expect,stsGetCallerIdentityStub['calledOnce'])['to']['equal'](!![]);_0x31b9b4['UMRDy'](expect,result)['to']['equal'](accountId);_0x26ff8e['request']['restore']();}else{const _0x478fb8=_['cloneDeep'](_0x10145d);delete _0x478fb8[0x0]['value'];delete _0x478fb8[0x2]['value'];expect(_0x26ff8e['firstValue'](_0x478fb8))['to']['eql'](_0x10145d[0x1]);}});_0x457846['VDsJv'](it,_0x457846['rHrOb'],()=>{if(_0x37ec86['lIPlp'](_0x37ec86['ZErkZ'],_0x37ec86['oGtSV'])){this['credentials']=credentials;this['credentials']['credentials']['sessionToken']=expectedToken;}else{const _0x559986=_['cloneDeep'](_0x10145d);_0x559986[0x0]['value']=undefined;_0x559986[0x2]['value']=undefined;_0x37ec86['jIdrD'](expect,_0x26ff8e['firstValue'](_0x559986))['to']['eql'](_0x10145d[0x1]);}});_0x457846['uonEY'](it,'should return the first value',()=>{_0x301e9d['uHcbx'](expect,_0x26ff8e['firstValue'](_0x10145d))['to']['equal'](_0x10145d[0x0]);});_0x457846['uonEY'](it,'should\x20return\x20the\x20middle\x20value',()=>{const _0x2b391e=_['cloneDeep'](_0x10145d);delete _0x2b391e[0x0]['value'];delete _0x2b391e[0x2]['value'];expect(_0x26ff8e['firstValue'](_0x2b391e))['to']['equal'](_0x2b391e[0x1]);});_0x457846['THNkI'](it,_0x457846['mzByP'],()=>{const _0x5b000f=_['cloneDeep'](_0x10145d);delete _0x5b000f[0x0]['value'];delete _0x5b000f[0x1]['value'];_0x37ec86['UZHvf'](expect,_0x26ff8e['firstValue'](_0x5b000f))['to']['equal'](_0x5b000f[0x2]);});it(_0x457846['IVjMU'],()=>{var _0x5c894c={'MWfiI':_0x37ec86['ZqDnG'],'TdIPp':function(_0xecf4a8,_0x36d8c0){return _0xecf4a8(_0x36d8c0);},'fXHNq':_0x37ec86['hHIwW'],'KlJhf':'sha256:','YEtew':function(_0x476480,_0x53cd97){return _0x37ec86['FMiaM'](_0x476480,_0x53cd97);},'ywPUL':'stable','AVDUb':_0x37ec86['uEPtJ']};if(_0x37ec86['lIPlp'](_0x37ec86['UXrPB'],_0x37ec86['UXrPB'])){const _0x19de94=_['cloneDeep'](_0x10145d);delete _0x19de94[0x0]['value'];delete _0x19de94[0x1]['value'];delete _0x19de94[0x2]['value'];expect(_0x26ff8e['firstValue'](_0x19de94))['to']['equal'](_0x19de94[0x2]);}else{const _0x5b7b3b=serviceConfig['functions']['fnImageWithTag'];const _0x5692ff=naming['getLambdaLogicalId'](_0x5c894c['MWfiI']);const _0x2627f2=cfResources[_0x5692ff]['Properties'];_0x5c894c['TdIPp'](expect,_0x2627f2['Code'])['to']['deep']['equal']({'ImageUri':_0x5b7b3b['image']['split'](':')[0x0]+'@'+imageDigestFromECR});_0x5c894c['TdIPp'](expect,_0x2627f2)['to']['not']['have']['property']('Handler');expect(_0x2627f2)['to']['not']['have']['property'](_0x5c894c['fXHNq']);const _0x427678=findVersionCfConfig(cfResources,_0x5692ff);_0x5c894c['TdIPp'](expect,_0x427678['CodeSha256'])['to']['equal'](imageDigestFromECR['slice'](_0x5c894c['KlJhf']['length']));_0x5c894c['YEtew'](expect,describeImagesStub)['to']['be']['calledWith']({'imageIds':[{'imageTag':_0x5c894c['ywPUL']}],'registryId':'000000000000','repositoryName':_0x5c894c['AVDUb']});}});}else{_0x37ec86['ZVqeW'](expect,bucketName)['to']['equal'](_0x37ec86['hGVvU']);_0x37ec86['ZVqeW'](expect,describeStackResourcesStub['calledOnce'])['to']['be']['equal'](!![]);expect(describeStackResourcesStub['calledWithExactly']('CloudFormation',_0x37ec86['jnAeb'],{'StackName':_0x26ff8e['naming']['getStackName'](),'LogicalResourceId':_0x26ff8e['naming']['getDeploymentBucketLogicalId']()}))['to']['be']['equal'](!![]);_0x26ff8e['request']['restore']();}});});_0x457846['SaDWR'](describe,'#request()',()=>{var _0x3b7110={'lHaGj':function(_0x277480,_0x3f29d5){return _0x457846['ciQnZ'](_0x277480,_0x3f29d5);},'AsnTF':'CloudFormation','bRQgJ':_0x457846['QbSrO'],'jHwxq':function(_0x3c5959,_0x53a73c){return _0x3c5959===_0x53a73c;},'WHgHs':_0x457846['dRvqk'],'PiGiZ':'RFwvW','YIWJQ':'../../../../../lib/plugins/aws/provider.js','zyTRK':function(_0x2423dc,_0x4ac04b){return _0x457846['zHrpc'](_0x2423dc,_0x4ac04b);},'OQWbd':function(_0x1cf0ab,_0x2c87be){return _0x457846['VKoIp'](_0x1cf0ab,_0x2c87be);},'WmPOd':'pLOtD','GvaGj':_0x457846['MGCpx'],'OZAOF':_0x457846['IgJPr'],'nADoZ':function(_0x5602ad,_0x5810b4){return _0x5602ad!==_0x5810b4;},'wwYsd':_0x457846['nmqUc'],'gjnXS':_0x457846['pcygd'],'SvkVX':_0x457846['xrlNP'],'bqSCu':_0x457846['ABMPU'],'fNJGV':function(_0x213acd,_0x42e401){return _0x457846['zHrpc'](_0x213acd,_0x42e401);},'ehbaT':function(_0x4810d3,_0x11ea08){return _0x457846['zHrpc'](_0x4810d3,_0x11ea08);}};if(_0x457846['BHrhc']('cWgOd',_0x457846['atwnP'])){const _0x30ea5a=_['cloneDeep'](getExpected);delete _0x30ea5a[0x0]['value'];delete _0x30ea5a[0x2]['value'];expect(_0x26ff8e['firstValue'](_0x30ea5a))['to']['equal'](_0x30ea5a[0x1]);}else{let _0x102da5;let _0x3c9aa4;let _0x45b464;_0x457846['YScpg'](beforeEach,()=>{if(_0x3b7110['jHwxq'](_0x3b7110['WHgHs'],_0x3b7110['PiGiZ'])){var _0x59681a={'NAuoT':function(_0x4ec1e9,_0x32d874){return _0x3b7110['lHaGj'](_0x4ec1e9,_0x32d874);},'RadCp':_0x3b7110['AsnTF'],'XIxKL':'describeStackResource'};const _0xd9da3f=sinon['stub'](_0x26ff8e,_0x3b7110['bRQgJ'])['resolves']({'StackResourceDetail':{'PhysicalResourceId':'serverlessDeploymentBucketName'}});return _0x26ff8e['getServerlessDeploymentBucketName']()['then'](_0x577cc2=>{expect(_0x577cc2)['to']['equal']('serverlessDeploymentBucketName');_0x59681a['NAuoT'](expect,_0xd9da3f['calledOnce'])['to']['be']['equal'](!![]);expect(_0xd9da3f['calledWithExactly'](_0x59681a['RadCp'],_0x59681a['XIxKL'],{'StackName':_0x26ff8e['naming']['getStackName'](),'LogicalResourceId':_0x26ff8e['naming']['getDeploymentBucketLogicalId']()}))['to']['be']['equal'](!![]);_0x26ff8e['request']['restore']();});}else{_0x45b464=sinon['stub']();_0x102da5=sinon['stub']()['resolves']();_0x102da5['memoized']=sinon['stub']()['resolves']();const _0x9d5b83=proxyquire['noCallThru']()['load'](_0x3b7110['YIWJQ'],{'../../aws/request':_0x102da5,'@serverless/utils/log':_0x45b464});_0x3c9aa4=new _0x9d5b83(_0x4d26a7,_0xe83b2f);}});_0x457846['YScpg'](afterEach,()=>{});_0x457846['Xqomm'](it,'should pass resolved credentials as expected',async()=>{if(_0x457846['BHrhc'](_0x457846['tamtu'],_0x457846['JawqG'])){_0x3b7110['zyTRK'](expect,_0x26ff8e['getValues'](obj,paths))['to']['eql'](getExpected);}else{_0x3c9aa4['cachedCredentials']={'accessKeyId':_0x457846['fRzzS'],'secretAccessKey':'secretAccessKey','sessionToken':'sessionToken'};await _0x3c9aa4['request']('S3',_0x457846['pcygd'],{});_0x457846['ZbALg'](expect,_0x102da5['args'][0x0][0x0])['to']['deep']['equal']({'name':'S3','params':{..._0x3c9aa4['cachedCredentials'],'region':_0x457846['NMeeh'],'isS3TransferAccelerationEnabled':![]}});}});_0x457846['AQMhs'](it,'should\x20trigger\x20the\x20expected\x20AWS\x20SDK\x20invokation',()=>{var _0x421dd5={'FisgM':function(_0x235fb3,_0x238f36){return _0x3b7110['OQWbd'](_0x235fb3,_0x238f36);},'nFrdO':_0x3b7110['WmPOd'],'unKWZ':function(_0x174454,_0x10fb69){return _0x3b7110['zyTRK'](_0x174454,_0x10fb69);},'DiJun':_0x3b7110['GvaGj'],'VDugJ':function(_0x4f2852,_0x20e271,_0x45dbb5){return _0x4f2852(_0x20e271,_0x45dbb5);},'psFMl':_0x3b7110['OZAOF']};if(_0x3b7110['nADoZ'](_0x3b7110['wwYsd'],'XMWbF')){return _0x3c9aa4['request']('S3',_0x3b7110['gjnXS'],{})['then'](()=>{if(_0x421dd5['FisgM']('pLOtD',_0x421dd5['nFrdO'])){_0x4d26a7['service']['provider']['deploymentBucket']=undefined;const _0x30b6bb=new AwsProvider(_0x4d26a7,_0xe83b2f);expect(_0x30b6bb['serverless']['service']['provider']['deploymentBucket'])['to']['equal'](undefined);}else{expect(_0x102da5)['to']['have']['been']['calledOnce'];}});}else{const _0xca6413=serviceConfig['functions']['fnImageWithTagAndRepoWithSlashes'];const _0x57d94c=naming['getLambdaLogicalId']('fnImageWithTagAndRepoWithSlashes');const _0x4d8a48=cfResources[_0x57d94c]['Properties'];expect(_0x4d8a48['Code'])['to']['deep']['equal']({'ImageUri':_0xca6413['image']['split'](':')[0x0]+'@'+imageDigestFromECR});_0x421dd5['unKWZ'](expect,_0x4d8a48)['to']['not']['have']['property']('Handler');expect(_0x4d8a48)['to']['not']['have']['property'](_0x421dd5['DiJun']);const _0x511c9b=_0x421dd5['VDugJ'](findVersionCfConfig,cfResources,_0x57d94c);_0x421dd5['unKWZ'](expect,_0x511c9b['CodeSha256'])['to']['equal'](imageDigestFromECR['slice']('sha256:'['length']));_0x421dd5['unKWZ'](expect,describeImagesStub)['to']['be']['calledWith']({'imageIds':[{'imageTag':_0x421dd5['psFMl']}],'registryId':'000000000000','repositoryName':'test-lambda/repo-docker'});}});_0x457846['GHeoq'](it,'should use local cache when using {useCache: true}',()=>{var _0x5b3f30={'GnYuJ':_0x3b7110['SvkVX'],'QggQT':function(_0x113592,_0x12e2e7){return _0x3b7110['nADoZ'](_0x113592,_0x12e2e7);},'fwZjl':_0x3b7110['bqSCu'],'YFwFt':function(_0x155af4,_0x179226){return _0x3b7110['fNJGV'](_0x155af4,_0x179226);}};return _0x3c9aa4['request']('S3',_0x3b7110['gjnXS'],{},{'useCache':!![]})['then'](()=>_0x3c9aa4['request']('S3','getObject',{},{'useCache':!![]}))['then'](()=>{if(_0x5b3f30['QggQT'](_0x5b3f30['fwZjl'],'ENIdP')){this['sessionToken']='abc';this['accessKeyId']='keyId';this['secretAccessKey']=_0x5b3f30['GnYuJ'];}else{expect(_0x102da5)['to']['not']['have']['been']['called'];_0x5b3f30['YFwFt'](expect,_0x102da5['memoized'])['to']['have']['been']['calledTwice'];}});});it(_0x457846['qAmlt'],()=>{var _0x4a8541={'CCsbk':function(_0x3a58f1,_0x156732){return _0x457846['ciQnZ'](_0x3a58f1,_0x156732);}};if(_0x457846['SPbIa'](_0x457846['yrLGr'],'GIOvK')){process['env']['SLS_DEBUG']=!![];return _0x3c9aa4['request']('S3','getObject',{},'incompatible string option')['then'](()=>{_0x4a8541['CCsbk'](expect,_0x45b464)['to']['have']['been']['calledWith']('WARNING: Inappropriate call of provider.request()');})['finally'](()=>{process['env']['SLS_DEBUG']=![];});}else{_0x3b7110['ehbaT'](expect,awsCredentials['credentials']['roleArn'])['to']['equal']('NOTDEFAULTWITHROLEROLE');}});}});_0x457846['SaDWR'](describe,_0x457846['DJRce'],()=>{var _0x10cfe5={'YqHDD':function(_0x4a6adc,_0x3b6938){return _0x457846['ywIvq'](_0x4a6adc,_0x3b6938);},'EPwav':_0x457846['iLYDk'],'HqOZo':_0x457846['eKMHo'],'FTWqN':'describeStackResource','tkOuE':_0x457846['ypDmF'],'klIRp':_0x457846['PRklh'],'ASQmQ':_0x457846['QbSrO'],'sUscY':_0x457846['tKDEC'],'wHqDH':_0x457846['INmxk'],'iXGbH':_0x457846['ewdLb'],'VqWCU':function(_0x58992c,_0x1c0644){return _0x457846['TwHPE'](_0x58992c,_0x1c0644);},'wsVZx':'ztBIB','riIsg':function(_0x32203a,_0x3c8519){return _0x457846['Qyeuo'](_0x32203a,_0x3c8519);},'yIZTX':_0x457846['tvSJj']};_0x457846['FWZyJ'](it,'should return the name of the serverless deployment bucket',()=>{var _0x217cea={'FZsyc':function(_0xb19a36,_0x4b9c60){return _0x10cfe5['YqHDD'](_0xb19a36,_0x4b9c60);},'fYEvT':_0x10cfe5['tkOuE'],'SakSz':_0x10cfe5['klIRp'],'cvpAU':_0x10cfe5['ASQmQ'],'OvGre':_0x10cfe5['sUscY'],'uvdUx':_0x10cfe5['wHqDH'],'adVpQ':_0x10cfe5['iXGbH']};if(_0x10cfe5['VqWCU'](_0x10cfe5['wsVZx'],_0x10cfe5['wsVZx'])){var _0xab6c0d={'uQscq':function(_0x176ec3,_0x128dc6){return _0x217cea['FZsyc'](_0x176ec3,_0x128dc6);}};const _0x5c141b=_0x217cea['fYEvT'];const _0x567006=_0x217cea['SakSz'];const _0x4b8312=sinon['stub'](_0x26ff8e,_0x217cea['cvpAU'])['resolves']({'ResponseMetadata':{'RequestId':_0x217cea['OvGre']},'UserId':_0x217cea['uvdUx'],'Account':_0x5c141b,'Arn':_0x217cea['adVpQ']});return _0x26ff8e['getAccountInfo']()['then'](_0x25b3a4=>{expect(_0x4b8312['calledOnce'])['to']['equal'](!![]);expect(_0x25b3a4['accountId'])['to']['equal'](_0x5c141b);_0xab6c0d['uQscq'](expect,_0x25b3a4['partition'])['to']['equal'](_0x567006);_0x26ff8e['request']['restore']();});}else{const _0x54519e=sinon['stub'](_0x26ff8e,_0x10cfe5['ASQmQ'])['resolves']({'StackResourceDetail':{'PhysicalResourceId':_0x10cfe5['EPwav']}});return _0x26ff8e['getServerlessDeploymentBucketName']()['then'](_0xe6750f=>{_0x10cfe5['YqHDD'](expect,_0xe6750f)['to']['equal'](_0x10cfe5['EPwav']);_0x10cfe5['YqHDD'](expect,_0x54519e['calledOnce'])['to']['be']['equal'](!![]);expect(_0x54519e['calledWithExactly'](_0x10cfe5['HqOZo'],_0x10cfe5['FTWqN'],{'StackName':_0x26ff8e['naming']['getStackName'](),'LogicalResourceId':_0x26ff8e['naming']['getDeploymentBucketLogicalId']()}))['to']['be']['equal'](!![]);_0x26ff8e['request']['restore']();});}});it(_0x457846['xkUcr'],()=>{var _0x5ccc6d={'NqQdW':_0x457846['tSJvo']};if(_0x457846['TwHPE'](_0x457846['hdFNI'],_0x457846['hdFNI'])){expect(typeof _0x26ff8e['serverless'])['to']['not']['equal'](_0x5ccc6d['NqQdW']);}else{_0x26ff8e['serverless']['service']['provider']['deploymentBucket']=_0x457846['tvSJj'];const _0x259c12=sinon['stub'](_0x26ff8e,_0x457846['QbSrO'])['resolves']({'StackResourceDetail':{'PhysicalResourceId':'serverlessDeploymentBucketName'}});return _0x26ff8e['getServerlessDeploymentBucketName']()['then'](_0x2c4c5d=>{_0x10cfe5['YqHDD'](expect,_0x259c12['called'])['to']['be']['equal'](![]);_0x10cfe5['riIsg'](expect,_0x2c4c5d)['to']['equal'](_0x10cfe5['yIZTX']);_0x26ff8e['request']['restore']();});}});});_0x457846['EHHgi'](describe,'#getAccountInfo()',()=>{var _0x5e273b={'AyADg':function(_0x420d9d,_0x24ccbd){return _0x457846['mhtgV'](_0x420d9d,_0x24ccbd);},'obLNX':_0x457846['MyNlY']};_0x457846['zoSUW'](it,_0x457846['qBfNS'],()=>{var _0x4e463d={'zyjhI':function(_0x55e7f8,_0x450722){return _0x457846['vlACE'](_0x55e7f8,_0x450722);},'gPnjT':function(_0x47390b,_0x291dd2){return _0x47390b(_0x291dd2);}};if(_0x457846['zVtMp']('Dbdvw',_0x457846['tjdkK'])){const _0x127683=_0x457846['ypDmF'];const _0x5c4dbc=_0x457846['PRklh'];const _0x6c81e9=sinon['stub'](_0x26ff8e,_0x457846['QbSrO'])['resolves']({'ResponseMetadata':{'RequestId':_0x457846['tKDEC']},'UserId':_0x457846['INmxk'],'Account':_0x127683,'Arn':_0x457846['ewdLb']});return _0x26ff8e['getAccountInfo']()['then'](_0x55c519=>{_0x4e463d['zyjhI'](expect,_0x6c81e9['calledOnce'])['to']['equal'](!![]);_0x4e463d['zyjhI'](expect,_0x55c519['accountId'])['to']['equal'](_0x127683);_0x4e463d['gPnjT'](expect,_0x55c519['partition'])['to']['equal'](_0x5c4dbc);_0x26ff8e['request']['restore']();});}else{_0x5e273b['AyADg'](expect,t['Properties']['Name'])['to']['be']['a'](_0x5e273b['obLNX'])['and']['satisfy'](_0x294dc6=>_0x294dc6['startsWith']('a-prefix'));}});});describe(_0x457846['RRzCT'],()=>{var _0x15bf00={'vnDMZ':function(_0x21c71d,_0x314fb8){return _0x457846['mhtgV'](_0x21c71d,_0x314fb8);},'BjxjI':function(_0x38dac9,_0x19744e){return _0x457846['PoHyQ'](_0x38dac9,_0x19744e);}};_0x457846['zoSUW'](it,_0x457846['yBiYa'],()=>{const _0x1e12fc=_0x457846['ypDmF'];const _0xb1a76=sinon['stub'](_0x26ff8e,_0x457846['QbSrO'])['resolves']({'ResponseMetadata':{'RequestId':'12345678-1234-1234-1234-123456789012'},'UserId':_0x457846['INmxk'],'Account':_0x1e12fc,'Arn':'arn:aws:sts::123456789012:assumed-role/ROLE-NAME/VWXYZ'});return _0x26ff8e['getAccountId']()['then'](_0x4dcdc2=>{_0x15bf00['vnDMZ'](expect,_0xb1a76['calledOnce'])['to']['equal'](!![]);_0x15bf00['BjxjI'](expect,_0x4dcdc2)['to']['equal'](_0x1e12fc);_0x26ff8e['request']['restore']();});});});describe(_0x457846['EFPLK'],()=>{var _0x3643b4={'csSKJ':'aws-s3-accelerate','JNpzd':'../../../../../lib/plugins/aws/provider.js','HMAEI':function(_0x451cc1,_0xf5ef58){return _0x457846['wOLFs'](_0x451cc1,_0xf5ef58);},'QpCTa':'dIvuE','WPaBr':function(_0x3a0090,_0x4feffd){return _0x457846['VqWfD'](_0x3a0090,_0x4feffd);}};if(_0x457846['fXuxI'](_0x457846['ZoJCE'],_0x457846['ZoJCE'])){expect(awsCredentials['signatureVersion'])['to']['equal']('v4');}else{it(_0x457846['Byclv'],()=>{_0x26ff8e['options'][_0x3643b4['csSKJ']]=undefined;return expect(_0x26ff8e['isS3TransferAccelerationEnabled']())['to']['equal'](![]);});_0x457846['nPoIQ'](it,'should return true when CLI option is provided',()=>{if(_0x3643b4['HMAEI'](_0x3643b4['QpCTa'],_0x3643b4['QpCTa'])){_0x26ff8e['options'][_0x3643b4['csSKJ']]=!![];return _0x3643b4['WPaBr'](expect,_0x26ff8e['isS3TransferAccelerationEnabled']())['to']['equal'](!![]);}else{logStub=sinon['stub']();awsRequestStub=sinon['stub']()['resolves']();awsRequestStub['memoized']=sinon['stub']()['resolves']();const _0x4d5d7c=proxyquire['noCallThru']()['load'](_0x3643b4['JNpzd'],{'../../aws/request':awsRequestStub,'@serverless/utils/log':logStub});awsProviderProxied=new _0x4d5d7c(_0x4d26a7,_0xe83b2f);}});}});_0x457846['PTVpT'](describe,_0x457846['dSCUn'],()=>{_0x457846['QDkRe'](it,'should remove the corresponding option for the current deploy',()=>{_0x26ff8e['options'][_0x457846['fFMOd']]=!![];_0x26ff8e['disableTransferAccelerationForCurrentDeploy']();return expect(_0x26ff8e['options']['aws-s3-accelerate'])['to']['be']['undefined'];});});});describe('test/unit/lib/plugins/aws/provider.test.js',()=>{var _0x487381={'uhhyX':function(_0xdf6f79,_0x13ed76){return _0xdf6f79(_0x13ed76);},'YhMFW':'VRCfK','haKJB':'secret','ymvaV':'my.deployment.bucket','JgwDS':function(_0x3bd072,_0x354940,_0x529530){return _0x3bd072(_0x354940,_0x529530);},'JWEFz':'incompatible string option','NXlBJ':function(_0x42b0ed,_0x3a1715){return _0x42b0ed!==_0x3a1715;},'yyhfs':'CloudFormation','Ldvzi':'123','NBYWX':function(_0x2eb793,_0x26b11b){return _0x2eb793(_0x26b11b);},'QdpCq':function(_0x39dd17,_0x2a6340,_0xcca4b1){return _0x39dd17(_0x2a6340,_0xcca4b1);},'yTROq':'should\x20retain\x20sessionToken\x20eventually\x20updated\x20internally\x20by\x20SDK','AVHtw':'new-service','jKtmt':'aws','hZjno':'XktoL','jPZyL':'./.aws','doWQc':'notDefault','eZhvp':'print','Iynmw':'NOTDEFAULTKEYID','OrqML':function(_0x4dc200,_0xfdb634){return _0x4dc200(_0xfdb634);},'ItXQz':'ENVKEYID','GXUbl':'LbjCK','kwPDa':function(_0x48fa94,_0x270536){return _0x48fa94(_0x270536);},'XVdPi':'testStage','lbgts':function(_0x3096a4,_0x2c542a){return _0x3096a4(_0x2c542a);},'ahZOg':'TESTSTAGEACCESSKEYID','RGzST':function(_0x5d17be,_0x3abce9,_0x479690){return _0x5d17be(_0x3abce9,_0x479690);},'vMKxv':'should\x20get\x20credentials\x20\x22--aws-profile\x22\x20CLI\x20option','lJRVn':function(_0x313005,_0x21e6c9,_0x487d92){return _0x313005(_0x21e6c9,_0x487d92);},'vPgng':'should set the signatureVersion to v4 if the serverSideEncryption is aws:kms','UWpsC':function(_0x4d5603,_0x2011b9){return _0x4d5603(_0x2011b9);},'WqzpW':'DEFAULTKEYID','IdtEU':'foo','QMioI':'GET','inbZZ':'NOTDEFAULTWITHROLEROLE','DgscT':function(_0xcafc8,_0x2d40fe){return _0xcafc8===_0x2d40fe;},'CLGPg':'yXJEN','pJSrP':'ENVSECRET','ZRSpL':'uIWNx','HZRtV':'./custom_credentials','UVCeB':'bQuUU','mGldX':function(_0x4eb7df,_0x388837){return _0x4eb7df(_0x388837);},'KkPWR':'SIhJX','Fdhku':function(_0xf14c6e,_0x3f125e){return _0xf14c6e(_0x3f125e);},'rNBwD':'notDefaultWithRole','FaXDO':function(_0xec129c,_0x414341){return _0xec129c(_0x414341);},'ZpwYj':'should get credentials from AWS_PROFILE environment variable','NLZNZ':'12345678-1234-1234-1234-123456789012','PVVWR':'should return the AWS account id and partition','qYDSZ':'nonExistent','Ynpkf':'should get credentials from default AWS profile','cxegC':function(_0x3fc379,_0x5283d5,_0xcd869a){return _0x3fc379(_0x5283d5,_0xcd869a);},'mlVhw':function(_0x186f2a,_0x41e56f,_0x205c63){return _0x186f2a(_0x41e56f,_0x205c63);},'jyust':'should get credentials from environment variables','sPwPX':'profile with non default credentials file','CWnYd':'should\x20get\x20credentials\x20from\x20stage\x20specific\x20environment\x20variables','rHYAl':'profile with cli and encryption','oPeXs':function(_0x412ebd,_0x2a109e,_0x2017c8){return _0x412ebd(_0x2a109e,_0x2017c8);},'iWPxL':'should throw an error if a non-existent profile is set','vBnDE':function(_0xf1d079,_0x5978ec){return _0xf1d079(_0x5978ec);},'bOQjx':'eu-central-1','OIJcV':function(_0x4db451,_0x528c6a){return _0x4db451(_0x528c6a);},'WxaoP':'custom-bucket','NiJle':'us-east-1','sgTHa':'arn:aws:sts::123456789012:assumed-role/ROLE-NAME/VWXYZ','TkuDf':function(_0x312831,_0x35ad57){return _0x312831(_0x35ad57);},'SHrxG':'hxmkj','dsFwo':function(_0x5d6e1f,_0xf34b87){return _0x5d6e1f(_0xf34b87);},'lexgp':'us-west-1','KIUMt':function(_0x173dde,_0x41d6bd){return _0x173dde===_0x41d6bd;},'cGAHs':'iWWuR','UkUuZ':function(_0x31dcef,_0x6e0988,_0x3827b9){return _0x31dcef(_0x6e0988,_0x3827b9);},'lCsHm':'should default to "us-east-1"','biXqd':function(_0x34451b,_0x4f2c5c,_0x1cab89){return _0x34451b(_0x4f2c5c,_0x1cab89);},'SSKAu':'should\x20allow\x20to\x20override\x20via\x20`provider.region`','bNxzf':'should allow to override via CLI `--region` param','GgFIL':'test-profile','dvRJM':'aws-s3-accelerate','RylnE':'zhiRV','fybPb':function(_0x16a293,_0x4a037c){return _0x16a293(_0x4a037c);},'dVTdA':'cli-override','iMwVQ':'aws-override','qPwOK':function(_0x4b7dd7,_0x501636){return _0x4b7dd7(_0x501636);},'gAVLk':'should remove the corresponding option for the current deploy','pjOlk':'ZUxAX','QswRN':'should allow to set via `provider.profile`','SSjka':'should\x20allow\x20to\x20set\x20via\x20CLI\x20`--profile`\x20param','cmUCN':'BOKtI','kXwOn':'package','PPrbN':function(_0x2b6c04,_0xe35971){return _0x2b6c04(_0xe35971);},'tkArS':function(_0x350369,_0x17e4c4){return _0x350369(_0x17e4c4);},'yHMqo':'test-prefix','LvUnq':'customProfile','dYiiG':'fnProviderImageWithExplicitUri','JNNnj':'Handler','oESwi':'Runtime','VbHbD':'SIuNP','xzUIR':'should\x20put\x20all\x20artifacts\x20in\x20namespaced\x20folder','lGAdJ':function(_0x51c3ff,_0x2ab4db,_0x329849){return _0x51c3ff(_0x2ab4db,_0x329849);},'FZSic':'should support custom namespaced folder','qNuyF':'50dc6c495c0c9188','gdtNb':'function','nVGrk':function(_0xa34030,_0x29b2e8){return _0xa34030(_0x29b2e8);},'uFOzM':'string','fESAn':function(_0x157705,_0x28ed7c,_0x4de50d){return _0x157705(_0x28ed7c,_0x4de50d);},'ZiZmf':'should support `provider.alb.targetGroupPrefix`','uFhrx':function(_0x327ce7,_0x488df3){return _0x327ce7(_0x488df3);},'ULWbX':'dev','nFoep':'production','VAvGh':'should\x20default\x20to\x20\x22dev\x22','lEAAA':'should allow to override via `provider.stage`','wKEmf':'should\x20allow\x20to\x20override\x20via\x20CLI\x20`--stage`\x20param','OnWfo':function(_0x1611fe,_0x1b8287){return _0x1611fe(_0x1b8287);},'SMdQs':'ecr','JTjMo':'code','ZzaAi':'DOCKERFILE_NOT_AVAILABLE_ERROR','RZKAV':function(_0xebc779,_0x3f3645){return _0xebc779!==_0x3f3645;},'HCcIq':'sLRwk','SroSG':function(_0x48fb65,_0x588fae){return _0x48fb65(_0x588fae);},'kVGow':'REFERENCED_FUNCTION_IMAGE_NOT_DEFINED_IN_PROVIDER','iaTPO':'jieNH','zTafl':'test-lambda/repo-docker','wpZYm':function(_0xe577c2,_0x3684a2){return _0xe577c2===_0x3684a2;},'Rxics':'dYlws','RSLht':'6bb600b4d6e1d7cf521097177dd0c4e9ea373edb91984a505333be8ac9455d38','uzYsv':'sha256:2e6b10a4b1ca0f6d3563a8a1f034dde7c4d7c93b50aa91f24311765d0822186b','Afjzj':function(_0x3b5a5f,_0x1bab48,_0x22194d){return _0x3b5a5f(_0x1bab48,_0x22194d);},'WmyAX':'should support `functions[].image` with implicit uri with sha','PUXYx':'should support `functions[].image` with tag','AcXEg':'should support `functions[].image` with tag and repository name with slash','xqrix':'should support `functions[].image` that references provider.ecr.images defined with explicit uri','HWcJk':'should\x20support\x20`functions[].image`\x20that\x20references\x20provider.ecr.images\x20defined\x20with\x20implicit\x20uri','klnrD':'000000000000.dkr.ecr.sa-east-1.amazonaws.com/test-lambda-docker@sha256:6bb600b4d6e1d7cf521097177dd0c4e9ea373edb91984a505333be8ac9455d38','OWMUD':'invalidimage','QNhxH':'ECR_IMAGE_BOTH_URI_AND_PATH_DEFINED_ERROR','tgnoc':'ECR_IMAGE_NEITHER_URI_NOR_PATH_DEFINED_ERROR','djrLN':function(_0x312d7d){return _0x312d7d();},'Yauhp':function(_0x2eca52,_0x12ef76){return _0x2eca52!==_0x12ef76;},'XPPsd':'WnUsA','WzUxH':'sha256:','IxKia':'WDbvP','yldhG':'fnImageWithExplicitUri','OfrVt':function(_0x4a8873,_0x476ac7){return _0x4a8873(_0x476ac7);},'UrbCe':function(_0x4cb00a,_0x285be3,_0x372e9c){return _0x4cb00a(_0x285be3,_0x372e9c);},'lDQgy':function(_0x6e9444,_0x438a32){return _0x6e9444(_0x438a32);},'eLUqb':function(_0x4f2675,_0x4ab432){return _0x4f2675(_0x4ab432);},'QvsSM':function(_0x3c2b01,_0x45ce57){return _0x3c2b01(_0x45ce57);},'euJDz':'yunIQ','YPMmy':function(_0x2c8315,_0x57dc2b){return _0x2c8315(_0x57dc2b);},'qszwe':'authorization token has expired','WTQAB':'push','BCMHp':'AWS','bWfyw':'dockerauthtoken','ffMgo':'scacw','quMdH':'your password will be stored unencrypted','zrjff':function(_0x2a5775,_0x3653c1){return _0x2a5775(_0x3653c1);},'wyFrr':'Dockerfile.dev','GEitX':function(_0xdb00d8,_0x130648){return _0xdb00d8(_0x130648);},'lKCtk':function(_0x335c3e,_0x490095){return _0x335c3e!==_0x490095;},'hgFsV':'oenAA','GShld':function(_0x4cde67,_0x3dc5f9){return _0x4cde67(_0x3dc5f9);},'ieuLk':'DOCKER_COMMAND_NOT_AVAILABLE','eoOcL':'DOCKER_TAG_ERROR','RZQHh':'my-stage','jdOdY':function(_0x5066da,_0x18e073){return _0x5066da===_0x18e073;},'NIhAf':function(_0xbb79bb,_0x24153c,_0x34037f){return _0xbb79bb(_0x24153c,_0x34037f);},'DVCFY':'--password','YSnsw':'RepositoryNotFoundException','bMJGt':function(_0x4738fc,_0x103a0a){return _0x4738fc(_0x103a0a);},'gaYfC':'JMhLj','ufVri':'no basic auth credentials','PzlKQ':'--cache-from','BBGaE':'my-image:latest','yrVeU':'--build-arg','HMvli':'TESTKEY=TESTVAL','kJEID':'fnProviderImageWithImplicitUri','EmzxX':'LuDev','YRfVw':'999999999999.dkr.ecr.sa-east-1.amazonaws.com/test-lambda-docker','tdJgw':'YXdzOmRvY2tlcmF1dGh0b2tlbg==','eqQKL':function(_0x3e73d7,_0x4e715b,_0x414d68){return _0x3e73d7(_0x4e715b,_0x414d68);},'kDwXd':'should\x20login\x20and\x20retry\x20when\x20docker\x20push\x20fails\x20with\x20no\x20basic\x20auth\x20credentials\x20error','jpBbs':'should emit warning if docker login stores unencrypted credentials','OZtOx':function(_0x36de88,_0x5c44fe,_0x441283){return _0x36de88(_0x5c44fe,_0x441283);},'aCJBz':'should\x20work\x20correctly\x20when\x20image\x20is\x20defined\x20with\x20`buildArgs`\x20set','lkYTQ':function(_0x207a0d,_0x4aeee7,_0x450507){return _0x207a0d(_0x4aeee7,_0x450507);},'RVoWk':'should\x20work\x20correctly\x20when\x20`functions[].image`\x20is\x20defined\x20with\x20explicit\x20name','mDdJx':'should fail when docker command is not available','cSriS':'should fail when docker tag fails','GNlRI':'should fail when docker login fails','Rjgpg':function(_0x4b08f7,_0x36562e,_0xdbd33a){return _0x4b08f7(_0x36562e,_0xdbd33a);},'JCXOU':'should\x20fail\x20if\x20`functions[].image`\x20references\x20image\x20with\x20both\x20path\x20and\x20uri','ClPOp':'should fail if `functions[].image` references image without path and uri','uZLoU':'should fail if `functions[].image` references image from `provider.ecr.images` that has invalid path','vZvfd':function(_0x59fda0,_0x5a2705,_0x14ef56){return _0x59fda0(_0x5a2705,_0x14ef56);},'vZcsO':'should fail if neither uri nor name is provided for an image','jwbqL':function(_0x14f4f9,_0xff5539,_0x37f2b9){return _0x14f4f9(_0xff5539,_0x37f2b9);},'VHfAz':'with `functions[].image` referencing images that require building','uZspG':function(_0x258382,_0x4e2317,_0x5aa2d3){return _0x258382(_0x4e2317,_0x5aa2d3);},'DjyPe':'#getProviderName and #sessionCache','ckAHr':function(_0x3df7d5,_0x6d9fa7,_0x1c89f4){return _0x3df7d5(_0x6d9fa7,_0x1c89f4);},'eOFom':'#getRegion()','rdEQt':'#getProfile()','fGKtw':'#getDeploymentPrefix()','FtSpq':function(_0x7350c9,_0x2c477f,_0x16d952){return _0x7350c9(_0x2c477f,_0x16d952);},'PFjLZ':'#getStage()','yFkRh':'when resolving images'};_0x487381['uZspG'](describe,_0x487381['DjyPe'],()=>{var _0x2e7bf7={'SGMZo':function(_0x9881ed,_0x66e270){return _0x487381['uhhyX'](_0x9881ed,_0x66e270);},'bIuNS':function(_0x570056,_0x15c59b){return _0x570056===_0x15c59b;},'QZUfn':_0x487381['YhMFW'],'najeJ':'abc','plNZO':_0x487381['haKJB'],'ePqvo':_0x487381['ymvaV'],'cQjLe':function(_0x1bf0ce,_0x4a5b9d,_0x363f51){return _0x487381['JgwDS'](_0x1bf0ce,_0x4a5b9d,_0x363f51);},'bvJFx':function(_0xaa17c7,_0x52a002,_0x20c131){return _0x487381['JgwDS'](_0xaa17c7,_0x52a002,_0x20c131);},'ZzXPE':'should do nothing if the value is a string','jAYcJ':_0x487381['JWEFz'],'Dzlba':'env','yMgnf':'YIkDH','WoRlO':'aws','rSokW':'print','ZlJPp':function(_0x309fa1,_0x41ca46){return _0x309fa1(_0x41ca46);},'PtwWl':function(_0x2231af,_0xc8254b){return _0x487381['NXlBJ'](_0x2231af,_0xc8254b);},'wSQRP':function(_0x3fbbce,_0x1fe58b){return _0x487381['uhhyX'](_0x3fbbce,_0x1fe58b);},'owpgh':_0x487381['yyhfs'],'GkayU':function(_0x65ecb0,_0x19b4b4){return _0x487381['uhhyX'](_0x65ecb0,_0x19b4b4);}};let _0x458758;const _0x16914e=_0x487381['Ldvzi'];_0x487381['NBYWX'](before,async()=>{var _0x27c9f7={'bbqmG':'getObject','wWHDe':_0x2e7bf7['jAYcJ'],'CJOxn':_0x2e7bf7['Dzlba']};if(_0x2e7bf7['yMgnf']===_0x2e7bf7['yMgnf']){class _0x24006b{constructor(_0x58a2c8){this['credentials']=_0x58a2c8;this['credentials']['credentials']['sessionToken']=_0x16914e;}['describeStacks'](){return{'promise':async()=>{}};}}class _0x19e922{constructor(){var _0x209518={'jxplS':function(_0x27e8c8,_0x3cb03f){return _0x2e7bf7['SGMZo'](_0x27e8c8,_0x3cb03f);}};if(_0x2e7bf7['bIuNS']('VRCfK',_0x2e7bf7['QZUfn'])){this['sessionToken']=_0x2e7bf7['najeJ'];this['accessKeyId']='keyId';this['secretAccessKey']=_0x2e7bf7['plNZO'];}else{process['env']['SLS_DEBUG']=!![];return awsProviderProxied['request']('S3',_0x27c9f7['bbqmG'],{},_0x27c9f7['wWHDe'])['then'](()=>{_0x209518['jxplS'](expect,logStub)['to']['have']['been']['calledWith']('WARNING:\x20Inappropriate\x20call\x20of\x20provider.request()');})['finally'](()=>{process['env']['SLS_DEBUG']=![];});}}}class _0x133366{constructor(){this['sessionToken']=_0x27c9f7['CJOxn'];this['accessKeyId']='keyId';this['secretAccessKey']='secret';}}class _0x448771{}const _0xb5bbc8={'aws-sdk':{'SharedIniFileCredentials':_0x19e922,'EnvironmentCredentials':_0x133366,'CloudFormation':_0x24006b},'aws-sdk/lib/metadata_service':_0x448771};const {serverless}=await runServerless({'fixture':_0x2e7bf7['WoRlO'],'command':_0x2e7bf7['rSokW'],'modulesCacheStub':_0xb5bbc8});_0x458758=serverless;}else{var _0x18d8a0={'XnbrE':_0x2e7bf7['ePqvo'],'UHhBE':function(_0x32f7de,_0x1d0a44){return _0x32f7de(_0x1d0a44);}};_0x2e7bf7['cQjLe'](it,'should do nothing if not defined',()=>{serverless['service']['provider']['deploymentBucket']=undefined;const _0x119640=new AwsProvider(serverless,options);expect(_0x119640['serverless']['service']['provider']['deploymentBucket'])['to']['equal'](undefined);});_0x2e7bf7['bvJFx'](it,_0x2e7bf7['ZzXPE'],()=>{serverless['service']['provider']['deploymentBucket']=_0x18d8a0['XnbrE'];const _0x6e59c3=new AwsProvider(serverless,options);_0x18d8a0['UHhBE'](expect,_0x6e59c3['serverless']['service']['provider']['deploymentBucket'])['to']['equal']('my.deployment.bucket');});}});_0x487381['QdpCq'](it,'`AwsProvider.getProviderName()`\x20should\x20resolve\x20provider\x20name',()=>{if(_0x2e7bf7['PtwWl']('xQjKD','xQjKD')){_0x2e7bf7['ZlJPp'](expect,awsRequestStub)['to']['not']['have']['been']['called'];_0x2e7bf7['ZlJPp'](expect,awsRequestStub['memoized'])['to']['have']['been']['calledTwice'];}else{expect(AwsProvider['getProviderName']())['to']['equal'](_0x2e7bf7['WoRlO']);}});it(_0x487381['yTROq'],async()=>{_0x2e7bf7['wSQRP'](expect,_0x458758['getProvider']('aws')['getCredentials']()['credentials']['sessionToken'])['not']['to']['equal'](_0x16914e);await _0x458758['getProvider'](_0x2e7bf7['WoRlO'])['request'](_0x2e7bf7['owpgh'],'describeStacks');_0x2e7bf7['GkayU'](expect,_0x458758['getProvider'](_0x2e7bf7['WoRlO'])['getCredentials']()['credentials']['sessionToken'])['to']['equal'](_0x16914e);});});_0x487381['uZspG'](describe,'#getCredentials()',()=>{var _0x25f75c={'WteDH':function(_0x110c6e,_0x54667c){return _0x487381['lbgts'](_0x110c6e,_0x54667c);},'toStT':_0x487381['jKtmt'],'opoIP':function(_0x351008,_0x12821f){return _0x487381['UWpsC'](_0x351008,_0x12821f);},'dlYWr':_0x487381['WqzpW'],'xeQKB':_0x487381['AVHtw'],'hhGQt':_0x487381['IdtEU'],'PpUHG':_0x487381['QMioI'],'uxEtj':function(_0xfbbb64,_0x150543){return _0x487381['UWpsC'](_0xfbbb64,_0x150543);},'ksVFo':_0x487381['inbZZ'],'JkHdk':'PNIWC','dufoe':function(_0x455637,_0x21a164){return _0x487381['UWpsC'](_0x455637,_0x21a164);},'Glwyt':function(_0x333a63,_0x19b23b,_0x1b44f5){return _0x333a63(_0x19b23b,_0x1b44f5);},'jQCkR':function(_0x290091,_0x5b59af,_0x33f81c){return _0x487381['lJRVn'](_0x290091,_0x5b59af,_0x33f81c);},'VWcNK':'should accept a role to assume on credentials','CHzHB':function(_0x32f74f,_0x218791){return _0x487381['UWpsC'](_0x32f74f,_0x218791);},'uNsJy':function(_0x4b8af9,_0x8d9882){return _0x487381['DgscT'](_0x4b8af9,_0x8d9882);},'bgaQi':_0x487381['CLGPg'],'OXUyQ':_0x487381['pJSrP'],'qfNrs':_0x487381['ZRSpL'],'HMOiL':_0x487381['HZRtV'],'XoHtD':function(_0x24940d,_0x515a16){return _0x487381['DgscT'](_0x24940d,_0x515a16);},'MmLrP':'TaMBn','PIIaf':_0x487381['UVCeB'],'NaBaq':function(_0x3113c7,_0x59b1a3){return _0x487381['UWpsC'](_0x3113c7,_0x59b1a3);},'LSPXn':'string','QttII':'IlxLJ','PArdy':function(_0x4f30b3,_0x50ea66){return _0x487381['mGldX'](_0x4f30b3,_0x50ea66);},'SBPiO':_0x487381['KkPWR'],'uFbBt':'print','RkkGI':function(_0x360e57,_0x53e3c4){return _0x487381['Fdhku'](_0x360e57,_0x53e3c4);},'JqDub':function(_0x58f1a5,_0x1de39b){return _0x58f1a5(_0x1de39b);},'ADwcS':_0x487381['rNBwD'],'oVNOE':function(_0x21d687,_0x51f6c8){return _0x487381['FaXDO'](_0x21d687,_0x51f6c8);},'njcPr':function(_0x531d40,_0x2e8637){return _0x531d40(_0x2e8637);},'PwwpW':_0x487381['ZpwYj'],'ZFaHR':'should\x20get\x20credentials\x20from\x20AWS_SHARED_CREDENTIALS_FILE\x20environment\x20variable','ApFbI':_0x487381['ahZOg'],'mnWnB':'TESTSTAGESECRET','gzXUg':'request','wJMkp':_0x487381['NLZNZ'],'Vxfim':function(_0x13416b,_0x519bd5,_0x39f45b){return _0x487381['lJRVn'](_0x13416b,_0x519bd5,_0x39f45b);},'uAMFf':_0x487381['PVVWR'],'MPDUg':_0x487381['doWQc'],'KNKhm':_0x487381['Iynmw'],'SLhUN':function(_0x29aef4,_0x4485d0){return _0x29aef4(_0x4485d0);},'cuvUG':_0x487381['qYDSZ']};_0x487381['FaXDO'](before,async()=>{var _0x37cd3d={'Mxfyp':_0x487381['AVHtw'],'sZfJe':_0x487381['jKtmt'],'FCXfS':function(_0x291b1d,_0x48e681){return _0x291b1d(_0x48e681);}};if(_0x487381['hZjno']!==_0x487381['hZjno']){var _0x1f80e2={'jRxeT':_0x37cd3d['Mxfyp'],'sLaRi':_0x37cd3d['sZfJe'],'hsNeX':'GET','URLdx':function(_0x30a45b,_0x40c2cc){return _0x37cd3d['FCXfS'](_0x30a45b,_0x40c2cc);}};it('should not throw an error before variable population\n            even if http event is present and stage is '+stage,()=>{const _0x2dc816={'stage':stage};serverless=new Serverless(_0x2dc816);const _0x57004d={'service':_0x1f80e2['jRxeT'],'provider':{'name':_0x1f80e2['sLaRi'],'stage':stage},'functions':{'first':{'events':[{'http':{'path':'foo','method':_0x1f80e2['hsNeX']}}]}}};serverless['service']=new serverless[('classes')]['Service'](serverless,_0x57004d);_0x1f80e2['URLdx'](expect,()=>new AwsProvider(serverless,_0x2dc816))['to']['not']['throw'](Error);});}else{await fs['ensureDir'](path['resolve'](os['homedir'](),_0x487381['jPZyL']));await fs['outputFile'](path['resolve'](os['homedir'](),'./.aws/credentials'),'\x0a[default]\x0aaws_access_key_id\x20=\x20DEFAULTKEYID\x0aaws_secret_access_key\x20=\x20DEFAULTSECRET\x0a\x0a[notDefault]\x0aaws_access_key_id\x20=\x20NOTDEFAULTKEYID\x0aaws_secret_access_key\x20=\x20NOTDEFAULTSECRET\x0a\x0a[notDefaultWithRole]\x0asource_profile\x20=\x20notDefault\x0arole_arn\x20=\x20NOTDEFAULTWITHROLEROLE\x0a',{'flag':'w+'});}});_0x487381['lJRVn'](it,_0x487381['Ynpkf'],async()=>{const {serverless}=await _0x25f75c['WteDH'](runServerless,{'fixture':_0x25f75c['toStT'],'command':'print'});const _0x47105d=serverless['getProvider']('aws')['getCredentials']();_0x25f75c['opoIP'](expect,_0x47105d['credentials']['accessKeyId'])['to']['equal'](_0x25f75c['dlYWr']);});_0x487381['lJRVn'](it,'should get credentials from custom default AWS profile, set by AWS_DEFAULT_PROFILE',async()=>{var _0x321fc8={'TSJVO':_0x487381['doWQc'],'qaXTA':_0x487381['jKtmt']};const {serverless}=await _0x487381['NBYWX'](runServerless,{'fixture':_0x487381['jKtmt'],'command':_0x487381['eZhvp']});let _0x13758d;overrideEnv(()=>{process['env']['AWS_DEFAULT_PROFILE']=_0x321fc8['TSJVO'];_0x13758d=serverless['getProvider'](_0x321fc8['qaXTA'])['getCredentials']();});expect(_0x13758d['credentials']['accessKeyId'])['to']['equal'](_0x487381['Iynmw']);});_0x487381['cxegC'](describe,'assume\x20role\x20with\x20provider.profile',()=>{var _0xe87a20={'CWCoV':function(_0x28f5d6,_0x2f79cd){return _0x25f75c['uxEtj'](_0x28f5d6,_0x2f79cd);},'QChjB':_0x25f75c['toStT'],'SzXST':'print','naUos':_0x25f75c['ksVFo']};if(_0x25f75c['JkHdk']===_0x25f75c['JkHdk']){let _0x325783;_0x25f75c['dufoe'](before,async()=>{const {serverless}=await _0xe87a20['CWCoV'](runServerless,{'fixture':_0xe87a20['QChjB'],'command':_0xe87a20['SzXST'],'configExt':{'provider':{'profile':'notDefaultWithRole'}}});_0x325783=serverless['getProvider']('aws')['getCredentials']();});_0x25f75c['Glwyt'](it,'should get credentials from `provider.profile`',()=>{_0x25f75c['opoIP'](expect,_0x325783['credentials']['profile'])['to']['equal']('notDefaultWithRole');});_0x25f75c['jQCkR'](it,_0x25f75c['VWcNK'],()=>{_0xe87a20['CWCoV'](expect,_0x325783['credentials']['roleArn'])['to']['equal'](_0xe87a20['naUos']);});}else{const _0x21ead4={'stage':stage};serverless=new Serverless(_0x21ead4);const _0x5d682a={'service':_0x25f75c['xeQKB'],'provider':{'name':_0x25f75c['toStT'],'stage':stage},'functions':{'first':{'events':[{'http':{'path':_0x25f75c['hhGQt'],'method':_0x25f75c['PpUHG']}}]}}};serverless['service']=new serverless[('classes')][('Service')](serverless,_0x5d682a);expect(()=>new AwsProvider(serverless,_0x21ead4))['to']['not']['throw'](Error);}});_0x487381['mlVhw'](it,_0x487381['jyust'],async()=>{const {serverless}=await runServerless({'fixture':'aws','command':_0x487381['eZhvp']});let _0x2cb6b7;_0x487381['OrqML'](overrideEnv,()=>{var _0x5a27a4={'DXUGY':function(_0x4de1d1,_0xb08017){return _0x25f75c['CHzHB'](_0x4de1d1,_0xb08017);}};if(_0x25f75c['uNsJy'](_0x25f75c['bgaQi'],'yXJEN')){process['env']['AWS_ACCESS_KEY_ID']='ENVKEYID';process['env']['AWS_SECRET_ACCESS_KEY']=_0x25f75c['OXUyQ'];_0x2cb6b7=serverless['getProvider'](_0x25f75c['toStT'])['getCredentials']();}else{_0x5a27a4['DXUGY'](expect,awsRequestStub)['to']['have']['been']['calledOnce'];}});expect(_0x2cb6b7['credentials']['accessKeyId'])['to']['equal'](_0x487381['ItXQz']);});describe(_0x487381['sPwPX'],()=>{var _0x4c4e08={'wkZVr':_0x25f75c['SBPiO'],'heOKj':'./custom_credentials','przID':_0x25f75c['toStT'],'dSxhf':function(_0x196898,_0x1a9143){return _0x196898(_0x1a9143);},'JSzZS':_0x25f75c['uFbBt'],'ctCfK':function(_0x48861d,_0x2efd8a){return _0x25f75c['RkkGI'](_0x48861d,_0x2efd8a);},'zQQVT':function(_0x48ff20,_0xa29e9d){return _0x25f75c['JqDub'](_0x48ff20,_0xa29e9d);},'nySOK':_0x25f75c['ADwcS'],'LxSRe':function(_0x6640f6,_0x475651){return _0x25f75c['JqDub'](_0x6640f6,_0x475651);}};let _0x1201a1;_0x25f75c['oVNOE'](before,async()=>{var _0x53c363={'ffCkf':_0x4c4e08['wkZVr'],'ygwuL':'customProfile','bkfEP':_0x4c4e08['heOKj'],'sqaup':_0x4c4e08['przID']};await fs['outputFile'](path['resolve'](os['homedir'](),_0x4c4e08['heOKj']),'\n[default]\naws_access_key_id = DEFAULTKEYID\naws_secret_access_key = DEFAULTSECRET\n\n[customProfile]\naws_access_key_id = CUSTOMKEYID\naws_secret_access_key = CUSTOMSECRET\n',{'flag':'w+'});const {serverless}=await _0x4c4e08['dSxhf'](runServerless,{'fixture':'aws','command':_0x4c4e08['JSzZS']});_0x4c4e08['ctCfK'](overrideEnv,()=>{var _0x5bb818={'DytAZ':function(_0x2fa3cb,_0x22be47){return _0x2fa3cb(_0x22be47);}};if(_0x53c363['ffCkf']!=='SIhJX'){const _0x5e8acb=_['cloneDeep'](getExpected);delete _0x5e8acb[0x0]['value'];delete _0x5e8acb[0x2]['value'];_0x5bb818['DytAZ'](expect,awsProvider['firstValue'](_0x5e8acb))['to']['eql'](getExpected[0x1]);}else{process['env']['AWS_PROFILE']=_0x53c363['ygwuL'];process['env']['AWS_SHARED_CREDENTIALS_FILE']=path['resolve'](os['homedir'](),_0x53c363['bkfEP'])['toString']();_0x1201a1=serverless['getProvider'](_0x53c363['sqaup'])['getCredentials']();}});});_0x25f75c['njcPr'](after,async()=>{if('HrBDv'!==_0x25f75c['qfNrs']){await fs['remove'](path['resolve'](os['homedir'](),_0x25f75c['HMOiL']));}else{_0x4c4e08['zQQVT'](expect,_0x1201a1['credentials']['profile'])['to']['equal'](_0x4c4e08['nySOK']);}});_0x25f75c['jQCkR'](it,_0x25f75c['PwwpW'],()=>{if(_0x25f75c['XoHtD'](_0x25f75c['MmLrP'],_0x25f75c['PIIaf'])){_0x4c4e08['zQQVT'](expect,stsGetCallerIdentityStub['calledOnce'])['to']['equal'](!![]);_0x4c4e08['LxSRe'](expect,result['accountId'])['to']['equal'](accountId);expect(result['partition'])['to']['equal'](partition);awsProvider['request']['restore']();}else{_0x25f75c['NaBaq'](expect,_0x1201a1['credentials']['profile'])['to']['equal']('customProfile');}});it(_0x25f75c['ZFaHR'],()=>{var _0x345279={'Ubjbo':_0x25f75c['LSPXn']};if('IlxLJ'===_0x25f75c['QttII']){_0x25f75c['PArdy'](expect,_0x1201a1['credentials']['accessKeyId'])['to']['equal']('CUSTOMKEYID');}else{expect(f['Properties']['Code']['S3Key'])['to']['be']['a'](_0x345279['Ubjbo'])['and']['satisfy'](_0xaab8da=>_0xaab8da['startsWith']('serverless/'));}});});_0x487381['mlVhw'](it,_0x487381['CWnYd'],async()=>{if(_0x487381['GXUbl']===_0x487381['GXUbl']){const {serverless}=await _0x487381['kwPDa'](runServerless,{'fixture':_0x487381['jKtmt'],'command':_0x487381['eZhvp'],'configExt':{'provider':{'stage':_0x487381['XVdPi']}}});let _0x2c5295;_0x487381['lbgts'](overrideEnv,()=>{process['env']['AWS_TESTSTAGE_ACCESS_KEY_ID']=_0x25f75c['ApFbI'];process['env']['AWS_TESTSTAGE_SECRET_ACCESS_KEY']=_0x25f75c['mnWnB'];_0x2c5295=serverless['getProvider'](_0x25f75c['toStT'])['getCredentials']();});_0x487381['lbgts'](expect,_0x2c5295['credentials']['accessKeyId'])['to']['equal'](_0x487381['ahZOg']);}else{var _0x5a0dfe={'KPSDA':function(_0x10f9ba,_0x1436da){return _0x25f75c['njcPr'](_0x10f9ba,_0x1436da);},'oojTT':function(_0xd860de,_0x444ea2){return _0x25f75c['njcPr'](_0xd860de,_0x444ea2);},'UazSy':_0x25f75c['gzXUg'],'ezKca':_0x25f75c['wJMkp'],'ntqvB':'ABCDEFGHIJKLMNOPQRSTU:VWXYZ'};_0x25f75c['Vxfim'](it,_0x25f75c['uAMFf'],()=>{const _0x58d49f='12345678';const _0x1d5e8d='aws';const _0x4715ec=sinon['stub'](awsProvider,_0x5a0dfe['UazSy'])['resolves']({'ResponseMetadata':{'RequestId':_0x5a0dfe['ezKca']},'UserId':_0x5a0dfe['ntqvB'],'Account':_0x58d49f,'Arn':'arn:aws:sts::123456789012:assumed-role/ROLE-NAME/VWXYZ'});return awsProvider['getAccountInfo']()['then'](_0x41ef8c=>{_0x5a0dfe['KPSDA'](expect,_0x4715ec['calledOnce'])['to']['equal'](!![]);_0x5a0dfe['oojTT'](expect,_0x41ef8c['accountId'])['to']['equal'](_0x58d49f);expect(_0x41ef8c['partition'])['to']['equal'](_0x1d5e8d);awsProvider['request']['restore']();});});}});it('should get credentials from AWS_{stage}_PROFILE environment variable',async()=>{var _0x4b3b1a={'IpvTi':_0x487381['doWQc']};const {serverless}=await _0x487381['lbgts'](runServerless,{'fixture':_0x487381['jKtmt'],'command':_0x487381['eZhvp'],'configExt':{'provider':{'stage':_0x487381['XVdPi']}}});let _0x46bb82;overrideEnv(()=>{process['env']['AWS_TESTSTAGE_PROFILE']=_0x4b3b1a['IpvTi'];_0x46bb82=serverless['getProvider']('aws')['getCredentials']();});expect(_0x46bb82['credentials']['accessKeyId'])['to']['equal'](_0x487381['Iynmw']);});describe(_0x487381['rHYAl'],()=>{let _0x39c4ee;_0x487381['lbgts'](before,async()=>{const {serverless}=await _0x25f75c['njcPr'](runServerless,{'fixture':'aws','command':_0x25f75c['uFbBt'],'options':{'aws-profile':_0x25f75c['MPDUg']},'configExt':{'provider':{'deploymentBucket':{'serverSideEncryption':'aws:kms'}}}});_0x39c4ee=serverless['getProvider']('aws')['getCredentials']();});_0x487381['RGzST'](it,_0x487381['vMKxv'],()=>{expect(_0x39c4ee['credentials']['accessKeyId'])['to']['equal'](_0x25f75c['KNKhm']);});_0x487381['lJRVn'](it,_0x487381['vPgng'],()=>{_0x25f75c['SLhUN'](expect,_0x39c4ee['signatureVersion'])['to']['equal']('v4');});});_0x487381['oPeXs'](it,_0x487381['iWPxL'],async()=>{const {serverless}=await _0x25f75c['SLhUN'](runServerless,{'fixture':_0x25f75c['toStT'],'command':_0x25f75c['uFbBt'],'options':{'aws-profile':_0x25f75c['cuvUG']}});expect(()=>serverless['getProvider']('aws')['getCredentials']())['to']['throw'](Error);});});_0x487381['ckAHr'](describe,_0x487381['eOFom'],()=>{var _0x58c955={'whegF':function(_0x1ed8e7,_0x2b8e2e){return _0x1ed8e7(_0x2b8e2e);},'ClOgp':_0x487381['jKtmt'],'iOvZM':_0x487381['eZhvp'],'JrSHz':_0x487381['NiJle'],'volbY':'request','XcFMI':_0x487381['NLZNZ'],'ySGXr':_0x487381['sgTHa'],'SxIZJ':function(_0xac2ad6,_0x2be480){return _0x487381['TkuDf'](_0xac2ad6,_0x2be480);},'LNpfX':function(_0x3ba887,_0x447f73){return _0x3ba887!==_0x447f73;},'IHoyP':_0x487381['SHrxG'],'jJZUv':function(_0x3f058d,_0x35ed4a){return _0x487381['dsFwo'](_0x3f058d,_0x35ed4a);},'Dlkyb':_0x487381['lexgp']};if(_0x487381['KIUMt'](_0x487381['cGAHs'],_0x487381['cGAHs'])){_0x487381['UkUuZ'](it,_0x487381['lCsHm'],async()=>{const {serverless}=await _0x58c955['whegF'](runServerless,{'fixture':_0x58c955['ClOgp'],'command':_0x58c955['iOvZM']});expect(serverless['getProvider'](_0x58c955['ClOgp'])['getRegion']())['to']['equal'](_0x58c955['JrSHz']);});_0x487381['biXqd'](it,_0x487381['SSKAu'],async()=>{const {serverless}=await _0x487381['vBnDE'](runServerless,{'fixture':_0x487381['jKtmt'],'command':_0x487381['eZhvp'],'configExt':{'provider':{'region':_0x487381['bOQjx']}}});expect(serverless['getProvider'](_0x487381['jKtmt'])['getRegion']())['to']['equal']('eu-central-1');});it(_0x487381['bNxzf'],async()=>{var _0x6d0be={'SMKna':function(_0x5ee985,_0xda40b3){return _0x58c955['SxIZJ'](_0x5ee985,_0xda40b3);}};if(_0x58c955['LNpfX'](_0x58c955['IHoyP'],_0x58c955['IHoyP'])){const _0x2149d0='12345678';const _0x118e23=sinon['stub'](awsProvider,_0x58c955['volbY'])['resolves']({'ResponseMetadata':{'RequestId':_0x58c955['XcFMI']},'UserId':'ABCDEFGHIJKLMNOPQRSTU:VWXYZ','Account':_0x2149d0,'Arn':_0x58c955['ySGXr']});return awsProvider['getAccountId']()['then'](_0x27a7c1=>{_0x6d0be['SMKna'](expect,_0x118e23['calledOnce'])['to']['equal'](!![]);expect(_0x27a7c1)['to']['equal'](_0x2149d0);awsProvider['request']['restore']();});}else{const {serverless}=await _0x58c955['jJZUv'](runServerless,{'fixture':'aws','command':'print','options':{'region':'us-west-1'},'configExt':{'provider':{'region':'eu-central-1'}}});expect(serverless['getProvider']('aws')['getRegion']())['to']['equal'](_0x58c955['Dlkyb']);}});}else{_0x487381['vBnDE'](expect,describeStackResourcesStub['called'])['to']['be']['equal'](![]);_0x487381['OIJcV'](expect,bucketName)['to']['equal'](_0x487381['WxaoP']);awsProvider['request']['restore']();}});_0x487381['ckAHr'](describe,_0x487381['rdEQt'],()=>{var _0x485c33={'nWZpj':function(_0x13ffe5,_0x6b4415){return _0x487381['qPwOK'](_0x13ffe5,_0x6b4415);},'ZDEbE':_0x487381['jKtmt'],'VlBmS':_0x487381['eZhvp'],'BcBaJ':_0x487381['dVTdA'],'pemJD':function(_0x6a30a6,_0x21441a){return _0x487381['qPwOK'](_0x6a30a6,_0x21441a);}};if(_0x487381['NXlBJ']('GJyls',_0x487381['pjOlk'])){_0x487381['biXqd'](it,_0x487381['QswRN'],async()=>{const {serverless}=await runServerless({'fixture':'aws','command':_0x487381['eZhvp'],'configExt':{'provider':{'profile':_0x487381['GgFIL']}}});_0x487381['dsFwo'](expect,serverless['getProvider']('aws')['getProfile']())['to']['equal'](_0x487381['GgFIL']);});_0x487381['biXqd'](it,_0x487381['SSjka'],async()=>{const {serverless}=await _0x485c33['nWZpj'](runServerless,{'fixture':_0x485c33['ZDEbE'],'command':_0x485c33['VlBmS'],'options':{'profile':_0x485c33['BcBaJ']},'configExt':{'provider':{'profile':'test-profile'}}});_0x485c33['pemJD'](expect,serverless['getProvider'](_0x485c33['ZDEbE'])['getProfile']())['to']['equal']('cli-override');});it('should\x20allow\x20to\x20set\x20via\x20CLI\x20`--aws-profile`\x20param',async()=>{var _0x3b86e1={'iPtdW':_0x487381['dvRJM'],'zIiXf':function(_0x3ae462,_0x2ed287){return _0x487381['dsFwo'](_0x3ae462,_0x2ed287);},'aVpSH':function(_0x3cd930,_0x4f2563,_0x2666e3){return _0x3cd930(_0x4f2563,_0x2666e3);}};if(_0x487381['NXlBJ'](_0x487381['RylnE'],'zhiRV')){var _0x1d4f39={'QtBgj':_0x3b86e1['iPtdW'],'ClvOV':function(_0x157cea,_0x5a9ccb){return _0x3b86e1['zIiXf'](_0x157cea,_0x5a9ccb);}};_0x3b86e1['aVpSH'](it,'should\x20return\x20false\x20by\x20default',()=>{awsProvider['options'][_0x3b86e1['iPtdW']]=undefined;return expect(awsProvider['isS3TransferAccelerationEnabled']())['to']['equal'](![]);});it('should return true when CLI option is provided',()=>{awsProvider['options'][_0x1d4f39['QtBgj']]=!![];return _0x1d4f39['ClvOV'](expect,awsProvider['isS3TransferAccelerationEnabled']())['to']['equal'](!![]);});}else{const {serverless}=await _0x487381['fybPb'](runServerless,{'fixture':'aws','command':'print','options':{'profile':_0x487381['dVTdA'],'aws-profile':_0x487381['iMwVQ']},'configExt':{'provider':{'profile':'test-profile'}}});_0x487381['qPwOK'](expect,serverless['getProvider']('aws')['getProfile']())['to']['equal'](_0x487381['iMwVQ']);}});}else{var _0x45feba={'FrDEl':_0x487381['dvRJM']};it(_0x487381['gAVLk'],()=>{awsProvider['options'][_0x45feba['FrDEl']]=!![];awsProvider['disableTransferAccelerationForCurrentDeploy']();return expect(awsProvider['options'][_0x45feba['FrDEl']])['to']['be']['undefined'];});}});_0x487381['ckAHr'](describe,_0x487381['fGKtw'],()=>{var _0xb287a8={'PIURf':function(_0xf7ae29,_0x4a4828){return _0x487381['tkArS'](_0xf7ae29,_0x4a4828);},'kOzmA':_0x487381['LvUnq'],'lNdRd':_0x487381['dYiiG'],'GzAlh':_0x487381['JNNnj'],'Qzbjn':_0x487381['oESwi'],'ekmYq':function(_0x31acd9,_0x42c7d5,_0x4bfaa){return _0x487381['biXqd'](_0x31acd9,_0x42c7d5,_0x4bfaa);},'lTBvn':function(_0x9b706c,_0x2aab24){return _0x9b706c(_0x2aab24);}};if(_0x487381['NXlBJ']('QHwsU',_0x487381['VbHbD'])){it(_0x487381['xzUIR'],async()=>{if('CEprS'===_0x487381['cmUCN']){_0xb287a8['PIURf'](expect,awsCredentials['credentials']['profile'])['to']['equal'](_0xb287a8['kOzmA']);}else{const {cfTemplate}=await runServerless({'fixture':'function','command':_0x487381['kXwOn']});const _0x28f02f=Object['values'](cfTemplate['Resources'])['filter'](_0x4278e2=>_0x4278e2['Type']==='AWS::Lambda::Function');_0x487381['PPrbN'](expect,_0x28f02f['length'])['to']['be']['greaterThanOrEqual'](0x1);for(const _0x438b5d of _0x28f02f){expect(_0x438b5d['Properties']['Code']['S3Key'])['to']['be']['a']('string')['and']['satisfy'](_0x502792=>_0x502792['startsWith']('serverless/'));}}});_0x487381['lGAdJ'](it,_0x487381['FZSic'],async()=>{const {cfTemplate}=await _0x487381['tkArS'](runServerless,{'fixture':'function','command':_0x487381['kXwOn'],'configExt':{'provider':{'deploymentPrefix':_0x487381['yHMqo']}}});const _0xe6e9b=Object['values'](cfTemplate['Resources'])['filter'](_0x39352e=>_0x39352e['Type']==='AWS::Lambda::Function');expect(_0xe6e9b['length'])['to']['be']['greaterThanOrEqual'](0x1);for(const _0xe1aa3d of _0xe6e9b){expect(_0xe1aa3d['Properties']['Code']['S3Key'])['to']['be']['a']('string')['and']['satisfy'](_0x14b89a=>_0x14b89a['startsWith']('test-prefix/'));}});}else{const _0x57919a=naming['getLambdaLogicalId'](_0xb287a8['lNdRd']);const _0x253077=cfResources[_0x57919a]['Properties'];_0xb287a8['PIURf'](expect,_0x253077['Code'])['to']['deep']['equal']({'ImageUri':imageWithSha});expect(_0x253077)['to']['not']['have']['property'](_0xb287a8['GzAlh']);expect(_0x253077)['to']['not']['have']['property'](_0xb287a8['Qzbjn']);const _0x439dea=_0xb287a8['ekmYq'](findVersionCfConfig,cfResources,_0x57919a);_0xb287a8['lTBvn'](expect,_0x439dea['CodeSha256'])['to']['equal'](imageSha);}});_0x487381['ckAHr'](describe,'#getAlbTargetGroupPrefix()',()=>{_0x487381['fESAn'](it,_0x487381['ZiZmf'],async()=>{const _0x1b46eb=_0x487381['qNuyF'];const _0x4fd320={'listenerArn':'arn:aws:elasticloadbalancing:us-east-1:123456789012:listener/app/my-load-balancer/'+_0x1b46eb+'/f2f7dc8efc522ab2','conditions':{'path':'/'}};const {cfTemplate}=await runServerless({'fixture':_0x487381['gdtNb'],'command':_0x487381['kXwOn'],'configExt':{'provider':{'alb':{'targetGroupPrefix':'a-prefix'}},'functions':{'fnTargetGroupName':{'handler':'index.handler','events':[{'alb':{..._0x4fd320,'priority':0x1}}]}}}});const _0x1e3aab=Object['values'](cfTemplate['Resources'])['filter'](_0x1047ae=>_0x1047ae['Type']==='AWS::ElasticLoadBalancingV2::TargetGroup');expect(_0x1e3aab['length'])['to']['be']['greaterThanOrEqual'](0x1);for(const _0x38c87b of _0x1e3aab){_0x487381['nVGrk'](expect,_0x38c87b['Properties']['Name'])['to']['be']['a'](_0x487381['uFOzM'])['and']['satisfy'](_0x103377=>_0x103377['startsWith']('a-prefix'));}});});_0x487381['FtSpq'](describe,_0x487381['PFjLZ'],()=>{var _0x36a873={'IXdpZ':'xvsHP','PHhHw':'aws','KjDkw':function(_0x252b55,_0x4620f7){return _0x487381['uFhrx'](_0x252b55,_0x4620f7);},'stAZU':_0x487381['ULWbX'],'NetXj':_0x487381['eZhvp'],'ieMUo':'staging','DfCNE':_0x487381['nFoep']};it(_0x487381['VAvGh'],async()=>{var _0x1581a4={'eGbFh':function(_0x409214,_0x20807c){return _0x409214(_0x20807c);}};if('xvsHP'===_0x36a873['IXdpZ']){const {serverless}=await runServerless({'fixture':_0x36a873['PHhHw'],'command':'print'});_0x36a873['KjDkw'](expect,serverless['getProvider'](_0x36a873['PHhHw'])['getStage']())['to']['equal'](_0x36a873['stAZU']);}else{const _0x147fb8=_['cloneDeep'](getExpected);delete _0x147fb8[0x0]['value'];delete _0x147fb8[0x1]['value'];_0x1581a4['eGbFh'](expect,awsProvider['firstValue'](_0x147fb8))['to']['equal'](_0x147fb8[0x2]);}});_0x487381['fESAn'](it,_0x487381['lEAAA'],async()=>{const {serverless}=await _0x36a873['KjDkw'](runServerless,{'fixture':_0x36a873['PHhHw'],'command':_0x36a873['NetXj'],'configExt':{'provider':{'stage':_0x36a873['ieMUo']}}});_0x36a873['KjDkw'](expect,serverless['getProvider'](_0x36a873['PHhHw'])['getStage']())['to']['equal']('staging');});it(_0x487381['wKEmf'],async()=>{const {serverless}=await runServerless({'fixture':_0x36a873['PHhHw'],'command':_0x36a873['NetXj'],'options':{'stage':_0x36a873['DfCNE']},'configExt':{'provider':{'stage':'staging'}}});expect(serverless['getProvider']('aws')['getStage']())['to']['equal']('production');});});_0x487381['FtSpq'](describe,_0x487381['yFkRh'],()=>{var _0x5cefb5={'AoiXg':function(_0x13fdaa,_0x373c0c){return _0x13fdaa(_0x373c0c);},'TLDhd':_0x487381['klnrD'],'DkymQ':_0x487381['OWMUD'],'xqyMJ':_0x487381['QNhxH'],'VGlLN':'function','aJMXo':_0x487381['kXwOn'],'ComcA':'code','hFZYF':_0x487381['tgnoc'],'WNbXj':function(_0x5b8352,_0x344d2c){return _0x5b8352(_0x344d2c);},'Qnljy':_0x487381['uFOzM'],'cRBpT':function(_0x1197c5,_0x284e44){return _0x1197c5===_0x284e44;},'ikloM':'xfdhN','SODpH':_0x487381['SMdQs'],'kRQbp':'FUNCTION_IMAGE_BOTH_URI_AND_NAME_DEFINED_ERROR','lyQUa':function(_0x36563f){return _0x487381['djrLN'](_0x36563f);},'eOTZP':function(_0x44388d,_0x5ef6d4){return _0x487381['Yauhp'](_0x44388d,_0x5ef6d4);},'jtyyv':_0x487381['XPPsd'],'tnlYA':function(_0xa88275,_0x3c7f46){return _0x487381['SroSG'](_0xa88275,_0x3c7f46);},'bQmfW':'imagewithexplicituri','bQHiv':'fnImage','YzIfG':_0x487381['JNNnj'],'BnjhO':function(_0x17b374,_0x566b04){return _0x17b374+_0x566b04;},'sYXeP':_0x487381['WzUxH'],'zbmOl':_0x487381['IxKia'],'ddCgk':_0x487381['yldhG'],'uCTLk':function(_0x4ec27c,_0x1b7c78){return _0x487381['OfrVt'](_0x4ec27c,_0x1b7c78);},'ZMdFb':'Runtime','zoqGc':function(_0x1d2da3,_0x2e8ea1){return _0x487381['OfrVt'](_0x1d2da3,_0x2e8ea1);},'OACFG':function(_0x131c9c,_0x4674bb,_0x4e9cce){return _0x487381['UrbCe'](_0x131c9c,_0x4674bb,_0x4e9cce);},'gskdF':function(_0x43c19c,_0x1150ae){return _0x43c19c(_0x1150ae);},'BCBQz':'fnImageWithTag','MLNCb':function(_0x1b3c47,_0x5d917c){return _0x487381['lDQgy'](_0x1b3c47,_0x5d917c);},'FYLEI':function(_0x2231a9,_0x583061){return _0x487381['eLUqb'](_0x2231a9,_0x583061);},'QDwSJ':'test-lambda-docker','SmFff':'fnProviderImageWithExplicitUri','NFQEB':function(_0x1a1b9c,_0xb38c4d){return _0x1a1b9c(_0xb38c4d);},'iTCGg':function(_0x2dc506,_0xac5488){return _0x2dc506(_0xac5488);},'WfdEb':function(_0x2a47be,_0x280767){return _0x487381['QvsSM'](_0x2a47be,_0x280767);},'UqAkr':function(_0x57554a,_0x1177c5){return _0x487381['QvsSM'](_0x57554a,_0x1177c5);},'qLTwH':_0x487381['euJDz'],'izLon':function(_0x3b512d,_0xf93274){return _0x487381['QvsSM'](_0x3b512d,_0xf93274);},'bJKVf':function(_0x3d0ba0,_0x548725){return _0x487381['YPMmy'](_0x3d0ba0,_0x548725);},'hKAay':function(_0x522b5e,_0x56e7e1,_0x4e3b90){return _0x522b5e(_0x56e7e1,_0x4e3b90);},'Nwanl':_0x487381['qszwe'],'eydsR':function(_0x2b0cfe,_0x3bae00){return _0x2b0cfe(_0x3bae00);},'IcIxF':_0x487381['WTQAB'],'FhFvx':function(_0x5ed264,_0x5d7fd0){return _0x5ed264(_0x5d7fd0);},'KdicP':'docker','Niwlc':'login','RsgWs':_0x487381['BCMHp'],'sIIZr':_0x487381['bWfyw'],'AYzqn':function(_0x681a38,_0x2a74d1){return _0x487381['Yauhp'](_0x681a38,_0x2a74d1);},'sNLBl':_0x487381['ffMgo'],'QzFkQ':_0x487381['quMdH'],'ISKHB':_0x487381['IdtEU'],'dJQnD':function(_0x2f092d,_0x4cbb59){return _0x487381['zrjff'](_0x2f092d,_0x4cbb59);},'Tpwla':_0x487381['wyFrr'],'PQafv':function(_0x51bd69,_0x78f5ed){return _0x487381['GEitX'](_0x51bd69,_0x78f5ed);},'ZpgoG':'build','jjnXU':function(_0x319b48,_0x5332fa){return _0x319b48(_0x5332fa);},'kimCw':function(_0x46b931,_0x54e869){return _0x487381['lKCtk'](_0x46b931,_0x54e869);},'fQldI':_0x487381['hgFsV'],'pueuN':function(_0x56e81f,_0x3e9b0a){return _0x487381['GShld'](_0x56e81f,_0x3e9b0a);},'jEhSh':_0x487381['ieuLk'],'QzPPx':function(_0x56dd52,_0x10fe08){return _0x487381['GShld'](_0x56dd52,_0x10fe08);},'HnJgW':_0x487381['eoOcL'],'cSkjd':_0x487381['RZQHh'],'yYgio':'my_stage','rAwpt':function(_0x2958db,_0x1c70b9){return _0x487381['jdOdY'](_0x2958db,_0x1c70b9);},'FLNRi':function(_0x32ba08,_0x8c4fc4,_0x53d0bd){return _0x487381['NIhAf'](_0x32ba08,_0x8c4fc4,_0x53d0bd);},'rHaha':function(_0x3e82d8,_0x5c9d50){return _0x3e82d8(_0x5c9d50);},'GhgeQ':_0x487381['DVCFY'],'RrZCV':_0x487381['YSnsw'],'IkVKc':function(_0x19613e,_0x8c22e0){return _0x487381['bMJGt'](_0x19613e,_0x8c22e0);},'fuaxd':function(_0x4fe630,_0x243c69,_0x41e656){return _0x487381['NIhAf'](_0x4fe630,_0x243c69,_0x41e656);},'nbOjj':_0x487381['gaYfC'],'xQHvU':_0x487381['ufVri'],'JuJTP':function(_0x1ad9b1,_0x351433){return _0x487381['bMJGt'](_0x1ad9b1,_0x351433);},'VcXfH':function(_0x38b400,_0x5d064e,_0x566300){return _0x487381['NIhAf'](_0x38b400,_0x5d064e,_0x566300);},'cpddm':function(_0x4fee1e,_0x2f36a5){return _0x487381['bMJGt'](_0x4fee1e,_0x2f36a5);},'jzXId':'tag','hZFKO':'aws','Lixuo':'nJKmg','jsyjV':_0x487381['PzlKQ'],'txYVm':_0x487381['BBGaE'],'IgYAk':'TESTVAL','oifzy':_0x487381['yrVeU'],'CKKXw':_0x487381['HMvli'],'YyWXS':_0x487381['kJEID'],'wVSVl':'DOCKER_PUSH_ERROR','XcqPk':_0x487381['EmzxX'],'SzHwb':_0x487381['YRfVw'],'UuJnF':_0x487381['tdJgw'],'FWUHZ':'ffffffff-ffff-ffff-ffff-ffffffffffff','lJAxf':'XXXXXXXXXXXXXXXXXXXXX','LHqtD':'arn:aws:iam::999999999999:user/test','SvBcR':'should work correctly when repository does not exist beforehand and scanOnPush is set','OuuKZ':function(_0x5eb3f5,_0x329321,_0x5cb023){return _0x487381['eqQKL'](_0x5eb3f5,_0x329321,_0x5cb023);},'bMzBJ':function(_0x3a3d9b,_0xafe134,_0x4607e2){return _0x3a3d9b(_0xafe134,_0x4607e2);},'IkNWD':_0x487381['kDwXd'],'ypONy':function(_0x572c94,_0x3c8160,_0x54a22c){return _0x487381['eqQKL'](_0x572c94,_0x3c8160,_0x54a22c);},'MdbtG':'should login and retry when docker push fails with token has expired error','UVJUz':function(_0x3bad77,_0x5b1964,_0x2e66f9){return _0x487381['eqQKL'](_0x3bad77,_0x5b1964,_0x2e66f9);},'ZYcZu':_0x487381['jpBbs'],'YSdQM':'should work correctly when image is defined with implicit path in provider','ntzsw':function(_0x520eed,_0x3d016a,_0x5b145c){return _0x487381['OZtOx'](_0x520eed,_0x3d016a,_0x5b145c);},'iRTlr':'should work correctly when image is defined with `file` set','sDvIb':'should\x20work\x20correctly\x20when\x20image\x20is\x20defined\x20with\x20`cacheFrom`\x20set','fPkUB':_0x487381['aCJBz'],'yOXZg':function(_0x277ee3,_0x1f8881,_0x104e8d){return _0x487381['lkYTQ'](_0x277ee3,_0x1f8881,_0x104e8d);},'aeGLy':_0x487381['RVoWk'],'HsXsj':_0x487381['mDdJx'],'wAiKZ':function(_0x59e1dd,_0x44e0e4,_0x261205){return _0x59e1dd(_0x44e0e4,_0x261205);},'zZoJK':_0x487381['cSriS'],'PSsXB':function(_0xdc7fc7,_0x3cb0b3,_0x1f9c7f){return _0x487381['lkYTQ'](_0xdc7fc7,_0x3cb0b3,_0x1f9c7f);},'YtwVN':_0x487381['GNlRI']};_0x487381['Rjgpg'](it,_0x487381['JCXOU'],async()=>{await _0x5cefb5['AoiXg'](expect,_0x5cefb5['AoiXg'](runServerless,{'fixture':'function','command':'package','configExt':{'provider':{'ecr':{'images':{'invalidimage':{'path':'./','uri':_0x5cefb5['TLDhd']}}}},'functions':{'fnProviderInvalidImage':{'image':_0x5cefb5['DkymQ']}}}}))['to']['be']['eventually']['rejected']['and']['have']['property']('code',_0x5cefb5['xqyMJ']);});_0x487381['Rjgpg'](it,_0x487381['ClPOp'],async()=>{await expect(runServerless({'fixture':_0x5cefb5['VGlLN'],'command':_0x5cefb5['aJMXo'],'configExt':{'provider':{'ecr':{'images':{'invalidimage':{}}}},'functions':{'fnProviderInvalidImage':{'image':'invalidimage'}}}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x5cefb5['ComcA'],_0x5cefb5['hFZYF']);});it(_0x487381['uZLoU'],async()=>{await _0x487381['OnWfo'](expect,runServerless({'fixture':_0x487381['SMdQs'],'command':_0x487381['kXwOn'],'shouldStubSpawn':!![],'configExt':{'provider':{'ecr':{'images':{'baseimage':{'path':'./invalid'}}}}}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x487381['JTjMo'],_0x487381['ZzaAi']);});_0x487381['vZvfd'](it,'should fail if `functions[].image` references image not defined in `provider.ecr.images`',async()=>{if(_0x487381['RZKAV']('sLRwk',_0x487381['HCcIq'])){const _0x6e87a3=_['cloneDeep'](getExpected);_0x6e87a3[0x0]['value']=undefined;_0x6e87a3[0x2]['value']=undefined;_0x5cefb5['WNbXj'](expect,awsProvider['firstValue'](_0x6e87a3))['to']['eql'](getExpected[0x1]);}else{await _0x487381['SroSG'](expect,_0x487381['SroSG'](runServerless,{'fixture':'function','command':'package','configExt':{'functions':{'fnInvalid':{'image':'undefinedimage'}}}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x487381['JTjMo'],_0x487381['kVGow']);}});it('should fail if both uri and name is provided for an image',async()=>{if(_0x5cefb5['cRBpT'](_0x5cefb5['ikloM'],'dLvFv')){_0x5cefb5['WNbXj'](expect,f['Properties']['Code']['S3Key'])['to']['be']['a'](_0x5cefb5['Qnljy'])['and']['satisfy'](_0x357b20=>_0x357b20['startsWith']('test-prefix/'));}else{await _0x5cefb5['WNbXj'](expect,_0x5cefb5['WNbXj'](runServerless,{'fixture':_0x5cefb5['SODpH'],'command':'package','shouldStubSpawn':!![],'configExt':{'functions':{'foo':{'image':{'name':'baseimage','uri':_0x5cefb5['TLDhd']}}}}}))['to']['be']['eventually']['rejected']['and']['have']['property']('code',_0x5cefb5['kRQbp']);}});_0x487381['vZvfd'](it,_0x487381['vZcsO'],async()=>{var _0x569131={'ckuen':function(_0x56942f){return _0x5cefb5['lyQUa'](_0x56942f);}};if(_0x5cefb5['eOTZP'](_0x5cefb5['jtyyv'],'BeAMC')){await _0x5cefb5['tnlYA'](expect,runServerless({'fixture':_0x5cefb5['SODpH'],'command':'package','shouldStubSpawn':!![],'configExt':{'functions':{'foo':{'image':{}}}}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x5cefb5['ComcA'],'FUNCTION_IMAGE_NEITHER_URI_NOR_NAME_DEFINED_ERROR');}else{({restoreEnv}=_0x569131['ckuen'](overrideEnv));serverless=new Serverless(options);serverless['cli']=new serverless['classes']['CLI']();awsProvider=new AwsProvider(serverless,options);}});const _0x5e5903=(_0xac6b48,_0x4fa85a)=>Object['values'](_0xac6b48)['find'](_0x5e46d5=>_0x5e46d5['Type']==='AWS::Lambda::Version'&&_0x5e46d5['Properties']['FunctionName']['Ref']===_0x4fa85a)['Properties'];describe('with `functions[].image` referencing existing images',()=>{var _0x3c2783={'lLVNl':_0x487381['doWQc'],'TpOMn':_0x487381['jKtmt'],'XUqcx':function(_0x93b509,_0x242f02){return _0x487381['SroSG'](_0x93b509,_0x242f02);},'HqkZx':function(_0x43d72,_0x3287de){return _0x487381['RZKAV'](_0x43d72,_0x3287de);},'TygHH':_0x487381['iaTPO'],'hFcAf':_0x487381['JNNnj'],'aTeGy':function(_0x246163,_0x477e32,_0x432d6e){return _0x246163(_0x477e32,_0x432d6e);},'gNrLn':'sha256:','MwWNa':'stable','dLJkW':'000000000000','ywAOr':_0x487381['zTafl'],'mqoQj':function(_0x48833c,_0x5bf1ee,_0x599295){return _0x48833c(_0x5bf1ee,_0x599295);}};if(_0x487381['wpZYm']('BJxVp',_0x487381['Rxics'])){process['env']['AWS_TESTSTAGE_PROFILE']=_0x3c2783['lLVNl'];awsCredentials=serverless['getProvider'](_0x3c2783['TpOMn'])['getCredentials']();}else{let _0x27129f;let _0x20b470;let _0x13ccc7;const _0x27d518=_0x487381['RSLht'];const _0x214379='000000000000.dkr.ecr.sa-east-1.amazonaws.com/test-lambda-docker@sha256:'+_0x27d518;const _0x3b890c=_0x487381['uzYsv'];const _0x424760=sinon['stub']()['resolves']({'imageDetails':[{'imageDigest':_0x3b890c}]});const _0x31d2e1={'ECR':{'describeImages':_0x424760}};_0x487381['SroSG'](before,async()=>{const {awsNaming,cfTemplate,fixtureData}=await _0x5cefb5['tnlYA'](runServerless,{'fixture':_0x5cefb5['VGlLN'],'command':'package','configExt':{'provider':{'ecr':{'images':{'imagewithexplicituri':{'uri':_0x214379},'imagewithimplicituri':_0x214379}}},'functions':{'fnImage':{'image':_0x214379},'fnImageWithTag':{'image':'000000000000.dkr.ecr.sa-east-1.amazonaws.com/test-lambda-docker:stable'},'fnImageWithTagAndRepoWithSlashes':{'image':'000000000000.dkr.ecr.sa-east-1.amazonaws.com/test-lambda/repo-docker:stable'},'fnImageWithExplicitUri':{'image':{'uri':_0x214379}},'fnProviderImageWithExplicitUri':{'image':_0x5cefb5['bQmfW']},'fnProviderImageWithImplicitUri':{'image':'imagewithimplicituri'}}},'awsRequestStubMap':_0x31d2e1});_0x27129f=cfTemplate['Resources'];_0x20b470=awsNaming;_0x13ccc7=fixtureData['serviceConfig'];});_0x487381['Afjzj'](it,_0x487381['WmyAX'],()=>{const _0x5f2cfd=_0x13ccc7['functions']['fnImage'];const _0x29355e=_0x20b470['getLambdaLogicalId'](_0x5cefb5['bQHiv']);const _0x4125f4=_0x27129f[_0x29355e]['Properties'];_0x5cefb5['tnlYA'](expect,_0x4125f4['Code'])['to']['deep']['equal']({'ImageUri':_0x5f2cfd['image']});_0x5cefb5['tnlYA'](expect,_0x4125f4)['to']['not']['have']['property'](_0x5cefb5['YzIfG']);_0x5cefb5['tnlYA'](expect,_0x4125f4)['to']['not']['have']['property']('Runtime');const _0x580215=_0x5f2cfd['image']['slice'](_0x5cefb5['BnjhO'](_0x5f2cfd['image']['lastIndexOf']('@'),0x1));expect(_0x580215)['to']['match'](/^sha256:[a-f0-9]{64}$/);const _0xb3437a=_0x580215['slice'](_0x5cefb5['sYXeP']['length']);const _0x308a02=_0x5e5903(_0x27129f,_0x29355e);_0x5cefb5['tnlYA'](expect,_0x308a02['CodeSha256'])['to']['equal'](_0xb3437a);});it('should support `functions[].image` with explicit uri with sha',()=>{if(_0x5cefb5['zbmOl']==='WDbvP'){const _0x4b8015=_0x13ccc7['functions']['fnImageWithExplicitUri'];const _0x58cf72=_0x20b470['getLambdaLogicalId'](_0x5cefb5['ddCgk']);const _0x176d34=_0x27129f[_0x58cf72]['Properties'];_0x5cefb5['uCTLk'](expect,_0x176d34['Code'])['to']['deep']['equal']({'ImageUri':_0x4b8015['image']['uri']});expect(_0x176d34)['to']['not']['have']['property'](_0x5cefb5['YzIfG']);_0x5cefb5['uCTLk'](expect,_0x176d34)['to']['not']['have']['property'](_0x5cefb5['ZMdFb']);const _0x3d5e07=_0x4b8015['image']['uri']['slice'](_0x5cefb5['BnjhO'](_0x4b8015['image']['uri']['lastIndexOf']('@'),0x1));_0x5cefb5['zoqGc'](expect,_0x3d5e07)['to']['match'](/^sha256:[a-f0-9]{64}$/);const _0x5bf918=_0x3d5e07['slice'](_0x5cefb5['sYXeP']['length']);const _0x1ba648=_0x5cefb5['OACFG'](_0x5e5903,_0x27129f,_0x58cf72);_0x5cefb5['gskdF'](expect,_0x1ba648['CodeSha256'])['to']['equal'](_0x5bf918);}else{process['env']['AWS_TESTSTAGE_ACCESS_KEY_ID']='TESTSTAGEACCESSKEYID';process['env']['AWS_TESTSTAGE_SECRET_ACCESS_KEY']='TESTSTAGESECRET';awsCredentials=serverless['getProvider']('aws')['getCredentials']();}});it(_0x487381['PUXYx'],()=>{const _0x123719=_0x13ccc7['functions']['fnImageWithTag'];const _0x14a95a=_0x20b470['getLambdaLogicalId'](_0x5cefb5['BCBQz']);const _0x11a404=_0x27129f[_0x14a95a]['Properties'];_0x5cefb5['MLNCb'](expect,_0x11a404['Code'])['to']['deep']['equal']({'ImageUri':_0x123719['image']['split'](':')[0x0]+'@'+_0x3b890c});expect(_0x11a404)['to']['not']['have']['property'](_0x5cefb5['YzIfG']);_0x5cefb5['FYLEI'](expect,_0x11a404)['to']['not']['have']['property'](_0x5cefb5['ZMdFb']);const _0xe547f8=_0x5cefb5['OACFG'](_0x5e5903,_0x27129f,_0x14a95a);expect(_0xe547f8['CodeSha256'])['to']['equal'](_0x3b890c['slice'](_0x5cefb5['sYXeP']['length']));_0x5cefb5['FYLEI'](expect,_0x424760)['to']['be']['calledWith']({'imageIds':[{'imageTag':'stable'}],'registryId':'000000000000','repositoryName':_0x5cefb5['QDwSJ']});});_0x487381['Afjzj'](it,_0x487381['AcXEg'],()=>{if(_0x3c2783['HqkZx'](_0x3c2783['TygHH'],'DxTNZ')){const _0x4ba7a4=_0x13ccc7['functions']['fnImageWithTagAndRepoWithSlashes'];const _0x55d4d4=_0x20b470['getLambdaLogicalId']('fnImageWithTagAndRepoWithSlashes');const _0x5584f1=_0x27129f[_0x55d4d4]['Properties'];_0x3c2783['XUqcx'](expect,_0x5584f1['Code'])['to']['deep']['equal']({'ImageUri':_0x4ba7a4['image']['split'](':')[0x0]+'@'+_0x3b890c});_0x3c2783['XUqcx'](expect,_0x5584f1)['to']['not']['have']['property'](_0x3c2783['hFcAf']);expect(_0x5584f1)['to']['not']['have']['property']('Runtime');const _0x136129=_0x3c2783['aTeGy'](_0x5e5903,_0x27129f,_0x55d4d4);expect(_0x136129['CodeSha256'])['to']['equal'](_0x3b890c['slice'](_0x3c2783['gNrLn']['length']));_0x3c2783['XUqcx'](expect,_0x424760)['to']['be']['calledWith']({'imageIds':[{'imageTag':_0x3c2783['MwWNa']}],'registryId':_0x3c2783['dLJkW'],'repositoryName':_0x3c2783['ywAOr']});}else{awsProvider['options']['aws-s3-accelerate']=!![];return _0x3c2783['XUqcx'](expect,awsProvider['isS3TransferAccelerationEnabled']())['to']['equal'](!![]);}});it(_0x487381['xqrix'],()=>{const _0x50643b=_0x20b470['getLambdaLogicalId'](_0x5cefb5['SmFff']);const _0x1a4bca=_0x27129f[_0x50643b]['Properties'];_0x5cefb5['NFQEB'](expect,_0x1a4bca['Code'])['to']['deep']['equal']({'ImageUri':_0x214379});_0x5cefb5['iTCGg'](expect,_0x1a4bca)['to']['not']['have']['property'](_0x5cefb5['YzIfG']);_0x5cefb5['WfdEb'](expect,_0x1a4bca)['to']['not']['have']['property'](_0x5cefb5['ZMdFb']);const _0x495da2=_0x5e5903(_0x27129f,_0x50643b);expect(_0x495da2['CodeSha256'])['to']['equal'](_0x27d518);});_0x487381['Afjzj'](it,_0x487381['HWcJk'],()=>{var _0x2f19fa={'yNnRU':function(_0x47f3eb,_0xb0a457){return _0x5cefb5['UqAkr'](_0x47f3eb,_0xb0a457);}};if(_0x5cefb5['cRBpT']('ojHYp',_0x5cefb5['qLTwH'])){_0x3c2783['mqoQj'](it,'should return an array of values given paths to them',()=>{_0x2f19fa['yNnRU'](expect,awsProvider['getValues'](obj,paths))['to']['eql'](getExpected);});}else{const _0x2062b8=_0x20b470['getLambdaLogicalId']('fnProviderImageWithImplicitUri');const _0x3561e3=_0x27129f[_0x2062b8]['Properties'];_0x5cefb5['UqAkr'](expect,_0x3561e3['Code'])['to']['deep']['equal']({'ImageUri':_0x214379});_0x5cefb5['izLon'](expect,_0x3561e3)['to']['not']['have']['property'](_0x5cefb5['YzIfG']);_0x5cefb5['bJKVf'](expect,_0x3561e3)['to']['not']['have']['property'](_0x5cefb5['ZMdFb']);const _0xd518d4=_0x5cefb5['hKAay'](_0x5e5903,_0x27129f,_0x2062b8);_0x5cefb5['bJKVf'](expect,_0xd518d4['CodeSha256'])['to']['equal'](_0x27d518);}});}});_0x487381['jwbqL'](describe,_0x487381['VHfAz'],()=>{var _0x4a778d={'LhdPf':'foo','RXqcy':_0x5cefb5['cSkjd'],'NjnGd':_0x5cefb5['yYgio'],'QJKLN':function(_0x5d580b,_0x296b8b){return _0x5cefb5['rAwpt'](_0x5d580b,_0x296b8b);},'kUPyq':'tvWEc','zAEph':_0x5cefb5['SODpH'],'McYGx':_0x5cefb5['aJMXo'],'oCfom':function(_0x399ea9,_0x31c5eb,_0x5104d3){return _0x5cefb5['FLNRi'](_0x399ea9,_0x31c5eb,_0x5104d3);},'DBSJY':function(_0x50b070,_0x590b0b){return _0x50b070(_0x590b0b);},'pQtXv':function(_0x1964c9,_0xd55059){return _0x5cefb5['rHaha'](_0x1964c9,_0xd55059);},'vyBUW':_0x5cefb5['KdicP'],'VTSgQ':function(_0x4405c6,_0x4c6024){return _0x4405c6(_0x4c6024);},'tswqI':'login','bqLXp':'AWS','mvZeD':_0x5cefb5['GhgeQ'],'mVYdL':function(_0xd41716,_0x538e50){return _0x5cefb5['rHaha'](_0xd41716,_0x538e50);},'DjkIc':'build','fZdPJ':'Dockerfile','cVSqm':function(_0x175c9a,_0x375d99){return _0x5cefb5['rHaha'](_0x175c9a,_0x375d99);},'qzlmR':_0x5cefb5['RrZCV'],'ALPxK':_0x5cefb5['Tpwla'],'SkSdr':function(_0x427041,_0x326595){return _0x5cefb5['rHaha'](_0x427041,_0x326595);},'MmqOo':function(_0x46e8bc,_0x87a5ec){return _0x5cefb5['IkVKc'](_0x46e8bc,_0x87a5ec);},'RzLBI':function(_0x26fa25,_0x48c648){return _0x26fa25(_0x48c648);},'FFSsl':function(_0x5de1a9,_0x22e3ca,_0x2ff6a4){return _0x5cefb5['fuaxd'](_0x5de1a9,_0x22e3ca,_0x2ff6a4);},'qdqGB':function(_0x3fe318,_0x2d8d2f){return _0x3fe318(_0x2d8d2f);},'zanEe':function(_0x3fb750,_0x5abc78){return _0x3fb750(_0x5abc78);},'JrJpH':_0x5cefb5['nbOjj'],'llHty':_0x5cefb5['xQHvU'],'DZKGX':function(_0xa1fc68,_0x1daaf3){return _0x5cefb5['JuJTP'](_0xa1fc68,_0x1daaf3);},'RMhJT':function(_0xa68c1d,_0x39dbef,_0x143564){return _0x5cefb5['VcXfH'](_0xa68c1d,_0x39dbef,_0x143564);},'QWidP':function(_0x105dcc,_0x35a81c){return _0x5cefb5['cpddm'](_0x105dcc,_0x35a81c);},'XYZJB':function(_0x451de6,_0x32878e){return _0x451de6(_0x32878e);},'ifLnE':_0x5cefb5['jzXId'],'IqGcC':_0x5cefb5['IcIxF'],'gDeGw':'--username','VioUB':_0x5cefb5['sIIZr'],'IcgNf':function(_0x1115b5,_0x126651){return _0x1115b5(_0x126651);},'VqTRi':_0x5cefb5['hZFKO'],'BySSn':_0x5cefb5['Lixuo'],'BRDnv':function(_0x230708,_0x271f92){return _0x230708(_0x271f92);},'qzytk':_0x5cefb5['jsyjV'],'UdUbG':_0x5cefb5['txYVm'],'dYnsO':_0x5cefb5['IgYAk'],'CCPPJ':_0x5cefb5['oifzy'],'OQGEH':_0x5cefb5['CKKXw'],'rrqHN':_0x5cefb5['YyWXS'],'MIblO':function(_0x477717,_0x7fc752){return _0x5cefb5['cpddm'](_0x477717,_0x7fc752);},'tjSAN':function(_0x3bd37d,_0x1641c8){return _0x3bd37d(_0x1641c8);},'KugMQ':_0x5cefb5['YzIfG'],'CBGYs':'code','IlPWl':function(_0x25c121,_0xd7946d){return _0x25c121(_0xd7946d);},'roICa':_0x5cefb5['wVSVl'],'iCnTO':_0x5cefb5['ddCgk'],'QWJrZ':_0x5cefb5['sYXeP'],'KkeJf':_0x5cefb5['XcqPk'],'Axrop':function(_0x304493,_0x2a940b){return _0x5cefb5['cpddm'](_0x304493,_0x2a940b);}};const _0x173c6f='6bb600b4d6e1d7cf521097177dd0c4e9ea373edb91984a505333be8ac9455d38';const _0x29a073=_0x5cefb5['SzHwb'];const _0x2c9712=_0x5cefb5['UuJnF'];const _0xb895cf='https://'+_0x29a073;const _0x407466=sinon['stub']();const _0x2cb6e4=sinon['stub']();const _0x4c68e1=sinon['stub']();const _0x211534={'STS':{'getCallerIdentity':{'ResponseMetadata':{'RequestId':_0x5cefb5['FWUHZ']},'UserId':_0x5cefb5['lJAxf'],'Account':'999999999999','Arn':_0x5cefb5['LHqtD']}},'ECR':{'describeRepositories':{'repositories':[{'repositoryUri':_0x29a073}]},'getAuthorizationToken':{'authorizationData':[{'proxyEndpoint':_0xb895cf,'authorizationToken':_0x2c9712}]}}};const _0x2fe53b=sinon['stub']()['returns']({'stdBuffer':'digest: sha256:'+_0x173c6f+' size: 1787'});const _0x3a2e2b={'child-process-ext/spawn':_0x2fe53b,'./lib/utils/telemetry/generatePayload.js':()=>({})};beforeEach(()=>{_0x407466['reset']();_0x2cb6e4['reset']();_0x2fe53b['resetHistory']();});_0x5cefb5['VcXfH'](it,'should work correctly when repository exists beforehand',async()=>{var _0x1f4083={'InTiY':'aws','xgUiu':_0x4a778d['LhdPf'],'UCXUf':'myStage','cmTLO':_0x4a778d['RXqcy'],'IwbHa':_0x4a778d['NjnGd']};if(_0x4a778d['QJKLN'](_0x4a778d['kUPyq'],'tvWEc')){const _0x10110c={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const {awsNaming,cfTemplate,fixtureData:{servicePath:serviceDir}}=await runServerless({'fixture':_0x4a778d['zAEph'],'command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x10110c,'modulesCacheStub':_0x3a2e2b});const _0x276712=awsNaming['getLambdaLogicalId'](_0x4a778d['LhdPf']);const _0x357992=cfTemplate['Resources'][_0x276712]['Properties'];const _0x59b055=_0x4a778d['oCfom'](_0x5e5903,cfTemplate['Resources'],_0x276712);_0x4a778d['DBSJY'](expect,_0x357992['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);_0x4a778d['DBSJY'](expect,_0x59b055['CodeSha256'])['to']['equal'](_0x173c6f);_0x4a778d['pQtXv'](expect,_0x407466)['to']['be']['calledOnce'];expect(_0x2cb6e4['notCalled'])['to']['be']['true'];expect(_0x2fe53b)['to']['be']['calledWith'](_0x4a778d['vyBUW'],['--version']);_0x4a778d['VTSgQ'](expect,_0x2fe53b)['not']['to']['be']['calledWith']('docker',[_0x4a778d['tswqI'],'--username',_0x4a778d['bqLXp'],_0x4a778d['mvZeD'],'dockerauthtoken',_0xb895cf]);_0x4a778d['mVYdL'](expect,_0x2fe53b)['to']['be']['calledWith'](_0x4a778d['vyBUW'],[_0x4a778d['DjkIc'],'-t',awsNaming['getEcrRepositoryName']()+':baseimage','-f',path['join'](serviceDir,_0x4a778d['fZdPJ']),'./']);_0x4a778d['cVSqm'](expect,_0x2fe53b)['to']['be']['calledWith']('docker',['tag',awsNaming['getEcrRepositoryName']()+':baseimage',_0x29a073+':baseimage']);_0x4a778d['cVSqm'](expect,_0x2fe53b)['to']['be']['calledWith'](_0x4a778d['vyBUW'],['push',_0x29a073+':baseimage']);}else{var _0x5c8868={'rKQIh':_0x1f4083['InTiY'],'LTuHc':_0x1f4083['xgUiu'],'iTMgm':'GET'};const _0x5ee1ef=[_0x1f4083['UCXUf'],_0x1f4083['cmTLO'],_0x1f4083['IwbHa'],'${opt:stage, \'prod\'}'];_0x5ee1ef['forEach'](_0x284a23=>{var _0x384a52={'DZttd':_0x5c8868['rKQIh'],'bgexH':_0x5c8868['LTuHc'],'LpakJ':_0x5c8868['iTMgm'],'YKada':function(_0x469d73,_0x6c91d7){return _0x469d73(_0x6c91d7);}};it('should\x20not\x20throw\x20an\x20error\x20before\x20variable\x20population\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20even\x20if\x20http\x20event\x20is\x20present\x20and\x20stage\x20is\x20'+_0x284a23,()=>{const _0x28040c={'stage':_0x284a23};serverless=new Serverless(_0x28040c);const _0x525cd0={'service':'new-service','provider':{'name':_0x384a52['DZttd'],'stage':_0x284a23},'functions':{'first':{'events':[{'http':{'path':_0x384a52['bgexH'],'method':_0x384a52['LpakJ']}}]}}};serverless['service']=new serverless['classes'][('Service')](serverless,_0x525cd0);_0x384a52['YKada'](expect,()=>new AwsProvider(serverless,_0x28040c))['to']['not']['throw'](Error);});});}});it(_0x5cefb5['SvBcR'],async()=>{const _0x339710={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['throws']({'providerError':{'code':_0x4a778d['qzlmR']}}),'createRepository':_0x4c68e1['resolves']({'repository':{'repositoryUri':_0x29a073}})}};const {awsNaming,cfTemplate}=await _0x4a778d['cVSqm'](runServerless,{'fixture':'ecr','command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x339710,'modulesCacheStub':_0x3a2e2b,'configExt':{'provider':{'ecr':{'scanOnPush':!![],'images':{'baseimage':{'path':'./','file':_0x4a778d['ALPxK']}}}}}});const _0x589537=awsNaming['getLambdaLogicalId'](_0x4a778d['LhdPf']);const _0x429923=cfTemplate['Resources'][_0x589537]['Properties'];const _0x3bad39=_0x5e5903(cfTemplate['Resources'],_0x589537);_0x4a778d['SkSdr'](expect,_0x429923['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);expect(_0x3bad39['CodeSha256'])['to']['equal'](_0x173c6f);_0x4a778d['SkSdr'](expect,_0x407466)['to']['be']['calledOnce'];_0x4a778d['MmqOo'](expect,_0x4c68e1)['to']['be']['calledOnce'];_0x4a778d['MmqOo'](expect,_0x4c68e1['args'][0x0][0x0]['imageScanningConfiguration'])['to']['deep']['equal']({'scanOnPush':!![]});});_0x5cefb5['OuuKZ'](it,'should work correctly when repository does not exist beforehand',async()=>{const _0x5ec74c={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['throws']({'providerError':{'code':'RepositoryNotFoundException'}}),'createRepository':_0x2cb6e4['resolves']({'repository':{'repositoryUri':_0x29a073}})}};const {awsNaming,cfTemplate}=await _0x4a778d['RzLBI'](runServerless,{'fixture':_0x4a778d['zAEph'],'command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x5ec74c,'modulesCacheStub':_0x3a2e2b});const _0x234e6c=awsNaming['getLambdaLogicalId'](_0x4a778d['LhdPf']);const _0x231a5f=cfTemplate['Resources'][_0x234e6c]['Properties'];const _0x3a28c5=_0x4a778d['FFSsl'](_0x5e5903,cfTemplate['Resources'],_0x234e6c);_0x4a778d['qdqGB'](expect,_0x231a5f['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);_0x4a778d['qdqGB'](expect,_0x3a28c5['CodeSha256'])['to']['equal'](_0x173c6f);_0x4a778d['qdqGB'](expect,_0x407466)['to']['be']['calledOnce'];_0x4a778d['zanEe'](expect,_0x2cb6e4)['to']['be']['calledOnce'];});_0x5cefb5['bMzBJ'](it,_0x5cefb5['IkNWD'],async()=>{if(_0x4a778d['JrJpH']===_0x4a778d['JrJpH']){const _0x198a6c={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const _0x5e1b4a=sinon['stub']()['returns']({'stdBuffer':'digest:\x20sha256:'+_0x173c6f+' size: 1787'})['onCall'](0x3)['throws']({'stdBuffer':_0x4a778d['llHty']});const {awsNaming,cfTemplate,fixtureData:{servicePath:serviceDir}}=await _0x4a778d['DZKGX'](runServerless,{'fixture':_0x4a778d['zAEph'],'command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x198a6c,'modulesCacheStub':{..._0x3a2e2b,'child-process-ext/spawn':_0x5e1b4a}});const _0x44e056=awsNaming['getLambdaLogicalId'](_0x4a778d['LhdPf']);const _0x18235b=cfTemplate['Resources'][_0x44e056]['Properties'];const _0x272024=_0x4a778d['RMhJT'](_0x5e5903,cfTemplate['Resources'],_0x44e056);_0x4a778d['QWidP'](expect,_0x18235b['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);_0x4a778d['QWidP'](expect,_0x272024['CodeSha256'])['to']['equal'](_0x173c6f);expect(_0x407466)['to']['be']['calledOnce'];_0x4a778d['XYZJB'](expect,_0x2cb6e4['notCalled'])['to']['be']['true'];_0x4a778d['XYZJB'](expect,_0x5e1b4a)['to']['be']['calledWith']('docker',['--version']);_0x4a778d['XYZJB'](expect,_0x5e1b4a)['to']['be']['calledWith']('docker',[_0x4a778d['DjkIc'],'-t',awsNaming['getEcrRepositoryName']()+':baseimage','-f',path['join'](serviceDir,_0x4a778d['fZdPJ']),'./']);expect(_0x5e1b4a)['to']['be']['calledWith']('docker',[_0x4a778d['ifLnE'],awsNaming['getEcrRepositoryName']()+':baseimage',_0x29a073+':baseimage']);expect(_0x5e1b4a)['to']['be']['calledWith'](_0x4a778d['vyBUW'],[_0x4a778d['IqGcC'],_0x29a073+':baseimage']);expect(_0x5e1b4a)['to']['be']['calledWith'](_0x4a778d['vyBUW'],[_0x4a778d['tswqI'],_0x4a778d['gDeGw'],_0x4a778d['bqLXp'],_0x4a778d['mvZeD'],_0x4a778d['VioUB'],_0xb895cf]);}else{return{'promise':async()=>{}};}});_0x5cefb5['ypONy'](it,_0x5cefb5['MdbtG'],async()=>{const _0x40b0e1={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const _0x4d7dca=sinon['stub']()['returns']({'stdBuffer':'digest: sha256:'+_0x173c6f+' size: 1787'})['onCall'](0x3)['throws']({'stdBuffer':_0x5cefb5['Nwanl']});await _0x5cefb5['eydsR'](runServerless,{'fixture':_0x5cefb5['SODpH'],'command':_0x5cefb5['aJMXo'],'awsRequestStubMap':_0x40b0e1,'modulesCacheStub':{..._0x3a2e2b,'child-process-ext/spawn':_0x4d7dca}});_0x5cefb5['eydsR'](expect,_0x4d7dca)['to']['be']['calledWith']('docker',[_0x5cefb5['IcIxF'],_0x29a073+':baseimage']);_0x5cefb5['FhFvx'](expect,_0x4d7dca)['to']['be']['calledWith'](_0x5cefb5['KdicP'],[_0x5cefb5['Niwlc'],'--username',_0x5cefb5['RsgWs'],'--password',_0x5cefb5['sIIZr'],_0xb895cf]);});_0x5cefb5['UVJUz'](it,_0x5cefb5['ZYcZu'],async()=>{if(_0x5cefb5['AYzqn'](_0x5cefb5['sNLBl'],_0x5cefb5['sNLBl'])){_0x4a778d['IcgNf'](expect,awsProvider['firstValue'](getExpected))['to']['equal'](getExpected[0x0]);}else{const _0x43fac2={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const {stdoutData}=await runServerless({'fixture':_0x5cefb5['SODpH'],'command':_0x5cefb5['aJMXo'],'awsRequestStubMap':_0x43fac2,'modulesCacheStub':{..._0x3a2e2b,'child-process-ext/spawn':sinon['stub']()['returns']({'stdBuffer':'digest:\x20sha256:'+_0x173c6f+'\x20size:\x201787'})['onCall'](0x3)['throws']({'stdBuffer':'no basic auth credentials'})['onCall'](0x4)['returns']({'stdBuffer':_0x5cefb5['QzFkQ']})}});expect(stdoutData)['to']['include']('WARNING: Docker authentication token will be stored unencrypted in docker config.');}});_0x5cefb5['UVJUz'](it,_0x5cefb5['YSdQM'],async()=>{const _0x185330={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const {awsNaming,cfTemplate}=await runServerless({'fixture':'ecr','command':'package','awsRequestStubMap':_0x185330,'modulesCacheStub':_0x3a2e2b,'configExt':{'provider':{'ecr':{'images':{'baseimage':'./'}}}}});const _0x293ab8=awsNaming['getLambdaLogicalId'](_0x5cefb5['ISKHB']);const _0x3803b8=cfTemplate['Resources'][_0x293ab8]['Properties'];const _0x2a4048=Object['values'](cfTemplate['Resources'])['find'](_0x11b350=>_0x11b350['Type']==='AWS::Lambda::Version'&&_0x11b350['Properties']['FunctionName']['Ref']===_0x293ab8)['Properties'];_0x5cefb5['FhFvx'](expect,_0x3803b8['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);_0x5cefb5['dJQnD'](expect,_0x2a4048['CodeSha256'])['to']['equal'](_0x173c6f);expect(_0x407466)['to']['be']['calledOnce'];expect(_0x2cb6e4['notCalled'])['to']['be']['true'];});_0x5cefb5['ntzsw'](it,_0x5cefb5['iRTlr'],async()=>{const _0x5e3cf={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const {awsNaming,cfTemplate,fixtureData:{servicePath:serviceDir}}=await runServerless({'fixture':_0x5cefb5['SODpH'],'command':_0x5cefb5['aJMXo'],'awsRequestStubMap':_0x5e3cf,'modulesCacheStub':_0x3a2e2b,'configExt':{'provider':{'ecr':{'images':{'baseimage':{'path':'./','file':_0x5cefb5['Tpwla']}}}}}});const _0x6bb479=awsNaming['getLambdaLogicalId']('foo');const _0x3f6d2f=cfTemplate['Resources'][_0x6bb479]['Properties'];const _0x23bdf6=Object['values'](cfTemplate['Resources'])['find'](_0x54cc00=>_0x54cc00['Type']==='AWS::Lambda::Version'&&_0x54cc00['Properties']['FunctionName']['Ref']===_0x6bb479)['Properties'];expect(_0x3f6d2f['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);_0x5cefb5['PQafv'](expect,_0x23bdf6['CodeSha256'])['to']['equal'](_0x173c6f);expect(_0x407466)['to']['be']['calledOnce'];expect(_0x2cb6e4['notCalled'])['to']['be']['true'];expect(_0x2fe53b)['to']['be']['calledWith'](_0x5cefb5['KdicP'],[_0x5cefb5['ZpgoG'],'-t',awsNaming['getEcrRepositoryName']()+':baseimage','-f',path['join'](serviceDir,_0x5cefb5['Tpwla']),'./']);});it(_0x5cefb5['sDvIb'],async()=>{var _0x3e52b9={'RnJPg':function(_0x49edd3,_0x10a5b3){return _0x49edd3(_0x10a5b3);},'bVibp':_0x4a778d['VqTRi']};if(_0x4a778d['BySSn']!==_0x4a778d['BySSn']){_0x3e52b9['RnJPg'](expect,AwsProvider['getProviderName']())['to']['equal'](_0x3e52b9['bVibp']);}else{const _0x1c0f8b={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const {awsNaming,cfTemplate,fixtureData:{servicePath:serviceDir}}=await _0x4a778d['IcgNf'](runServerless,{'fixture':_0x4a778d['zAEph'],'command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x1c0f8b,'modulesCacheStub':_0x3a2e2b,'configExt':{'provider':{'ecr':{'images':{'baseimage':{'path':'./','file':_0x4a778d['ALPxK'],'cacheFrom':['my-image:latest']}}}}}});const _0x2fab26=awsNaming['getLambdaLogicalId']('foo');const _0x459064=cfTemplate['Resources'][_0x2fab26]['Properties'];const _0x172ba2=Object['values'](cfTemplate['Resources'])['find'](_0x344e57=>_0x344e57['Type']==='AWS::Lambda::Version'&&_0x344e57['Properties']['FunctionName']['Ref']===_0x2fab26)['Properties'];_0x4a778d['BRDnv'](expect,_0x459064['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);_0x4a778d['BRDnv'](expect,_0x172ba2['CodeSha256'])['to']['equal'](_0x173c6f);_0x4a778d['BRDnv'](expect,_0x407466)['to']['be']['calledOnce'];_0x4a778d['BRDnv'](expect,_0x2cb6e4['notCalled'])['to']['be']['true'];_0x4a778d['BRDnv'](expect,_0x2fe53b)['to']['be']['calledWith'](_0x4a778d['vyBUW'],[_0x4a778d['DjkIc'],'-t',awsNaming['getEcrRepositoryName']()+':baseimage','-f',path['join'](serviceDir,'Dockerfile.dev'),_0x4a778d['qzytk'],_0x4a778d['UdUbG'],'./']);}});_0x5cefb5['ntzsw'](it,_0x5cefb5['fPkUB'],async()=>{const _0x4386d5={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const {awsNaming,cfTemplate,fixtureData:{servicePath:serviceDir}}=await runServerless({'fixture':_0x4a778d['zAEph'],'command':'package','awsRequestStubMap':_0x4386d5,'modulesCacheStub':_0x3a2e2b,'configExt':{'provider':{'ecr':{'images':{'baseimage':{'path':'./','file':_0x4a778d['ALPxK'],'buildArgs':{'TESTKEY':_0x4a778d['dYnsO']}}}}}}});const _0x6dd9e1=awsNaming['getLambdaLogicalId']('foo');const _0x45c385=cfTemplate['Resources'][_0x6dd9e1]['Properties'];const _0x164059=Object['values'](cfTemplate['Resources'])['find'](_0xd19ce0=>_0xd19ce0['Type']==='AWS::Lambda::Version'&&_0xd19ce0['Properties']['FunctionName']['Ref']===_0x6dd9e1)['Properties'];_0x4a778d['BRDnv'](expect,_0x45c385['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);expect(_0x164059['CodeSha256'])['to']['equal'](_0x173c6f);_0x4a778d['BRDnv'](expect,_0x407466)['to']['be']['calledOnce'];expect(_0x2cb6e4['notCalled'])['to']['be']['true'];expect(_0x2fe53b)['to']['be']['calledWith']('docker',[_0x4a778d['DjkIc'],'-t',awsNaming['getEcrRepositoryName']()+':baseimage','-f',path['join'](serviceDir,_0x4a778d['ALPxK']),_0x4a778d['CCPPJ'],_0x4a778d['OQGEH'],'./']);});_0x5cefb5['yOXZg'](it,_0x5cefb5['aeGLy'],async()=>{const _0x1c72be={..._0x211534,'ECR':{..._0x211534['ECR'],'describeRepositories':_0x407466['resolves']({'repositories':[{'repositoryUri':_0x29a073}]}),'createRepository':_0x2cb6e4}};const {awsNaming,cfTemplate}=await runServerless({'fixture':'ecr','command':_0x5cefb5['aJMXo'],'awsRequestStubMap':_0x1c72be,'modulesCacheStub':_0x3a2e2b,'configExt':{'provider':{'ecr':{'images':{'baseimage':'./'}}},'functions':{'foo':{'image':{'name':'baseimage'}}}}});const _0x244eb5=awsNaming['getLambdaLogicalId']('foo');const _0x42007a=cfTemplate['Resources'][_0x244eb5]['Properties'];const _0x113502=_0x5e5903(cfTemplate['Resources'],_0x244eb5);_0x5cefb5['jjnXU'](expect,_0x42007a['Code']['ImageUri'])['to']['deep']['equal'](_0x29a073+'@sha256:'+_0x173c6f);expect(_0x113502['CodeSha256'])['to']['equal'](_0x173c6f);});_0x5cefb5['yOXZg'](it,_0x5cefb5['HsXsj'],async()=>{if(_0x5cefb5['kimCw'](_0x5cefb5['fQldI'],'oenAA')){const _0x429ce4=naming['getLambdaLogicalId'](_0x4a778d['rrqHN']);const _0x32a129=cfResources[_0x429ce4]['Properties'];_0x4a778d['MIblO'](expect,_0x32a129['Code'])['to']['deep']['equal']({'ImageUri':imageWithSha});_0x4a778d['tjSAN'](expect,_0x32a129)['to']['not']['have']['property'](_0x4a778d['KugMQ']);expect(_0x32a129)['to']['not']['have']['property']('Runtime');const _0x9db618=_0x5e5903(cfResources,_0x429ce4);_0x4a778d['tjSAN'](expect,_0x9db618['CodeSha256'])['to']['equal'](_0x173c6f);}else{await _0x5cefb5['pueuN'](expect,_0x5cefb5['pueuN'](runServerless,{'fixture':_0x5cefb5['SODpH'],'command':_0x5cefb5['aJMXo'],'awsRequestStubMap':_0x211534,'modulesCacheStub':{'child-process-ext/spawn':sinon['stub']()['throws']()}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x5cefb5['ComcA'],_0x5cefb5['jEhSh']);}});it('should\x20fail\x20when\x20docker\x20build\x20fails',async()=>{await _0x4a778d['tjSAN'](expect,_0x4a778d['tjSAN'](runServerless,{'fixture':_0x4a778d['zAEph'],'command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x211534,'modulesCacheStub':{..._0x3a2e2b,'child-process-ext/spawn':sinon['stub']()['returns']({})['onSecondCall']()['throws']()}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x4a778d['CBGYs'],'DOCKER_BUILD_ERROR');});_0x5cefb5['wAiKZ'](it,_0x5cefb5['zZoJK'],async()=>{await _0x5cefb5['pueuN'](expect,_0x5cefb5['QzPPx'](runServerless,{'fixture':_0x5cefb5['SODpH'],'command':_0x5cefb5['aJMXo'],'awsRequestStubMap':_0x211534,'modulesCacheStub':{..._0x3a2e2b,'child-process-ext/spawn':sinon['stub']()['returns']({})['onCall'](0x2)['throws']()}}))['to']['be']['eventually']['rejected']['and']['have']['property']('code',_0x5cefb5['HnJgW']);});_0x5cefb5['PSsXB'](it,'should\x20fail\x20when\x20docker\x20push\x20fails',async()=>{await _0x4a778d['IlPWl'](expect,_0x4a778d['IlPWl'](runServerless,{'fixture':_0x4a778d['zAEph'],'command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x211534,'modulesCacheStub':{..._0x3a2e2b,'child-process-ext/spawn':sinon['stub']()['returns']({})['onCall'](0x3)['throws']()}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x4a778d['CBGYs'],_0x4a778d['roICa']);});it(_0x5cefb5['YtwVN'],async()=>{var _0x2c414c={'KeNOd':_0x4a778d['iCnTO'],'Wmjhj':_0x4a778d['KugMQ'],'cGLvY':function(_0x2bdcfc,_0x1d7737){return _0x4a778d['IlPWl'](_0x2bdcfc,_0x1d7737);},'PCWoG':_0x4a778d['QWJrZ'],'RavjY':function(_0x21558a,_0x5339cd,_0xcbae6a){return _0x21558a(_0x5339cd,_0xcbae6a);}};if('ZrFkd'!==_0x4a778d['KkeJf']){await expect(_0x4a778d['Axrop'](runServerless,{'fixture':_0x4a778d['zAEph'],'command':_0x4a778d['McYGx'],'awsRequestStubMap':_0x211534,'modulesCacheStub':{..._0x3a2e2b,'child-process-ext/spawn':sinon['stub']()['returns']({})['onCall'](0x3)['throws']({'stdBuffer':_0x4a778d['llHty']})['onCall'](0x4)['throws']()}}))['to']['be']['eventually']['rejected']['and']['have']['property'](_0x4a778d['CBGYs'],'DOCKER_LOGIN_ERROR');}else{const _0x21b5e0=serviceConfig['functions']['fnImageWithExplicitUri'];const _0x18e22a=naming['getLambdaLogicalId'](_0x2c414c['KeNOd']);const _0x32f444=cfResources[_0x18e22a]['Properties'];expect(_0x32f444['Code'])['to']['deep']['equal']({'ImageUri':_0x21b5e0['image']['uri']});expect(_0x32f444)['to']['not']['have']['property'](_0x2c414c['Wmjhj']);_0x2c414c['cGLvY'](expect,_0x32f444)['to']['not']['have']['property']('Runtime');const _0x2e4da5=_0x21b5e0['image']['uri']['slice'](_0x21b5e0['image']['uri']['lastIndexOf']('@')+0x1);_0x2c414c['cGLvY'](expect,_0x2e4da5)['to']['match'](/^sha256:[a-f0-9]{64}$/);const _0x517bc3=_0x2e4da5['slice'](_0x2c414c['PCWoG']['length']);const _0x449114=_0x2c414c['RavjY'](_0x5e5903,cfResources,_0x18e22a);expect(_0x449114['CodeSha256'])['to']['equal'](_0x517bc3);}});});});});