import{onInitialClientRender,onRouteUpdate}from'../gatsby-browser';import{Minimatch}from'minimatch';import{getLCP,getFID,getCLS}from'web-vitals/base';jest['mock']('web-vitals/base',()=>{var XlOrFq={'nTMKa':function(callee,param1){return callee(param1);},'mBimx':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'gmwhA':function(callee,param1){return callee(param1);},'ObfaP':function(callee,param1,param2,param3){return callee(param1,param2,param3);}};function createEntry(type,id,value){return{'name':type,'id':id,'value':value};}return{'getLCP':jest['fn'](report=>{XlOrFq['nTMKa'](report,XlOrFq['mBimx'](createEntry,'LCP','1','300'));}),'getFID':jest['fn'](report=>{XlOrFq['gmwhA'](report,XlOrFq['mBimx'](createEntry,'FID','2','150'));}),'getCLS':jest['fn'](report=>{report(XlOrFq['ObfaP'](createEntry,'CLS','3','0.10'));})};});describe('gatsby-plugin-google-analytics',()=>{var DxWPTf={'WWnWu':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'ShMwG':function(x,y){return x===y;},'ZTPKK':'SoQpd','ecNDX':function(callee,param1,param2){return callee(param1,param2);},'xiFjz':'Rygan','twaIl':function(x,y){return x===y;},'fLlQp':'xOBPo','TurSj':function(callee,param1){return callee(param1);},'YQzzC':function(x,y){return x!==y;},'whkOK':'UyGcu','ZlCUU':'uvDpv','KvChl':'rOSCA','aNqIM':'1|4|6|3|2|0|5','bnBbM':'NDESY','NLTBM':function(callee,param1,param2){return callee(param1,param2);},'SXmPY':'vNbNG'};DxWPTf['NLTBM'](describe,'gatsby-browser',()=>{var xixVtb={'VDnSj':function(callee,param1,param2,param3){return DxWPTf['WWnWu'](callee,param1,param2,param3);},'QkJRB':function(x,y){return DxWPTf['ShMwG'](x,y);},'dGHKb':DxWPTf['ZTPKK'],'nNxwe':function(callee,param1,param2){return DxWPTf['ecNDX'](callee,param1,param2);},'sahzj':DxWPTf['xiFjz'],'szhAH':function(x,y){return DxWPTf['twaIl'](x,y);},'wQuHG':DxWPTf['fLlQp'],'LZZTa':function(callee,param1){return DxWPTf['TurSj'](callee,param1);},'fdyWf':function(x,y){return DxWPTf['YQzzC'](x,y);},'RPgYK':DxWPTf['whkOK'],'mVRuO':function(callee,param1,param2){return callee(param1,param2);},'orUMk':DxWPTf['ZlCUU'],'fOLhi':DxWPTf['KvChl'],'eJAQO':DxWPTf['aNqIM'],'OGyjU':function(x,y){return DxWPTf['YQzzC'](x,y);},'bYqEU':DxWPTf['bnBbM'],'MzIfR':'iZFwC','AgYzs':function(callee,param1,param2){return DxWPTf['NLTBM'](callee,param1,param2);}};if(DxWPTf['YQzzC'](DxWPTf['SXmPY'],'gwdJz')){describe('onRouteUpdate',()=>{var VmDlWy={'TdClG':'lbTYM','KfuZI':xixVtb['orUMk'],'GZWea':function(x,y){return xixVtb['fdyWf'](x,y);},'rQhQw':xixVtb['fOLhi'],'NoEmD':function(callee,param1){return callee(param1);},'LDfSi':function(callee,param1){return xixVtb['LZZTa'](callee,param1);},'KDQOx':function(callee,param1){return xixVtb['LZZTa'](callee,param1);},'ggOqW':xixVtb['eJAQO'],'qyRee':function(callee,param1){return xixVtb['LZZTa'](callee,param1);},'OEAtk':function(callee,param1,param2){return xixVtb['mVRuO'](callee,param1,param2);},'AHTMO':function(callee,param1){return callee(param1);},'YKqFJ':function(callee,param1){return callee(param1);},'AMUBZ':function(callee,param1){return callee(param1);}};if(xixVtb['OGyjU'](xixVtb['bYqEU'],xixVtb['MzIfR'])){xixVtb['AgYzs'](describe,'in non-production env',()=>{var LmRGGI={'GBoid':function(callee,param1){return callee(param1);},'BkPjs':function(callee,param1,param2,param3){return xixVtb['VDnSj'](callee,param1,param2,param3);},'ivPkl':function(x,y){return xixVtb['QkJRB'](x,y);},'wahdP':xixVtb['dGHKb']};xixVtb['nNxwe'](it,'does\x20not\x20send\x20page\x20view',()=>{if(LmRGGI['ivPkl'](LmRGGI['wahdP'],'SoQpd')){window['ga']=jest['fn']();onRouteUpdate({});expect(window['ga'])['not']['toHaveBeenCalled']();}else{LmRGGI['GBoid'](report,LmRGGI['BkPjs'](createEntry,'CLS','3','0.10'));}});});describe('in production env',()=>{var subnxV={'hYGvG':function(callee,param1){return callee(param1);},'FPbDH':function(x,y){return x!==y;},'NCzZJ':xixVtb['sahzj'],'wSbkn':function(callee,param1){return callee(param1);},'PrKKD':function(callee,param1,param2,param3){return callee(param1,param2,param3);},'evaVA':function(callee,param1,param2){return xixVtb['nNxwe'](callee,param1,param2);},'NxMNz':function(x,y){return xixVtb['szhAH'](x,y);},'bByDt':xixVtb['wQuHG'],'JXIoA':'xUTsx','ijeOQ':'FRkEs','tazhz':function(callee,param1){return xixVtb['LZZTa'](callee,param1);},'kigIp':function(callee,param1){return xixVtb['LZZTa'](callee,param1);},'ePloF':function(callee,param1,param2){return xixVtb['nNxwe'](callee,param1,param2);}};if(xixVtb['fdyWf'](xixVtb['RPgYK'],'NpLEw')){let env;beforeAll(()=>{env=process['env']['NODE_ENV'];process['env']['NODE_ENV']='production';});afterAll(()=>{process['env']['NODE_ENV']=env;});xixVtb['LZZTa'](beforeEach,()=>{var oBGQqw={'acQJP':function(callee,param1){return subnxV['hYGvG'](callee,param1);},'IwGja':function(callee,param1,param2,param3){return callee(param1,param2,param3);}};if(subnxV['FPbDH']('YYjWW',subnxV['NCzZJ'])){jest['useFakeTimers']();jest['clearAllMocks']();window['ga']=jest['fn']();}else{oBGQqw['acQJP'](report,oBGQqw['IwGja'](createEntry,'FID','2','150'));}});xixVtb['LZZTa'](afterEach,()=>{if(VmDlWy['TdClG']===VmDlWy['KfuZI']){subnxV['wSbkn'](report,subnxV['PrKKD'](createEntry,'LCP','1','300'));}else{jest['useRealTimers']();}});xixVtb['nNxwe'](it,'does not send page view when ga is undefined',()=>{var iQuoAa={'QMxVy':function(callee,param1){return callee(param1);}};if(VmDlWy['GZWea'](VmDlWy['rQhQw'],'rOSCA')){subnxV['evaVA'](it,'does not send page view',()=>{window['ga']=jest['fn']();onRouteUpdate({});iQuoAa['QMxVy'](expect,window['ga'])['not']['toHaveBeenCalled']();});}else{delete window['ga'];VmDlWy['NoEmD'](onRouteUpdate,{});jest['runAllTimers']();VmDlWy['LDfSi'](expect,setTimeout)['not']['toHaveBeenCalled']();}});it('does\x20not\x20send\x20page\x20view\x20when\x20path\x20is\x20excluded',()=>{const mm=new Minimatch('/test-pages/**');window['excludeGAPaths']=[mm['makeRe']()];onRouteUpdate({'location':{'pathname':'/test-pages/example'}});jest['runAllTimers']();VmDlWy['KDQOx'](expect,window['ga'])['not']['toHaveBeenCalled']();});xixVtb['nNxwe'](it,'sends page view',()=>{VmDlWy['KDQOx'](onRouteUpdate,{});jest['runAllTimers']();VmDlWy['KDQOx'](expect,window['ga'])['toHaveBeenCalledTimes'](0x2);});xixVtb['nNxwe'](it,'uses setTimeout with a minimum delay of 32ms',()=>{onRouteUpdate({});jest['runAllTimers']();expect(setTimeout)['toHaveBeenCalledWith'](expect['any'](Function),0x20);VmDlWy['KDQOx'](expect,window['ga'])['toHaveBeenCalledTimes'](0x2);});xixVtb['mVRuO'](it,'uses setTimeout with the provided pageTransitionDelay value',()=>{var adJSKb={'jxyNr':function(callee,param1,param2){return subnxV['evaVA'](callee,param1,param2);}};if(subnxV['NxMNz']('bdXej',subnxV['bByDt'])){adJSKb['jxyNr'](onRouteUpdate,{},{'pageTransitionDelay':0x3e8});jest['runAllTimers']();expect(setTimeout)['toHaveBeenCalledWith'](expect['any'](Function),0x3e8);expect(window['ga'])['toHaveBeenCalledTimes'](0x2);}else{subnxV['evaVA'](onRouteUpdate,{},{'pageTransitionDelay':0x3e8});jest['runAllTimers']();subnxV['wSbkn'](expect,setTimeout)['toHaveBeenCalledWith'](expect['any'](Function),0x3e8);subnxV['wSbkn'](expect,window['ga'])['toHaveBeenCalledTimes'](0x2);}});xixVtb['mVRuO'](it,'sends core web vitals when enabled',async()=>{if(subnxV['JXIoA']!==subnxV['ijeOQ']){var QBzxpe='7|2|0|1|5|3|4|6'['split']('|'),nDLKXx=0x0;while(!![]){switch(QBzxpe[nDLKXx++]){case'0':await Promise['resolve']();continue;case'1':jest['runAllTimers']();continue;case'2':await Promise['resolve']();continue;case'3':subnxV['tazhz'](expect,window['ga'])['toBeCalledWith']('send','event',expect['objectContaining']({'eventAction':'LCP','eventCategory':'Web Vitals','eventLabel':'1','eventValue':0x12c}));continue;case'4':expect(window['ga'])['toBeCalledWith']('send','event',expect['objectContaining']({'eventAction':'FID','eventCategory':'Web Vitals','eventLabel':'2','eventValue':0x96}));continue;case'5':expect(window['ga'])['toBeCalledTimes'](0x3);continue;case'6':subnxV['kigIp'](expect,window['ga'])['toBeCalledWith']('send','event',expect['objectContaining']({'eventAction':'CLS','eventCategory':'Web\x20Vitals','eventLabel':'3','eventValue':0x64}));continue;case'7':subnxV['ePloF'](onInitialClientRender,{},{'enableWebVitalsTracking':!![]});continue;}break;}}else{env=process['env']['NODE_ENV'];process['env']['NODE_ENV']='production';}});it('sends nothing when web vitals tracking is disabled',async()=>{var ReGzBV=VmDlWy['ggOqW']['split']('|'),YPfMpK=0x0;while(!![]){switch(ReGzBV[YPfMpK++]){case'0':VmDlWy['qyRee'](expect,getFID)['not']['toBeCalled']();continue;case'1':VmDlWy['OEAtk'](onInitialClientRender,{},{'enableWebVitalsTracking':![]});continue;case'2':VmDlWy['qyRee'](expect,getLCP)['not']['toBeCalled']();continue;case'3':jest['runAllTimers']();continue;case'4':await Promise['resolve']();continue;case'5':VmDlWy['qyRee'](expect,getCLS)['not']['toBeCalled']();continue;case'6':await Promise['resolve']();continue;}break;}});}else{const _0x8b45f7=new Minimatch('/test-pages/**');window['excludeGAPaths']=[_0x8b45f7['makeRe']()];VmDlWy['AHTMO'](onRouteUpdate,{'location':{'pathname':'/test-pages/example'}});jest['runAllTimers']();VmDlWy['YKqFJ'](expect,window['ga'])['not']['toHaveBeenCalled']();}});}else{VmDlWy['AMUBZ'](onRouteUpdate,{});jest['runAllTimers']();VmDlWy['AMUBZ'](expect,window['ga'])['toHaveBeenCalledTimes'](0x2);}});}else{return{'name':type,'id':id,'value':value};}});});