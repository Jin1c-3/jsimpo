'use strict';const {expect}=require('chai');const log=require('log')['get']('serverless:test');const fixtures=require('../../fixtures/programmatic');const {createKinesisStream,deleteKinesisStream,putKinesisRecord}=require('../../utils/kinesis');const {putDynamoDbItem}=require('../../utils/dynamodb');const {confirmCloudWatchLogs}=require('../../utils/misc');const {deployService,removeService}=require('../../utils/integration');describe('AWS - Stream Integration Test',function(){var _0x1a04cf={'rhRdh':'stream','Cuqtu':function(_0x25cbe6,_0x189bdf){return _0x25cbe6(_0x189bdf);},'YpUfi':function(_0x7c6bbc,_0x34cccf){return _0x7c6bbc!==_0x34cccf;},'XJXgB':'RFhPF','VEMfr':function(_0x142999,_0x2f74da){return _0x142999(_0x2f74da);},'rnTrU':'Deleting Kinesis stream','adImt':function(_0x46f15a,_0x2fdd72,_0x328eca){return _0x46f15a(_0x2fdd72,_0x328eca);},'TaKrQ':function(_0x559ae7,_0xefd9c6){return _0x559ae7(_0xefd9c6);},'hUvcF':'streamDynamoDb','nIjpu':'streamKinesis','xZnNm':function(_0x4066b3,_0x5c59eb,_0x349fdf,_0x3efb45){return _0x4066b3(_0x5c59eb,_0x349fdf,_0x3efb45);},'BMDYN':'should invoke on kinesis messages from the trim horizon','QmiSP':'uNzIg','Gfiwd':function(_0x148c9a,_0x1fb533){return _0x148c9a(_0x1fb533);},'NeNIW':'message','hDjog':'should invoke on dynamodb messages from the latest position','DINYd':function(_0x192314,_0x322186){return _0x192314*_0x322186;},'oBLPn':'Hello\x20from\x20the\x20Kinesis\x20horizon!','BZXhv':'dev','yRkyB':function(_0x2aaafd,_0x590f7e){return _0x2aaafd(_0x590f7e);},'KbisN':function(_0xbb0e23,_0x3ad600,_0x2a43cb){return _0xbb0e23(_0x3ad600,_0x2a43cb);},'GIFcT':'DynamoDB Streams'};this['timeout'](_0x1a04cf['DINYd'](0x3e8,0x3c)*0x64);let _0x175eb9;let _0x15db66;let _0x226f2f;let _0x521d2c;const _0x363f65=_0x1a04cf['oBLPn'];const _0x3735f2=_0x1a04cf['BZXhv'];_0x1a04cf['Gfiwd'](before,async()=>{const _0x35152a=await fixtures['setup'](_0x1a04cf['rhRdh']);({servicePath:_0x15db66}=_0x35152a);const _0x3dd78d=_0x35152a['serviceConfig']['service'];_0x226f2f=_0x3dd78d+'-kinesis';_0x521d2c=_0x3dd78d+'-table';_0x175eb9=_0x3dd78d+'-'+_0x3735f2;log['notice']('Creating Kinesis stream "'+_0x226f2f+'"...');return _0x1a04cf['Cuqtu'](createKinesisStream,_0x226f2f)['then'](()=>putKinesisRecord(_0x226f2f,_0x363f65))['then'](()=>deployService(_0x15db66));});_0x1a04cf['yRkyB'](after,async()=>{if(_0x1a04cf['YpUfi']('tXMGD',_0x1a04cf['XJXgB'])){await _0x1a04cf['VEMfr'](removeService,_0x15db66);log['notice'](_0x1a04cf['rnTrU']);return deleteKinesisStream(_0x226f2f);}else{item['hello']='from dynamo!'+Math['random']()['toString'](0x24)['slice'](0x2);return putDynamoDbItem(_0x521d2c,item);}});_0x1a04cf['adImt'](describe,'Kinesis Streams',()=>{var _0x5f561a={'jLnAC':function(_0x373216,_0x571a2a,_0xad10b0){return _0x1a04cf['adImt'](_0x373216,_0x571a2a,_0xad10b0);},'UOGue':'should invoke on dynamodb messages from the latest position','FGjEH':function(_0x4f7e94,_0x5e4867){return _0x1a04cf['TaKrQ'](_0x4f7e94,_0x5e4867);},'Qcfti':function(_0x371486,_0x3f21e1){return _0x371486(_0x3f21e1);},'jGETu':_0x1a04cf['hUvcF'],'OXuCF':function(_0x548319,_0x414232){return _0x1a04cf['YpUfi'](_0x548319,_0x414232);},'CchBA':_0x1a04cf['nIjpu'],'EfrPf':'Hello from Kinesis!','gsdwY':function(_0x40a264,_0x3f18aa,_0x87b21d,_0xe01a8f){return _0x1a04cf['xZnNm'](_0x40a264,_0x3f18aa,_0x87b21d,_0xe01a8f);}};_0x1a04cf['adImt'](it,_0x1a04cf['BMDYN'],()=>{var _0x30443a={'zYKnD':function(_0x2d5669,_0x3544e6,_0x31a100){return _0x5f561a['jLnAC'](_0x2d5669,_0x3544e6,_0x31a100);},'VgTmy':function(_0x4b59f4,_0xa7aadd){return _0x5f561a['Qcfti'](_0x4b59f4,_0xa7aadd);},'JQkEW':_0x5f561a['jGETu'],'FuxWt':'message','EESdE':function(_0x19525b,_0x1e8716,_0xee5336,_0x5b2056){return _0x19525b(_0x1e8716,_0xee5336,_0x5b2056);}};if(_0x5f561a['OXuCF']('pmWXd','pmWXd')){_0x5f561a['jLnAC'](it,_0x5f561a['UOGue'],()=>{var _0x1872f1={'yoHAY':function(_0x238e69,_0xe3f20e,_0x34e28f){return _0x30443a['zYKnD'](_0x238e69,_0xe3f20e,_0x34e28f);},'cBaAA':function(_0x9e7af8,_0x3c8f0f){return _0x30443a['VgTmy'](_0x9e7af8,_0x3c8f0f);},'wjcvY':function(_0x568c73,_0x1a0134){return _0x568c73(_0x1a0134);}};const _0x209ff7=_0x30443a['JQkEW'];const _0x140b2c={'id':_0x30443a['FuxWt']};return _0x30443a['EESdE'](confirmCloudWatchLogs,'/aws/lambda/'+_0x175eb9+'-'+_0x209ff7,()=>{_0x140b2c['hello']='from dynamo!'+Math['random']()['toString'](0x24)['slice'](0x2);return _0x1872f1['yoHAY'](putDynamoDbItem,_0x521d2c,_0x140b2c);},{'checkIsComplete':_0x51a2f2=>_0x51a2f2['reduce']((_0x12262a,_0x390d3f)=>_0x12262a+_0x390d3f['message'],'')['includes'](_0x209ff7)})['then'](_0x259fca=>{const _0x2c5c56=_0x259fca['reduce']((_0x3fcbe6,_0x226faa)=>_0x3fcbe6+_0x226faa['message'],'');_0x1872f1['cBaAA'](expect,_0x2c5c56)['to']['include'](_0x209ff7);_0x1872f1['cBaAA'](expect,_0x2c5c56)['to']['include']('INSERT');_0x1872f1['wjcvY'](expect,_0x2c5c56)['to']['include'](_0x140b2c['id']);});});}else{const _0x45afa4=_0x5f561a['CchBA'];const _0x202fba=_0x5f561a['EfrPf'];return _0x5f561a['gsdwY'](confirmCloudWatchLogs,'/aws/lambda/'+_0x175eb9+'-'+_0x45afa4,()=>putKinesisRecord(_0x226f2f,_0x202fba),{'checkIsComplete':_0x4929af=>_0x4929af['reduce']((_0x3ffac9,_0x3599b4)=>_0x3ffac9+_0x3599b4['message'],'')['includes'](_0x202fba)})['then'](_0x3ed161=>{const _0x58ac5e=_0x3ed161['reduce']((_0x56de34,_0x4a1a96)=>_0x56de34+_0x4a1a96['message'],'');_0x5f561a['FGjEH'](expect,_0x58ac5e)['to']['include'](_0x45afa4);_0x5f561a['FGjEH'](expect,_0x58ac5e)['to']['include'](_0x202fba);expect(_0x58ac5e)['to']['include'](_0x363f65);});}});});_0x1a04cf['KbisN'](describe,_0x1a04cf['GIFcT'],()=>{var _0x59f91b={'uZFDL':function(_0x27dd79,_0x5cd805){return _0x27dd79(_0x5cd805);},'QRwgm':_0x1a04cf['nIjpu'],'ZvYxw':function(_0x57db44,_0x2863fe,_0x2531c6,_0x483277){return _0x1a04cf['xZnNm'](_0x57db44,_0x2863fe,_0x2531c6,_0x483277);},'FaaiM':function(_0x4b8a25,_0x3b3689){return _0x4b8a25!==_0x3b3689;},'CAIKn':_0x1a04cf['QmiSP'],'tQkbU':function(_0x4657fe,_0x2e1590){return _0x1a04cf['Gfiwd'](_0x4657fe,_0x2e1590);},'ikFFi':_0x1a04cf['NeNIW']};_0x1a04cf['adImt'](it,_0x1a04cf['hDjog'],()=>{var _0x456e1a={'QNOoN':function(_0xd16d80,_0x25bd52){return _0x59f91b['tQkbU'](_0xd16d80,_0x25bd52);},'vQpsy':'INSERT'};const _0x5d91ac='streamDynamoDb';const _0x29d4={'id':_0x59f91b['ikFFi']};return _0x59f91b['ZvYxw'](confirmCloudWatchLogs,'/aws/lambda/'+_0x175eb9+'-'+_0x5d91ac,()=>{var _0x190fe5={'adzrq':function(_0x248e24,_0x69d99c){return _0x59f91b['uZFDL'](_0x248e24,_0x69d99c);},'mxCVu':_0x59f91b['QRwgm'],'sscpk':function(_0x4cd152,_0xc1bf1f,_0x4dddf1,_0x39eefe){return _0x59f91b['ZvYxw'](_0x4cd152,_0xc1bf1f,_0x4dddf1,_0x39eefe);}};if(_0x59f91b['FaaiM'](_0x59f91b['CAIKn'],_0x59f91b['CAIKn'])){var _0x29a9d1={'mSuLp':function(_0x22b9e3,_0x51abad){return _0x190fe5['adzrq'](_0x22b9e3,_0x51abad);}};const _0x352e84=_0x190fe5['mxCVu'];const _0xa4c145='Hello\x20from\x20Kinesis!';return _0x190fe5['sscpk'](confirmCloudWatchLogs,'/aws/lambda/'+_0x175eb9+'-'+_0x352e84,()=>putKinesisRecord(_0x226f2f,_0xa4c145),{'checkIsComplete':_0x12ba1a=>_0x12ba1a['reduce']((_0x58995b,_0x635fe)=>_0x58995b+_0x635fe['message'],'')['includes'](_0xa4c145)})['then'](_0x5cee4b=>{const _0x4c1558=_0x5cee4b['reduce']((_0x46e227,_0x2aa81d)=>_0x46e227+_0x2aa81d['message'],'');_0x29a9d1['mSuLp'](expect,_0x4c1558)['to']['include'](_0x352e84);_0x29a9d1['mSuLp'](expect,_0x4c1558)['to']['include'](_0xa4c145);expect(_0x4c1558)['to']['include'](_0x363f65);});}else{_0x29d4['hello']='from dynamo!'+Math['random']()['toString'](0x24)['slice'](0x2);return putDynamoDbItem(_0x521d2c,_0x29d4);}},{'checkIsComplete':_0x12e7f5=>_0x12e7f5['reduce']((_0x4d6536,_0x3d0586)=>_0x4d6536+_0x3d0586['message'],'')['includes'](_0x5d91ac)})['then'](_0x34036f=>{const _0x3ef2a8=_0x34036f['reduce']((_0x651074,_0xe22c20)=>_0x651074+_0xe22c20['message'],'');_0x456e1a['QNOoN'](expect,_0x3ef2a8)['to']['include'](_0x5d91ac);expect(_0x3ef2a8)['to']['include'](_0x456e1a['vQpsy']);expect(_0x3ef2a8)['to']['include'](_0x29d4['id']);});});});});