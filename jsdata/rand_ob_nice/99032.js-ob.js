'use strict';
const _0x11bc = ["open", "message", "should expose a websocket route that can reply to a message", "dev", "should expose an accessible websocket endpoint", "when using an existing websocket API", "Two-Way Setup", "Minimal Setup", "timeout", "LuqfC", "pGlQv", "iigKt", "setup", "YCNkw", "serviceConfig", "service", "vgKyk", "swsIE", "LTpEi", "pdJQo", "describeStacks", "Stacks", "Outputs", "find", "ServiceEndpointWebsocket", "OutputValue", "gBeYl", "serverless", "hZCSK", "stMIr", "wKveJ", "efMJL", "PyoRA", 
"tCoZI", "DfTYZ", "LLuxN", "close", "debug", "Sending message to 'hello' route", "stringify", "OAPmw", "zaHgi", "error", "elSMz", "Myvnp", "Received WebSocket message: ", "equal", "Hello, serverless", "dqYlk", "qvZsI", "jcGFU", "2|4|5|0|3|1", "Deleting external websocket API...", "xOkXu", "skip", "yBzRU", "anHGE", "match", "Stop propagation", "yenHK", "dYOGH", "MzBzi", "/aws/websocket/", "iHcHp", "send", "jQpRz", "then", "length", "uZTDU", "cGpfg", "ZmUkE", "mjNVn", "SQKyM", "eeHuj", "-ext-api", 
"ApiId", "xtFNc", "pDlVQ", "lxISt", "iuEjR", "vdVIu", "RAjZm", "WUGfV", "BxEZy", "1oNgrBb", "59031XfhiDX", "1017MrBjUs", "209OqdcFA", "10qmzOsn", "3581RGGsHB", "1ZVjcpr", "102247veYlLI", "108844TRDxOK", "93136EUlGDZ", "1rqHhgU", "187217AEDwnU", "chai", "@serverless/test/aws-request", "log", "get", "serverless:test", "timers-ext/promise/sleep", "../../fixtures/programmatic", "../../utils/misc", "../../utils/websocket", "AWS - API Gateway Websocket Integration Test", "websocket", "CloudFormation"];
const _0x107c77 = _0x30c6;
(function(data, val) {
  const toMonths = _0x30c6;
  for (; !![];) {
    try {
      const nodeval = parseInt(toMonths(470)) * parseInt(toMonths(471)) + -parseInt(toMonths(472)) * -parseInt(toMonths(473)) + parseInt(toMonths(474)) * parseInt(toMonths(475)) + -parseInt(toMonths(476)) * parseInt(toMonths(477)) + -parseInt(toMonths(478)) + -parseInt(toMonths(479)) + -parseInt(toMonths(480)) * -parseInt(toMonths(481));
      if (nodeval === val) {
        break;
      } else {
        data["push"](data["shift"]());
      }
    } catch (_0x496aed) {
      data["push"](data["shift"]());
    }
  }
})(_0x11bc, -347486 * -1 + 295348 + -452450);
const WebSocket = require("ws");
const {
  expect : expect
} = require(_0x107c77(482));
const awsRequest = require(_0x107c77(483));
const log = require(_0x107c77(484))[_0x107c77(485)](_0x107c77(486));
const wait = require(_0x107c77(487));
const fixtures = require(_0x107c77(488));
const {
  confirmCloudWatchLogs : confirmCloudWatchLogs
} = require(_0x107c77(489));
const {
  deployService : deployService,
  removeService : removeService
} = require("../../utils/integration");
const {
  createApi : createApi,
  deleteApi : deleteApi,
  getRoutes : getRoutes,
  createStage : createStage,
  deleteStage : deleteStage
} = require(_0x107c77(490));
function _0x30c6(isBgroundImg, stgs) {
  return _0x30c6 = function(isBgroundImg, stgs) {
    isBgroundImg = isBgroundImg - (-9408 + -4348 + 14226);
    let _0x14840e = _0x11bc[isBgroundImg];
    return _0x14840e;
  }, _0x30c6(isBgroundImg, stgs);
}
describe(_0x107c77(491), function() {
  async function result() {
    const String = parseInt;
    const prefixes = await matches[String(512)](awsRequest, matches[String(513)], String(514), {
      "StackName" : name
    });
    const fragment = prefixes[String(515)][5 * -55 + -6824 + -31 * -229][String(516)][String(517)]((data) => {
      return data["OutputKey"] === String(518);
    })[String(519)];
    return fragment;
  }
  const parseInt = _0x107c77;
  const matches = {
    "YCNkw" : parseInt(492),
    "vgKyk" : function(saveNotifs, notifications) {
      return saveNotifs(notifications);
    },
    "swsIE" : function(saveNotifs, notifications) {
      return saveNotifs(notifications);
    },
    "LTpEi" : function(require, load, callback, id) {
      return require(load, callback, id);
    },
    "pdJQo" : parseInt(493),
    "hZCSK" : function(require, load, callback) {
      return require(load, callback);
    },
    "stMIr" : parseInt(494),
    "wKveJ" : parseInt(495),
    "efMJL" : function(saveNotifs) {
      return saveNotifs();
    },
    "PyoRA" : function(saveNotifs, notifications) {
      return saveNotifs(notifications);
    },
    "tCoZI" : function(require, load, callback) {
      return require(load, callback);
    },
    "kaNpk" : parseInt(496),
    "qvZsI" : "Unexpected message",
    "jcGFU" : "error",
    "gBeYl" : function(require, load, callback) {
      return require(load, callback);
    },
    "IMlCm" : function(saveNotifs) {
      return saveNotifs();
    },
    "iigKt" : function(saveNotifs, notifications) {
      return saveNotifs(notifications);
    },
    "pGlQv" : parseInt(497),
    "xOkXu" : parseInt(498),
    "ZmUkE" : parseInt(499),
    "LuqfC" : function(mmCoreSecondsDay, daysInterval) {
      return mmCoreSecondsDay * daysInterval;
    },
    "ijbaq" : parseInt(500),
    "dqYlk" : parseInt(501)
  };
  this[parseInt(502)](matches[parseInt(503)](-2627 * -1 + 1958 + -15 * 239, 1 * 3253 + -37 * -26 + -4155) * (-3859 + -24 * -257 + 11 * -209));
  let name;
  let locale;
  let relation;
  let authenticate;
  let _0x63fe43;
  const key = matches[parseInt(504)];
  matches[parseInt(505)](before, async() => {
    const rel2Mstr = parseInt;
    const same = await fixtures[rel2Mstr(506)](matches[rel2Mstr(507)]);
    return {
      servicePath : relation,
      updateConfig : authenticate
    } = same, locale = same[rel2Mstr(508)][rel2Mstr(509)], name = locale + "-" + key, matches[rel2Mstr(510)](deployService, relation);
  });
  matches[parseInt(505)](after, () => {
    const decodeURIComponent = parseInt;
    if (!_0x63fe43) {
      return null;
    }
    return matches[decodeURIComponent(511)](removeService, relation);
  });
  matches[parseInt(520)](describe, matches["ijbaq"], () => {
    const decodeURIComponent = parseInt;
    const callbacks = {
      "DfTYZ" : function(after, pages_back) {
        const parseInt = _0x30c6;
        return matches[parseInt(511)](after, pages_back);
      },
      "LLuxN" : decodeURIComponent(521),
      "KkPwu" : function(after, members, paramName) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(522)](after, members, paramName);
      },
      "elSMz" : matches[decodeURIComponent(523)],
      "dogCD" : matches[decodeURIComponent(524)],
      "JtcEz" : function(after) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(525)](after);
      }
    };
    let loadingTimeout;
    matches[decodeURIComponent(526)](after, () => {
      return clearTimeout(loadingTimeout);
    });
    matches[decodeURIComponent(527)](it, matches["kaNpk"], async() => {
      const wssurl = await callbacks["JtcEz"](result);
      return (new Promise((PL$16, cb) => {
        const gotoNewOfflinePage = _0x30c6;
        const zlib = {
          "Myvnp" : function(par1, par2) {
            const gotoNewOfflinePage = _0x30c6;
            return callbacks[gotoNewOfflinePage(528)](par1, par2);
          },
          "OAPmw" : callbacks[gotoNewOfflinePage(529)],
          "zaHgi" : function(par1, par2, par3) {
            return callbacks["KkPwu"](par1, par2, par3);
          }
        };
        const p = new WebSocket(wssurl);
        cb = ((buf) => {
          return (done) => {
            const makeTransactionID = gotoNewOfflinePage;
            zlib["Myvnp"](buf, done);
            try {
              p[makeTransactionID(530)]();
            } catch (_0x82f74d) {
            }
          };
        })(cb);
        const done = () => {
          const Number = gotoNewOfflinePage;
          log[Number(531)](Number(532));
          p["send"](JSON[Number(533)]({
            "action" : "hello",
            "name" : zlib[Number(534)]
          }));
          loadingTimeout = zlib[Number(535)](setTimeout, done, -2460 + -5268 + 8728);
        };
        p["on"](gotoNewOfflinePage(536), cb);
        p["on"](callbacks[gotoNewOfflinePage(537)], done);
        p["on"](gotoNewOfflinePage(530), PL$16);
        p["on"](callbacks["dogCD"], (type) => {
          const dwordAsString = gotoNewOfflinePage;
          _0x63fe43 = !![];
          zlib[dwordAsString(538)](clearTimeout, loadingTimeout);
          try {
            log[dwordAsString(531)](dwordAsString(539) + type);
            zlib[dwordAsString(538)](expect, type)["to"][dwordAsString(540)](dwordAsString(541));
          } finally {
            p["close"]();
          }
        });
      }))["finally"](() => {
        return clearTimeout(loadingTimeout);
      });
    });
  });
  matches[parseInt(520)](describe, matches[parseInt(542)], () => {
    const decodeURIComponent = parseInt;
    const zlib = {
      "anHGE" : function(after, pages_back) {
        const parseInt = _0x30c6;
        return matches[parseInt(526)](after, pages_back);
      },
      "yenHK" : matches[decodeURIComponent(543)],
      "tOCdV" : matches[decodeURIComponent(544)],
      "uZTDU" : matches[decodeURIComponent(524)],
      "GnKLn" : function(after, members, paramName) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(520)](after, members, paramName);
      },
      "yBzRU" : function(after) {
        return matches["IMlCm"](after);
      },
      "KkHWf" : decodeURIComponent(545),
      "iuEjR" : function(after, pages_back) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(526)](after, pages_back);
      },
      "vdVIu" : decodeURIComponent(546),
      "RAjZm" : function(after, pages_back) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(505)](after, pages_back);
      },
      "WUGfV" : function(require, load, callback) {
        return require(load, callback);
      },
      "QLfyv" : function(after, pages_back) {
        return matches["iigKt"](after, pages_back);
      },
      "mjNVn" : function(after, members, paramName) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(520)](after, members, paramName);
      },
      "SQKyM" : matches[decodeURIComponent(504)],
      "eeHuj" : function(saveNotifs, notifications) {
        return saveNotifs(notifications);
      },
      "uNZiA" : function(saveNotifs, notifications) {
        return saveNotifs(notifications);
      },
      "lxISt" : function(after, pages_back) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(505)](after, pages_back);
      },
      "BxEZy" : function(after, members, paramName) {
        const parseInt = decodeURIComponent;
        return matches[parseInt(520)](after, members, paramName);
      }
    };
    matches[decodeURIComponent(520)](it, matches[decodeURIComponent(547)], async function() {
      const levelFn = decodeURIComponent;
      const frontpageItems = {
        "MzBzi" : function(body, done, callback) {
          return zlib["GnKLn"](body, done, callback);
        }
      };
      if (!_0x63fe43) {
        this[levelFn(548)]();
      }
      const id = await zlib[levelFn(549)](result);
      return log[levelFn(531)]("WebSocket Server URL " + id), zlib[levelFn(550)](expect, id)["to"][levelFn(551)](/wss:\/\/.+\.execute-api\..+\.amazonaws\.com.+/), new Promise((PL$16, args) => {
        const wrap = levelFn;
        const ret = {
          "dYOGH" : function(body, done) {
            return zlib["anHGE"](body, done);
          },
          "iHcHp" : wrap(552),
          "jQpRz" : function(body, done) {
            const updateDevicesAfterDelay = wrap;
            return zlib[updateDevicesAfterDelay(550)](body, done);
          },
          "cGpfg" : zlib[wrap(553)]
        };
        const original = new WebSocket(id);
        let _0x479aed = ![];
        args = ((args) => {
          return (mmCoreSplitViewBlock) => {
            const camelToSnake = wrap;
            _0x479aed = !![];
            ret[camelToSnake(554)](args, mmCoreSplitViewBlock);
            try {
              original["close"]();
            } catch (_0x53d457) {
            }
          };
        })(args);
        original["on"](zlib["tOCdV"], args);
        original["on"](wrap(494), () => {
          const getBlocksDir = wrap;
          frontpageItems[getBlocksDir(555)](confirmCloudWatchLogs, getBlocksDir(556) + name, () => {
            const decodeURIComponent = getBlocksDir;
            if (_0x479aed) {
              throw new Error(ret[decodeURIComponent(557)]);
            }
            return original[decodeURIComponent(558)]("test message"), ret[decodeURIComponent(559)](wait, 3895 + -6 * 585 + -115 * -1);
          })[getBlocksDir(560)]((myPreferences) => {
            const getPreferenceKey = getBlocksDir;
            ret[getPreferenceKey(559)](expect, myPreferences[getPreferenceKey(561)] > 2776 + 2895 + -5671)["to"][getPreferenceKey(540)](!![]);
            original["close"]();
          }, args);
        });
        original["on"](wrap(530), PL$16);
        original["on"](zlib[wrap(562)], (message) => {
          const camelToSnake = wrap;
          log[camelToSnake(531)]("Unexpected WebSocket message", message);
          ret["jQpRz"](args, new Error(ret[camelToSnake(563)]));
        });
      });
    });
    matches["gBeYl"](describe, matches[decodeURIComponent(564)], () => {
      const updateDevicesAfterDelay = decodeURIComponent;
      const _related2 = {
        "zgzKL" : function(body, done) {
          return zlib["QLfyv"](body, done);
        },
        "xtFNc" : function(body, done, callback) {
          const gotoNewOfflinePage = _0x30c6;
          return zlib[gotoNewOfflinePage(565)](body, done, callback);
        },
        "xDMpl" : zlib[updateDevicesAfterDelay(566)],
        "pDlVQ" : function(body, done) {
          const gotoNewOfflinePage = updateDevicesAfterDelay;
          return zlib[gotoNewOfflinePage(567)](body, done);
        }
      };
      let syncFlushOpt;
      zlib["uNZiA"](before, async function() {
        const now = updateDevicesAfterDelay;
        if (!_0x63fe43) {
          this[now(548)]();
        }
        const relationName = key + "-" + locale + now(568);
        const rpm_traffic = await _related2["zgzKL"](createApi, relationName);
        return syncFlushOpt = rpm_traffic[now(569)], await _related2[now(570)](createStage, syncFlushOpt, _related2["xDMpl"]), await authenticate({
          "provider" : {
            "apiGateway" : {
              "websocketApiId" : syncFlushOpt
            }
          }
        }), _related2[now(571)](deployService, relation);
      });
      zlib[updateDevicesAfterDelay(572)](after, async() => {
        const levelFn = updateDevicesAfterDelay;
        const callbackVals = zlib["KkHWf"]["split"]("|");
        let callbackCount = -336 + -104 * -5 + -184;
        for (; !![];) {
          switch(callbackVals[callbackCount++]) {
            case "0":
              await zlib[levelFn(573)](deployService, relation);
              continue;
            case "1":
              await deleteApi(syncFlushOpt);
              continue;
            case "2":
              if (!_0x63fe43) {
                return;
              }
              continue;
            case "3":
              log[levelFn(531)](zlib[levelFn(574)]);
              continue;
            case "4":
              await zlib[levelFn(575)](authenticate, {
                "provider" : {
                  "apiGateway" : {
                    "websocketApiId" : null
                  }
                }
              });
              continue;
            case "5":
              await zlib[levelFn(576)](deleteStage, syncFlushOpt, "dev");
              continue;
          }
          break;
        }
      });
      zlib[updateDevicesAfterDelay(577)](it, "should add the routes to the referenced API", async() => {
        const edgeId = updateDevicesAfterDelay;
        const updatedEdgesById = await _related2[edgeId(571)](getRoutes, syncFlushOpt);
        _related2[edgeId(571)](expect, updatedEdgesById[edgeId(561)])["to"][edgeId(540)](-2718 + -4 * 135 + -466 * -7);
      });
    });
  });
});

