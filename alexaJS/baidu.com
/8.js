"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){
if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}(function(){var config={sample:{jsnotfound:.02,imgError:.02,jserror:.02},logServer:"https://sp1.baidu.com/5b1ZeDe5KgQFm2e88IuM_a/mwb2.gif"};var imgErrorLen=0
;function alwaysMonitor(info){if(bds.comm.alwaysMonitor==="1"){info.alwaysMonitor=1;return true}return false}var LocalCache=function(){function LocalCache(){_classCallCheck(this,LocalCache);_defineProperty(this,"lsName","pcSpyLocalCache");_defineProperty(this,"tmpList",[]);_defineProperty(this,"timer",null)}_createClass(LocalCache,[{key:"addLog",value:function addLog(info){var _this=this;var infoStr=JSON.stringify(info);this.tmpList.push(infoStr);if(this.timer){clearTimeout(this.timer)}
this.timer=setTimeout(function(){_this.save()},500)}},{key:"getData",value:function getData(cb){try{var storageStr=localStorage.getItem(this.lsName);if(storageStr){cb(storageStr)}else{cb("")}}catch(e){console.error(e);cb("")}}},{key:"save",value:function save(){var _this2=this;this.getData(function(str){var content=str+"\n"+_this2.tmpList.join("\n");try{localStorage.setItem(_this2.lsName,content)}catch(error){}})}}],[{key:"getInstance",value:function getInstance(){if(!this.instance){
this.instance=new LocalCache}return this.instance}}]);return LocalCache}();_defineProperty(LocalCache,"instance",void 0);function shouldSend(sample){if(!sample){return false}var hitCookie=document.cookie.indexOf("webbtest=1")>-1;return hitCookie||Math.random()<sample}function send(obj){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"except";var lid=bds.comm.qid||bds.comm.queryId;var time=Date.now();var spyCache=LocalCache.getInstance();spyCache.addLog({from:"result",
info:obj.info,lid:lid,group:obj.group,ts:time,url:location.href});if(!shouldSend(config.sample[obj.group])&&!alwaysMonitor(obj.info)){return""}var pid="1_87";if(bds.comm.ishome){pid="1_79"}var logUrl=config.logServer+"?pid="+pid+"&lid="+lid+"&ts="+time+"&type="+type+"&group="+obj.group+"&info="+encodeURIComponent(JSON.stringify(obj.info))+"&dim="+encodeURIComponent(JSON.stringify(obj.dim||{}));var img=new Image;img.src=logUrl;return logUrl}function filterError(msg,stack){if(stack.indexOf(
"chrome-extension://")>-1||stack.indexOf("moz-extension://")>-1){return false}return true}function jsError(event,info){var obj={info:info,dim:{},group:"jserror"};var error=event.error||{};var errorStack=error.stack||"";if(event.message&&filterError(event.message,errorStack)){obj.info.msg=event.message;obj.info.file=event.filename;obj.info.ln=event.lineno;obj.info.col=event.colno;obj.info.stack=errorStack.split("\n").slice(0,3).join("\n");send(obj)}}function getPathTo(element){
var _element$parentNode;if(element.id!==""){return'id("'.concat(element.id,'")')}if(element===document.body){return element.tagName}var ix=0;var siblings=(element===null||element===void 0?void 0:(_element$parentNode=element.parentNode)===null||_element$parentNode===void 0?void 0:_element$parentNode.childNodes)?element.parentNode.childNodes:[];for(var i=0;i<siblings.length;i++){var sibling=siblings[i];if(sibling===element){return getPathTo(sibling.parentNode)+"/"+element.tagName+"["+(ix+1)+"]"}
if(sibling.nodeType===1&&sibling.tagName===element.tagName){ix++}}return""}function getLocation(href){var ele=document.createElement("a");ele.href=href;return ele}function getUrlHost(url){var host=getLocation(url).hostname;if(!/\.baidu|bcebos|bdstatic|baidubce|bdimg\.com/.test(host)){return"other"}return host}function imgError(target,info){var imgSrc=target.getAttribute("src")||"";info.msg=imgSrc;info.errLen=++imgErrorLen;info.xpath=getPathTo(target);send({info:info,dim:{host:getUrlHost(imgSrc)
},group:"imgError"},"et_comm")}function sourceError(event,from){try{var obj={info:{},dim:{},group:""};var info=obj.info;var target=event.target;var dataConnection=navigator.connection||{};info.downlink=dataConnection.downlink;info.effectiveType=dataConnection.effectiveType;info.rtt=dataConnection.rtt;info.deviceMemory=navigator.deviceMemory||0;info.hardwareConcurrency=navigator.hardwareConcurrency||0;info.saveData=!!dataConnection.saveData;if(target&&target.nodeName&&target.nodeName.toLowerCase(
)==="img"){imgError(target,info);return}var localName=target.localName||"";var errorLink=target.src||"";if(localName&&localName==="script"){obj.group="jsnotfound";info.msg=errorLink;info.file=errorLink;send(obj);return}if(target===window||from==="onerror"){jsError(event,info)}}catch(e){}}window.addEventListener&&window.addEventListener("error",sourceError,true)})();