angular.module('500lines',[]).controller('Spreadsheet',function($scope,$timeout){$scope.Cols=[],$scope.Rows=[];makeRange($scope.Cols,'A','H');makeRange($scope.Rows,1,20);function makeRange(array,cur,end){while(cur<=end){array.push(cur);cur=(isNaN(cur)?String.fromCharCode(cur.charCodeAt()+1):cur+1)}}$scope.keydown=function(event,col,row){switch(event.which){case 38:case 40:case 13:$timeout(function(){var direction=(event.which===38)?-1:+1;var cell=document.querySelector('#'+col+(row+direction));if(cell){cell.focus()}})}};$scope.reset=function(){$scope.sheet={A1:1874,B1:'+',C1:2046,D1:'â‡’',E1:'=A1+C1'}};($scope.init=function(){$scope.sheet=angular.fromJson(localStorage.getItem(''));if(!$scope.sheet){$scope.reset()}$scope.worker=new Worker('worker.js')}).call();$scope.errs={},$scope.vals={};$scope.calc=function(){var json=angular.toJson($scope.sheet);var promise=$timeout(function(){$scope.worker.terminate();$scope.init();$scope.calc()},99);$scope.worker.onmessage=function(message){$timeout.cancel(promise);localStorage.setItem('',json);$timeout(function(){$scope.errs=message.data[0],$scope.vals=message.data[1]})};$scope.worker.postMessage($scope.sheet)};$scope.worker.onmessage=$scope.calc;$scope.worker.postMessage(null)});
